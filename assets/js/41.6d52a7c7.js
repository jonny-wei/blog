(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{339:function(s,t,a){"use strict";a.r(t);var r=a(6),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"积分任务与埋点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#积分任务与埋点"}},[s._v("#")]),s._v(" 积分任务与埋点")]),s._v(" "),t("p",[s._v("在数字营销和用户参与策略中，积分任务系统已成为提升用户活跃度和忠诚度的重要工具。本文探讨了积分任务与埋点技术之间的关联，并分析了如何通过有效的埋点策略来优化积分任务系统。文章首先介绍了积分任务系统的基本框架，包括积分的获取、消耗和用户激励机制。随后，深入讨论了埋点技术在积分任务系统中的作用，包括用户行为追踪、数据收集、用户体验优化、任务完成验证、个性化推荐、效果评估、防止欺诈、A/B测试以及成本控制等方面。")]),s._v(" "),t("h2",{attrs:{id:"积分任务基本框架"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#积分任务基本框架"}},[s._v("#")]),s._v(" 积分任务基本框架")]),s._v(" "),t("p",[t("img",{attrs:{src:"/blog/images/architecture/tracker1.png",alt:"tracker1"}})]),s._v(" "),t("ol",[t("li",[s._v("App 启动初初始化积分 SDK 并从服务端拉取积分任务的配置信息。")]),s._v(" "),t("li",[s._v("用户操作，调用积分 SDK 对用户行为数据进行匹配、过滤和去重，并将数据上报到服务器。")]),s._v(" "),t("li",[s._v("服务端接收到行为数据后，会进行任务记录，任务评估等，确定任务达标后自动发放对应积分，并将结果发送回积分 SDK。")]),s._v(" "),t("li",[s._v("积分 SDK 在接收到服务端的响应后，会根据配置通过组件（Popup、Snackbar等方式）展示奖励结果给用户。")]),s._v(" "),t("li",[s._v("用户可以选择手动领取积分奖励，或者系统将自动完成发放过程。")])]),s._v(" "),t("p",[s._v("上述的积分 SDK 离不开任务的埋点，埋点技术在积分任务系统中有不可或缺的作用。有了埋点，积分任务系统才能准确地记录用户的行为，并根据这些行为数据进行任务评估和积分发放。业务方可以优雅对接，不需要额外关心任务达成的判断，直接基于SDK透传埋点即可；新任务可以快速支持配置，业务方一次接入，后续零成本开发。")]),s._v(" "),t("h2",{attrs:{id:"埋点方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#埋点方案"}},[s._v("#")]),s._v(" 埋点方案")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("无痕埋点（全埋点）")])])]),s._v(" "),t("p",[s._v("前端页面通过设置监听器，拦截所有用户操作事件，并将其发送到后端数据采集平台。这些事件数据包括时间戳、用户ID、事件类型、事件属性等关键信息，全埋点是一种全量采集，无需开发人员干预的埋点方案，适用于运营阶段初期，产品功能相对简单的情况。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("优点")]),s._v("：自动采集所有用户行为数据，无需开发人员干预，节省人力、时间成本且灵活适应需求变化；覆盖所有用户交互动作，不会出现漏埋和误埋等现象。")]),s._v(" "),t("li",[t("strong",[s._v("缺点")]),s._v("：数据量大，数据存储、计算、分析成本高，同时给数据传输和服务器增加压；无法定制化埋点，无法采集到指定事件和业务属性，数据维度单一，业务数据准确性和价值不高；大量的数据上报可能影响端侧的性能。")]),s._v(" "),t("li",[t("strong",[s._v("使用场景")]),s._v("：业务场景简单，产品快速迭代需求比精细化分析优先级更高（只分析PV、UV）的场景。一般主流 App 会结合代码埋点等方式形成互补来满足不同场景的需求（代码埋点是不可以缺少的，全埋点是锦上添花）。")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("strong",[s._v("代码埋点")])])]),s._v(" "),t("p",[s._v("代码埋点是通过在业务代码中手动埋点来实现的，开发人员需要在业务代码中添加埋点代码，以便收集用户行为数据。代码埋点是侵入式的，需要工程师在每个需要埋点的位置上打点。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("优点")]),s._v("：触发方式灵活定义，高可定制化，满足特定业务目标；可以采集到指定事件和业务属性，数据维度丰富，业务数据准确性和价值高。")]),s._v(" "),t("li",[t("strong",[s._v("缺点")]),s._v("：需要开发人员手动埋点，工作量大，代码侵入太强，过于耦合业务代码，一次埋点的更改就要引起发版之类的操作。")]),s._v(" "),t("li",[t("strong",[s._v("适用场景")]),s._v("：适用于精细记录用户、业务定制化埋点的场景。适用于需要采集非点击、不可视行为，或者需要整合用户信息和行为附带属性信息的场景。")])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[s._v("可视化埋点")])])]),s._v(" "),t("p",[s._v("可视化埋点是通过可视化交互的手段，代替代码埋点，可以新建、编辑、修改埋点。在组件和页面的维度进行埋点的设计。将业务代码和埋点配置分离，允许非技术人员（如产品经理、运营人员等）直接在应用界面上定义和设置数据收集点，而无需编写代码，从服务端拉取配置，根据配置监听相关交互操作并采集上报。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("优点")]),s._v("：可视化圈定并选择埋点模块，开发量小节省研发人力；非研发人员也可进行埋点操作；埋点更改后可以立即生效，无需发版。")]),s._v(" "),t("li",[t("strong",[s._v("缺点")]),s._v("：可能无法覆盖所有用户行为，特别是那些不触发界面元素交互的行为；需要确保 SDK 与应用的兼容性，以及与后端分析平台的无缝对接，一旦对页面路径或模块名称等进行改动，埋点就会失效, 新增自定义事件比较困难；对于动态加载的内容，可视化埋点可能无法准确捕获数据。")]),s._v(" "),t("li",[t("strong",[s._v("适用场景")]),s._v("：适用于非技术人员希望快速实施埋点快速收集用户反馈的业务场景。适用于业务页面多，且变动相对不是很频繁，有一定的分析场景但都能枚举, 用户行为可直接与页面可视元素挂钩。")])]),s._v(" "),t("h3",{attrs:{id:"常见埋点属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见埋点属性"}},[s._v("#")]),s._v(" 常见埋点属性")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户基本信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"userId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uid_12345"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户ID，唯一标识用户")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"userName"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户名称，根据实际情况填写")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"isLoggedIn"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户登录状态")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设备和操作系统信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"deviceId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"device_id_abcdef"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设备ID，唯一标识设备")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"deviceType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mobile"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设备类型，如mobile、tablet、desktop等")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"osType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iOS"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 操作系统类型")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"osVersion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"14.2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 操作系统版本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"userAgent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (iPhone; CPU iPhone OS 14_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.1 Mobile/15E148 Safari/604.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户代理字符串")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"appId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.example.myapp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用ID，唯一标识应用")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"appVersion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.2.3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用版本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"appName"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MyApp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用名称")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 时间和地理位置信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"eventTime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1678590400000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件的时间戳，毫秒级")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"localEventTime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2024-04-19 12:34:56"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件的本地时间，格式为YYYY-MM-DD HH:mm:ss")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"timeZone"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 时区")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"country"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 国家，ISO代码")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"city"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shanghai"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 城市")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 网络信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"ip"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.1.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户IP地址")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"networkType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4G"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 网络类型，如WiFi、4G、5G等")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"carrier"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"China_Mobile"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 运营商类型")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件详情")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"eventType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"click"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件类型，如click、pageview等")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"eventName"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Login_Button_Click"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 具体事件名称")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"pageUrl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://example.com/login"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前页面的URL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"pageTitle"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Login Page"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前页面的标题")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交互细节")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"elementSelector"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#loginButton"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 触发事件的元素选择器")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"elementPosition"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 触发事件的元素位置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"clickType"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"left"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 鼠标点击类型")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 性能指标")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"pageLoadTime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面加载时间，单位为毫秒")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"firstContentfulPaint"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 首次内容绘制时间，单位为毫秒")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"domInteractive"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// DOM 交互时间，单位为毫秒")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 来源和行为路径")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"referrerUrl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://example.com/referrer"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上一个页面的URL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"previousPageUrl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://example.com/previous"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户访问的上一个页面URL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"sessionDuration"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户在当前会话中的停留时间，单位为秒")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 自定义属性")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"customAttributes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"membershipLevel"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gold"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"campaignId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"campaign_2024spring"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 错误信息")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"errorOccurred"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"errorDescription"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"errorStackTrace"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br")])]),t("h3",{attrs:{id:"埋点上报方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#埋点上报方式"}},[s._v("#")]),s._v(" 埋点上报方式")]),s._v(" "),t("ul",[t("li",[s._v("XHR 发请求上报")]),s._v(" "),t("li",[s._v("img 发请求上报")]),s._v(" "),t("li",[s._v("navigator.sendBeacon() 发送请求上报")])]),s._v(" "),t("h4",{attrs:{id:"xhr-发请求上报"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xhr-发请求上报"}},[s._v("#")]),s._v(" XHR 发请求上报")]),s._v(" "),t("p",[s._v("使用 XMLHttpRequest 或 fetch API 发送异步请求，可以选择 GET 或 POST 方法，并将数据作为请求体或 URL 参数发送。")]),s._v(" "),t("ul",[t("li",[s._v("优点：发送异步请求，灵活地设置请求头属性，针对 POST 能发送的数据量大。")]),s._v(" "),t("li",[s._v("缺点：在页面销毁时，请求可能还未发送至服务端就被取消，导致数据上报失败；一般埋点域名并不是当前域名，需要处理跨域请求的问题（如设置CORS）；GET 上报存在安全和数据大小局限性。")]),s._v(" "),t("li",[s._v("解决方案：可以使用 XMLHttpRequest 发送同步请求，以确保请求一定能发送到服务端。由于 fetch 和 axios 不支持同步请求，可以通过 XMLHttpRequest 发送同步请求。")])]),s._v(" "),t("p",[s._v("如果使用 ajax 的话，会存在跨域的问题。而且数据上报前端主要是负责将数据传递到后端，并不过分强调前后端交互。因此我们可以通过一些支持跨域的标签去实现数据上报功能，例如 script，link，img。但是当我们使用 script 和 link 进行埋点上报时，需要挂载到页面上，而反复操作 dom 会造成页面性能受影响，而且载入 js/css 资源还会阻塞页面渲染，影响用户体验，因此对于需要频繁上报的埋点而言，script 和 link 并不合适。")]),s._v(" "),t("h4",{attrs:{id:"img-上报方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#img-上报方式"}},[s._v("#")]),s._v(" img 上报方式")]),s._v(" "),t("p",[s._v("通过创建一个 Image 对象，将要上报的数据作为 URL 参数，通过 src 发送一个 GET 请求来触发上报。")]),s._v(" "),t("ul",[t("li",[s._v("优点：兼容性好，支持跨域，不会阻塞页面加载。")]),s._v(" "),t("li",[s._v("缺点：只能发送GET请求，无法获取响应结果，不支持异步操作。不同服务器针对 URI 的长度有限制，长度超过限制时会出现 HTTP 414 错误。")])]),s._v(" "),t("h4",{attrs:{id:"navigator-sendbeacon-上报方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#navigator-sendbeacon-上报方式"}},[s._v("#")]),s._v(" navigator.sendBeacon 上报方式")]),s._v(" "),t("p",[s._v("通过 HTTP POST 将少量数据异步传输到服务器，允许在页面卸载时异步发送数据，通常用于在页面关闭时进行最后的数据上报，以确保数据能够成功发送。")]),s._v(" "),t("ul",[t("li",[s._v("优点：页面销毁时的埋点请求不会中断，可靠地发送数据，不会阻塞页面关闭，支持在后台发送数据。")]),s._v(" "),t("li",[s._v("缺点：有数据大小限制（但一般够用了），因此它不适合发送大量数据；始终使用 HTTP POST 请求，且不返回响应，因此无法检查请求是否成功或处理服务器的返回结果；同样遵循同源策略，不能发送跨域请求，除非服务器设置了适当的 CORS 头。")])]),s._v(" "),t("p",[s._v("sendBeacon 是异步的，不会影响当前页到下一个页面的跳转速度。这个方法还是异步发出请求，但是请求与当前页面脱离关联，作为浏览器的任务，因此可以保证会把数据发出去，不拖延卸载流程。相较于 img 标签，使用 navigator.sendBeacon 会更规范，数据传输上可传输资源类型会更多。相较于 ajax 在页面卸载时上报，ajax 有可能没上报完，页面就卸载了导致请求中断，因此 ajax 处理这种情况时必须作为同步操作。")]),s._v(" "),t("p",[s._v("对于埋点方式的考量，主要考虑的有三个因素：")]),s._v(" "),t("ul",[t("li",[s._v("跨域的问题")]),s._v(" "),t("li",[s._v("页面销毁时，如何保障还未成功上传的数据完成数据上传请求")]),s._v(" "),t("li",[s._v("大数据量的上传")])]),s._v(" "),t("p",[s._v("所以，一般采用组合方式，根据数据量，选择 Image 或者 Beacon 的方式，若检测不支持 Beacon, 在大数据量时回退到传统的 XHR 请求。")]),s._v(" "),t("h2",{attrs:{id:"可视化埋点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可视化埋点"}},[s._v("#")]),s._v(" 可视化埋点")]),s._v(" "),t("p",[s._v("通过埋点平台圈选所需埋点的页面元素，进行埋点上报属性的配置与发布，由采集 SDK 同步埋点配置，并根据配置自动进行用户行为数据的采集和发送。")]),s._v(" "),t("p",[s._v("可视化埋点的基本思路：")]),s._v(" "),t("p",[s._v("以点击事件为例，Web 可视化埋点一般会提供一个 SDK，SDK 会在 document 上面监听 click 事件，借助于事件委托的特性，可以捕获到页面上任意元素的 click 事件及元素的信息。同时 Web 可视化埋点会提供一个平台，该平台通过 iframe 嵌入需要进行埋点配置的网页，然后通过 postMessage 来进行平台与目标页面的通信。但是像 React Native，无法通过 iframe 嵌入页面及 postMessage 实现平台与目标页面的通信，无法借助事件委托的特性来实现可视化埋点，可通过高阶组件的方式导出了跟点击相关的一些组件供业务方使用。")]),s._v(" "),t("h3",{attrs:{id:"连接客户端与可视化埋点平台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接客户端与可视化埋点平台"}},[s._v("#")]),s._v(" 连接客户端与可视化埋点平台")]),s._v(" "),t("p",[t("img",{attrs:{src:"/blog/images/architecture/tracker2.png",alt:"tracker2"}})]),s._v(" "),t("p",[s._v("埋点配置人员首先需要在可视化埋点平台开始一个埋点任务，可视化埋点平台前端会通过 WebSocket 连接到服务端，服务端会生成一个 sessionId 发送给前端，并且会将连接到服务端的 WebSocket 客户端进行登记。此时埋点配置人员在 React Native 客户端通过 SDK 提供的工具进入连接页面，输入 sessionId 后通过 WebSocket 连接到埋点可视化平台服务端，服务端也会将连接到的 WebSocket 客户端进行登记。")]),s._v(" "),t("ul",[t("li",[s._v("React 高阶组件的思想，通过对 React Native 组件进行重写，添加我们埋点相关的逻辑；")]),s._v(" "),t("li",[s._v("通过类组件的 _reactInternals 可获取对应的 FiberNode 节点；")]),s._v(" "),t("li",[s._v("FiberNode 相关的属性，比如可以通过 child、return、sibling 三个指针来对 FiberNode 树进行遍历，memoizedProps 和 memoizedState 可以用来替代组件的 props 和 state 等；")]),s._v(" "),t("li",[s._v("使用 babel 插件对代码进行改写，解决组件名称被混淆的问题。")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/kbAQTP1JeeDoTt-kId1Nog",target:"_blank",rel:"noopener noreferrer"}},[s._v("vivo积分任务体系的架构演进"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/xTFUT5C3rUzyOv887NEKJg",target:"_blank",rel:"noopener noreferrer"}},[s._v("可视化埋点在React Native中的实践"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{559:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jsbridge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge"}},[t._v("#")]),t._v(" JSBridge")]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[a("strong",[t._v("JSBridge")]),t._v("  是一种 JS 实现的 Bridge，连接着桥两端的 Native 和 WebView。它在 APP 内方便地让 Native 调用 JS，JS 调用 Native ，是双向通信的通道。JSBridge 主要是 "),a("strong",[t._v("给 JavaScript 提供调用 Native 功能的接口")]),t._v("，实现原生功能如查看本地相册、打开摄像头、指纹支付等 Native 功能。它的核心是 "),a("strong",[t._v("构建 Native 和非 Native 间消息通信的通道")]),t._v("，而且是 "),a("strong",[t._v("双向通信的通道")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("H5 与 Native 对比")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("name")]),t._v(" "),a("th",[t._v("H5")]),t._v(" "),a("th",[t._v("Native")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("稳定性")]),t._v(" "),a("td",[t._v("调用系统浏览器内核，稳定性较差")]),t._v(" "),a("td",[t._v("使用原生内核，更加稳定")])]),t._v(" "),a("tr",[a("td",[t._v("灵活性")]),t._v(" "),a("td",[t._v("版本迭代快，上线灵活")]),t._v(" "),a("td",[t._v("迭代慢，需要应用商店审核，上线速度受限制")])]),t._v(" "),a("tr",[a("td",[t._v("受网速 影响")]),t._v(" "),a("td",[t._v("较大")]),t._v(" "),a("td",[t._v("较小")])]),t._v(" "),a("tr",[a("td",[t._v("流畅度")]),t._v(" "),a("td",[t._v("有时加载慢，给用户“卡顿”的感觉")]),t._v(" "),a("td",[t._v("加载速度快，更加流畅")])]),t._v(" "),a("tr",[a("td",[t._v("用户体验")]),t._v(" "),a("td",[t._v("功能受浏览器限制，体验有时较差")]),t._v(" "),a("td",[t._v("原生系统 api 丰富，能实现的功能较多，体验较好")])]),t._v(" "),a("tr",[a("td",[t._v("可移植性")]),t._v(" "),a("td",[t._v("兼容跨平台跨系统，如 PC 与 移动端，iOS 与 Android")]),t._v(" "),a("td",[t._v("可移植性较低，对于 iOS 和 Android 需要维护两套代码")])])])]),t._v(" "),a("h2",{attrs:{id:"双向通信原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#双向通信原理"}},[t._v("#")]),t._v(" 双向通信原理")]),t._v(" "),a("h3",{attrs:{id:"js-调用-native"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-调用-native"}},[t._v("#")]),t._v(" JS 调用 Native")]),t._v(" "),a("p",[t._v("JS 调用 Native 的实现方式较多，主要有拦截 "),a("code",[t._v("URL Scheme")]),t._v(" 、重写 prompt 、注入 API 等方法。")]),t._v(" "),a("h4",{attrs:{id:"拦截-url-scheme"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拦截-url-scheme"}},[t._v("#")]),t._v(" 拦截 URL Scheme")]),t._v(" "),a("p",[t._v("URL Schema 是类 UR L的一种请求格式，格式如下：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<protocol>://<host>/<path>?<qeury>#fragment\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("我们可以自定义 JSBridge 通信的 URL Schema，比如："),a("code",[t._v("jsbridge://showToast?text=hello")])]),t._v(" "),a("p",[t._v("Native 加载 WebView之后，Web 发送的所有请求都会经过 WebView 组件，所以 Native 可以重写 WebView 里的方法，从来拦截 Web发起的请求，我们对请求的格式进行判断：")]),t._v(" "),a("ul",[a("li",[t._v("如果符合我们自定义的URL Schema，对URL进行解析，拿到相关操作、操作，进而调用原生Native的方法")]),t._v(" "),a("li",[t._v("如果不符合我们自定义的URL Schema，我们直接转发，请求真正的服务")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/mobile/jsbridge1.png",alt:"jsbridge1"}})]),t._v(" "),a("p",[t._v("Web发送URL请求的方法有这么几种：")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("a")]),t._v("标签")]),t._v(" "),a("li",[a("code",[t._v("location.href")])]),t._v(" "),a("li",[t._v("使用"),a("code",[t._v("iframe.src")])]),t._v(" "),a("li",[t._v("发送"),a("code",[t._v("ajax")]),t._v("请求")])]),t._v(" "),a("p",[t._v("这些方法，"),a("code",[t._v("a")]),t._v("标签需要用户操作，"),a("code",[t._v("location.href")]),t._v("可能会引起页面的跳转丢失调用，发送"),a("code",[t._v("ajax")]),t._v("请求Android没有相应的拦截方法，所以使用"),a("code",[t._v("iframe.src")]),t._v("是经常会使用的方案。")]),t._v(" "),a("p",[t._v("Android 和 iOS 都可以通过拦截 URL Scheme 并解析 Scheme 来决定是否进行对应的 Native 代码逻辑处理：")]),t._v(" "),a("ul",[a("li",[t._v("Android 侧，"),a("code",[t._v("Webview")]),t._v(" 提供了 "),a("code",[t._v("shouldOverrideUrlLoading")]),t._v(" 方法来提供给 Native 拦截 H5 发送的 "),a("code",[t._v("URL Scheme")]),t._v(" 请求。")]),t._v(" "),a("li",[t._v("iOS 侧  "),a("code",[t._v("WKWebview")]),t._v(" 可以根据拦截到的 "),a("code",[t._v("URL Scheme")]),t._v(" 和对应的参数执行相关的操作。")])]),t._v(" "),a("p",[t._v("拦截 URL Scheme 这种方法的优点是不存在漏洞问题、使用灵活，可以实现 H5 和 Native 页面的无缝切换。例如在某一页面需要快速上线的情况下，先开发出 H5 页面。某一链接填写的是 H5 链接，在对应的 Native 页面开发完成前先跳转至 H5 页面，待 Native 页面开发完后再进行拦截，跳转至 Native 页面，此时 H5 的链接无需进行修改。但是使用 iframe.src 来发送 "),a("code",[t._v("URL Scheme")]),t._v(" 需要对 URL 的长度作控制，使用复杂，速度较慢。")]),t._v(" "),a("p",[t._v("拦截 URL Scheme 这种方式从早期就存在，兼容性很好，但是由于是基于URL的方式，长度受到限制而且不太直观，数据格式有限制，而且建立请求有时间耗时。")]),t._v(" "),a("h4",{attrs:{id:"重写-prompt-等原生-js-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重写-prompt-等原生-js-方法"}},[t._v("#")]),t._v(" 重写 prompt 等原生 JS 方法")]),t._v(" "),a("ul",[a("li",[t._v("Android 4.2 之前注入对象的接口是 addJavascriptInterface ，但是由于安全原因慢慢不被使用。一般会通过修改浏览器的部分 Window 对象的方法来完成操作。主要是拦截 alert、confirm、prompt、console.log 四个方法，分别被 "),a("code",[t._v("Webview")]),t._v(" 的 onJsAlert、onJsConfirm、onConsoleMessage、onJsPrompt 监听。")]),t._v(" "),a("li",[t._v("iOS 由于安全机制，"),a("code",[t._v("WKWebView")]),t._v(" 对 alert、confirm、prompt 等方法做了拦截，如果通过此方式进行 Native 与 JS 交互，需要实现 "),a("code",[t._v("WKWebView")]),t._v(" 的三个 "),a("code",[t._v("WKUIDelegate")]),t._v(" 代理方法。")])]),t._v(" "),a("p",[t._v("使用该方式时，可以与 Android 和 iOS 约定好使用传参的格式，这样 H5 可以无需识别客户端，传入不同参数直接调用 Native 即可。剩下的交给客户端自己去拦截相同的方法，识别相同的参数，进行自己的处理逻辑即可实现多端表现一致。另外，如果能与 Native 确定好方法名、传参等调用的协议规范，这样其它格式的 prompt 等方法是不会被识别的，能起到隔离的作用。")]),t._v(" "),a("h4",{attrs:{id:"注入-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注入-api"}},[t._v("#")]),t._v(" 注入 API")]),t._v(" "),a("p",[t._v("这个方法会通过 webView 提供的接口，App 将 Native 的相关接口注入到 JS 的 Context（window）的对象中，一般来说这个对象内的方法名与 Native 相关方法名是相同的，Web 端就可以直接在全局 "),a("strong",[t._v("window")]),t._v(" 下使用这个暴露的全局 JS 对象，进而调用原生端的方法。")]),t._v(" "),a("ul",[a("li",[t._v("Android 的 "),a("code",[t._v("Webview")]),t._v(" 提供了 "),a("code",[t._v("addJavascriptInterface")]),t._v(" 方法，支持 Android 4.2 及以上系统。")]),t._v(" "),a("li",[t._v("iOS 的 "),a("code",[t._v("UIWebview")]),t._v(" 提供了 "),a("code",[t._v("JavaScriptScore")]),t._v(" 方法，支持 iOS 7.0 及以上系统。"),a("code",[t._v("WKWebview")]),t._v(" 提供了 "),a("code",[t._v("window.webkit.messageHandlers")]),t._v(" 方法，支持 iOS 8.0 及以上系统。"),a("code",[t._v("UIWebview")]),t._v(" 在几年前常用，目前已不常见。")])]),t._v(" "),a("h3",{attrs:{id:"native-调用-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#native-调用-js"}},[t._v("#")]),t._v(" Native 调用 JS")]),t._v(" "),a("p",[t._v("Native 调用 JS 比较简单，只要 H5 将 JS 方法暴露在 Window 上给 Native 调用即可。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Android 中主要有两种方式实现。在 4.4 以前，通过 "),a("code",[t._v("loadUrl")]),t._v(" 方法，执行一段 JS 代码来实现。在 4.4 以后，可以使用 "),a("code",[t._v("evaluateJavascript")]),t._v(" 方法实现。"),a("code",[t._v("loadUrl")]),t._v(" 方法使用起来方便简洁，但是效率低无法获得返回结果且调用的时候会刷新 WebView。"),a("code",[t._v("evaluateJavascript")]),t._v(" 方法效率高获取返回值方便，调用时候不刷新 WebView，但是只支持 Android 4.4+。")])]),t._v(" "),a("li",[a("p",[t._v("iOS 在 "),a("code",[t._v("UIWebView")]),t._v(" 使用 "),a("code",[t._v("stringByEvaluatingJavaScriptFromString")]),t._v(" 实现。在 "),a("code",[t._v("WKWebview")]),t._v(" 中可以通过 "),a("code",[t._v("evaluateJavaScript:javaScriptString")]),t._v(" 来实现，且支持 iOS 8.0 及以上系统。")])])]),t._v(" "),a("h2",{attrs:{id:"jsbridge-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge-的使用"}},[t._v("#")]),t._v(" JSBridge 的使用")]),t._v(" "),a("h3",{attrs:{id:"webview-调用-native"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webview-调用-native"}},[t._v("#")]),t._v(" webview 调用 native")]),t._v(" "),a("p",[t._v("当 webview 调用 native 时，会调用 "),a("code",[t._v("callHandler")]),t._v(" 方法。实际上就是先生成一个 message，然后 push 到 "),a("code",[t._v("sendMessageQueue")]),t._v(" 里，然后更改 iframe 的 "),a("code",[t._v("src")]),t._v("。然后，当 native 端检测到 "),a("code",[t._v("iframe src")]),t._v(" 的变化时，会走到 "),a("code",[t._v("isQueueMessageURL")]),t._v(" 的判断逻辑，然后执行 "),a("code",[t._v("WKFlushMessageQueue")]),t._v(" 函数，获取到 JS 侧的 "),a("code",[t._v("sendMessageQueue")]),t._v(" 中的所有 message。")]),t._v(" "),a("p",[t._v("当一个 message 结构存在 responseId 的时候说明这个 message 是执行 bridge 后传回的。取不到 responseId 说明是第一次调用 bridge 传过来的，这个时候会生成一个返回给调用方的 message，其 reponseId 是传过来的 message 的 callbackId，当 native 执行 responseCallback 时，会触发 _dispatchMessage 方法执行 webview 环境的的 js 逻辑，将生成的包含 responseId 的 message 返回给webview。")]),t._v(" "),a("p",[t._v("如果从 native 获取到的 message 中有 responseId，说明这个 message 是 JS 调 Native 之后回调接收的 message，所以从一开始 sendData 中添加的 responseCallbacks 中根据 responseId（一开始存的时候是用的callbackId，两个值是相同的）取出这个回调函数并执行，这样就完成了一次 JS 调用 Native 的流程。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/mobile/jsbridge2.png",alt:"jsbridge2"}})]),t._v(" "),a("p",[t._v("1、native 端注册 jsb。")]),t._v(" "),a("p",[t._v("2、webview 侧创建 iframe，设置 src 为 "),a("code",[t._v("__bridge_load__。")])]),t._v(" "),a("p",[t._v("3、native 端捕获请求，注入jsb初始化代码，在window上挂载相关对象和方法。")]),t._v(" "),a("p",[t._v("4、webview 侧调用 "),a("code",[t._v("callHandler")]),t._v("方法，并在 "),a("code",[t._v("responseCallback")]),t._v(" 上添加 "),a("code",[t._v("callbackId: responseCallback")]),t._v("，并修改 iframe 的 src，触发捕获。")]),t._v(" "),a("p",[t._v("5、native 收到 message，生成一个 "),a("code",[t._v("responseCallback")]),t._v("，并执行 native 侧注册好的方法")]),t._v(" "),a("p",[t._v("6、native 执行完毕后，通过 webview 执行"),a("code",[t._v("_handleMessageFromObjC")]),t._v("方法，取出 callback 函数，并执行。")]),t._v(" "),a("h4",{attrs:{id:"优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优缺点"}},[t._v("#")]),t._v(" 优缺点")]),t._v(" "),a("ul",[a("li",[t._v("优点：JavaScript 端可以确定 JSBridge 的存在，直接调用即可。")]),t._v(" "),a("li",[t._v("缺点：如果桥的实现方式有更改，JSBridge 需要兼容多版本的 Native Bridge 或者 Native Bridge 兼容多版本的 JSBridge。。")])]),t._v(" "),a("h3",{attrs:{id:"native-调用-webview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#native-调用-webview"}},[t._v("#")]),t._v(" native 调用 webview")]),t._v(" "),a("p",[t._v("native 调用 webview 注册的 jsb 的逻辑是相似的，不过就不是通过触发 iframe 的 src 触发执行的了，因为 Native 可以自己主动调用 JS侧的方法。其具体过程如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/mobile/jsbridge3.png",alt:"jsbridge3"}})]),t._v(" "),a("p",[t._v("1、native 侧调用"),a("code",[t._v("callHandler")]),t._v("方法，并在 "),a("code",[t._v("responseCallback")]),t._v("上添加 "),a("code",[t._v("callbackId: responseCallback")]),t._v("。")]),t._v(" "),a("p",[t._v("2、native 侧主动调用 "),a("code",[t._v("_handleMessageFromObjC")]),t._v(" 方法，在webview中执行对应的逻辑。")]),t._v(" "),a("p",[t._v("3、webview 侧执行结束后，生成带有 "),a("code",[t._v("responseId")]),t._v(" 的 message，添加到 "),a("code",[t._v("sendMessageQueue")]),t._v(" 中，并修改 iframe 的 src 为"),a("code",[t._v("__wvjb_queue_message__")]),t._v("。")]),t._v(" "),a("p",[t._v("4、native 端拦截到 url 变化，调用 webview 的逻辑获取到 message，拿到 "),a("code",[t._v("responseId")]),t._v("，并执行对应的 callback 函数。")]),t._v(" "),a("h4",{attrs:{id:"优缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优缺点-2"}},[t._v("#")]),t._v(" 优缺点")]),t._v(" "),a("ul",[a("li",[t._v("优点：桥的版本很容易与 Native 保持一致，Native 端不用对不同版本的 JSBridge 进行兼容。")]),t._v(" "),a("li",[t._v("缺点：注入时机不确定，需要实现注入失败后重试的机制，保证注入的成功率，同时 JavaScript 端在调用接口时，需要优先判断 JSBridge 是否已经注入成功。")])]),t._v(" "),a("h2",{attrs:{id:"最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[t._v("#")]),t._v(" 最佳实践")]),t._v(" "),a("p",[t._v("最佳实践的 JSBridge 要求做到以下几点：")]),t._v(" "),a("ul",[a("li",[t._v("官方认可，符合规范")]),t._v(" "),a("li",[t._v("跨平台通用")]),t._v(" "),a("li",[t._v("APP 内和 APP 外规范通用")]),t._v(" "),a("li",[t._v("安全可靠")]),t._v(" "),a("li",[t._v("约定大于配置的原则")])]),t._v(" "),a("p",[t._v("综合上文介绍的内容，JSBridge 的最佳实践是：")]),t._v(" "),a("ol",[a("li",[t._v("协议规范都使用："),a("code",[t._v("hybrid://action/method?arg1=xxx&arg2=xxx")])]),t._v(" "),a("li",[t._v("iOS 使用 Universal Link 和 UIWebview 的 "),a("code",[t._v("delegate")])]),t._v(" "),a("li",[t._v("安卓使用 "),a("code",[t._v("shouldOverrideUrlLoading")]),t._v(" 和 Applink")])]),t._v(" "),a("h3",{attrs:{id:"规范和约定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#规范和约定"}},[t._v("#")]),t._v(" 规范和约定")]),t._v(" "),a("p",[t._v("先理解下 URL scheme的组成部分：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("yourappscheme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("action"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("arg1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("arg2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("ios_version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("andr_version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("upgrade"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("sendlog"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("整体小写")]),t._v(" "),a("li",[a("code",[t._v("yourappscheme")]),t._v("：就是你的 scheme，可辨识，别冲突，通过这个可以进行 Universal Link 和 Applink 的分发")]),t._v(" "),a("li",[a("code",[t._v("module")]),t._v(" 和 "),a("code",[t._v("action")]),t._v("：某个模块组件的某个方法")]),t._v(" "),a("li",[a("code",[t._v("?")]),t._v("后面是 "),a("code",[t._v("querystring")]),t._v("，这里预定了几个特殊的参数：\n"),a("ul",[a("li",[a("code",[t._v("ios_version/andr_version")]),t._v("：非必须，iOS 和安卓的最小版本，即本协议从哪个版本开始支持的，低版本不支持则忽略，配合 upgrade 使用进行 APP 升级")]),t._v(" "),a("li",[a("code",[t._v("upgrade")]),t._v("：是否强制升级，即当版本低于设置的 ios/andr_version 是否弹出提示用户升级的对话框（yourappscheme 已经可以调起 app，只不过功能可能因为版本低不支持，这时候可以引导用户升级）")]),t._v(" "),a("li",[a("code",[t._v("callback")]),t._v("：异步回调函数，下面详细树下 callback 的最佳实践")]),t._v(" "),a("li",[a("code",[t._v("sendlog")]),t._v("：调起后是否打点发送日志\n示例：")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 账号相关")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开用户个人主页")]),t._v("\nfb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("account"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("userprofile"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开登录界面")]),t._v("\nfb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("account"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("login"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 工具类")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取定位")]),t._v("\nfb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("utils"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("getgeolocation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xx\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h3",{attrs:{id:"回调方法设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回调方法设计"}},[t._v("#")]),t._v(" 回调方法设计")]),t._v(" "),a("p",[t._v("当 Native 操作成功之后，会将处理结束后的结果或者数据通过 "),a("code",[t._v("callback")]),t._v(" 回调传给 Web，当然有成果就又失败，"),a("code",[t._v("callback")]),t._v(" 的参数设计有两种方式：")]),t._v(" "),a("h4",{attrs:{id:"错误优先"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误优先"}},[t._v("#")]),t._v(" 错误优先")]),t._v(" "),a("p",[t._v("即下面的回调方法格式：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h4",{attrs:{id:"json-结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json-结构"}},[t._v("#")]),t._v(" JSON 结构")]),t._v(" "),a("p",[t._v("即回调方法只接收一个 JSON 对象，JSON 格式如下：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error_code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h3",{attrs:{id:"预留升级-日志能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预留升级-日志能力"}},[t._v("#")]),t._v(" 预留升级/日志能力")]),t._v(" "),a("p",[t._v("做 APP 开发经常会遇见下面的问题：")]),t._v(" "),a("ol",[a("li",[t._v("功能/端能力是从某个版本开始的，低版本用不了，但是 "),a("code",[t._v("scheme")]),t._v(" 还是会调起 APP。")]),t._v(" "),a("li",[t._v("对于低版本，PM 希望提示用户升级")]),t._v(" "),a("li",[t._v("统计调起成功率，分发次数之类的统计需求")])]),t._v(" "),a("p",[a("code",[t._v("scheme")]),t._v(" 的 "),a("code",[t._v("querystring")]),t._v(" 部分由 "),a("code",[t._v("ios_version/andr_version")]),t._v(" 和 "),a("code",[t._v("upgrade")]),t._v(" 这三个成对的参数，可以解决升级问题，"),a("code",[t._v("sendlog")]),t._v(" 解决日志统计问题。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ios_version/andr_version")]),t._v("：是标示该协议的最低支持版本，如果低于这个版本可能因为功能并未实现而能识别。")]),t._v(" "),a("li",[a("code",[t._v("upgrade")]),t._v("：是是否强制低版本弹出升级对话框")]),t._v(" "),a("li",[a("code",[t._v("sendlog")]),t._v("：当为 1 的时候，则发送调起成功失败之类的统计需求")])]),t._v(" "),a("h3",{attrs:{id:"简易代码实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简易代码实现"}},[t._v("#")]),t._v(" 简易代码实现")]),t._v(" "),a("p",[t._v("简单封装下 JSBridge 调用的方法，参数如下：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("module")]),t._v("：类名称，如果 "),a("code",[t._v("account")])]),t._v(" "),a("li",[a("code",[t._v("action")]),t._v("：具体操作方法，如 "),a("code",[t._v("login")])]),t._v(" "),a("li",[a("code",[t._v("args")]),t._v("：非必须，协议参数，支持 "),a("code",[t._v("string")]),t._v(" 和对象")]),t._v(" "),a("li",[a("code",[t._v("callback")]),t._v("：非必须，回调单独提出来，方便全局方法命名")])]),t._v(" "),a("p",[t._v("具体代码如下")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" scheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("yourappscheme://")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("action"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理下参数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    scheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("each")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isArray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      scheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("v"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callback 独立传，方便全局函数名命名")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" funcName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_jsbridge_cb_'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("funcName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    scheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v("scheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'&'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("callback=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("funcName"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ios "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("versionCompare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'9.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" scheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" $node "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    $node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    $node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" scheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      $node "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844904070881214471#heading-8",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSBridge 初探"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7177407635317063735",target:"_blank",rel:"noopener noreferrer"}},[t._v("App实现JSBridge的最佳方案"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844903491970793480#heading-1",target:"_blank",rel:"noopener noreferrer"}},[t._v("H5与Native交互之JSBridge技术"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);
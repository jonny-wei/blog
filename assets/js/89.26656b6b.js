(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{540:function(e,t,r){"use strict";r.r(t);var o=r(15),v=Object(o.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"proxy-和-reflect"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#proxy-和-reflect"}},[e._v("#")]),e._v(" Proxy 和 Reflect")]),e._v(" "),r("h2",{attrs:{id:"proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#proxy"}},[e._v("#")]),e._v(" Proxy")]),e._v(" "),r("h3",{attrs:{id:"简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),r("p",[e._v("一个 Proxy 对象包装另一个对象并拦截诸如读取/写入属性和其他操作，可以选择自行处理它们，或者透明地允许该对象处理它们。")]),e._v(" "),r("p",[r("code",[e._v("var proxy = new Proxy(target, handler);")])]),e._v(" "),r("p",[e._v("new Proxy() 表示生成一个 Proxy 实例，target 参数表示所要拦截的目标对象(包括函数)，handler 参数也是一个对象，用来定制拦截行为。")]),e._v(" "),r("h3",{attrs:{id:"proxy-实例的方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#proxy-实例的方法"}},[e._v("#")]),e._v(" Proxy 实例的方法")]),e._v(" "),r("h4",{attrs:{id:"get-target-propkey-receiver"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#get-target-propkey-receiver"}},[e._v("#")]),e._v(" get(target, propKey, receiver)")]),e._v(" "),r("p",[e._v("拦截对象属性的读取，比如 "),r("code",[e._v("proxy.foo")]),e._v(" 和 "),r("code",[e._v("proxy['foo']")]),e._v("。如果一个属性不可配置（configurable）且不可写（writable），则 Proxy 不能修改该属性，通过 Proxy 对象访问该属性会报错。")]),e._v(" "),r("h4",{attrs:{id:"set-target-propkey-value-receiver"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#set-target-propkey-value-receiver"}},[e._v("#")]),e._v(" set(target, propKey, value, receiver)")]),e._v(" "),r("p",[e._v("拦截对象属性的设置，比如 "),r("code",[e._v("proxy.foo = v")]),e._v(" 或 "),r("code",[e._v("proxy['foo'] = v")]),e._v("，返回一个布尔值。")]),e._v(" "),r("p",[e._v("set 方法用来拦截某个属性的赋值操作，可以接受四个参数，依次为目标对象、属性名、属性值和 Proxy 实例本身，其中最后一个参数可选。如果目标对象自身的某个属性不可写，那么 set 方法将不起作用。严格模式下，set 代理如果没有返回 true，就会报错。")]),e._v(" "),r("h4",{attrs:{id:"has-target-propkey"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#has-target-propkey"}},[e._v("#")]),e._v(" has(target, propKey)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("propKey in proxy")]),e._v(" 的操作，返回一个布尔值。用来拦截 "),r("code",[e._v("HasProperty")]),e._v(" 操作，即判断对象是否具有某个属性时，这个方法会生效。典型的操作就是 in 运算符。has()方法可以接受两个参数，分别是目标对象、需查询的属性名。"),r("code",[e._v("has()")]),e._v(" 方法拦截的是 "),r("code",[e._v("HasProperty")]),e._v(" 操作，而不是 "),r("code",[e._v("HasOwnProperty")]),e._v(" 操作，即 "),r("code",[e._v("has()")]),e._v(" 方法不判断一个属性是对象自身的属性，还是继承的属性。另外，虽然 "),r("code",[e._v("for...in")]),e._v(" 循环也用到了 "),r("code",[e._v("in")]),e._v(" 运算符，但是 "),r("code",[e._v("has()")]),e._v(" 拦截对 "),r("code",[e._v("for...in")]),e._v(" 循环不生效。")]),e._v(" "),r("h4",{attrs:{id:"deleteproperty-target-propkey"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#deleteproperty-target-propkey"}},[e._v("#")]),e._v(" deleteProperty(target, propKey)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("delete proxy[propKey]")]),e._v(" 的操作，返回一个布尔值。")]),e._v(" "),r("h4",{attrs:{id:"ownkeys-target"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ownkeys-target"}},[e._v("#")]),e._v(" ownKeys(target)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.getOwnPropertyNames(proxy)")]),e._v("、"),r("code",[e._v("Object.getOwnPropertySymbols(proxy)")]),e._v("、"),r("code",[e._v("Object.keys(proxy)")]),e._v("、"),r("code",[e._v("for...in")]),e._v("循环，返回一个数组。该方法返回目标对象所有自身的属性的属性名，而 "),r("code",[e._v("Object.keys()")]),e._v(" 的返回结果仅包括目标对象自身的可遍历属性。")]),e._v(" "),r("h4",{attrs:{id:"getownpropertydescriptor-target-propkey"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#getownpropertydescriptor-target-propkey"}},[e._v("#")]),e._v(" getOwnPropertyDescriptor(target, propKey)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.getOwnPropertyDescriptor(proxy, propKey)")]),e._v("，返回属性的描述对象。")]),e._v(" "),r("h4",{attrs:{id:"defineproperty-target-propkey-propdesc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#defineproperty-target-propkey-propdesc"}},[e._v("#")]),e._v(" defineProperty(target, propKey, propDesc)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.defineProperty(proxy, propKey, propDesc)")]),e._v("、"),r("code",[e._v("Object.defineProperties(proxy, propDescs)")]),e._v("，返回一个布尔值。")]),e._v(" "),r("h4",{attrs:{id:"preventextensions-target"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#preventextensions-target"}},[e._v("#")]),e._v(" preventExtensions(target)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.preventExtensions(proxy)")]),e._v("，返回一个布尔值。")]),e._v(" "),r("h4",{attrs:{id:"getprototypeof-target"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#getprototypeof-target"}},[e._v("#")]),e._v(" getPrototypeOf(target)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.getPrototypeOf(proxy)")]),e._v("，返回一个对象。")]),e._v(" "),r("h4",{attrs:{id:"isextensible-target"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#isextensible-target"}},[e._v("#")]),e._v(" isExtensible(target)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.isExtensible(proxy)")]),e._v("，返回一个布尔值。")]),e._v(" "),r("h4",{attrs:{id:"setprototypeof-target-proto"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#setprototypeof-target-proto"}},[e._v("#")]),e._v(" setPrototypeOf(target, proto)")]),e._v(" "),r("p",[e._v("拦截 "),r("code",[e._v("Object.setPrototypeOf(proxy, proto)")]),e._v("，返回一个布尔值。如果目标对象是函数，那么还有两种额外操作可以拦截。")]),e._v(" "),r("h4",{attrs:{id:"apply-target-object-args"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#apply-target-object-args"}},[e._v("#")]),e._v(" apply(target, object, args)")]),e._v(" "),r("p",[e._v("拦截 Proxy 实例作为函数调用的操作，比如 "),r("code",[e._v("proxy(...args)")]),e._v("、"),r("code",[e._v("proxy.call(object, ...args)")]),e._v("、"),r("code",[e._v("proxy.apply(...)")]),e._v("。apply 方法可以接受三个参数，分别是目标对象、目标对象的上下文对象（this）和目标对象的参数数组。")]),e._v(" "),r("h4",{attrs:{id:"construct-target-args"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#construct-target-args"}},[e._v("#")]),e._v(" construct(target, args)")]),e._v(" "),r("p",[e._v("拦截 Proxy 实例作为构造函数调用的操作，比如 "),r("code",[e._v("new proxy(...args)")]),e._v("。 construct() 方法用于拦截 new 命令。")]),e._v(" "),r("h3",{attrs:{id:"proxy-实例的方法一览表"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#proxy-实例的方法一览表"}},[e._v("#")]),e._v(" Proxy 实例的方法一览表")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",[e._v("内部方法")]),e._v(" "),r("th",[e._v("Handler 方法")]),e._v(" "),r("th",[e._v("何时触发")])])]),e._v(" "),r("tbody",[r("tr",[r("td",[r("code",[e._v("[[Get]]")])]),e._v(" "),r("td",[r("code",[e._v("get")])]),e._v(" "),r("td",[e._v("读取属性")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[Set]]")])]),e._v(" "),r("td",[r("code",[e._v("set")])]),e._v(" "),r("td",[e._v("写入属性")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[HasProperty]]")])]),e._v(" "),r("td",[r("code",[e._v("has")])]),e._v(" "),r("td",[r("code",[e._v("in")]),e._v(" 运算符")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[Delete]]")])]),e._v(" "),r("td",[r("code",[e._v("deleteProperty")])]),e._v(" "),r("td",[r("code",[e._v("delete")]),e._v(" 操作")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[Call]]")])]),e._v(" "),r("td",[r("code",[e._v("apply")])]),e._v(" "),r("td",[e._v("proxy 对象作为函数被调用")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[Construct]]")])]),e._v(" "),r("td",[r("code",[e._v("construct")])]),e._v(" "),r("td",[r("code",[e._v("new")]),e._v(" 操作")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[GetPrototypeOf]]")])]),e._v(" "),r("td",[r("code",[e._v("getPrototypeOf")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.getPrototypeOf"),r("OutboundLink")],1)])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[SetPrototypeOf]]")])]),e._v(" "),r("td",[r("code",[e._v("setPrototypeOf")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.setPrototypeOf"),r("OutboundLink")],1)])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[IsExtensible]]")])]),e._v(" "),r("td",[r("code",[e._v("isExtensible")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.isExtensible"),r("OutboundLink")],1)])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[PreventExtensions]]")])]),e._v(" "),r("td",[r("code",[e._v("preventExtensions")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.preventExtensions"),r("OutboundLink")],1)])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[DefineOwnProperty]]")])]),e._v(" "),r("td",[r("code",[e._v("defineProperty")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.defineProperty"),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.defineProperties"),r("OutboundLink")],1)])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[GetOwnProperty]]")])]),e._v(" "),r("td",[r("code",[e._v("getOwnPropertyDescriptor")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.getOwnPropertyDescriptor"),r("OutboundLink")],1),e._v(", "),r("code",[e._v("for..in")]),e._v(", "),r("code",[e._v("Object.keys/values/entries")])])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("[[OwnPropertyKeys]]")])]),e._v(" "),r("td",[r("code",[e._v("ownKeys")])]),e._v(" "),r("td",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.getOwnPropertyNames"),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols",target:"_blank",rel:"noopener noreferrer"}},[e._v("Object.getOwnPropertySymbols"),r("OutboundLink")],1),e._v(", "),r("code",[e._v("for..in")]),e._v(", "),r("code",[e._v("Object/keys/values/entries")])])])])]),e._v(" "),r("h2",{attrs:{id:"reflect"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reflect"}},[e._v("#")]),e._v(" Reflect")]),e._v(" "),r("p",[e._v("Reflect 对象与 Proxy 对象一样，也是 ES6 为了操作对象而提供的新 API。Reflect 不是一个函数对象，因此它是不可构造的。")]),e._v(" "),r("ol",[r("li",[e._v("将 Object 对象的一些明显属于 "),r("strong",[e._v("语言内部")]),e._v(" 的方法（比如 "),r("code",[e._v("Object.defineProperty")]),e._v("），放到 Reflect 对象上。现阶段，某些方法同时在 Object 和 Reflect 对象上部署，未来的新方法将只部署在 Reflect 对象上。也就是说，从 Reflect 对象上可以拿到语言内部的方法。")]),e._v(" "),r("li",[e._v("修改某些 Object 方法的返回结果，让其变得更合理。比如，"),r("code",[e._v("Object.defineProperty(obj, name, desc)")]),e._v(" 在无法定义属性时，会抛出一个错误，而 "),r("code",[e._v("Reflect.defineProperty(obj, name, desc)")]),e._v(" 则会返回 false。")]),e._v(" "),r("li",[e._v("让 Object 操作都变成函数行为。某些 Object 操作是命令式，比如 "),r("code",[e._v("name in obj")]),e._v(" 和 "),r("code",[e._v("delete obj[name]")]),e._v("，而 "),r("code",[e._v("Reflect.has(obj, name)")]),e._v(" 和 "),r("code",[e._v("Reflect.deleteProperty(obj, name)")]),e._v(" 让它们变成了函数行为。")]),e._v(" "),r("li",[e._v("Reflect 对象的方法与 Proxy 对象的方法一一对应，只要是 Proxy 对象的方法，就能在 Reflect 对象上找到对应的方法。这就让 Proxy 对象可以方便地调用对应的 Reflect 方法，完成默认行为，作为修改行为的基础。也就是说，不管 Proxy 怎么修改默认行为，你总可以在Reflect 上获取默认行为。")])]),e._v(" "),r("h3",{attrs:{id:"reflect-静态方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reflect-静态方法"}},[e._v("#")]),e._v(" Reflect 静态方法")]),e._v(" "),r("p",[e._v("Reflect对象一共有 13 个静态方法。")]),e._v(" "),r("ul",[r("li",[e._v("Reflect.apply(target, thisArg, args)")]),e._v(" "),r("li",[e._v("Reflect.construct(target, args)")]),e._v(" "),r("li",[e._v("Reflect.get(target, name, receiver)")]),e._v(" "),r("li",[e._v("Reflect.set(target, name, value, receiver)")]),e._v(" "),r("li",[e._v("Reflect.defineProperty(target, name, desc)")]),e._v(" "),r("li",[e._v("Reflect.deleteProperty(target, name)")]),e._v(" "),r("li",[e._v("Reflect.has(target, name)")]),e._v(" "),r("li",[e._v("Reflect.ownKeys(target)")]),e._v(" "),r("li",[e._v("Reflect.isExtensible(target)")]),e._v(" "),r("li",[e._v("Reflect.preventExtensions(target)")]),e._v(" "),r("li",[e._v("Reflect.getOwnPropertyDescriptor(target, name)")]),e._v(" "),r("li",[e._v("Reflect.getPrototypeOf(target)")]),e._v(" "),r("li",[e._v("Reflect.setPrototypeOf(target, prototype)")])]),e._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[e._v("参考文献")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://es6.ruanyifeng.com/#docs/proxy",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript 6 入门"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://juejin.cn/post/6924442692667572237",target:"_blank",rel:"noopener noreferrer"}},[e._v("你不知道的 Proxy"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=v.exports}}]);
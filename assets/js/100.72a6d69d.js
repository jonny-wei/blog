(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{552:function(s,n,t){"use strict";t.r(n);var a=t(15),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"模块依赖关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块依赖关系"}},[s._v("#")]),s._v(" 模块依赖关系")]),s._v(" "),t("p",[s._v("如何从 Entry 开始逐步递归读入、解析模块内容，并最终构建出模块依赖关系图 —— ModuleGraph 对象。为什么需要先将依赖文件构建为 Dependency，之后再根据 Dependency 创建文件对应的 Module 对象？Dependency 对象到底有什么作用？")]),s._v(" "),t("p",[s._v("Dependency Graph 贯穿 Webpack 整个运行周期，从「"),t("strong",[s._v("构建阶段")]),s._v("」的模块解析，到「"),t("strong",[s._v("生成阶段")]),s._v("」的 Chunk 生成，以及 Tree-shaking 等功能都高度依赖于Dependency Graph ，是 Webpack 资源构建流程中一个非常核心的数据结构。")]),s._v(" "),t("h2",{attrs:{id:"dependency-graph-是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependency-graph-是什么"}},[s._v("#")]),s._v(" Dependency Graph 是什么")]),s._v(" "),t("p",[s._v("回顾 Webpack 构建阶段的关键过程：")]),s._v(" "),t("ol",[t("li",[s._v("首先根据 entry 配置信息创建若干 EntryDependency 对象")]),s._v(" "),t("li",[s._v("调用 NormalModuleFactory ，根据 EntryDependency 对象的资源路径创建 Module 子类对象")]),s._v(" "),t("li",[s._v("将 Module 代码解析为 AST 结构")]),s._v(" "),t("li",[s._v("遍历 AST，找到所有模块导入语句（import/require）")]),s._v(" "),t("li",[s._v("根据导入语句创建对应的 Dependency 子类对象")]),s._v(" "),t("li",[s._v("递归执行步骤 2，直到所有项目文件都处理完毕。")])]),s._v(" "),t("p",[s._v("这个过程从 entry 模块开始，逐步递归找出所有依赖文件，模块之间隐式形成了以 entry 为起点，以模块为节点，以导入导出依赖为边的有向图关系 - Dependency Graph 模块依赖关系图。")]),s._v(" "),t("p",[s._v("这个 Dependency Graph 是 Webpack 内部非常重要的过程信息之一，后续封装 Chunk、Code Splits、Tree-Shaking、Hot Module Replacement 等等，几乎所有功能都需要依赖这一信息实现。")]),s._v(" "),t("p",[s._v("Webpack5 之前，Dependency Graph 关系隐含在 Dependence、Module 对象的一系列属性中，例如：")]),s._v(" "),t("ul",[t("li",[s._v("通过 module.dependencies 数组记录模块依赖对象；")]),s._v(" "),t("li",[s._v("通过 dependency.module 记录依赖对应的模块对象引用；")]),s._v(" "),t("li",[s._v("通过 module.issuer 记录父模块引用。")])]),s._v(" "),t("p",[s._v("这种设计存在很多问题，例如：模块之间的关系非常隐晦难懂；模块搜索算法与模块资源构建逻辑耦合在同一个 Class 实体内，Module 职责不单一且复杂度非常高；同一个 Module 对象无法在多个 Dependency Graph 之间共享，等等。为此，Webpack5 重构 了 Dependency Graph 的具体实现，将依赖关系从 Dependence/Module 类型中解耦出来，以一套独立的 Graph 数据结构记录模块间依赖关系，并基于 Map/Set 等原生模块实现更高效的模块搜索、校验、遍历算法。")]),s._v(" "),t("h2",{attrs:{id:"dependency-graph-设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependency-graph-设计"}},[s._v("#")]),s._v(" Dependency Graph 设计")]),s._v(" "),t("p",[s._v("Webpack 5.0 之后的 Dependency Graph 涉及如下数据类型：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ModuleGraph")]),s._v("：记录 Dependency Graph 信息的容器，记录构建过程中涉及到的所有 "),t("code",[s._v("module")]),s._v("、"),t("code",[s._v("dependency")]),s._v(" 对象，以及这些对象互相之间的引用；")]),s._v(" "),t("li",[t("code",[s._v("ModuleGraphConnection")]),s._v(" ：记录模块间引用关系的数据结构，内部通过 "),t("code",[s._v("originModule")]),s._v(" 属性记录引用关系中的父模块，通过 "),t("code",[s._v("module")]),s._v(" 属性记录子模块；")]),s._v(" "),t("li",[t("code",[s._v("ModuleGraphModule")]),s._v(" ："),t("code",[s._v("Module")]),s._v(" 对象在 Dependency Graph 体系下的补充信息，包含模块对象的 "),t("code",[s._v("incomingConnections")]),s._v(" —— 指向模块本身的 "),t("code",[s._v("ModuleGraphConnection")]),s._v(" 集合，即谁引用了模块自身；"),t("code",[s._v("outgoingConnections")]),s._v(" —— 该模块对外的依赖，即该模块引用了其他那些模块。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/blog/images/devops/dependency1.png",alt:"dependency1"}})]),s._v(" "),t("p",[s._v("这些类型之间关系的基本逻辑是：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Compilation")]),s._v(" 类内部会维护一个全局唯一的 "),t("code",[s._v("ModuleGraph")]),s._v(" 实例对象")]),s._v(" "),t("li",[s._v("每次解析出新模块后，将 Module、Dependency，以及模块之间的关系 —— "),t("code",[s._v("ModuleConnection")]),s._v(" 记录到 "),t("code",[s._v("compilation.moduleGraph")]),s._v(" 对象中")]),s._v(" "),t("li",[t("code",[s._v("ModuleGraph")]),s._v(" 除了记录依赖关系外，还提供了许多工具方法，方便使用者迅速读取出 "),t("code",[s._v("module")]),s._v(" 或 "),t("code",[s._v("dependency")]),s._v(" 附加的信息。"),t("code",[s._v("ModuleGraph")]),s._v(" 内部有两个关键属性：\n"),t("ul",[t("li",[s._v("通过 "),t("code",[s._v("_dependencyMap")]),s._v(" 属性记录 "),t("code",[s._v("Dependency")]),s._v(" 对象与 "),t("code",[s._v("ModuleGraphConnection")]),s._v(" 连接对象之间的映射关系，后续的处理中可以基于这层映射迅速找到 "),t("code",[s._v("Dependency")]),s._v(" 实例对应的引用与被引用者；")]),s._v(" "),t("li",[s._v("通过 "),t("code",[s._v("_moduleMap")]),s._v(" 属性记录 "),t("code",[s._v("Module")]),s._v(" 与 "),t("code",[s._v("ModuleGraphModule")]),s._v(" 之间的映射关系。")])])])]),s._v(" "),t("p",[s._v("最终，通过 "),t("code",[s._v("ModuleGraph")]),s._v("、"),t("code",[s._v("ModuleGraphConnection")]),s._v("、"),t("code",[s._v("ModuleGraphModule")]),s._v(" 三种类型的协作，在主体的 "),t("code",[s._v("Module")]),s._v("、"),t("code",[s._v("Dependency")]),s._v(" 体系之外，记录模块之间的依赖信息。")]),s._v(" "),t("p",[s._v("依赖关系收集过程，主要发生在构建阶段的两个节点：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/blog/images/devops/dependency2.png",alt:"dependency2"}})]),s._v(" "),t("ul",[t("li",[t("code",[s._v("addDependency")]),s._v(" ：webpack 从模块内容中解析出引用关系后，创建适当的 "),t("code",[s._v("Dependency")]),s._v(" 子类并调用该方法记录到 "),t("code",[s._v("module")]),s._v(" 实例；")]),s._v(" "),t("li",[t("code",[s._v("handleModuleCreation")]),s._v(" ：模块解析完毕后，webpack 遍历父模块的依赖集合，调用该方法创建 "),t("code",[s._v("Dependency")]),s._v(" 对应的子模块对象，之后调用 "),t("code",[s._v("moduleGraph.setResolvedModule")]),s._v(" 方法将父子引用信息记录到 "),t("code",[s._v("moduleGraph")]),s._v(" 对象上。moduleGraph.setResolvedModule 方法的逻辑大致为：")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ModuleGraph")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @type {Map<Dependency, ModuleGraphConnection>} */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_dependencyMap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @type {Map<Module, ModuleGraphModule>} */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_moduleMap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * @param {Module} originModule the referencing module\n     * @param {Dependency} dependency the referencing dependency\n     * @param {Module} module the referenced module\n     * @returns {void}\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setResolvedModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("originModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" module")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" connection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ModuleGraphConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            originModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("weak"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCondition")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_dependencyMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_getModuleGraphModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("incomingConnections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        connections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mgm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_getModuleGraphModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("originModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mgm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("outgoingConnections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            mgm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("outgoingConnections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        mgm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("outgoingConnections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("ul",[t("li",[s._v("主要更改了 "),t("code",[s._v("_dependencyMap")]),s._v(" 及 "),t("code",[s._v("moduleGraphModule")]),s._v(" 的出入 "),t("code",[s._v("connections")]),s._v(" 属性，以此收集当前模块的上下游依赖关系。")])]),s._v(" "),t("h3",{attrs:{id:"案例分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例分析"}},[s._v("#")]),s._v(" 案例分析")]),s._v(" "),t("p",[s._v("案例：index.js 依赖 a.js 和 b.js，那么其构建过程中模块间依赖关系生成过程如下：")]),s._v(" "),t("ol",[t("li",[s._v("首先创建 "),t("code",[s._v("index.js")]),s._v(" 对应的 "),t("code",[s._v("EntryDependency")]),s._v(" 对象；")]),s._v(" "),t("li",[s._v("调用 "),t("code",[s._v("NormalModuleFactory")]),s._v(" 创建 "),t("code",[s._v("EntryDependency")]),s._v(" 对应的 "),t("code",[s._v("NormalModule")]),s._v(" 实例；")]),s._v(" "),t("li",[s._v("执行 "),t("code",[s._v("compilation.handleModuleCreation")]),s._v("，经过解析、遍历 AST 等操作，最终得到 "),t("code",[s._v("a.js")]),s._v("、"),t("code",[s._v("b.js")]),s._v(" 两个新 Dependency 对象；")]),s._v(" "),t("li",[s._v("调用 "),t("code",[s._v("NormalModuleFactory")]),s._v(" 为这两个 Dependency 对象创建对应的 "),t("code",[s._v("NormalModule")]),s._v(" 对象；")]),s._v(" "),t("li",[s._v("调用 "),t("code",[s._v("moduleGraph.setResolvedModule")]),s._v(" 记录 "),t("code",[s._v("entry")]),s._v(" 模块与 "),t("code",[s._v("a/b")]),s._v(" 模块的依赖关系。")])]),s._v(" "),t("p",[s._v("最终生成如下数据结果：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("ModuleGraph"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    _dependencyMap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n            EntryDependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 入口模块没有引用者，故设置为 null")]),s._v("\n                originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n            HarmonyImportSideEffectDependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n            HarmonyImportSideEffectDependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/b.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    _moduleMap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            incomingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// entry 模块，对应 originModule 为null")]),s._v("\n                ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            outgoingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从 index 指向 a 模块")]),s._v("\n                ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从 index 指向 b 模块")]),s._v("\n                ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/b.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            incomingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/a.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a 模块没有其他依赖，故 outgoingConnections 属性值为 undefined")]),s._v("\n            outgoingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/b.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" ModuleGraphModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            incomingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                ModuleGraphConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/b.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" originModule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NormalModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// b 模块没有其他依赖，故 outgoingConnections 属性值为 undefined")]),s._v("\n            outgoingConnections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("p",[s._v("从上面的 Dependency Graph 可以看出，本质上 "),t("code",[s._v("ModuleGraph._moduleMap")]),s._v(" 已经形成了一个有向无环图结构，其中字典 "),t("code",[s._v("_moduleMap")]),s._v(" 的 key 为图的节点，对应 value "),t("code",[s._v("ModuleGraphModule")]),s._v(" 结构中的 "),t("code",[s._v("outgoingConnections")]),s._v(" 属性为图的边，则上例中从起点 "),t("code",[s._v("index.js")]),s._v(" 出发沿 "),t("code",[s._v("outgoingConnections")]),s._v(" 向前可遍历出图的所有顶点。")]),s._v(" "),t("h2",{attrs:{id:"dependency-graph-作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependency-graph-作用"}},[s._v("#")]),s._v(" Dependency Graph 作用")]),s._v(" "),t("ul",[t("li",[s._v("信息索引")]),s._v(" "),t("li",[s._v("辅助构建 ChunkGraph")])]),s._v(" "),t("p",[s._v("信息索引是 ModuleGraph 最重要的功能，在 "),t("code",[s._v("ModuleGraph")]),s._v(" 类型中提供了很多实现 "),t("code",[s._v("module")]),s._v(" / "),t("code",[s._v("dependency")]),s._v(" 信息查询的工具函数，例如：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("getModule(dep: Dependency)")]),s._v(" ：根据 "),t("code",[s._v("dep")]),s._v(" 查找对应的 "),t("code",[s._v("module")]),s._v(" 实例。")]),s._v(" "),t("li",[t("code",[s._v("getOutgoingConnections(module)")]),s._v(" ：查找 "),t("code",[s._v("module")]),s._v(" 实例的所有依赖。")]),s._v(" "),t("li",[t("code",[s._v("getIssuer(module: Module)")]),s._v(" ：查找 "),t("code",[s._v("module")]),s._v(" 在何处被引用。")]),s._v(" "),t("li",[s._v("...")])]),s._v(" "),t("p",[s._v("Webpack5 内部的许多插件、Dependency 子类、Module 子类的实现都需要用到这些工具函数查找特定模块、依赖的信息，例如：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("SplitChunksPlugin")]),s._v(" 在优化 "),t("code",[s._v("chunks")]),s._v(" 处理中，需要使用 "),t("code",[s._v("moduleGraph.getExportsInfo")]),s._v(" 查询各个模块的 "),t("code",[s._v("exportsInfo")]),s._v(" (模块导出的信息集合，与 tree-shaking 强相关，后续会单出一篇文章讲解)信息以确定如何分离 chunk。")]),s._v(" "),t("li",[s._v("在 "),t("code",[s._v("compilation.seal")]),s._v(" 函数中，需要遍历 "),t("code",[s._v("entry")]),s._v(" 对应的 dep 并调用 "),t("code",[s._v("moduleGraph.getModule")]),s._v(" 获取完整的 "),t("code",[s._v("module")]),s._v(" 定义。")]),s._v(" "),t("li",[s._v("...")])]),s._v(" "),t("p",[s._v("此外，在 Webpack 完成模块构建，进入「"),t("strong",[s._v("生成阶段")]),s._v("」之后，会按一系列规则将模块逐一分配到不同 Chunk 对象中，在 Webpack4 时，这个过程主要围绕 "),t("code",[s._v("Chunk")]),s._v(" 及 "),t("code",[s._v("ChunkGroup")]),s._v(" 两个类型展开。")]),s._v(" "),t("p",[s._v("而 5.0 之后，对 Chunk 之间的依赖关系管理也做了一次大型 "),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fblog%2F2020-10-10-webpack-5-release%2F%23module-and-chunk-graph",target:"_blank",rel:"noopener noreferrer"}},[s._v("重构"),t("OutboundLink")],1),s._v("：首先根据默认规则为每一个 "),t("code",[s._v("entry")]),s._v(" 创建对应 Chunk 对象 ，之后调用 "),t("code",[s._v("buildChunkGraph")]),s._v(" 方法，遍历 "),t("code",[s._v("moduleGraph")]),s._v(" 对象，找出入口模块对应的所有 "),t("code",[s._v("Module")]),s._v(" 对象，并将依赖关系转化为 ChunkGraph 对象")]),s._v(" "),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("p",[s._v("综上，Webpack 构建过程中会持续收集模块之间的引用、被引用关系，并记录到 Dependency Graph 结构中，后续的 Chunk 封装、Code Split、Tree-Shaking 等，但凡需要分析模块关系的功能都强依赖于 Dependency Graph。")]),s._v(" "),t("p",[s._v("可以说，Dependency Graph 是 Webpack 底层最关键的模块地图数据，因此在 Webpack5 之后，Dependency Graph 结构被解耦抽离为以 "),t("code",[s._v("ModuleGraph")]),s._v(" 为中心的若干独立类型，架构逻辑更合理，模块搜索、分析效率也得到不同程度优化，进而使得 Webpack5 构建速度也有明显提升。")])])}),[],!1,null,null,null);n.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{575:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"reconciler-è°ƒå’Œå™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reconciler-è°ƒå’Œå™¨"}},[t._v("#")]),t._v(" Reconciler è°ƒå’Œå™¨")]),t._v(" "),a("ul",[a("li",[t._v("ä»€ä¹ˆæ˜¯ fiber? Fiber æ¶æ„è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ")]),t._v(" "),a("li",[t._v("Fiber root å’Œ root fiber æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),t._v(" "),a("li",[t._v("ä¸åŒ fiber ä¹‹é—´å¦‚ä½•å»ºç«‹èµ·å…³è”çš„ï¼Ÿ")]),t._v(" "),a("li",[t._v("React è°ƒå’Œæµç¨‹ï¼Ÿ")]),t._v(" "),a("li",[t._v("ä¸¤å¤§é˜¶æ®µ commit å’Œ render éƒ½åšäº†å“ªäº›äº‹æƒ…ï¼Ÿ")]),t._v(" "),a("li",[t._v("ä»€ä¹ˆæ˜¯åŒç¼“å†²æ ‘ï¼Ÿ æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ")]),t._v(" "),a("li",[t._v("Fiber æ·±åº¦éå†æµç¨‹ï¼Ÿ")]),t._v(" "),a("li",[t._v("Fiber çš„è°ƒå’Œèƒ½ä¸­æ–­å—ï¼Ÿ å¦‚ä½•ä¸­æ–­ï¼Ÿ")])]),t._v(" "),a("h2",{attrs:{id:"fiber"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fiber"}},[t._v("#")]),t._v(" Fiber")]),t._v(" "),a("p",[a("strong",[t._v("ä»€ä¹ˆæ˜¯ fiber")])]),t._v(" "),a("p",[t._v("fiber æ¶æ„ï¼Œç›®çš„å°±æ˜¯è§£å†³å¤§å‹ React åº”ç”¨å¡é¡¿ï¼›fiber åœ¨ React ä¸­æ˜¯æœ€å°ç²’åº¦çš„æ‰§è¡Œå•å…ƒï¼Œæ— è®º React è¿˜æ˜¯ Vue ï¼Œåœ¨éå†æ›´æ–°æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™éƒ½ä¸æ˜¯ç”¨çš„çœŸå® DOM ï¼Œéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿ DOM ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£æˆ fiber å°±æ˜¯ React çš„è™šæ‹Ÿ DOM ã€‚")]),t._v(" "),a("p",[t._v("Fiber æ˜¯ä¸€ä¸ª"),a("strong",[t._v("åŸºäºä¼˜å…ˆçº§ç­–ç•¥")]),t._v("å’Œ"),a("strong",[t._v("å¸§é—´å›è°ƒ")]),t._v("çš„"),a("strong",[t._v("å¾ªç¯ä»»åŠ¡è°ƒåº¦ç®—æ³•")]),t._v("çš„æ¶æ„æ–¹æ¡ˆã€‚")]),t._v(" "),a("p",[t._v("å¤§é‡çš„ç»„ä»¶æ¸²æŸ“ä¼šå¯¼è‡´ä¸»è¿›ç¨‹é•¿æ—¶é—´è¢«å ç”¨ï¼Œå¯¼è‡´ä¸€äº›åŠ¨ç”»æˆ–é«˜é¢‘æ“ä½œå‡ºç°å¡é¡¿å’Œæ‰å¸§çš„æƒ…å†µã€‚è€Œå…³é”®ç‚¹ï¼Œä¾¿æ˜¯ åŒæ­¥é˜»å¡ã€‚åœ¨ä¹‹å‰çš„è°ƒåº¦ç®—æ³•ä¸­ï¼ŒReact éœ€è¦å®ä¾‹åŒ–æ¯ä¸ªç±»ç»„ä»¶ï¼Œç”Ÿæˆä¸€æ£µç»„ä»¶æ ‘ï¼Œä½¿ç”¨ åŒæ­¥é€’å½’ çš„æ–¹å¼è¿›è¡Œéå†æ¸²æŸ“ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯æ— æ³• æš‚åœå’Œæ¢å¤ã€‚")]),t._v(" "),a("p",[t._v("å½“é‡åˆ°è¿›ç¨‹åŒæ­¥é˜»å¡çš„é—®é¢˜æ—¶ï¼Œä»»åŠ¡åˆ†å‰²ã€å¼‚æ­¥è°ƒç”¨ å’Œ ç¼“å­˜ç­–ç•¥ æ˜¯ä¸‰ä¸ªæ˜¾è‘—çš„è§£å†³æ€è·¯ã€‚è€Œ React Fiber ä¾¿æ˜¯ä¸ºäº†å®ç°ä»»åŠ¡åˆ†å‰²è€Œè¯ç”Ÿçš„ã€‚ Fiber æ¶æ„çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ ä»»åŠ¡æ‹†åˆ† å’Œ ååŒï¼Œä¸»åŠ¨æŠŠæ‰§è¡Œæƒäº¤ç»™ä¸»çº¿ç¨‹ï¼Œä½¿ä¸»çº¿ç¨‹æœ‰æ—¶é—´ç©ºæ¡£å¤„ç†å…¶ä»–é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[t._v("React Fiber æœ€ç»ˆæä¾›çš„å…³é”®ç‰¹æ€§ä¸»è¦æ˜¯ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¢é‡æ¸²æŸ“ï¼ˆæŠŠæ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆå—ï¼Œå‡åŒ€åˆ†å¸ƒåˆ°å¤šå¸§ï¼‰")]),t._v(" "),a("li",[t._v("æ›´æ–°æ—¶èƒ½å¤Ÿæš‚åœã€ç»ˆæ­¢ã€å¤ç”¨æ¸²æŸ“ä»»åŠ¡")]),t._v(" "),a("li",[t._v("ç»™ä¸åŒç±»å‹çš„æ›´æ–°èµ‹äºˆä¼˜å…ˆçº§")]),t._v(" "),a("li",[t._v("å¹¶å‘æ–¹é¢æ–°çš„åŸºç¡€èƒ½åŠ›")])]),t._v(" "),a("p",[a("strong",[t._v("ä¸ºä»€ä¹ˆè¦ç”¨ fiber")])]),t._v(" "),a("p",[t._v("åœ¨æµè§ˆå™¨ä¸­ï¼Œé¡µé¢æ˜¯ä¸€å¸§ä¸€å¸§ç»˜åˆ¶å‡ºæ¥çš„ï¼Œæ¸²æŸ“çš„å¸§ç‡ä¸è®¾å¤‡çš„åˆ·æ–°ç‡ä¿æŒä¸€è‡´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¾å¤‡çš„å±å¹•åˆ·æ–°ç‡ä¸º1s 60æ¬¡ï¼Œå½“æ¯ç§’å†…ç»˜åˆ¶çš„å¸§æ•°ï¼ˆFPSï¼‰è¶…è¿‡60æ—¶ï¼Œé¡µé¢æ¸²æŸ“æ˜¯æµç•…çš„ï¼›è€Œå½“FPSå°äº60æ—¶ï¼Œä¼šå‡ºç°ä¸€å®šç¨‹åº¦çš„å¡é¡¿ç°è±¡ã€‚ä¸‹é¢æ¥çœ‹å®Œæ•´çš„ä¸€å¸§ä¸­ï¼Œå…·ä½“åšäº†å“ªäº›äº‹æƒ…ï¼š")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/react/reconciler3.png",alt:"reconciler3"}}),t._v(" "),a("img",{attrs:{src:"/blog/images/react/reconciler4.png",alt:"reconciler4"}})]),t._v(" "),a("p",[a("strong",[t._v("ä¸€å¸§")]),t._v(" å†…å¯å®Œæˆå¦‚ä¸‹å…­ä¸ªæ­¥éª¤çš„ä»»åŠ¡ï¼š")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("ç”¨æˆ·äº¤äº’è¾“å…¥äº‹ä»¶ï¼ˆInput eventsï¼‰ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·å¾—åˆ°æœ€æ—©çš„åé¦ˆã€‚")]),t._v(" "),a("ul",[a("li",[t._v("Blocking input eventsï¼ˆé˜»å¡è¾“å…¥äº‹ä»¶ï¼‰ï¼šä¾‹å¦‚ touch æˆ– wheel")]),t._v(" "),a("li",[t._v("Non-blocking input eventsï¼ˆéé˜»å¡è¾“å…¥äº‹ä»¶ï¼‰ï¼šä¾‹å¦‚ click æˆ– keypress")])])]),t._v(" "),a("li",[a("p",[t._v("JavaScript å¼•æ“è§£ææ‰§è¡Œï¼šæ‰§è¡Œå®šæ—¶å™¨ï¼ˆTimersï¼‰äº‹ä»¶ç­‰å›è°ƒï¼Œéœ€è¦æ£€æŸ¥å®šæ—¶å™¨æ˜¯å¦åˆ°æ—¶é—´ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å›è°ƒã€‚")])]),t._v(" "),a("li",[a("p",[t._v("å¸§å¼€å§‹ï¼ˆBegin frameï¼‰ï¼šæ¯ä¸€å¸§äº‹ä»¶ï¼ˆPer frame eventsï¼‰ï¼Œä¾‹å¦‚ window resizeã€scroll æˆ– media query change")])]),t._v(" "),a("li",[a("p",[t._v("æ‰§è¡Œè¯·æ±‚åŠ¨ç”»å¸§ rAFï¼ˆrequestAnimationFrameï¼‰ï¼Œå³åœ¨æ¯æ¬¡ç»˜åˆ¶ä¹‹å‰ï¼Œä¼šæ‰§è¡Œ rAF å›è°ƒã€‚")])]),t._v(" "),a("li",[a("p",[t._v("é¡µé¢å¸ƒå±€ï¼ˆLayoutï¼‰ï¼šè®¡ç®—æ ·å¼ï¼ˆRecalculate styleï¼‰å’Œæ›´æ–°å¸ƒå±€ï¼ˆUpdate Layoutï¼‰ã€‚å³è¿™ä¸ªå…ƒç´ çš„æ ·å¼æ˜¯æ€æ ·çš„ï¼Œå®ƒåº”è¯¥åœ¨é¡µé¢å¦‚ä½•å±•ç¤ºã€‚")])]),t._v(" "),a("li",[a("p",[t._v("ç»˜åˆ¶æ¸²æŸ“ï¼ˆPaintï¼‰ï¼šåˆæˆæ›´æ–°ï¼ˆCompositing updateï¼‰ã€é‡ç»˜éƒ¨åˆ†èŠ‚ç‚¹ï¼ˆPaint invalidationï¼‰å’Œ Recordã€‚å¾—åˆ°æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸ä¸ä½ç½®ç­‰ä¿¡æ¯ï¼Œæµè§ˆå™¨é’ˆå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå†…å®¹å¡«å……ã€‚")])]),t._v(" "),a("li",[a("p",[t._v("ä¸Šè¿°6ä¸ªé˜¶æ®µå®Œæˆï¼Œå°±å¤„äº ç©ºé—²é˜¶æ®µï¼ˆIdle Peroidï¼‰ä¼šæ‰§è¡Œ RIC (RequestIdelCallback)æ³¨å†Œçš„ä»»åŠ¡ã€‚")])])]),t._v(" "),a("p",[t._v("JS å¼•æ“å’Œé¡µé¢æ¸²æŸ“å¼•æ“æ˜¯åœ¨åŒä¸€ä¸ªæ¸²æŸ“çº¿ç¨‹(ä¸»çº¿ç¨‹)ä¹‹å†…ï¼Œä¸¤è€…æ˜¯äº’æ–¥å…³ç³»ã€‚å¦‚æœåœ¨æŸä¸ªé˜¶æ®µæ‰§è¡Œä»»åŠ¡ç‰¹åˆ«é•¿ï¼Œä¾‹å¦‚åœ¨å®šæ—¶å™¨é˜¶æ®µæˆ– Begin Frame é˜¶æ®µæ‰§è¡Œæ—¶é—´éå¸¸é•¿ï¼Œæ—¶é—´å·²ç»æ˜æ˜¾è¶…è¿‡äº† 16msï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“ï¼Œä»è€Œå‡ºç°å¡é¡¿ç°è±¡ã€‚")]),t._v(" "),a("p",[t._v("åœ¨ "),a("code",[t._v("Reactv15")]),t._v(" ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒReact å¯¹äºè™šæ‹Ÿ DOM æ˜¯é‡‡ç”¨è‡ªé¡¶å‘ä¸‹é€’å½’ï¼ˆæ·±åº¦ä¼˜å…ˆéå†ï¼‰å¯¹æ¯”è™šæ‹Ÿ DOM æ ‘ï¼Œæ‰¾å‡ºéœ€è¦å˜åŠ¨çš„èŠ‚ç‚¹ï¼Œç„¶ååŒæ­¥æ›´æ–°å®ƒä»¬ï¼Œè¿™ä¸ªè¿‡ç¨‹ react ç§°ä¸º reconcilationï¼ˆè°ƒå’Œï¼‰ã€‚åœ¨ reconcilation æœŸé—´ï¼Œreact ä¼šä¸€ç›´å ç”¨æµè§ˆå™¨èµ„æºï¼Œä¼šå¯¼è‡´ç”¨æˆ·è§¦å‘çš„äº‹ä»¶å¾—ä¸åˆ°å“åº”ã€‚éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼Œå±‚çº§è¶Šæ¥è¶Šæ·±ï¼Œå¯¼è‡´æ›´æ–°çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œç»™å‰ç«¯äº¤äº’ä¸Šçš„ä½“éªŒå°±æ˜¯å¡é¡¿ã€‚"),a("strong",[t._v("æ‰€ä»¥ V16 ä¹‹å‰æœ‰ä¸€ä¸‹ 3 ä¸ªç—›ç‚¹")]),t._v("ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("é€’å½’è°ƒç”¨ï¼Œæ‰§è¡Œæ ˆä¼šè¶Šæ¥è¶Šæ·±ã€‚")]),t._v(" "),a("li",[t._v("åŒæ­¥æ›´æ–°è™šæ‹Ÿã€€DOMï¼Œä¸èƒ½ä¸­æ–­ï¼Œä¸­æ–­åä¹Ÿä¸èƒ½æ¢å¤ã€‚")]),t._v(" "),a("li",[t._v("JS ä»£ç æ‰§è¡Œæ—¶é—´é•¿ï¼Œä¼šæŒç»­å ç”¨ä¸»çº¿ç¨‹ï¼Œå‡ºç°æ¸²æŸ“å¡é¡¿ã€‚")])]),t._v(" "),a("p",[t._v("å½“é‡åˆ°è¿›ç¨‹åŒæ­¥é˜»å¡çš„é—®é¢˜æ—¶ï¼Œ"),a("strong",[t._v("ä»»åŠ¡åˆ†å‰²ã€å¼‚æ­¥è°ƒç”¨")]),t._v(" å’Œ "),a("strong",[t._v("ç¼“å­˜ç­–ç•¥")]),t._v(" æ˜¯ä¸‰ä¸ªæ˜¾è‘—çš„è§£å†³æ€è·¯ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³ä»¥ä¸Šçš„ç—›ç‚¹é—®é¢˜ï¼ŒReact è®¾è®¡äº† Fiber æ¶æ„ï¼Œ æŠŠæ›´æ–°ã€æ¸²æŸ“è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªå°å—çš„ä»»åŠ¡ï¼Œé€šè¿‡åˆç†çš„è°ƒåº¦æœºåˆ¶æ¥è°ƒæ§æ—¶é—´ï¼ŒæŒ‡å®šä»»åŠ¡æ‰§è¡Œçš„æ—¶æœºï¼Œå®ç°å¼‚æ­¥å¯ä¸­æ–­æ‰§è¡Œï¼Œä»è€Œé™ä½é¡µé¢å¡é¡¿çš„æ¦‚ç‡ï¼Œæå‡é¡µé¢äº¤äº’ä½“éªŒã€‚é€šè¿‡ Fiber æ¶æ„ï¼Œè®© reconcilation è¿‡ç¨‹å˜å¾—å¯è¢«ä¸­æ–­ï¼Œé€‚æ—¶åœ°è®©å‡º CPU æ‰§è¡Œæƒï¼Œå¯ä»¥è®©æµè§ˆå™¨åŠæ—¶åœ°å“åº”ç”¨æˆ·çš„äº¤äº’ã€‚ï¼ˆå°±æ˜¯ä½¿ JS çš„æ‰§è¡Œå˜æˆå¯æ§ï¼Œä¸å¸Œæœ› JS ä¸å—æ§åˆ¶åœ°é•¿æ—¶é—´æ‰§è¡Œï¼‰")]),t._v(" "),a("p",[a("code",[t._v("Reactv16")]),t._v(" ä¸ºäº†è§£å†³å¡é¡¿é—®é¢˜å¼•å…¥äº† fiber ï¼Œä¸ºä»€ä¹ˆå®ƒèƒ½è§£å†³å¡é¡¿ï¼Œæ›´æ–° fiber çš„è¿‡ç¨‹å«åš "),a("code",[t._v("Reconciler")]),t._v("ï¼ˆè°ƒå’Œå™¨ï¼‰ï¼Œæ¯ä¸€ä¸ª fiber éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªæ‰§è¡Œå•å…ƒæ¥å¤„ç†ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª fiber å¯ä»¥æ ¹æ®è‡ªèº«çš„è¿‡æœŸæ—¶é—´"),a("code",[t._v("expirationTime")]),t._v("ï¼ˆ v17 ç‰ˆæœ¬å«åšä¼˜å…ˆçº§ "),a("code",[t._v("lane")]),t._v(" ï¼‰æ¥åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ç©ºé—´æ—¶é—´æ‰§è¡Œæ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´æ›´æ–°ï¼Œå°±è¦æŠŠä¸»åŠ¨æƒäº¤ç»™æµè§ˆå™¨å»æ¸²æŸ“ï¼Œåšä¸€äº›åŠ¨ç”»ï¼Œé‡æ’ï¼ˆ reflow ï¼‰ï¼Œé‡ç»˜ repaints ä¹‹ç±»çš„äº‹æƒ…ï¼Œè¿™æ ·å°±èƒ½ç»™ç”¨æˆ·æ„Ÿè§‰ä¸æ˜¯å¾ˆå¡ã€‚ç„¶åç­‰æµè§ˆå™¨ç©ºä½™æ—¶é—´ï¼Œåœ¨é€šè¿‡ "),a("code",[t._v("scheduler")]),t._v(" ï¼ˆè°ƒåº¦å™¨ï¼‰ï¼Œå†æ¬¡æ¢å¤æ‰§è¡Œå•å…ƒä¸Šæ¥ï¼Œè¿™æ ·å°±èƒ½æœ¬è´¨ä¸Šä¸­æ–­äº†æ¸²æŸ“ï¼Œæé«˜äº†ç”¨æˆ·ä½“éªŒã€‚")]),t._v(" "),a("p",[t._v("Fiber æ¶æ„çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯"),a("strong",[t._v("ä»»åŠ¡æ‹†åˆ†")]),t._v("å’Œ"),a("strong",[t._v("ååŒ")]),t._v("ï¼Œä¸»åŠ¨æŠŠæ‰§è¡Œæƒäº¤ç»™ä¸»çº¿ç¨‹ï¼Œä½¿ä¸»çº¿ç¨‹æœ‰æ—¶é—´ç©ºæ¡£å¤„ç†å…¶ä»–é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€‚")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("åˆä½œå¼è°ƒåº¦")]),t._v(" "),a("p",[t._v("è¿™ç§æŠŠæ¸²æŸ“æ›´æ–°è¿‡ç¨‹æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œæ¯æ¬¡åªåšä¸€å°éƒ¨åˆ†ï¼Œåšå®Œçœ‹æ˜¯å¦è¿˜æœ‰å‰©ä½™æ—¶é—´ï¼Œå¦‚æœæœ‰ç»§ç»­ä¸‹ä¸ªä»»åŠ¡ï¼›å¦‚æœæ²¡æœ‰ï¼ŒæŒ‚èµ·å½“å‰ä»»åŠ¡ï¼Œå°†æ—¶é—´æ§åˆ¶æƒäº¤ç»™ä¸»çº¿ç¨‹ï¼Œç­‰ä¸»çº¿ç¨‹ä¸å¿™çš„æ—¶å€™å†ç»§ç»­æ‰§è¡Œã€‚è¿™ç§ç­–ç•¥å«åš "),a("a",{attrs:{href:"https://www.w3.org/TR/requestidlecallback/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cooperative Schedulingï¼ˆåˆä½œå¼è°ƒåº¦ï¼‰"),a("OutboundLink")],1),t._v("ï¼Œæ“ä½œç³»ç»Ÿå¸¸ç”¨ä»»åŠ¡è°ƒåº¦ç­–ç•¥ä¹‹ä¸€ã€‚")]),t._v(" "),a("p",[t._v("æ“ä½œç³»ç»Ÿå¸¸ç”¨ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼šå…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•ã€çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰æœ‰é™è°ƒåº¦ç®—æ³•ï¼ˆSJ/PFï¼‰ã€æœ€é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆFPFï¼‰ã€é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRNï¼‰ã€æ—¶é—´ç‰‡è½®è½¬æ³•ï¼ˆRRï¼‰ã€å¤šçº§é˜Ÿåˆ—åé¦ˆæ³•ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"element-fiber-dom-ä¹‹é—´å…³ç³»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#element-fiber-dom-ä¹‹é—´å…³ç³»"}},[t._v("#")]),t._v(" element,fiber,dom ä¹‹é—´å…³ç³»")]),t._v(" "),a("p",[t._v("é¦–å…ˆå¿…é¡»éœ€è¦å¼„æ˜ç™½ React.element ï¼Œfiber å’ŒçœŸå® DOM ä¸‰è€…æ˜¯ä»€ä¹ˆå…³ç³»ã€‚")]),t._v(" "),a("ul",[a("li",[t._v("element æ˜¯ React è§†å›¾å±‚åœ¨ä»£ç å±‚çº§ä¸Šçš„è¡¨è±¡ï¼Œä¹Ÿå°±æ˜¯å¼€å‘è€…å†™çš„ jsx è¯­æ³•ï¼Œå†™çš„å…ƒç´ ç»“æ„ï¼Œéƒ½ä¼šè¢«åˆ›å»ºæˆ element å¯¹è±¡çš„å½¢å¼ã€‚ä¸Šé¢ä¿å­˜äº† props ï¼Œ children ç­‰ä¿¡æ¯ã€‚")]),t._v(" "),a("li",[t._v("DOM æ˜¯å…ƒç´ åœ¨æµè§ˆå™¨ä¸Šç»™ç”¨æˆ·ç›´è§‚çš„è¡¨è±¡ã€‚")]),t._v(" "),a("li",[t._v("fiber å¯ä»¥è¯´æ˜¯æ˜¯ element å’ŒçœŸå® DOM ä¹‹é—´çš„äº¤æµæ¢çº½ç«™ï¼Œä¸€æ–¹é¢æ¯ä¸€ä¸ªç±»å‹ element éƒ½ä¼šæœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ fiber ç±»å‹ï¼Œelement å˜åŒ–å¼•èµ·æ›´æ–°æµç¨‹éƒ½æ˜¯é€šè¿‡ fiber å±‚é¢åšä¸€æ¬¡è°ƒå’Œæ”¹å˜ï¼Œç„¶åå¯¹äºå…ƒç´ ï¼Œå½¢æˆæ–°çš„ DOM åšè§†å›¾æ¸²æŸ“ã€‚")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/react/reconciler1.png",alt:"reconciler"}})]),t._v(" "),a("p",[t._v("é¦–å…ˆå…ˆæ¥çœ‹ä¸€ä¸‹ element ä¸ fiber ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼š")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" FunctionComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº”å‡½æ•°ç»„ä»¶")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ClassComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº”çš„ç±»ç»„ä»¶")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" IndeterminateComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆå§‹åŒ–çš„æ—¶å€™ä¸çŸ¥é“æ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Root Fiber å¯ä»¥ç†è§£ä¸ºè·Ÿå…ƒç´  ï¼Œ é€šè¿‡reactDom.render()äº§ç”Ÿçš„æ ¹å…ƒç´ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostPortal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº”  ReactDOM.createPortal äº§ç”Ÿçš„ Portal ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dom å…ƒç´  æ¯”å¦‚ <div>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostText "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–‡æœ¬èŠ‚ç‚¹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Fragment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <React.Fragment> ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <React.StrictMode>   ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ContextConsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <Context.Consumer>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ContextProvider "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <Context.Provider>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ForwardRef "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” React.ForwardRef")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Profiler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <Profiler/ >")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SuspenseComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” <Suspense>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" MemoComponent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹åº” React.memo è¿”å›çš„ç»„ä»¶")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("h3",{attrs:{id:"fiber-ä¿å­˜çš„ä¿¡æ¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fiber-ä¿å­˜çš„ä¿¡æ¯"}},[t._v("#")]),t._v(" fiber ä¿å­˜çš„ä¿¡æ¯")]),t._v(" "),a("p",[t._v("fiber ä½œä¸º element å’ŒçœŸå® DOM å…ƒç´ çš„æ²Ÿé€šæ¢çº½ï¼Œé‚£ä¹ˆä¸€ä¸ª fiber ä¸Šåˆ°åº•ä¿å­˜äº†é‚£äº›ä¿¡æ¯å‘¢ï¼Ÿ")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FiberNode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fiber æ ‡ç­¾ è¯æ˜æ˜¯ä»€ä¹ˆç±»å‹fiberã€‚")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// keyè°ƒå’Œå­èŠ‚ç‚¹æ—¶å€™ç”¨åˆ°ã€‚ ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// domå…ƒç´ æ˜¯å¯¹åº”çš„å…ƒç´ ç±»å‹ï¼Œæ¯”å¦‚divï¼Œç»„ä»¶æŒ‡å‘ç»„ä»¶å¯¹åº”çš„ç±»æˆ–è€…å‡½æ•°ã€‚  ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘å¯¹åº”çš„çœŸå®domå…ƒç´ ï¼Œç±»ç»„ä»¶æŒ‡å‘ç»„ä»¶å®ä¾‹ï¼Œå¯ä»¥è¢«refè·å–ã€‚")]),t._v("\n \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘çˆ¶çº§fiber")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘å­çº§fiber")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘å…„å¼Ÿfiber ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç´¢å¼•")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// refæŒ‡å‘ï¼Œrefå‡½æ•°ï¼Œæˆ–è€…refå¯¹è±¡ã€‚")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pendingProps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pendingProps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œä»£è¡¨elementåˆ›å»º")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedProps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®°å½•ä¸Šä¸€æ¬¡æ›´æ–°å®Œæ¯•åçš„props")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç±»ç»„ä»¶å­˜æ”¾setStateæ›´æ–°é˜Ÿåˆ—ï¼Œå‡½æ•°ç»„ä»¶å­˜æ”¾")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç±»ç»„ä»¶ä¿å­˜stateä¿¡æ¯ï¼Œå‡½æ•°ç»„ä»¶ä¿å­˜hooksä¿¡æ¯ï¼Œdomå…ƒç´ ä¸ºnull")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependencies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// contextæˆ–æ˜¯æ—¶é—´çš„ä¾èµ–é¡¹")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æè¿°fiberæ ‘çš„æ¨¡å¼ï¼Œæ¯”å¦‚ ConcurrentMode æ¨¡å¼")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// effectæ ‡ç­¾ï¼Œç”¨äºæ”¶é›†effectList")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘ä¸‹ä¸€ä¸ªeffect")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç¬¬ä¸€ä¸ªeffect")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æœ€åä¸€ä¸ªeffect")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expirationTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€šè¿‡ä¸åŒè¿‡æœŸæ—¶é—´ï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¿‡æœŸï¼Œ åœ¨v17ç‰ˆæœ¬ç”¨laneè¡¨ç¤ºã€‚")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åŒç¼“å­˜æ ‘ï¼ŒæŒ‡å‘ç¼“å­˜çš„fiberã€‚æ›´æ–°é˜¶æ®µï¼Œä¸¤é¢—æ ‘äº’ç›¸äº¤æ›¿ã€‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br")])]),a("h3",{attrs:{id:"fiber-èŠ‚ç‚¹é—´çš„å…³è”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fiber-èŠ‚ç‚¹é—´çš„å…³è”"}},[t._v("#")]),t._v(" fiber èŠ‚ç‚¹é—´çš„å…³è”")]),t._v(" "),a("p",[t._v("å¯¹äºæ¯ä¸€ä¸ª element éƒ½ä¼šå¯¹åº”ä¸€ä¸ª fiber ï¼Œæ¯ä¸€ä¸ª fiber æ˜¯é€šè¿‡ return ï¼Œ child ï¼Œsibling ä¸‰ä¸ªå±æ€§å»ºç«‹èµ·è”ç³»çš„ã€‚")]),t._v(" "),a("ul",[a("li",[t._v("returnï¼š æŒ‡å‘çˆ¶çº§ Fiber èŠ‚ç‚¹ã€‚")]),t._v(" "),a("li",[t._v("childï¼š æŒ‡å‘å­ Fiber èŠ‚ç‚¹ã€‚")]),t._v(" "),a("li",[t._v("siblingï¼šæŒ‡å‘å…„å¼Ÿ fiber èŠ‚ç‚¹ã€‚")])]),t._v(" "),a("p",[t._v("æ¯”å¦‚é¡¹ç›®ä¸­å…ƒç´ ç»“æ„æ˜¯è¿™æ ·çš„ï¼š")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   state"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" number"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n   "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("handleClick")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         number"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n       helloï¼Œworld\n       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("number "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ğŸ‘  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handleClick "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ç‚¹èµ"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("h2",{attrs:{id:"fiberæ›´æ–°æœºåˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fiberæ›´æ–°æœºåˆ¶"}},[t._v("#")]),t._v(" Fiberæ›´æ–°æœºåˆ¶")]),t._v(" "),a("h3",{attrs:{id:"åˆå§‹åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆå§‹åŒ–"}},[t._v("#")]),t._v(" åˆå§‹åŒ–")]),t._v(" "),a("p",[a("strong",[t._v("ç¬¬ä¸€æ­¥ï¼šåˆ›å»º fiberRoo tå’Œ rootFiber")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("fiberRoot")]),t._v("ï¼šé¦–æ¬¡æ„å»ºåº”ç”¨ï¼Œ åˆ›å»ºä¸€ä¸ª fiberRoot ï¼Œä½œä¸ºæ•´ä¸ª React åº”ç”¨çš„æ ¹åŸºã€‚")]),t._v(" "),a("li",[a("code",[t._v("rootFiber")]),t._v("ï¼š å¦‚ä¸‹é€šè¿‡ ReactDOM.render æ¸²æŸ“å‡ºæ¥çš„ï¼Œå¦‚ä¸Š Index å¯ä»¥ä½œä¸ºä¸€ä¸ª rootFiberã€‚ä¸€ä¸ª React åº”ç”¨å¯ä»¥æœ‰å¤š ReactDOM.render åˆ›å»ºçš„ rootFiber ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ª fiberRootï¼ˆåº”ç”¨æ ¹èŠ‚ç‚¹ï¼‰ã€‚")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ReactDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("ç¬¬ä¸€æ¬¡æŒ‚è½½çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°† fiberRoot å’Œ rootFiber å»ºç«‹èµ·å…³è”ã€‚")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactFiberRoot.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("containerInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("tag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* åˆ›å»ºä¸€ä¸ªroot */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FiberRootNode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("containerInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rootFiber "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHostRootFiber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rootFiber\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" root\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[t._v("ç¬¬äºŒæ­¥ï¼šworkInProgresså’Œcurrent")])]),t._v(" "),a("p",[t._v("ç»è¿‡ç¬¬ä¸€æ­¥çš„å¤„ç†ï¼Œå¼€å§‹åˆ°æ­£å¼æ¸²æŸ“é˜¶æ®µï¼Œä¼šè¿›å…¥ "),a("code",[t._v("beginwork")]),t._v(" æµç¨‹ï¼Œåœ¨è®²æ¸²æŸ“æµç¨‹ä¹‹å‰ï¼Œè¦å…ˆå¼„æ˜ç™½ä¸¤ä¸ªæ¦‚å¿µï¼š")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("workInProgress")]),t._v(" æ˜¯ï¼šæ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„ Fiber æ ‘ç§°ä¸º "),a("code",[t._v("workInProgress Fiber æ ‘")]),t._v("ã€‚åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œæ‰€æœ‰çš„æ›´æ–°éƒ½æ˜¯å‘ç”Ÿåœ¨ "),a("code",[t._v("workInProgress")]),t._v(" æ ‘ä¸Šã€‚åœ¨ä¸€æ¬¡æ›´æ–°ä¹‹åï¼Œ"),a("code",[t._v("workInProgress æ ‘")]),t._v("ä¸Šçš„çŠ¶æ€æ˜¯æœ€æ–°çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒå°†å˜æˆ "),a("code",[t._v("current æ ‘")]),t._v("ç”¨äºæ¸²æŸ“è§†å›¾ã€‚")]),t._v(" "),a("li",[a("code",[t._v("current")]),t._v("ï¼šæ­£åœ¨è§†å›¾å±‚æ¸²æŸ“çš„æ ‘å«åš "),a("code",[t._v("current æ ‘")]),t._v("ã€‚")])]),t._v(" "),a("p",[t._v("æ¥ä¸‹æ¥ä¼šåˆ° "),a("code",[t._v("rootFiber")]),t._v(" çš„æ¸²æŸ“æµç¨‹ï¼Œé¦–å…ˆä¼šå¤ç”¨å½“å‰ current æ ‘ï¼ˆ rootFiber ï¼‰çš„ "),a("code",[t._v("alternate")]),t._v(" ä½œä¸º "),a("code",[t._v("workInProgress")]),t._v(" ï¼Œå¦‚æœæ²¡æœ‰ alternate ï¼ˆåˆå§‹åŒ–çš„ rootFiber æ˜¯æ²¡æœ‰ alternate ï¼‰ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºä¸€ä¸ª fiber ä½œä¸º "),a("code",[t._v("workInProgress")]),t._v(" ã€‚ä¼šç”¨ "),a("code",[t._v("alternate")]),t._v(" å°†æ–°åˆ›å»ºçš„ "),a("code",[t._v("workInProgress")]),t._v(" ä¸ "),a("code",[t._v("current")]),t._v(" æ ‘å»ºç«‹èµ·å…³è”ã€‚è¿™ä¸ªå…³è”è¿‡ç¨‹åªæœ‰åˆå§‹åŒ–ç¬¬ä¸€æ¬¡åˆ›å»º "),a("code",[t._v("alternate")]),t._v(" æ—¶å€™è¿›è¡Œã€‚")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("currentFiber"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgressFiber\nworkInProgressFiber"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentFiber\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[a("strong",[t._v("ç¬¬ä¸‰æ­¥ï¼šæ·±åº¦è°ƒå’Œå­èŠ‚ç‚¹ï¼Œæ¸²æŸ“è§†å›¾")])]),t._v(" "),a("p",[t._v("æ¥ä¸‹æ¥ä¼šæŒ‰ç…§ä¸Šè¿°ç¬¬äºŒæ­¥ï¼Œåœ¨æ–°åˆ›å»ºçš„ alternates ä¸Šï¼Œå®Œæˆæ•´ä¸ª fiber æ ‘çš„éå†ï¼ŒåŒ…æ‹¬ fiber çš„åˆ›å»ºã€‚æœ€åä¼šä»¥ workInProgress ä½œä¸ºæœ€æ–°çš„æ¸²æŸ“æ ‘ï¼ŒfiberRoot çš„ current æŒ‡é’ˆæŒ‡å‘ workInProgress ä½¿å…¶å˜ä¸º current Fiber æ ‘ã€‚åˆ°æ­¤å®Œæˆåˆå§‹åŒ–æµç¨‹ã€‚")]),t._v(" "),a("h3",{attrs:{id:"æ›´æ–°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ–°"}},[t._v("#")]),t._v(" æ›´æ–°")]),t._v(" "),a("p",[t._v("æ›´æ–°æ—¶ï¼Œé‡æ–°åˆ›å»ºä¸€é¢— "),a("code",[t._v("workInProgresss æ ‘")]),t._v("ï¼Œå¤ç”¨å½“å‰ current æ ‘ä¸Šçš„ "),a("code",[t._v("alternate")]),t._v(" ï¼Œä½œä¸ºæ–°çš„ "),a("code",[t._v("workInProgress")]),t._v(" ï¼Œç”±äºåˆå§‹åŒ– rootfiber æœ‰ "),a("code",[t._v("alternate")]),t._v(" ï¼Œæ‰€ä»¥å¯¹äºå‰©ä½™çš„å­èŠ‚ç‚¹ï¼ŒReact è¿˜éœ€è¦åˆ›å»ºä¸€ä»½ï¼Œå’Œ "),a("code",[t._v("current æ ‘")]),t._v("ä¸Šçš„ fiber å»ºç«‹èµ· "),a("code",[t._v("alternate")]),t._v(" å…³è”ã€‚æ¸²æŸ“å®Œæ¯•åï¼Œ"),a("code",[t._v("workInProgresss")]),t._v(" å†æ¬¡å˜æˆ "),a("code",[t._v("current æ ‘")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"åŒç¼“å†²æ ‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŒç¼“å†²æ ‘"}},[t._v("#")]),t._v(" åŒç¼“å†²æ ‘")]),t._v(" "),a("p",[t._v("canvas ç»˜åˆ¶åŠ¨ç”»çš„æ—¶å€™ï¼Œå¦‚æœä¸Šä¸€å¸§è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§ç”»é¢åˆ°ç»˜åˆ¶å½“å‰å¸§ç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œcanvas åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œç”±äºçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œä¸ä¼šå‡ºç°ä»ç™½å±åˆ°å‡ºç°ç”»é¢çš„é—ªçƒæƒ…å†µã€‚è¿™ç§åœ¨å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢çš„æŠ€æœ¯å«åš"),a("strong",[t._v("åŒç¼“å­˜")]),t._v("ã€‚")]),t._v(" "),a("p",[t._v("React ç”¨ workInProgress æ ‘(å†…å­˜ä¸­æ„å»ºçš„æ ‘) å’Œ current (æ¸²æŸ“æ ‘) æ¥å®ç°æ›´æ–°é€»è¾‘ã€‚åŒç¼“å­˜ä¸€ä¸ªåœ¨å†…å­˜ä¸­æ„å»ºï¼Œä¸€ä¸ªæ¸²æŸ“è§†å›¾ï¼Œä¸¤é¢—æ ‘ç”¨ alternate æŒ‡é’ˆç›¸äº’æŒ‡å‘ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œç›´æ¥å¤ç”¨ç¼“å­˜æ ‘åšä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“æ ‘ï¼Œä¸Šä¸€æ¬¡çš„æ¸²æŸ“æ ‘åˆä½œä¸ºç¼“å­˜æ ‘ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢åªç”¨ä¸€é¢—æ ‘æ›´æ–°çŠ¶æ€çš„ä¸¢å¤±çš„æƒ…å†µï¼ŒåˆåŠ å¿«äº† DOM èŠ‚ç‚¹çš„æ›¿æ¢ä¸æ›´æ–°ã€‚")]),t._v(" "),a("h2",{attrs:{id:"ä¸¤å¤§é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¤å¤§é˜¶æ®µ"}},[t._v("#")]),t._v(" ä¸¤å¤§é˜¶æ®µ")]),t._v(" "),a("h3",{attrs:{id:"render-é˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#render-é˜¶æ®µ"}},[t._v("#")]),t._v(" render é˜¶æ®µ")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactFiberWorkLoop.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("workLoop")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      workInProgress "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performUnitOfWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("ä¸Šè¿°å·²ç»è¯´äº†ï¼Œæ¯ä¸€ä¸ª fiber å¯ä»¥çœ‹ä½œä¸€ä¸ªæ‰§è¡Œçš„å•å…ƒï¼Œåœ¨è°ƒå’Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªå‘ç”Ÿæ›´æ–°çš„ fiber éƒ½ä¼šä½œä¸ºä¸€æ¬¡ workInProgress ã€‚é‚£ä¹ˆ workLoop å°±æ˜¯æ‰§è¡Œæ¯ä¸€ä¸ªå•å…ƒçš„è°ƒåº¦å™¨ï¼Œå¦‚æœæ¸²æŸ“æ²¡æœ‰è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆ workLoop ä¼šéå†ä¸€é fiber æ ‘ã€‚ performUnitOfWork åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µ beginWork å’Œ completeWork ã€‚")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactFiberWorkLoop.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performUnitOfWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    next "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" unitOfWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" renderExpirationTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       next "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("completeUnitOfWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unitOfWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[a("code",[t._v("beginWork")]),t._v("ï¼šæ˜¯å‘ä¸‹è°ƒå’Œçš„è¿‡ç¨‹ã€‚å°±æ˜¯ç”± fiberRoot æŒ‰ç…§ child æŒ‡é’ˆé€å±‚å‘ä¸‹è°ƒå’Œï¼ŒæœŸé—´ä¼šæ‰§è¡Œå‡½æ•°ç»„ä»¶ï¼Œå®ä¾‹ç±»ç»„ä»¶ï¼Œdiff è°ƒå’Œå­èŠ‚ç‚¹ï¼Œæ‰“ä¸åŒeffectTagã€‚")]),t._v(" "),a("p",[a("code",[t._v("completeUnitOfWork")]),t._v("ï¼šæ˜¯å‘ä¸Šå½’å¹¶çš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œä¼šè¿”å› siblingå…„å¼Ÿï¼Œæ²¡æœ‰è¿”å› return çˆ¶çº§ï¼Œä¸€ç›´è¿”å›åˆ° fiebrRoot ï¼ŒæœŸé—´å¯ä»¥å½¢æˆeffectListï¼Œå¯¹äºåˆå§‹åŒ–æµç¨‹ä¼šåˆ›å»º DOM ï¼Œå¯¹äº DOM å…ƒç´ è¿›è¡Œäº‹ä»¶æ”¶é›†ï¼Œå¤„ç†styleï¼ŒclassNameç­‰ã€‚")]),t._v(" "),a("p",[t._v("è¿™ä¹ˆä¸€ä¸Šä¸€ä¸‹ï¼Œæ„æˆäº†æ•´ä¸ª fiber æ ‘çš„è°ƒå’Œã€‚")]),t._v(" "),a("h4",{attrs:{id:"å‘ä¸‹è°ƒå’Œ-beginwork"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘ä¸‹è°ƒå’Œ-beginwork"}},[t._v("#")]),t._v(" å‘ä¸‹è°ƒå’Œ beginWork")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactFiberBeginWork.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("workInProgress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IndeterminateComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆå§‹åŒ–çš„æ—¶å€™ä¸çŸ¥é“æ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶ ")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//....")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" FunctionComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¯¹åº”å‡½æ•°ç»„ä»¶")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//....")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" ClassComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ç±»ç»„ä»¶")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" HostComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...  ")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("p",[t._v("æ€»ç»“ beginWork ä½œç”¨å¦‚ä¸‹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¯¹äºç»„ä»¶ï¼Œæ‰§è¡Œéƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸï¼Œæ‰§è¡Œ render ï¼Œå¾—åˆ°æœ€æ–°çš„ children ã€‚")]),t._v(" "),a("li",[t._v("å‘ä¸‹éå†è°ƒå’Œ children ï¼Œå¤ç”¨ oldFiber ( diff ç®—æ³•)ï¼Œdiff æµç¨‹åœ¨ç¬¬åäºŒç« å·²ç»è®²è¿‡äº†ã€‚")]),t._v(" "),a("li",[t._v("æ‰“ä¸åŒçš„å‰¯ä½œç”¨æ ‡ç­¾ effectTag ï¼Œæ¯”å¦‚ç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…å…ƒç´ çš„å¢åŠ ï¼Œåˆ é™¤ï¼Œæ›´æ–°ã€‚")])]),t._v(" "),a("p",[a("strong",[t._v("reconcileChildren")])]),t._v(" "),a("p",[t._v("æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ React æ˜¯å¦‚ä½•è°ƒå’Œå­èŠ‚ç‚¹çš„ï¼š")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactFiberBeginWork.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reconcileChildren")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("workInProgress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* åˆå§‹åŒ–å­ä»£fiber  */")]),t._v("\n        workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mountChildFibers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("nextChildren"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("renderExpirationTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* æ›´æ–°æµç¨‹ï¼Œdiff childrenå°†åœ¨è¿™é‡Œè¿›è¡Œã€‚ */")]),t._v("\n        workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reconcileChildFibers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("nextChildren"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("renderExpirationTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[t._v("EffectTag")]),t._v(" æˆ‘åˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ effectTag ã€‚")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Placement "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*             */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000000000010")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ’å…¥èŠ‚ç‚¹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Update "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*                */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000000000100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ›´æ–°fiber")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Deletion "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000000001000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ é™¤fiebr")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Snapshot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000100000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¿«ç…§")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Passive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*               */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0001000000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// useEffectçš„å‰¯ä½œç”¨")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000000100000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setStateçš„ callback")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Ref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*                   */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b0000010000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ref")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h4",{attrs:{id:"å‘ä¸Šå½’å¹¶-completeunitofwork"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘ä¸Šå½’å¹¶-completeunitofwork"}},[t._v("#")]),t._v(" å‘ä¸Šå½’å¹¶ completeUnitOfWork")]),t._v(" "),a("p",[t._v("completeUnitOfWork çš„æµç¨‹æ˜¯è‡ªä¸‹å‘ä¸Šçš„ï¼Œé‚£ä¹ˆ completeUnitOfWork è¿‡ç¨‹ä¸»è¦åšå†™ä»€ä¹ˆå‘¢ï¼Ÿ")]),t._v(" "),a("ul",[a("li",[t._v("é¦–å…ˆ completeUnitOfWork ä¼šå°† effectTag çš„ Fiber èŠ‚ç‚¹ä¼šè¢«ä¿å­˜åœ¨ä¸€æ¡è¢«ç§°ä¸º effectList çš„å•å‘é“¾è¡¨ä¸­ã€‚åœ¨ commit é˜¶æ®µï¼Œå°†ä¸å†éœ€è¦éå†æ¯ä¸€ä¸ª fiber ï¼Œåªéœ€è¦æ‰§è¡Œæ›´æ–° effectList å°±å¯ä»¥äº†ã€‚")]),t._v(" "),a("li",[t._v("completeWork é˜¶æ®µå¯¹äºç»„ä»¶å¤„ç† context ï¼›å¯¹äºå…ƒç´ æ ‡ç­¾åˆå§‹åŒ–ï¼Œä¼šåˆ›å»ºçœŸå® DOM ï¼Œå°†å­å­™ DOM èŠ‚ç‚¹æ’å…¥åˆšç”Ÿæˆçš„ DOM èŠ‚ç‚¹ä¸­ï¼›ä¼šè§¦å‘ diffProperties å¤„ç† props ï¼Œæ¯”å¦‚äº‹ä»¶æ”¶é›†ï¼Œstyleï¼ŒclassName å¤„ç†ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"commité˜¶æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commité˜¶æ®µ"}},[t._v("#")]),t._v(" commité˜¶æ®µ")]),t._v(" "),a("p",[t._v("commit é˜¶æ®µåšçš„äº‹æƒ…æ˜¯ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("ä¸€æ–¹é¢æ˜¯å¯¹ä¸€äº›ç”Ÿå‘½å‘¨æœŸå’Œå‰¯ä½œç”¨é’©å­çš„å¤„ç†ï¼Œæ¯”å¦‚ componentDidMount ï¼Œå‡½æ•°ç»„ä»¶çš„ useEffect ï¼ŒuseLayoutEffect ï¼›")]),t._v(" "),a("li",[t._v("å¦ä¸€æ–¹é¢å°±æ˜¯åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œæ·»åŠ èŠ‚ç‚¹ï¼ˆ "),a("code",[t._v("Placement")]),t._v(" ï¼‰ï¼Œæ›´æ–°èŠ‚ç‚¹ï¼ˆ "),a("code",[t._v("Update")]),t._v(" ï¼‰ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼ˆ "),a("code",[t._v("Deletion")]),t._v(" ï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯ä¸€äº›ç»†èŠ‚çš„å¤„ç†ï¼Œæ¯”å¦‚ ref çš„å¤„ç†ã€‚")])]),t._v(" "),a("p",[t._v("commit ç»†åˆ†å¯ä»¥åˆ†ä¸ºï¼š")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Before mutation")]),t._v(" é˜¶æ®µï¼ˆæ‰§è¡Œ DOM æ“ä½œå‰ï¼‰ï¼›")]),t._v(" "),a("li",[a("code",[t._v("mutation")]),t._v(" é˜¶æ®µï¼ˆæ‰§è¡Œ DOM æ“ä½œï¼‰ï¼›")]),t._v(" "),a("li",[a("code",[t._v("layout")]),t._v(" é˜¶æ®µï¼ˆæ‰§è¡Œ DOM æ“ä½œåï¼‰")])]),t._v(" "),a("h4",{attrs:{id:"before-mutation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#before-mutation"}},[t._v("#")]),t._v(" Before mutation")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitBeforeMutationEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨getSnapshotBeforeUpdates")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitBeforeMutationEffectOnFiber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Passive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NormalPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flushPassiveEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[t._v("Before mutation é˜¶æ®µåšçš„äº‹ä¸»è¦æœ‰ä»¥ä¸‹å†…å®¹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å› ä¸º Before mutation è¿˜æ²¡ä¿®æ”¹çœŸå®çš„ DOM ï¼Œæ˜¯è·å– DOM å¿«ç…§çš„æœ€ä½³æ—¶æœŸï¼Œå¦‚æœæ˜¯ç±»ç»„ä»¶æœ‰ getSnapshotBeforeUpdate ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸã€‚")]),t._v(" "),a("li",[t._v("ä¼šå¼‚æ­¥è°ƒç”¨ useEffect ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸç« èŠ‚è®²åˆ° useEffect æ˜¯é‡‡ç”¨å¼‚æ­¥è°ƒç”¨çš„æ¨¡å¼ï¼Œå…¶ç›®çš„å°±æ˜¯é˜²æ­¢åŒæ­¥æ‰§è¡Œæ—¶é˜»å¡æµè§ˆå™¨åšè§†å›¾æ¸²æŸ“ã€‚")])]),t._v(" "),a("h4",{attrs:{id:"mutation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mutation"}},[t._v("#")]),t._v(" Mutation")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitMutationEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ç½®ç©ºRef */")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitDetachRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("primaryEffectTag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Placement"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  æ–°å¢å…ƒç´ ")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Update"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  æ›´æ–°å…ƒç´ ")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Deletion"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  åˆ é™¤å…ƒç´ ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("mutation é˜¶æ®µåšçš„äº‹æƒ…æœ‰ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("ç½®ç©º ref ï¼Œåœ¨ ref ç« èŠ‚è®²åˆ°å¯¹äº ref çš„å¤„ç†ã€‚")]),t._v(" "),a("li",[t._v("å¯¹æ–°å¢å…ƒç´ ï¼Œæ›´æ–°å…ƒç´ ï¼Œåˆ é™¤å…ƒç´ ã€‚è¿›è¡ŒçœŸå®çš„ DOM æ“ä½œã€‚")])]),t._v(" "),a("h4",{attrs:{id:"layout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#layout"}},[t._v("#")]),t._v(" Layout")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitLayoutEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitLayoutEffectOnFiber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("committedExpirationTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("effectTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitAttachRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("Layout é˜¶æ®µ DOM å·²ç»æ›´æ–°å®Œæ¯•ï¼ŒLayout åšçš„äº‹æƒ…æœ‰ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("commitLayoutEffectOnFiber å¯¹äºç±»ç»„ä»¶ï¼Œä¼šæ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼ŒsetState çš„callbackï¼Œå¯¹äºå‡½æ•°ç»„ä»¶ä¼šæ‰§è¡Œ useLayoutEffect é’©å­ã€‚")]),t._v(" "),a("li",[t._v("å¦‚æœæœ‰ ref ï¼Œä¼šé‡æ–°èµ‹å€¼ ref ã€‚")])]),t._v(" "),a("p",[t._v("commit é˜¶æ®µä¸»è¦åšçš„äº‹å°±æ˜¯æ‰§è¡Œ effectListï¼Œæ›´æ–° DOMï¼Œæ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼Œè·å– ref ç­‰æ“ä½œã€‚")]),t._v(" "),a("h2",{attrs:{id:"reconciler-è¿ä½œæµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reconciler-è¿ä½œæµç¨‹"}},[t._v("#")]),t._v(" Reconciler è¿ä½œæµç¨‹")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/images/react/reconciler2.png",alt:"reconciler2"}})]),t._v(" "),a("h3",{attrs:{id:"è¾“å…¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¾“å…¥"}},[t._v("#")]),t._v(" è¾“å…¥")]),t._v(" "),a("p",[t._v("åœ¨"),a("code",[t._v("ReactFiberWorkLoop.js")]),t._v("ä¸­, æ‰¿æ¥è¾“å…¥çš„å‡½æ•°åªæœ‰"),a("code",[t._v("scheduleUpdateOnFiber")]),a("a",{attrs:{href:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L517-L619",target:"_blank",rel:"noopener noreferrer"}},[t._v("æºç åœ°å€"),a("OutboundLink")],1),t._v(". åœ¨"),a("code",[t._v("react-reconciler")]),t._v("å¯¹å¤–æš´éœ²çš„ api å‡½æ•°ä¸­, åªè¦æ¶‰åŠåˆ°éœ€è¦æ”¹å˜ fiber çš„æ“ä½œ(æ— è®ºæ˜¯"),a("code",[t._v("é¦–æ¬¡æ¸²æŸ“")]),t._v("æˆ–"),a("code",[t._v("åç»­æ›´æ–°")]),t._v("æ“ä½œ), æœ€åéƒ½ä¼šé—´æ¥è°ƒç”¨"),a("code",[t._v("scheduleUpdateOnFiber")]),t._v(", æ‰€ä»¥"),a("code",[t._v("scheduleUpdateOnFiber")]),t._v("å‡½æ•°æ˜¯è¾“å…¥é“¾è·¯ä¸­çš„"),a("code",[t._v("å¿…ç»ä¹‹è·¯")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å”¯ä¸€æ¥æ”¶è¾“å…¥ä¿¡å·çš„å‡½æ•°")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("fiber"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  lane"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  eventTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... çœç•¥éƒ¨åˆ†æ— å…³ä»£ç ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("markUpdateLaneFromFiberToRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lane "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" SyncLane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("executionContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" LegacyUnbatchedContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("executionContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RenderContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CommitContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoContext\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›´æ¥è¿›è¡Œ`fiberæ„é€ `")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performSyncWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ³¨å†Œè°ƒåº¦ä»»åŠ¡, ç»è¿‡`Scheduler`åŒ…çš„è°ƒåº¦, é—´æ¥è¿›è¡Œ`fiberæ„é€ `")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ³¨å†Œè°ƒåº¦ä»»åŠ¡, ç»è¿‡`Scheduler`åŒ…çš„è°ƒåº¦, é—´æ¥è¿›è¡Œ`fiberæ„é€ `")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("p",[t._v("é€»è¾‘è¿›å…¥åˆ°"),a("code",[t._v("scheduleUpdateOnFiber")]),t._v("ä¹‹å, åé¢æœ‰ 2 ç§å¯èƒ½:")]),t._v(" "),a("ol",[a("li",[t._v("ä¸ç»è¿‡è°ƒåº¦, ç›´æ¥è¿›è¡Œ"),a("code",[t._v("fiberæ„é€ ")]),t._v(".")]),t._v(" "),a("li",[t._v("æ³¨å†Œè°ƒåº¦ä»»åŠ¡, ç»è¿‡"),a("code",[t._v("Scheduler")]),t._v("åŒ…çš„è°ƒåº¦, é—´æ¥è¿›è¡Œ"),a("code",[t._v("fiberæ„é€ ")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"æ³¨å†Œè°ƒåº¦ä»»åŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å†Œè°ƒåº¦ä»»åŠ¡"}},[t._v("#")]),t._v(" æ³¨å†Œè°ƒåº¦ä»»åŠ¡")]),t._v(" "),a("p",[t._v("ä¸"),a("code",[t._v("è¾“å…¥")]),t._v("ç¯èŠ‚ç´§å¯†ç›¸è¿, "),a("code",[t._v("scheduleUpdateOnFiber")]),t._v("å‡½æ•°ä¹‹å, ç«‹å³è¿›å…¥"),a("code",[t._v("ensureRootIsScheduled")]),t._v("å‡½æ•°("),a("a",{attrs:{href:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L674-L736",target:"_blank",rel:"noopener noreferrer"}},[t._v("æºç åœ°å€"),a("OutboundLink")],1),t._v("):")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... çœç•¥éƒ¨åˆ†æ— å…³ä»£ç ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" currentTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‰åŠéƒ¨åˆ†: åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨å†Œæ–°çš„è°ƒåº¦")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" existingCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNextLanes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" workInProgressRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" workInProgressRootRenderLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newCallbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("returnNextLanesPriority")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("existingCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" existingCallbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("existingCallbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" newCallbackPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("existingCallbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ååŠéƒ¨åˆ†: æ³¨å†Œè°ƒåº¦ä»»åŠ¡")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newCallbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newCallbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" SyncLanePriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    newCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleSyncCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performSyncWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newCallbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" SyncBatchedLanePriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    newCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      ImmediateSchedulerPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performSyncWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" schedulerPriorityLevel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lanePriorityToSchedulerPriority")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      newCallbackPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    newCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      schedulerPriorityLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performConcurrentWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackPriority "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCallbackPriority"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCallbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br")])]),a("p",[a("code",[t._v("ensureRootIsScheduled")]),t._v("çš„é€»è¾‘å¾ˆæ¸…æ™°, åˆ†ä¸º 2 éƒ¨åˆ†:")]),t._v(" "),a("ol",[a("li",[t._v("å‰åŠéƒ¨åˆ†: åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨å†Œæ–°çš„è°ƒåº¦(å¦‚æœæ— éœ€æ–°çš„è°ƒåº¦, ä¼šé€€å‡ºå‡½æ•°)")]),t._v(" "),a("li",[t._v("ååŠéƒ¨åˆ†: æ³¨å†Œè°ƒåº¦ä»»åŠ¡\n"),a("ul",[a("li",[a("code",[t._v("performSyncWorkOnRoot")]),t._v("æˆ–"),a("code",[t._v("performConcurrentWorkOnRoot")]),t._v("è¢«å°è£…åˆ°äº†ä»»åŠ¡å›è°ƒ("),a("code",[t._v("scheduleCallback")]),t._v(")ä¸­")]),t._v(" "),a("li",[t._v("ç­‰å¾…è°ƒåº¦ä¸­å¿ƒæ‰§è¡Œä»»åŠ¡, ä»»åŠ¡è¿è¡Œå…¶å®å°±æ˜¯æ‰§è¡Œ"),a("code",[t._v("performSyncWorkOnRoot")]),t._v("æˆ–"),a("code",[t._v("performConcurrentWorkOnRoot")])])])])]),t._v(" "),a("h3",{attrs:{id:"æ‰§è¡Œä»»åŠ¡å›è°ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‰§è¡Œä»»åŠ¡å›è°ƒ"}},[t._v("#")]),t._v(" æ‰§è¡Œä»»åŠ¡å›è°ƒ")]),t._v(" "),a("p",[t._v("ä»»åŠ¡å›è°ƒ, å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œ"),a("code",[t._v("performSyncWorkOnRoot")]),t._v("æˆ–"),a("code",[t._v("performConcurrentWorkOnRoot")]),t._v(". ç®€å•çœ‹ä¸€ä¸‹å®ƒä»¬çš„æºç (åœ¨"),a("code",[t._v("fiberæ ‘æ„é€ ")]),t._v("ç« èŠ‚å†æ·±å…¥åˆ†æ), å°†ä¸»è¦é€»è¾‘å‰¥ç¦»å‡ºæ¥, å•ä¸ªå‡½æ•°çš„ä»£ç é‡å¹¶ä¸å¤š.")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L965-L1045",target:"_blank",rel:"noopener noreferrer"}},[t._v("performSyncWorkOnRoot"),a("OutboundLink")],1),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... çœç•¥éƒ¨åˆ†æ— å…³ä»£ç ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performSyncWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" exitStatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  lanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNextLanes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. fiberæ ‘æ„é€ ")]),t._v("\n  exitStatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderRootSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. å¼‚å¸¸å¤„ç†: æœ‰å¯èƒ½fiberæ„é€ è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" LegacyRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" exitStatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" RootErrored"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. è¾“å‡º: æ¸²æŸ“fiberæ ‘")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedWork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€€å‡ºå‰å†æ¬¡æ£€æµ‹, æ˜¯å¦è¿˜æœ‰å…¶ä»–æ›´æ–°, æ˜¯å¦éœ€è¦å‘èµ·æ–°è°ƒåº¦")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("p",[a("code",[t._v("performSyncWorkOnRoot")]),t._v("çš„é€»è¾‘å¾ˆæ¸…æ™°, åˆ†ä¸º 3 éƒ¨åˆ†:")]),t._v(" "),a("ol",[a("li",[t._v("fiber æ ‘æ„é€ ")]),t._v(" "),a("li",[t._v("å¼‚å¸¸å¤„ç†: æœ‰å¯èƒ½ fiber æ„é€ è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸")]),t._v(" "),a("li",[t._v("è°ƒç”¨è¾“å‡º")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L740-L839",target:"_blank",rel:"noopener noreferrer"}},[t._v("performConcurrentWorkOnRoot"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... çœç•¥éƒ¨åˆ†æ— å…³ä»£ç ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performConcurrentWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" originalCallbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. åˆ·æ–°pendingçŠ¶æ€çš„effects, æœ‰å¯èƒ½æŸäº›effectä¼šå–æ¶ˆæœ¬æ¬¡ä»»åŠ¡")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" didFlushPassiveEffects "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flushPassiveEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("didFlushPassiveEffects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" originalCallbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»»åŠ¡è¢«å–æ¶ˆ, é€€å‡ºè°ƒç”¨")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current task was not canceled. Continue.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. è·å–æœ¬æ¬¡æ¸²æŸ“çš„ä¼˜å…ˆçº§")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNextLanes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" workInProgressRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" workInProgressRootRenderLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. æ„é€ fiberæ ‘")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" exitStatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderRootConcurrent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includesSomeLane")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      workInProgressRootIncludedLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      workInProgressRootUpdatedLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœåœ¨renderè¿‡ç¨‹ä¸­äº§ç”Ÿäº†æ–°çš„update, ä¸”æ–°updateçš„ä¼˜å…ˆçº§ä¸æœ€åˆrenderçš„ä¼˜å…ˆçº§æœ‰äº¤é›†")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é‚£ä¹ˆæœ€åˆrenderæ— æ•ˆ, ä¸¢å¼ƒæœ€åˆrenderçš„ç»“æœ, ç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareFreshStack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exitStatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" RootIncomplete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. å¼‚å¸¸å¤„ç†: æœ‰å¯èƒ½fiberæ„é€ è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exitStatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" RootErrored"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedWork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5. è¾“å‡º: æ¸²æŸ“fiberæ ‘")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("finishConcurrentRender")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exitStatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é€€å‡ºå‰å†æ¬¡æ£€æµ‹, æ˜¯å¦è¿˜æœ‰å…¶ä»–æ›´æ–°, æ˜¯å¦éœ€è¦å‘èµ·æ–°è°ƒåº¦")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" originalCallbackNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¸²æŸ“è¢«é˜»æ–­, è¿”å›ä¸€ä¸ªæ–°çš„performConcurrentWorkOnRootå‡½æ•°, ç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒç”¨")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("performConcurrentWorkOnRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br")])]),a("p",[a("code",[t._v("performConcurrentWorkOnRoot")]),t._v("çš„é€»è¾‘ä¸"),a("code",[t._v("performSyncWorkOnRoot")]),t._v("çš„ä¸åŒä¹‹å¤„åœ¨äº, å¯¹äº"),a("code",[t._v("å¯ä¸­æ–­æ¸²æŸ“")]),t._v("çš„æ”¯æŒ:")]),t._v(" "),a("ol",[a("li",[t._v("è°ƒç”¨"),a("code",[t._v("performConcurrentWorkOnRoot")]),t._v("å‡½æ•°æ—¶, é¦–å…ˆæ£€æŸ¥æ˜¯å¦å¤„äº"),a("code",[t._v("render")]),t._v("è¿‡ç¨‹ä¸­, æ˜¯å¦éœ€è¦æ¢å¤ä¸Šä¸€æ¬¡æ¸²æŸ“.")]),t._v(" "),a("li",[t._v("å¦‚æœæœ¬æ¬¡æ¸²æŸ“è¢«ä¸­æ–­, æœ€åè¿”å›ä¸€ä¸ªæ–°çš„ performConcurrentWorkOnRoot å‡½æ•°, ç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒç”¨.")])]),t._v(" "),a("h3",{attrs:{id:"è¾“å‡º"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¾“å‡º"}},[t._v("#")]),t._v(" è¾“å‡º")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... çœç•¥éƒ¨åˆ†æ— å…³ä»£ç ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitRootImpl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" renderPriorityLevel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¾ç½®å±€éƒ¨å˜é‡")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" finishedWork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" lanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¸…ç©ºFiberRootå¯¹è±¡ä¸Šçš„å±æ€§")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedWork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finishedLanes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoLanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æäº¤é˜¶æ®µ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" firstEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("firstEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prevExecutionContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" executionContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    executionContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|=")]),t._v(" CommitContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é˜¶æ®µ1: domçªå˜ä¹‹å‰")]),t._v("\n    nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firstEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitBeforeMutationEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é˜¶æ®µ2: domçªå˜, ç•Œé¢å‘ç”Ÿæ”¹å˜")]),t._v("\n    nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firstEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitMutationEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" renderPriorityLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" finishedWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é˜¶æ®µ3: layouté˜¶æ®µ, è°ƒç”¨ç”Ÿå‘½å‘¨æœŸcomponentDidUpdateå’Œå›è°ƒå‡½æ•°ç­‰")]),t._v("\n    nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" firstEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitLayoutEffects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lanes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    nextEffect "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    executionContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" prevExecutionContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ensureRootIsScheduled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br")])]),a("p",[t._v("åœ¨è¾“å‡ºé˜¶æ®µ,"),a("code",[t._v("commitRoot")]),t._v("çš„å®ç°é€»è¾‘æ˜¯åœ¨"),a("code",[t._v("commitRootImpl")]),t._v("å‡½æ•°ä¸­, å…¶ä¸»è¦é€»è¾‘æ˜¯å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—, å°†æœ€æ–°çš„ fiber æ ‘ç»“æ„åæ˜ åˆ° DOM ä¸Š.")]),t._v(" "),a("p",[t._v("æ ¸å¿ƒé€»è¾‘åˆ†ä¸º 3 ä¸ªæ­¥éª¤:")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("commitBeforeMutationEffects")]),t._v(" "),a("ul",[a("li",[t._v("dom å˜æ›´ä¹‹å‰, ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰"),a("code",[t._v("Snapshot")]),t._v(","),a("code",[t._v("Passive")]),t._v("æ ‡è®°çš„"),a("code",[t._v("fiber")]),t._v("èŠ‚ç‚¹.")])])]),t._v(" "),a("li",[a("p",[t._v("commitMutationEffects")]),t._v(" "),a("ul",[a("li",[t._v("dom å˜æ›´, ç•Œé¢å¾—åˆ°æ›´æ–°. ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰"),a("code",[t._v("Placement")]),t._v(", "),a("code",[t._v("Update")]),t._v(", "),a("code",[t._v("Deletion")]),t._v(", "),a("code",[t._v("Hydrating")]),t._v("æ ‡è®°çš„"),a("code",[t._v("fiber")]),t._v("èŠ‚ç‚¹.")])])]),t._v(" "),a("li",[a("p",[t._v("commitLayoutEffects")]),t._v(" "),a("ul",[a("li",[t._v("dom å˜æ›´å, ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰"),a("code",[t._v("Update | Callback")]),t._v("æ ‡è®°çš„"),a("code",[t._v("fiber")]),t._v("èŠ‚ç‚¹")])])])]),t._v(" "),a("h2",{attrs:{id:"é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜"}},[t._v("#")]),t._v(" é—®é¢˜")]),t._v(" "),a("h3",{attrs:{id:"q1-ä¸ºä»€ä¹ˆè®¾è®¡-fiber-react-ä¸ºä»€ä¹ˆéœ€è¦-fiber"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q1-ä¸ºä»€ä¹ˆè®¾è®¡-fiber-react-ä¸ºä»€ä¹ˆéœ€è¦-fiber"}},[t._v("#")]),t._v(" Q1. ä¸ºä»€ä¹ˆè®¾è®¡ Fiberï¼ŒReact ä¸ºä»€ä¹ˆéœ€è¦ Fiber ï¼Ÿ")]),t._v(" "),a("p",[t._v("è§£é¢˜æ€è·¯")]),t._v(" "),a("ol",[a("li",[t._v("Fiber è®¾è®¡ä¹‹å‰çš„ç—›ç‚¹")]),t._v(" "),a("li",[t._v("Fiber æ€ä¹ˆè§£å†³çš„è¿™äº›ç—›ç‚¹")])]),t._v(" "),a("p",[t._v("React v15 åŠä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨çš„åè°ƒç®—æ³•ï¼ˆdiff ç®—æ³•ï¼‰ æ˜¯ Stack Reconciler ï¼Œæœ‰ä»¥ä¸‹çš„ 3 ä¸ªç—›ç‚¹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("é€’å½’å¯¹æ¯”è™šæ‹Ÿ DOM æ ‘ï¼Œæ‰§è¡Œæ ˆä¼šè¶Šæ¥è¶Šæ·±ã€‚")]),t._v(" "),a("li",[t._v("åŒæ­¥æ›´æ–°DOMï¼Œä¸èƒ½ä¸­æ–­ï¼Œä¸­æ–­åä¹Ÿä¸èƒ½æ¢å¤ã€‚")]),t._v(" "),a("li",[t._v("JS ä»£ç æ‰§è¡Œæ—¶é—´é•¿ï¼Œä¼šæŒç»­å ç”¨ä¸»çº¿ç¨‹ï¼Œå‡ºç°æ¸²æŸ“å¡é¡¿ã€‚")])]),t._v(" "),a("p",[t._v("å½“é‡åˆ°è¿›ç¨‹åŒæ­¥é˜»å¡çš„é—®é¢˜æ—¶ï¼Œ"),a("strong",[t._v("ä»»åŠ¡åˆ†å‰²ã€å¼‚æ­¥è°ƒç”¨")]),t._v(" å’Œ "),a("strong",[t._v("ç¼“å­˜ç­–ç•¥")]),t._v(" æ˜¯ä¸‰ä¸ªæ˜¾è‘—çš„è§£å†³æ€è·¯ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³ä»¥ä¸Šçš„ç—›ç‚¹é—®é¢˜ï¼ŒReact è®¾è®¡äº† Fiber æ¶æ„ï¼Œ æŠŠæ›´æ–°ã€æ¸²æŸ“è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªå°å—çš„ä»»åŠ¡ï¼Œé€šè¿‡åˆç†çš„è°ƒåº¦æœºåˆ¶æ¥è°ƒæ§æ—¶é—´ï¼ŒæŒ‡å®šä»»åŠ¡æ‰§è¡Œçš„æ—¶æœºï¼Œå®ç°å¼‚æ­¥å¯ä¸­æ–­æ‰§è¡Œï¼Œä»è€Œé™ä½é¡µé¢å¡é¡¿çš„æ¦‚ç‡ï¼Œæå‡é¡µé¢äº¤äº’ä½“éªŒã€‚é€šè¿‡ Fiber æ¶æ„ï¼Œè®© reconcilation è¿‡ç¨‹å˜å¾—å¯è¢«ä¸­æ–­ï¼Œé€‚æ—¶åœ°è®©å‡º CPU æ‰§è¡Œæƒï¼Œå¯ä»¥è®©æµè§ˆå™¨åŠæ—¶åœ°å“åº”ç”¨æˆ·çš„äº¤äº’ã€‚ï¼ˆå°±æ˜¯ä½¿ JS çš„æ‰§è¡Œå˜æˆå¯æ§ï¼Œä¸å¸Œæœ› JS ä¸å—æ§åˆ¶åœ°é•¿æ—¶é—´æ‰§è¡Œï¼‰ã€‚")]),t._v(" "),a("p",[t._v("Fiber çš„ä¸»è¦ç›®æ ‡æ˜¯å®ç°è™šæ‹Ÿ DOM çš„å¢é‡æ¸²æŸ“ï¼Œèƒ½å¤Ÿå°†æ¸²æŸ“å·¥ä½œæ‹†åˆ†æˆå—å¹¶å°†å…¶åˆ†æ•£åˆ°å¤šä¸ªå¸§çš„èƒ½åŠ›ã€‚åœ¨æ–°çš„æ›´æ–°åˆ°æ¥æ—¶ï¼Œèƒ½å¤Ÿæš‚åœã€ä¸­æ­¢å’Œå¤ç”¨å·¥ä½œï¼Œèƒ½ä¸ºä¸åŒç±»å‹çš„æ›´æ–°åˆ†é…ä¼˜å…ˆçº§é¡ºåºçš„èƒ½åŠ›ï¼Œå› æ­¤ è¿™ç§ Fiber reconciler å¾ˆå¥½çš„è§£å†³äº†Stack Reconciler  çš„é—®é¢˜ã€‚")]),t._v(" "),a("h3",{attrs:{id:"q2-fiber-ä¸ºä»€ä¹ˆè®¾è®¡æˆé“¾è¡¨ç»“æ„-ä¸ºä»€ä¹ˆä¸­æ–­æ‰§è¡Œåå¯ä»¥æ¢å¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q2-fiber-ä¸ºä»€ä¹ˆè®¾è®¡æˆé“¾è¡¨ç»“æ„-ä¸ºä»€ä¹ˆä¸­æ–­æ‰§è¡Œåå¯ä»¥æ¢å¤"}},[t._v("#")]),t._v(" Q2. Fiber ä¸ºä»€ä¹ˆè®¾è®¡æˆé“¾è¡¨ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆä¸­æ–­æ‰§è¡Œåå¯ä»¥æ¢å¤ï¼Ÿ")]),t._v(" "),a("p",[t._v("fiber å¯¹è±¡ä¸­å­˜å‚¨çš„å…ƒç´ ä¸Šä¸‹æ–‡ä¿¡æ¯ä»¥åŠæŒ‡é’ˆåŸŸæ„æˆçš„é“¾è¡¨ç»“æ„ï¼Œä½¿å…¶èƒ½å¤Ÿå°†æ‰§è¡Œåˆ°ä¸€åŠçš„å·¥ä½œä¿å­˜åœ¨å†…å­˜çš„é“¾è¡¨ä¸­ã€‚å½“ React åœæ­¢å¹¶å®Œæˆä¿å­˜çš„å·¥ä½œåï¼Œè®©å‡ºæ—¶é—´ç‰‡å»å¤„ç†ä¸€äº›å…¶ä»–ä¼˜å…ˆçº§æ›´é«˜çš„äº‹æƒ…ã€‚ä¹‹åï¼Œåœ¨é‡æ–°è·å–åˆ°å¯ç”¨çš„æ—¶é—´ç‰‡åï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®ä¹‹å‰ä¿å­˜åœ¨å†…å­˜çš„ä¸Šä¸‹æ–‡ä¿¡æ¯é€šè¿‡å¿«é€Ÿéå†çš„æ–¹å¼æ‰¾åˆ°åœæ­¢çš„ fiber èŠ‚ç‚¹å¹¶ç»§ç»­å·¥ä½œã€‚ç”±äºåœ¨æ­¤é˜¶æ®µæ‰§è¡Œçš„å·¥ä½œå¹¶ä¸ä¼šå¯¼è‡´ä»»ä½•ç”¨æˆ·å¯è§çš„æ›´æ”¹ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¢«æäº¤åˆ°çœŸå®çš„ DOMã€‚æ‰€ä»¥ï¼Œè¿™ç§é“¾è¡¨ç»“æ„çš„ fiber èƒ½è®©è®©è°ƒåº¦èƒ½å¤Ÿå®ç°æš‚åœã€ä¸­æ­¢ä»¥åŠé‡æ–°å¼€å§‹ç­‰å¢é‡æ¸²æŸ“çš„èƒ½åŠ›ã€‚")]),t._v(" "),a("h3",{attrs:{id:"q3-react-fiber-æ˜¯å¦‚ä½•å®ç°æ›´æ–°è¿‡ç¨‹å¯æ§-æ‰§è¡Œæµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q3-react-fiber-æ˜¯å¦‚ä½•å®ç°æ›´æ–°è¿‡ç¨‹å¯æ§-æ‰§è¡Œæµç¨‹"}},[t._v("#")]),t._v(" Q3. React Fiber æ˜¯å¦‚ä½•å®ç°æ›´æ–°è¿‡ç¨‹å¯æ§ï¼Ÿæ‰§è¡Œæµç¨‹ï¼Ÿ")]),t._v(" "),a("p",[t._v("æ›´æ–°è¿‡ç¨‹çš„å¯æ§ä¸»è¦ä½“ç°åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("ä»»åŠ¡æ‹†åˆ†")]),t._v(" "),a("li",[t._v("ä»»åŠ¡æŒ‚èµ·ã€æ¢å¤ã€ç»ˆæ­¢")]),t._v(" "),a("li",[t._v("ä»»åŠ¡å…·å¤‡ä¼˜å…ˆçº§")])]),t._v(" "),a("p",[a("strong",[t._v("ä»»åŠ¡æ‹†åˆ†")])]),t._v(" "),a("p",[t._v('åœ¨ React Fiber æœºåˆ¶ä¸­ï¼Œå®ƒé‡‡ç”¨"åŒ–æ•´ä¸ºé›¶"çš„æ€æƒ³ï¼Œå°†è°ƒå’Œé˜¶æ®µï¼ˆReconcilerï¼‰é€’å½’éå† VDOM è¿™ä¸ªå¤§ä»»åŠ¡åˆ†æˆè‹¥å¹²å°ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡åªè´Ÿè´£ä¸€ä¸ªèŠ‚ç‚¹çš„å¤„ç†ã€‚')]),t._v(" "),a("p",[a("strong",[t._v("ä»»åŠ¡æŒ‚èµ·ã€æ¢å¤ã€ç»ˆæ­¢")])]),t._v(" "),a("p",[a("strong",[t._v("workInProgress tree")]),t._v("ï¼š workInProgress ä»£è¡¨å½“å‰æ­£åœ¨æ‰§è¡Œæ›´æ–°çš„ Fiber æ ‘ã€‚åœ¨ render æˆ–è€… setState åï¼Œä¼šæ„å»ºä¸€é¢— Fiber æ ‘ï¼Œä¹Ÿå°±æ˜¯ workInProgress treeï¼Œè¿™æ£µæ ‘åœ¨æ„å»ºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šæ”¶é›†å½“å‰èŠ‚ç‚¹çš„å‰¯ä½œç”¨ï¼Œæ•´æ£µæ ‘æ„å»ºå®Œæˆåï¼Œä¼šå½¢æˆä¸€æ¡å®Œæ•´çš„å‰¯ä½œç”¨é“¾ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("currentFiber tree")]),t._v("ï¼šcurrentFiber è¡¨ç¤ºä¸Šæ¬¡æ¸²æŸ“æ„å»ºçš„ Filber æ ‘ã€‚åœ¨æ¯ä¸€æ¬¡æ›´æ–°å®Œæˆå workInProgress ä¼šèµ‹å€¼ç»™ currentFiberã€‚åœ¨æ–°ä¸€è½®æ›´æ–°æ—¶ workInProgress tree å†é‡æ–°æ„å»ºï¼Œæ–° workInProgress çš„èŠ‚ç‚¹é€šè¿‡ alternate å±æ€§å’Œ currentFiber çš„èŠ‚ç‚¹å»ºç«‹è”ç³»ã€‚")]),t._v(" "),a("p",[t._v("åœ¨æ–° workInProgress tree çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¼šåŒ currentFiber çš„å¯¹åº”èŠ‚ç‚¹è¿›è¡Œ Diff æ¯”è¾ƒï¼Œæ”¶é›†å‰¯ä½œç”¨ã€‚åŒæ—¶ä¹Ÿä¼šå¤ç”¨å’Œ currentFiber å¯¹åº”çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œå‡å°‘æ–°åˆ›å»ºå¯¹è±¡å¸¦æ¥çš„å¼€é”€ã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºæ˜¯åˆ›å»ºè¿˜æ˜¯æ›´æ–°ã€æŒ‚èµ·ã€æ¢å¤ä»¥åŠç»ˆæ­¢æ“ä½œéƒ½æ˜¯å‘ç”Ÿåœ¨ workInProgress tree åˆ›å»ºè¿‡ç¨‹ä¸­çš„ã€‚workInProgress tree æ„å»ºè¿‡ç¨‹å…¶å®å°±æ˜¯å¾ªç¯çš„æ‰§è¡Œä»»åŠ¡å’Œåˆ›å»ºä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("æŒ‚èµ·")])]),t._v(" "),a("p",[t._v("å½“ç¬¬ä¸€ä¸ªå°ä»»åŠ¡å®Œæˆåï¼Œå…ˆåˆ¤æ–­è¿™ä¸€å¸§æ˜¯å¦è¿˜æœ‰ç©ºé—²æ—¶é—´ï¼Œæ²¡æœ‰å°±æŒ‚èµ·ä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œè®°ä½å½“å‰æŒ‚èµ·çš„èŠ‚ç‚¹ï¼Œè®©å‡ºæ§åˆ¶æƒç»™æµè§ˆå™¨æ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("æ¢å¤")])]),t._v(" "),a("p",[t._v("åœ¨æµè§ˆå™¨æ¸²æŸ“å®Œä¸€å¸§åï¼Œåˆ¤æ–­å½“å‰å¸§æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ï¼Œå¦‚æœæœ‰å°±æ¢å¤æ‰§è¡Œä¹‹å‰æŒ‚èµ·çš„ä»»åŠ¡ã€‚å¦‚æœæ²¡æœ‰ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œä»£è¡¨è°ƒå’Œé˜¶æ®µå®Œæˆï¼Œå¯ä»¥å¼€å§‹è¿›å…¥æ¸²æŸ“é˜¶æ®µã€‚")]),t._v(" "),a("ol",[a("li",[t._v("å¦‚ä½•åˆ¤æ–­ä¸€å¸§æ˜¯å¦æœ‰ç©ºé—²æ—¶é—´çš„å‘¢ï¼Ÿ")])]),t._v(" "),a("p",[t._v("ä½¿ç”¨å‰é¢æåˆ°çš„ RIC (RequestIdleCallback) æµè§ˆå™¨åŸç”Ÿ APIï¼ŒReact æºç ä¸­ä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œå¯¹è¯¥æ–¹æ³•è¿›è¡Œäº† Polyfillã€‚")]),t._v(" "),a("ol",[a("li",[t._v("æ¢å¤æ‰§è¡Œçš„æ—¶å€™åˆæ˜¯å¦‚ä½•çŸ¥é“ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ")])]),t._v(" "),a("p",[t._v("ç­”æ¡ˆæ˜¯åœ¨å‰é¢æåˆ°çš„é“¾è¡¨ã€‚åœ¨ React Fiber ä¸­æ¯ä¸ªä»»åŠ¡å…¶å®å°±æ˜¯åœ¨å¤„ç†ä¸€ä¸ª FiberNode å¯¹è±¡ï¼Œç„¶ååˆç”Ÿæˆä¸‹ä¸€ä¸ªä»»åŠ¡éœ€è¦å¤„ç†çš„ FiberNodeã€‚")]),t._v(" "),a("p",[a("strong",[t._v("ç»ˆæ­¢")])]),t._v(" "),a("p",[t._v("å…¶å®å¹¶ä¸æ˜¯æ¯æ¬¡æ›´æ–°éƒ½ä¼šèµ°åˆ°æäº¤é˜¶æ®µã€‚å½“åœ¨è°ƒå’Œè¿‡ç¨‹ä¸­è§¦å‘äº†æ–°çš„æ›´æ–°ï¼Œåœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæœ‰å°±ç»ˆæ­¢åŸæ¥å°†è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¼€å§‹æ–°çš„ workInProgressFiber æ ‘æ„å»ºè¿‡ç¨‹ï¼Œå¼€å§‹æ–°çš„æ›´æ–°æµç¨‹ã€‚è¿™æ ·å¯ä»¥é¿å…é‡å¤æ›´æ–°æ“ä½œã€‚è¿™ä¹Ÿæ˜¯åœ¨ React 16 ä»¥åç”Ÿå‘½å‘¨æœŸå‡½æ•° componentWillMount æœ‰å¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡çš„åŸå› ã€‚")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("æ³¨æ„")]),t._v(" "),a("p",[t._v("React 17 å…¨é¢å¼€å¯ async renderingã€‚å› æ­¤ 17 å°†ä¼šåºŸå¼ƒå¤šä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆwill ç³»åˆ—ï¼‰ï¼ŒåŸå› æ˜¯å¼€å¯ async renderingï¼Œåœ¨ render å‡½æ•°ä¹‹å‰çš„æ‰€æœ‰å‡½æ•°ï¼Œéƒ½æœ‰å¯èƒ½è¢«æ‰§è¡Œå¤šæ¬¡ã€‚")]),t._v(" "),a("p",[t._v("é•¿æœŸä»¥æ¥ï¼ŒåŸæœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ€»æ˜¯ä¼šè¯±æƒ‘å¼€å‘è€…åœ¨ render ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åšä¸€äº›åŠ¨ä½œï¼Œç°åœ¨è¿™äº›åŠ¨ä½œè¿˜æ”¾åœ¨è¿™äº›å‡½æ•°ä¸­çš„è¯ï¼Œæœ‰å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œè¿™è‚¯å®šä¸æ˜¯ä½ æƒ³è¦çš„ç»“æœã€‚åœ¨ componentWillMount æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œæ— è®ºè¯·æ±‚å¤šå¿«éƒ½æ— æ³•èµ¶ä¸Šé¦–æ¬¡ renderï¼Œè€Œä¸” componentWillMount åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¹Ÿä¼šè¢«è°ƒç”¨ï¼Œè¿™æ ·çš„ I/O æ“ä½œæ”¾åœ¨ componentDidMount é‡Œæ›´åŠ åˆé€‚ã€‚")]),t._v(" "),a("p",[t._v("åœ¨ Fiber å¯ç”¨ async rendering ä¹‹åï¼Œæ›´æ²¡æœ‰ç†ç”±åœ¨ componentWillMount é‡Œæ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œå› ä¸º componentWillMount å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œè°ä¹Ÿä¸ä¼šå¸Œæœ›æ— è°“åœ°å¤šæ¬¡è°ƒç”¨å¤šæ¬¡ç½‘ç»œè¯·æ±‚å§ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"q4-react-èƒ½å¦åƒ-vue-é‚£æ ·è¿›è¡Œé¢„ç¼–è¯‘ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q4-react-èƒ½å¦åƒ-vue-é‚£æ ·è¿›è¡Œé¢„ç¼–è¯‘ä¼˜åŒ–"}},[t._v("#")]),t._v(" Q4. React èƒ½å¦åƒ Vue é‚£æ ·è¿›è¡Œé¢„ç¼–è¯‘ä¼˜åŒ–")]),t._v(" "),a("p",[t._v("Vue3.0 æå‡ºåŠ¨é™ç»“åˆçš„ DOM diff æ€æƒ³ï¼ŒåŠ¨é™ç»“åˆçš„ DOM diffå…¶å®æ˜¯åœ¨é¢„ç¼–è¯‘é˜¶æ®µè¿›è¡Œäº†ä¼˜åŒ–ã€‚ä¹‹æ‰€ä»¥èƒ½å¤Ÿåšåˆ°"),a("strong",[t._v("é¢„ç¼–è¯‘ä¼˜åŒ–")]),t._v("ï¼Œæ˜¯å› ä¸º Vue core å¯ä»¥"),a("strong",[t._v("é™æ€åˆ†æ template")]),t._v("ï¼Œåœ¨è§£ææ¨¡ç‰ˆæ—¶ï¼Œæ•´ä¸ª parse çš„è¿‡ç¨‹æ˜¯åˆ©ç”¨"),a("strong",[t._v("æ­£åˆ™è¡¨è¾¾å¼")]),t._v("é¡ºåºè§£ææ¨¡æ¿ï¼Œå½“è§£æåˆ°å¼€å§‹æ ‡ç­¾ã€é—­åˆæ ‡ç­¾å’Œæ–‡æœ¬çš„æ—¶å€™éƒ½ä¼šåˆ†åˆ«æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œæ¥è¾¾åˆ°æ„é€  AST æ ‘çš„ç›®çš„ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("å€ŸåŠ©é¢„ç¼–è¯‘è¿‡ç¨‹")]),t._v("ï¼ŒVue å¯ä»¥åšåˆ°çš„é¢„ç¼–è¯‘ä¼˜åŒ–å°±å¾ˆå¼ºå¤§äº†ã€‚æ¯”å¦‚åœ¨é¢„ç¼–è¯‘æ—¶æ ‡è®°å‡ºæ¨¡ç‰ˆä¸­å¯èƒ½å˜åŒ–çš„ç»„ä»¶èŠ‚ç‚¹ï¼Œå†æ¬¡è¿›è¡Œæ¸²æŸ“å‰ diff æ—¶å°±å¯ä»¥"),a("strong",[t._v("è·³è¿‡â€œæ°¸è¿œä¸ä¼šå˜åŒ–çš„èŠ‚ç‚¹â€")]),t._v("ï¼Œè€Œåªéœ€è¦å¯¹æ¯”â€œå¯èƒ½ä¼šå˜åŒ–çš„åŠ¨æ€èŠ‚ç‚¹â€ã€‚è¿™ä¹Ÿå°±æ˜¯"),a("strong",[t._v("åŠ¨é™ç»“åˆçš„ DOM diff å°† diff æˆæœ¬ä¸æ¨¡ç‰ˆå¤§å°æ­£ç›¸å…³ä¼˜åŒ–åˆ°ä¸åŠ¨æ€èŠ‚ç‚¹æ­£ç›¸å…³çš„ç†è®ºä¾æ®")]),t._v("ã€‚")]),t._v(" "),a("p",[t._v("Vue éœ€è¦åšæ•°æ®åŒå‘ç»‘å®šï¼Œéœ€è¦è¿›è¡Œæ•°æ®æ‹¦æˆªæˆ–ä»£ç†ï¼Œé‚£å®ƒå°±éœ€è¦åœ¨"),a("strong",[t._v("é¢„ç¼–è¯‘é˜¶æ®µé™æ€åˆ†ææ¨¡ç‰ˆï¼Œåˆ†æå‡ºè§†å›¾ä¾èµ–äº†å“ªäº›æ•°æ®ï¼Œè¿›è¡Œå“åº”å¼å¤„ç†")]),t._v("ã€‚è€Œ React å°±æ˜¯"),a("strong",[t._v("å±€éƒ¨é‡æ–°æ¸²æŸ“")]),t._v("ï¼ŒReact æ‹¿åˆ°çš„æˆ–è€…è¯´æŒç®¡çš„ï¼Œæ‰€è´Ÿè´£çš„å°±æ˜¯ä¸€å †"),a("strong",[t._v("é€’å½’ React.createElement")]),t._v(" çš„æ‰§è¡Œè°ƒç”¨ï¼ˆå‚è€ƒä¸‹æ–¹ç»è¿‡Babelè½¬æ¢çš„ä»£ç ï¼‰ï¼Œå®ƒæ— æ³•ä»æ¨¡ç‰ˆå±‚é¢è¿›è¡Œé™æ€åˆ†æã€‚"),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fguide%2Frender-function.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSX å’Œæ‰‹å†™çš„ render function"),a("OutboundLink")],1),t._v(" æ˜¯å®Œå…¨åŠ¨æ€çš„ï¼Œ"),a("strong",[t._v("è¿‡åº¦çš„çµæ´»æ€§å¯¼è‡´è¿è¡Œæ—¶å¯ä»¥ç”¨äºä¼˜åŒ–çš„ä¿¡æ¯ä¸è¶³")]),t._v("ã€‚")]),t._v(" "),a("ul",[a("li",[t._v("JSX å…·æœ‰ JavaScript çš„å®Œæ•´è¡¨ç°åŠ›ï¼Œå¯ä»¥æ„å»ºéå¸¸å¤æ‚çš„ç»„ä»¶ã€‚ä½†æ˜¯"),a("strong",[t._v("çµæ´»")]),t._v("çš„è¯­æ³•ï¼Œä¹Ÿæ„å‘³ç€"),a("strong",[t._v("å¼•æ“éš¾ä»¥ç†è§£")]),t._v("ï¼Œæ— æ³•é¢„åˆ¤å¼€å‘è€…çš„ç”¨æˆ·æ„å›¾ï¼Œä»è€Œéš¾ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚")]),t._v(" "),a("li",[t._v("Template æ¨¡æ¿æ˜¯ä¸€ç§éå¸¸æœ‰"),a("strong",[t._v("çº¦æŸ")]),t._v("çš„è¯­è¨€ï¼Œä½ åªèƒ½ä»¥æŸç§æ–¹å¼å»ç¼–å†™æ¨¡æ¿ã€‚")])]),t._v(" "),a("p",[t._v("æ—¢ç„¶å­˜åœ¨ä»¥ä¸Š"),a("strong",[t._v("ç¼–è¯‘æ—¶å…ˆå¤©ä¸è¶³")]),t._v("ï¼Œåœ¨è¿è¡Œæ—¶ä¼˜åŒ–æ–¹é¢ï¼ŒReact ä¸€ç›´åœ¨åŠªåŠ›ã€‚æ¯”å¦‚ï¼ŒReact15 å®ç°äº† batchedUpdatesï¼ˆæ‰¹é‡æ›´æ–°ï¼‰ã€‚å³"),a("strong",[t._v("åŒä¸€äº‹ä»¶å›è°ƒå‡½æ•°ä¸Šä¸‹æ–‡")]),t._v("ä¸­çš„å¤šæ¬¡ setState åªä¼šè§¦å‘ä¸€æ¬¡æ›´æ–°ã€‚ä½†æ˜¯ï¼Œå¦‚æœå•æ¬¡æ›´æ–°å°±å¾ˆè€—æ—¶ï¼Œé¡µé¢è¿˜æ˜¯ä¼šå¡é¡¿ï¼ˆè¿™åœ¨ä¸€ä¸ªç»´æŠ¤æ—¶é—´å¾ˆé•¿çš„å¤§åº”ç”¨ä¸­æ˜¯å¾ˆå¸¸è§çš„ï¼‰ã€‚è¿™æ˜¯å› ä¸º React15 çš„æ›´æ–°æµç¨‹æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¸€æ—¦å¼€å§‹æ›´æ–°ç›´åˆ°é¡µé¢æ¸²æŸ“å‰éƒ½ä¸èƒ½ä¸­æ–­ã€‚")]),t._v(" "),a("h3",{attrs:{id:"q5-react-hooks-çš„å®ç°å¿…é¡»ä¾èµ–-fiber-å—"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q5-react-hooks-çš„å®ç°å¿…é¡»ä¾èµ–-fiber-å—"}},[t._v("#")]),t._v(" Q5. React  hooks çš„å®ç°å¿…é¡»ä¾èµ– Fiber å—?")]),t._v(" "),a("p",[t._v("React çš„ hooks æ˜¯åœ¨ fiber ä¹‹åå‡ºç°çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å¾ˆå¤šäººè¯¯ä»¥ä¸º hooks æ˜¯å¿…é¡»ä¾èµ– fiber æ‰èƒ½å®ç°çš„ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œå®ƒä»¬ä¿©æ²¡å•¥å¿…ç„¶è”ç³»ã€‚")]),t._v(" "),a("p",[t._v("åœ¨ React16 ä¹‹å‰ï¼Œä¼šé€’å½’æ¸²æŸ“è¿™ä¸ª vdomï¼Œå¢åˆ æ”¹çœŸå® domã€‚è€Œåœ¨ React16 å¼•å…¥äº† fiber æ¶æ„ä¹‹åå°±å¤šäº†ä¸€æ­¥ï¼šé¦–å…ˆæŠŠ vdom è½¬æˆ fiberï¼Œä¹‹åå†æ¸²æŸ“ fiberã€‚vdom è½¬ fiber çš„è¿‡ç¨‹å«åš reconcileï¼Œæœ€åå¢åˆ æ”¹çœŸå® dom çš„è¿‡ç¨‹å«åš commitã€‚å› ä¸º vdom åªæœ‰å­èŠ‚ç‚¹ children çš„å¼•ç”¨ï¼Œæ²¡æœ‰çˆ¶èŠ‚ç‚¹ parent å’Œå…¶ä»–å…„å¼ŸèŠ‚ç‚¹ sibling çš„å¼•ç”¨ï¼Œè¿™å¯¼è‡´äº†è¦ä¸€æ¬¡æ€§é€’å½’æŠŠæ‰€æœ‰ vdom èŠ‚ç‚¹æ¸²æŸ“åˆ° dom æ‰è¡Œï¼Œä¸å¯æ‰“æ–­ã€‚ä¸‡ä¸€æ‰“æ–­äº†ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå› ä¸ºæ²¡æœ‰è®°å½•çˆ¶èŠ‚ç‚¹å’Œå…„å¼ŸèŠ‚ç‚¹ï¼Œé‚£åªèƒ½ç»§ç»­å¤„ç†å­èŠ‚ç‚¹ï¼Œå´ä¸èƒ½å¤„ç† vdom çš„å…¶ä»–éƒ¨åˆ†äº†ã€‚æ‰€ä»¥ React æ‰å¼•å…¥äº†è¿™ç§ fiber çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯æœ‰çˆ¶èŠ‚ç‚¹ returnã€å­èŠ‚ç‚¹ childã€å…„å¼ŸèŠ‚ç‚¹ sibling ç­‰å¼•ç”¨ï¼Œå¯ä»¥æ‰“æ–­ï¼Œå› ä¸ºæ–­äº†å†æ¢å¤ä¹Ÿèƒ½æ‰¾åˆ°åé¢æ‰€æœ‰æ²¡å¤„ç†è¿‡çš„èŠ‚ç‚¹ã€‚")]),t._v(" "),a("p",[t._v("æ‰€ä»¥ fiber æ¶æ„å°±åˆ†ä¸ºäº† schduleã€reconcileï¼ˆvdom è½¬ fiberï¼‰ã€commitï¼ˆæ›´æ–°åˆ° domï¼‰ä¸‰ä¸ªé˜¶æ®µã€‚")]),t._v(" "),a("p",[t._v("å‡½æ•°ç»„ä»¶å†…å¯ä»¥ç”¨ hooks æ¥å­˜å–ä¸€äº›å€¼ï¼Œè¿™äº›å€¼å°±æ˜¯å­˜åœ¨ fiber èŠ‚ç‚¹ä¸Šçš„ã€‚ä¸åŒçš„ hook åœ¨ memorizedState é“¾è¡¨ä¸åŒçš„å…ƒç´ ä¸Šå­˜å–å€¼ï¼Œé€šè¿‡ next ä¸²è”èµ·æ¥ï¼Œè¿™å°±æ˜¯ react hooks çš„åŸç†ã€‚")]),t._v(" "),a("p",[t._v("å¯¹æ¯”å…¶ä»–æ¡†æ¶ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("react æ˜¯æŠŠ vdom è½¬æˆ fiberï¼Œç„¶åæŠŠ hook é“¾è¡¨å­˜æ”¾åˆ°äº† fiber.memorizedState å±æ€§ä¸Šï¼Œé€šè¿‡ next ä¸²è”")]),t._v(" "),a("li",[t._v("preact æ²¡æœ‰å®ç° fiberï¼Œå®ƒæ˜¯æŠŠ hook é“¾è¡¨æ”¾åˆ°äº† vnode._component._hooks å±æ€§ä¸Šï¼Œæ•°ç»„å®ç°çš„ï¼Œé€šè¿‡ä¸‹æ ‡è®¿é—®")]),t._v(" "),a("li",[t._v("react ssr æ—¶ä¸éœ€è¦ fiberï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰æŠŠ hook é“¾è¡¨æŒ‚åˆ° vdom ä¸Šï¼Œè€Œæ˜¯ç›´æ¥æ”¾åœ¨äº†ä¸€ä¸ªå…¨å±€å˜é‡ä¸Šï¼Œå› ä¸ºåªéœ€è¦æ¸²æŸ“ä¸€æ¬¡ï¼Œæ¸²æŸ“å®Œä¸€ä¸ªç»„ä»¶å°±æ¸…ç©ºè¿™ä¸ªå…¨å±€å˜é‡å°±è¡Œ")]),t._v(" "),a("li",[t._v("midway æ˜¯ä¸€ä¸ª Node.js æ¡†æ¶ï¼Œå®ƒä¹Ÿå®ç°äº† hooks ç±»ä¼¼çš„ apiï¼Œå…·ä½“æ”¾åœ¨å“ªæˆ‘ä»¬æ²¡æ·±å…¥ï¼Œä½†æ˜¯åªè¦æœ‰ä¸ªä¸Šä¸‹æ–‡å­˜æ”¾ hook é“¾è¡¨å°±è¡Œ")])]),t._v(" "),a("h3",{attrs:{id:"q6-react-15-16-17-çš„æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q6-react-15-16-17-çš„æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«"}},[t._v("#")]),t._v(" Q6. React 15/16/17 çš„æ¶æ„æœ‰ä»€ä¹ˆåŒºåˆ«")]),t._v(" "),a("p",[t._v("Reactæ¸²æŸ“é¡µé¢çš„ä¸¤ä¸ªé˜¶æ®µ")]),t._v(" "),a("ul",[a("li",[t._v("è°ƒåº¦é˜¶æ®µï¼ˆreconciliationï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µ React ä¼šæ›´æ–°æ•°æ®ç”Ÿæˆæ–°çš„ Virtual DOMï¼Œç„¶åé€šè¿‡Diffç®—æ³•ï¼Œå¿«é€Ÿæ‰¾å‡ºéœ€è¦æ›´æ–°çš„å…ƒç´ ï¼Œæ”¾åˆ°æ›´æ–°é˜Ÿåˆ—ä¸­å»ï¼Œ"),a("strong",[t._v("å¾—åˆ°æ–°çš„æ›´æ–°é˜Ÿåˆ—")]),t._v("ã€‚")]),t._v(" "),a("li",[t._v("æ¸²æŸ“é˜¶æ®µï¼ˆcommitï¼‰ï¼šè¿™ä¸ªé˜¶æ®µ React ä¼šéå†æ›´æ–°é˜Ÿåˆ—ï¼Œ"),a("strong",[t._v("å°†å…¶æ‰€æœ‰çš„å˜æ›´ä¸€æ¬¡æ€§æ›´æ–°åˆ°DOMä¸Š")]),t._v("ã€‚")])]),t._v(" "),a("p",[a("strong",[t._v("React15 æ¶æ„")])]),t._v(" "),a("p",[t._v("React15 æ¶æ„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ï¼›")]),t._v(" "),a("li",[t._v("Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼›")])]),t._v(" "),a("p",[t._v("åœ¨ React15 åŠä»¥å‰ï¼ŒReconciler é‡‡ç”¨é€’å½’çš„æ–¹å¼åˆ›å»ºè™šæ‹Ÿ DOMï¼Œ"),a("strong",[t._v("é€’å½’è¿‡ç¨‹æ˜¯ä¸èƒ½ä¸­æ–­çš„")]),t._v("ã€‚å¦‚æœç»„ä»¶æ ‘çš„å±‚çº§å¾ˆæ·±ï¼Œé€’å½’ä¼šå ç”¨çº¿ç¨‹å¾ˆå¤šæ—¶é—´ï¼Œé€’å½’æ›´æ–°æ—¶é—´è¶…è¿‡äº†16msï¼Œç”¨æˆ·äº¤äº’å°±ä¼šå¡é¡¿ã€‚")]),t._v(" "),a("p",[t._v("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact16 å°†é€’å½’çš„æ— æ³•ä¸­æ–­çš„æ›´æ–°é‡æ„ä¸º"),a("strong",[t._v("å¼‚æ­¥çš„å¯ä¸­æ–­æ›´æ–°")]),t._v("ï¼Œç”±äºæ›¾ç»ç”¨äºé€’å½’çš„è™šæ‹Ÿ DOMæ•°æ®ç»“æ„å·²ç»æ— æ³•æ»¡è¶³éœ€è¦ã€‚äºæ˜¯ï¼Œå…¨æ–°çš„ Fiber æ¶æ„åº”è¿è€Œç”Ÿã€‚")]),t._v(" "),a("p",[a("strong",[t._v("React 16 æ¶æ„")])]),t._v(" "),a("p",[t._v("ä¸ºäº†è§£å†³åŒæ­¥æ›´æ–°é•¿æ—¶é—´å ç”¨çº¿ç¨‹å¯¼è‡´é¡µé¢å¡é¡¿çš„é—®é¢˜ï¼Œä¹Ÿä¸ºäº†æ¢ç´¢è¿è¡Œæ—¶ä¼˜åŒ–çš„æ›´å¤šå¯èƒ½ï¼ŒReact å¼€å§‹é‡æ„å¹¶ä¸€ç›´æŒç»­è‡³ä»Šã€‚é‡æ„çš„ç›®æ ‡æ˜¯å®ç° Concurrent Modeï¼ˆå¹¶å‘æ¨¡å¼ï¼‰ã€‚")]),t._v(" "),a("p",[t._v("ä» v15 åˆ° v16ï¼ŒReact å›¢é˜ŸèŠ±äº†ä¸¤å¹´æ—¶é—´å°†æºç æ¶æ„ä¸­çš„ Stack Reconciler é‡æ„ä¸º Fiber Reconcilerã€‚")]),t._v(" "),a("p",[t._v("React16 æ¶æ„å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰â€”â€” "),a("strong",[t._v("è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§")]),t._v("ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥Reconcilerï¼›")]),t._v(" "),a("li",[t._v("Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ï¼š"),a("strong",[t._v("æ›´æ–°å·¥ä½œä»é€’å½’å˜æˆäº†å¯ä»¥ä¸­æ–­çš„å¾ªç¯è¿‡ç¨‹ã€‚Reconcilerå†…éƒ¨é‡‡ç”¨äº†Fiberçš„æ¶æ„")]),t._v("ï¼›")]),t._v(" "),a("li",[t._v("Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚")])]),t._v(" "),a("p",[a("strong",[t._v("React 17 ä¼˜åŒ–")])]),t._v(" "),a("p",[t._v("React16 çš„ expirationTimes æ¨¡å‹åªèƒ½åŒºåˆ†æ˜¯å¦ >=expirationTimes å†³å®šèŠ‚ç‚¹æ˜¯å¦æ›´æ–°ã€‚React17 çš„ lanes æ¨¡å‹å¯ä»¥é€‰å®šä¸€ä¸ªæ›´æ–°åŒºé—´ï¼Œå¹¶ä¸”åŠ¨æ€çš„å‘åŒºé—´ä¸­å¢å‡ä¼˜å…ˆçº§ï¼Œå¯ä»¥å¤„ç†æ›´ç»†ç²’åº¦çš„æ›´æ–°ã€‚")]),t._v(" "),a("p",[t._v("Lane ç”¨äºŒè¿›åˆ¶ä½è¡¨ç¤ºä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œæ–¹ä¾¿ä¼˜å…ˆçº§çš„è®¡ç®—ï¼ˆä½è¿ç®—ï¼‰ï¼Œä¸åŒä¼˜å…ˆçº§å ç”¨ä¸åŒä½ç½®çš„â€œèµ›é“â€ï¼Œè€Œä¸”å­˜åœ¨æ‰¹çš„æ¦‚å¿µï¼Œä¼˜å…ˆçº§è¶Šä½ï¼Œâ€œèµ›é“â€è¶Šå¤šã€‚é«˜ä¼˜å…ˆçº§æ‰“æ–­ä½ä¼˜å…ˆçº§ï¼Œæ–°å»ºçš„ä»»åŠ¡éœ€è¦èµ‹äºˆä»€ä¹ˆä¼˜å…ˆçº§ç­‰é—®é¢˜éƒ½æ˜¯Lane æ‰€è¦è§£å†³çš„é—®é¢˜ã€‚")]),t._v(" "),a("p",[t._v("Concurrent Modeçš„ç›®çš„æ˜¯å®ç°ä¸€å¥—å¯ä¸­æ–­/æ¢å¤çš„æ›´æ–°æœºåˆ¶ã€‚å…¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š")]),t._v(" "),a("ul",[a("li",[t._v("ä¸€å¥—åç¨‹æ¶æ„ï¼šFiber Reconciler")]),t._v(" "),a("li",[t._v("åŸºäºåç¨‹æ¶æ„çš„"),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/182411298",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¯å‘å¼æ›´æ–°ç®—æ³•"),a("OutboundLink")],1),t._v("ï¼šæ§åˆ¶åç¨‹æ¶æ„å·¥ä½œæ–¹å¼çš„ç®—æ³•")])]),t._v(" "),a("h3",{attrs:{id:"q7-concurrent-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#q7-concurrent-mode"}},[t._v("#")]),t._v(" Q7. Concurrent Mode")]),t._v(" "),a("p",[t._v("Concurrent Mode æŒ‡çš„å°±æ˜¯ React åˆ©ç”¨ä¸Šé¢ Fiber å¸¦æ¥çš„æ–°ç‰¹æ€§çš„å¼€å¯çš„æ–°æ¨¡å¼ (mode)ã€‚react17å¼€å§‹æ”¯æŒconcurrent modeï¼Œè¿™ç§æ¨¡å¼çš„æ ¹æœ¬ç›®çš„æ˜¯ä¸ºäº†è®©åº”ç”¨ä¿æŒcpuå’Œioçš„å¿«é€Ÿå“åº”ï¼Œå®ƒæ˜¯ä¸€ç»„æ–°åŠŸèƒ½ï¼ŒåŒ…æ‹¬Fiberã€Schedulerã€Laneï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·ç¡¬ä»¶æ€§èƒ½å’Œç½‘ç»œçŠ¶å†µè°ƒæ•´åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸ºäº†å®ç°å¼‚æ­¥å¯ä¸­æ–­çš„æ›´æ–°ã€‚concurrent modeä¹Ÿæ˜¯æœªæ¥reactä¸»è¦è¿­ä»£çš„æ–¹å‘ã€‚")]),t._v(" "),a("p",[t._v("ç›®å‰ React å®éªŒç‰ˆæœ¬å…è®¸ç”¨æˆ·é€‰æ‹©ä¸‰ç§ modeï¼š")]),t._v(" "),a("ol",[a("li",[t._v("Legacy Mode: å°±ç›¸å½“äºç›®å‰ç¨³å®šç‰ˆçš„æ¨¡å¼")]),t._v(" "),a("li",[t._v("Blocking Mode: åº”è¯¥æ˜¯ä»¥åä¼šä»£æ›¿ Legacy Mode è€Œé•¿æœŸå­˜åœ¨çš„æ¨¡å¼")]),t._v(" "),a("li",[t._v("Concurrent Mode: ä»¥åä¼šå˜æˆ default çš„æ¨¡å¼")])]),t._v(" "),a("p",[t._v("Concurrent Mode å…¶å®å¼€å¯äº†ä¸€å †æ–°ç‰¹æ€§ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„ç‰¹æ€§å¯ä»¥ç”¨æ¥è§£å†³æˆ‘ä»¬å¼€å¤´æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼š")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903981999718407",target:"_blank",rel:"noopener noreferrer"}},[t._v("Suspense"),a("OutboundLink")],1),t._v("ï¼šSuspense æ˜¯ React æä¾›çš„ä¸€ç§å¼‚æ­¥å¤„ç†çš„æœºåˆ¶, å®ƒä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®è¯·æ±‚åº“ã€‚å®ƒæ˜¯React æä¾›çš„åŸç”Ÿçš„ç»„ä»¶å¼‚æ­¥è°ƒç”¨åŸè¯­ã€‚")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903986420514823",target:"_blank",rel:"noopener noreferrer"}},[t._v("useTrasition"),a("OutboundLink")],1),t._v("ï¼šè®©é¡µé¢å®ç° Pending -> Skeleton -> Complete çš„æ›´æ–°è·¯å¾„, ç”¨æˆ·åœ¨åˆ‡æ¢é¡µé¢æ—¶å¯ä»¥åœç•™åœ¨å½“å‰é¡µé¢ï¼Œè®©é¡µé¢ä¿æŒå“åº”ã€‚ ç›¸æ¯”å±•ç¤ºä¸€ä¸ªæ— ç”¨çš„ç©ºç™½é¡µé¢æˆ–è€…åŠ è½½çŠ¶æ€ï¼Œè¿™ç§ç”¨æˆ·ä½“éªŒæ›´åŠ å‹å¥½ã€‚")])]),t._v(" "),a("p",[t._v("å…¶ä¸­ Suspense å¯ä»¥ç”¨æ¥è§£å†³è¯·æ±‚é˜»å¡çš„é—®é¢˜ï¼ŒUI å¡é¡¿çš„é—®é¢˜å…¶å®å¼€å¯ concurrent mode å°±å·²ç»è§£å†³çš„ï¼Œä½†å¦‚ä½•åˆ©ç”¨ concurrent mode æ¥å®ç°æ›´å‹å¥½çš„äº¤äº’è¿˜æ˜¯éœ€è¦å¯¹ä»£ç åšä¸€ç•ªæ”¹åŠ¨çš„ã€‚")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247490064&idx=1&sn=0f5047c2be91db25203c42b0ece074e9&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ·±å…¥åˆ†æè™šæ‹ŸDOMçš„æ¸²æŸ“è¿‡ç¨‹å’Œç‰¹æ€§"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7010539227284766751#heading-30",target:"_blank",rel:"noopener noreferrer"}},[t._v("React è¿è¡Œæ—¶ä¼˜åŒ–æ–¹æ¡ˆçš„æ¼”è¿›"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);
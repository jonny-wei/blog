<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>性能指标与采集 | 前端那些事儿</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.7b6e3ec2.css" as="style"><link rel="preload" href="/blog/assets/js/app.e9b7ea63.js" as="script"><link rel="preload" href="/blog/assets/js/2.dec2e75d.js" as="script"><link rel="preload" href="/blog/assets/js/1.5b9e135c.js" as="script"><link rel="preload" href="/blog/assets/js/93.4e138a06.js" as="script"><link rel="preload" href="/blog/assets/js/20.badbb211.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc7e09f3.js"><link rel="prefetch" href="/blog/assets/js/100.337ef741.js"><link rel="prefetch" href="/blog/assets/js/101.1257f2fc.js"><link rel="prefetch" href="/blog/assets/js/102.131f1e86.js"><link rel="prefetch" href="/blog/assets/js/103.849d9dd6.js"><link rel="prefetch" href="/blog/assets/js/104.552a90e6.js"><link rel="prefetch" href="/blog/assets/js/105.ac2e5d37.js"><link rel="prefetch" href="/blog/assets/js/106.7af79b20.js"><link rel="prefetch" href="/blog/assets/js/107.d6020f8b.js"><link rel="prefetch" href="/blog/assets/js/108.21caa9f0.js"><link rel="prefetch" href="/blog/assets/js/109.0eb1751c.js"><link rel="prefetch" href="/blog/assets/js/11.b60c9933.js"><link rel="prefetch" href="/blog/assets/js/110.8d2fbecf.js"><link rel="prefetch" href="/blog/assets/js/111.20943a01.js"><link rel="prefetch" href="/blog/assets/js/112.cab8e641.js"><link rel="prefetch" href="/blog/assets/js/113.f1eca1b4.js"><link rel="prefetch" href="/blog/assets/js/114.894abd93.js"><link rel="prefetch" href="/blog/assets/js/115.85624fa4.js"><link rel="prefetch" href="/blog/assets/js/116.c5a70ef7.js"><link rel="prefetch" href="/blog/assets/js/117.4453d953.js"><link rel="prefetch" href="/blog/assets/js/118.eefb56cd.js"><link rel="prefetch" href="/blog/assets/js/119.b14d6450.js"><link rel="prefetch" href="/blog/assets/js/12.c53283e7.js"><link rel="prefetch" href="/blog/assets/js/120.cbb7c7cd.js"><link rel="prefetch" href="/blog/assets/js/121.9b31b1a5.js"><link rel="prefetch" href="/blog/assets/js/122.f43b9cef.js"><link rel="prefetch" href="/blog/assets/js/123.257fe662.js"><link rel="prefetch" href="/blog/assets/js/124.4011ea82.js"><link rel="prefetch" href="/blog/assets/js/125.d1e8e0d9.js"><link rel="prefetch" href="/blog/assets/js/126.448fca54.js"><link rel="prefetch" href="/blog/assets/js/127.0f8042b6.js"><link rel="prefetch" href="/blog/assets/js/128.369941f3.js"><link rel="prefetch" href="/blog/assets/js/129.c409f907.js"><link rel="prefetch" href="/blog/assets/js/13.6bdc6b5d.js"><link rel="prefetch" href="/blog/assets/js/130.d645057b.js"><link rel="prefetch" href="/blog/assets/js/131.45ccfc83.js"><link rel="prefetch" href="/blog/assets/js/132.044b86a9.js"><link rel="prefetch" href="/blog/assets/js/133.ce9418b3.js"><link rel="prefetch" href="/blog/assets/js/134.c068e9d4.js"><link rel="prefetch" href="/blog/assets/js/135.cb875c47.js"><link rel="prefetch" href="/blog/assets/js/136.dded7b9f.js"><link rel="prefetch" href="/blog/assets/js/137.aa92a0ec.js"><link rel="prefetch" href="/blog/assets/js/138.c6ae5afe.js"><link rel="prefetch" href="/blog/assets/js/139.afd9803d.js"><link rel="prefetch" href="/blog/assets/js/14.c3201a23.js"><link rel="prefetch" href="/blog/assets/js/140.bfa6c1fe.js"><link rel="prefetch" href="/blog/assets/js/141.80ba11c6.js"><link rel="prefetch" href="/blog/assets/js/142.280c9b87.js"><link rel="prefetch" href="/blog/assets/js/143.84572423.js"><link rel="prefetch" href="/blog/assets/js/144.d60eabb4.js"><link rel="prefetch" href="/blog/assets/js/145.ee097aff.js"><link rel="prefetch" href="/blog/assets/js/146.1ee847d6.js"><link rel="prefetch" href="/blog/assets/js/147.0d80f645.js"><link rel="prefetch" href="/blog/assets/js/148.248ec39a.js"><link rel="prefetch" href="/blog/assets/js/149.abe65cfb.js"><link rel="prefetch" href="/blog/assets/js/15.a0b9e44e.js"><link rel="prefetch" href="/blog/assets/js/150.9b4cbf0f.js"><link rel="prefetch" href="/blog/assets/js/151.83597e3e.js"><link rel="prefetch" href="/blog/assets/js/152.4276f94d.js"><link rel="prefetch" href="/blog/assets/js/153.14722280.js"><link rel="prefetch" href="/blog/assets/js/154.dd293d18.js"><link rel="prefetch" href="/blog/assets/js/155.0ad6ffac.js"><link rel="prefetch" href="/blog/assets/js/156.765a7f18.js"><link rel="prefetch" href="/blog/assets/js/157.02f08cdb.js"><link rel="prefetch" href="/blog/assets/js/158.6e0bf1c0.js"><link rel="prefetch" href="/blog/assets/js/159.e50fb630.js"><link rel="prefetch" href="/blog/assets/js/16.491191e4.js"><link rel="prefetch" href="/blog/assets/js/160.479a263e.js"><link rel="prefetch" href="/blog/assets/js/161.3d7e9515.js"><link rel="prefetch" href="/blog/assets/js/162.45499727.js"><link rel="prefetch" href="/blog/assets/js/163.45bdc0ec.js"><link rel="prefetch" href="/blog/assets/js/164.eeb4f26d.js"><link rel="prefetch" href="/blog/assets/js/165.e8ec1a69.js"><link rel="prefetch" href="/blog/assets/js/166.09e4c5ba.js"><link rel="prefetch" href="/blog/assets/js/167.682e9c17.js"><link rel="prefetch" href="/blog/assets/js/168.a80229c6.js"><link rel="prefetch" href="/blog/assets/js/169.bacba512.js"><link rel="prefetch" href="/blog/assets/js/17.89ec8c57.js"><link rel="prefetch" href="/blog/assets/js/170.1cec8dd4.js"><link rel="prefetch" href="/blog/assets/js/171.0089fe1a.js"><link rel="prefetch" href="/blog/assets/js/172.ea5262e4.js"><link rel="prefetch" href="/blog/assets/js/173.7875bea9.js"><link rel="prefetch" href="/blog/assets/js/174.7aa99a96.js"><link rel="prefetch" href="/blog/assets/js/175.28492d4b.js"><link rel="prefetch" href="/blog/assets/js/176.c79421e2.js"><link rel="prefetch" href="/blog/assets/js/177.1a2283d9.js"><link rel="prefetch" href="/blog/assets/js/178.ad2555ad.js"><link rel="prefetch" href="/blog/assets/js/179.b576f82d.js"><link rel="prefetch" href="/blog/assets/js/18.b91f1411.js"><link rel="prefetch" href="/blog/assets/js/180.7aa47869.js"><link rel="prefetch" href="/blog/assets/js/181.b82bb8f4.js"><link rel="prefetch" href="/blog/assets/js/182.ed725fa4.js"><link rel="prefetch" href="/blog/assets/js/183.5a57b1b7.js"><link rel="prefetch" href="/blog/assets/js/184.850c643c.js"><link rel="prefetch" href="/blog/assets/js/185.a1629294.js"><link rel="prefetch" href="/blog/assets/js/186.4c59b35b.js"><link rel="prefetch" href="/blog/assets/js/187.b1ee21ec.js"><link rel="prefetch" href="/blog/assets/js/188.e6e1009d.js"><link rel="prefetch" href="/blog/assets/js/189.d4c24933.js"><link rel="prefetch" href="/blog/assets/js/19.cb1f17c8.js"><link rel="prefetch" href="/blog/assets/js/190.52af3d91.js"><link rel="prefetch" href="/blog/assets/js/191.daac205d.js"><link rel="prefetch" href="/blog/assets/js/192.8735a570.js"><link rel="prefetch" href="/blog/assets/js/193.0619ad3e.js"><link rel="prefetch" href="/blog/assets/js/194.83e05501.js"><link rel="prefetch" href="/blog/assets/js/195.d3c64566.js"><link rel="prefetch" href="/blog/assets/js/196.bff584ec.js"><link rel="prefetch" href="/blog/assets/js/197.2db9e539.js"><link rel="prefetch" href="/blog/assets/js/198.2cde63d5.js"><link rel="prefetch" href="/blog/assets/js/199.01c57daa.js"><link rel="prefetch" href="/blog/assets/js/200.c5041eec.js"><link rel="prefetch" href="/blog/assets/js/201.a3c96a9f.js"><link rel="prefetch" href="/blog/assets/js/202.c382b0c1.js"><link rel="prefetch" href="/blog/assets/js/203.56dd6c0b.js"><link rel="prefetch" href="/blog/assets/js/204.cd7bd9b2.js"><link rel="prefetch" href="/blog/assets/js/205.f8ba82b1.js"><link rel="prefetch" href="/blog/assets/js/206.1f62843b.js"><link rel="prefetch" href="/blog/assets/js/207.91b1d1d9.js"><link rel="prefetch" href="/blog/assets/js/208.e8d0fc56.js"><link rel="prefetch" href="/blog/assets/js/209.f4613282.js"><link rel="prefetch" href="/blog/assets/js/21.bf0041b7.js"><link rel="prefetch" href="/blog/assets/js/210.27d0e36b.js"><link rel="prefetch" href="/blog/assets/js/211.0dad5495.js"><link rel="prefetch" href="/blog/assets/js/212.6ff2cec6.js"><link rel="prefetch" href="/blog/assets/js/22.48390d4f.js"><link rel="prefetch" href="/blog/assets/js/23.35c4ba93.js"><link rel="prefetch" href="/blog/assets/js/24.5dc212cd.js"><link rel="prefetch" href="/blog/assets/js/25.01cde98b.js"><link rel="prefetch" href="/blog/assets/js/26.51647c2f.js"><link rel="prefetch" href="/blog/assets/js/27.b0efe319.js"><link rel="prefetch" href="/blog/assets/js/28.6ae36e8b.js"><link rel="prefetch" href="/blog/assets/js/29.09981e94.js"><link rel="prefetch" href="/blog/assets/js/3.cb0627fa.js"><link rel="prefetch" href="/blog/assets/js/30.bcafbd5b.js"><link rel="prefetch" href="/blog/assets/js/31.b99dc8e5.js"><link rel="prefetch" href="/blog/assets/js/32.aaa83642.js"><link rel="prefetch" href="/blog/assets/js/33.84478543.js"><link rel="prefetch" href="/blog/assets/js/34.fa4f18d6.js"><link rel="prefetch" href="/blog/assets/js/35.0835b775.js"><link rel="prefetch" href="/blog/assets/js/36.8f409625.js"><link rel="prefetch" href="/blog/assets/js/37.37e725fb.js"><link rel="prefetch" href="/blog/assets/js/38.f70df6b0.js"><link rel="prefetch" href="/blog/assets/js/39.c62ad3ad.js"><link rel="prefetch" href="/blog/assets/js/4.cbb57fa7.js"><link rel="prefetch" href="/blog/assets/js/40.fa1e4cd7.js"><link rel="prefetch" href="/blog/assets/js/41.b0b54a79.js"><link rel="prefetch" href="/blog/assets/js/42.38f97c50.js"><link rel="prefetch" href="/blog/assets/js/43.c0d731cf.js"><link rel="prefetch" href="/blog/assets/js/44.1ada494a.js"><link rel="prefetch" href="/blog/assets/js/45.f9f0d1d3.js"><link rel="prefetch" href="/blog/assets/js/46.f61ebf44.js"><link rel="prefetch" href="/blog/assets/js/47.1e3244f7.js"><link rel="prefetch" href="/blog/assets/js/48.d5d6e9cf.js"><link rel="prefetch" href="/blog/assets/js/49.874c0d73.js"><link rel="prefetch" href="/blog/assets/js/5.fe065607.js"><link rel="prefetch" href="/blog/assets/js/50.2bde8ac3.js"><link rel="prefetch" href="/blog/assets/js/51.e6c26277.js"><link rel="prefetch" href="/blog/assets/js/52.b5171a6c.js"><link rel="prefetch" href="/blog/assets/js/53.5e07287e.js"><link rel="prefetch" href="/blog/assets/js/54.33ff2540.js"><link rel="prefetch" href="/blog/assets/js/55.ec9542b6.js"><link rel="prefetch" href="/blog/assets/js/56.d99bf778.js"><link rel="prefetch" href="/blog/assets/js/57.6f4b13ff.js"><link rel="prefetch" href="/blog/assets/js/58.63a8354d.js"><link rel="prefetch" href="/blog/assets/js/59.af80b9ec.js"><link rel="prefetch" href="/blog/assets/js/6.68cda050.js"><link rel="prefetch" href="/blog/assets/js/60.63c1fc8d.js"><link rel="prefetch" href="/blog/assets/js/61.b3a0847f.js"><link rel="prefetch" href="/blog/assets/js/62.4ae929a2.js"><link rel="prefetch" href="/blog/assets/js/63.0f8029d4.js"><link rel="prefetch" href="/blog/assets/js/64.69daf65d.js"><link rel="prefetch" href="/blog/assets/js/65.cd1bf692.js"><link rel="prefetch" href="/blog/assets/js/66.5c506ec8.js"><link rel="prefetch" href="/blog/assets/js/67.e76ea4c3.js"><link rel="prefetch" href="/blog/assets/js/68.50e5e983.js"><link rel="prefetch" href="/blog/assets/js/69.d3d5ee70.js"><link rel="prefetch" href="/blog/assets/js/7.3b8d63a0.js"><link rel="prefetch" href="/blog/assets/js/70.9d2c5ae6.js"><link rel="prefetch" href="/blog/assets/js/71.1ff968ec.js"><link rel="prefetch" href="/blog/assets/js/72.a5c66acf.js"><link rel="prefetch" href="/blog/assets/js/73.beb7a9f7.js"><link rel="prefetch" href="/blog/assets/js/74.30f7ec1e.js"><link rel="prefetch" href="/blog/assets/js/75.50b2e636.js"><link rel="prefetch" href="/blog/assets/js/76.e4a2de98.js"><link rel="prefetch" href="/blog/assets/js/77.695fe053.js"><link rel="prefetch" href="/blog/assets/js/78.91e5a782.js"><link rel="prefetch" href="/blog/assets/js/79.b216b823.js"><link rel="prefetch" href="/blog/assets/js/80.c2247050.js"><link rel="prefetch" href="/blog/assets/js/81.f167f26a.js"><link rel="prefetch" href="/blog/assets/js/82.b4d5e9c9.js"><link rel="prefetch" href="/blog/assets/js/83.297d7d3d.js"><link rel="prefetch" href="/blog/assets/js/84.7f7e2cd1.js"><link rel="prefetch" href="/blog/assets/js/85.72b43fe6.js"><link rel="prefetch" href="/blog/assets/js/86.0b4102e0.js"><link rel="prefetch" href="/blog/assets/js/87.707e49df.js"><link rel="prefetch" href="/blog/assets/js/88.d3bd696a.js"><link rel="prefetch" href="/blog/assets/js/89.9c611b54.js"><link rel="prefetch" href="/blog/assets/js/90.001805e9.js"><link rel="prefetch" href="/blog/assets/js/91.3b5b43f2.js"><link rel="prefetch" href="/blog/assets/js/92.70cd30f9.js"><link rel="prefetch" href="/blog/assets/js/94.0d5ed05c.js"><link rel="prefetch" href="/blog/assets/js/95.07a70e9a.js"><link rel="prefetch" href="/blog/assets/js/96.34b29a24.js"><link rel="prefetch" href="/blog/assets/js/97.af74319a.js"><link rel="prefetch" href="/blog/assets/js/98.f2f367d9.js"><link rel="prefetch" href="/blog/assets/js/99.a1c21720.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.bd3cdb54.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.7b6e3ec2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="前端那些事儿" class="logo"> <span class="site-name can-hide">前端那些事儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link router-link-active">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">
  架构&amp;方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link router-link-active">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">
  架构&amp;方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops/" aria-current="page" class="sidebar-link">Webpack 常用配置</a></li><li><a href="/blog/devops/webpack/building.html" class="sidebar-link">构建流程与原理</a></li><li><a href="/blog/devops/webpack/dependency-graph.html" class="sidebar-link">模块依赖关系</a></li><li><a href="/blog/devops/webpack/chunk.html" class="sidebar-link">产物打包逻辑</a></li><li><a href="/blog/devops/webpack/compile.html" class="sidebar-link">模块编译及运行时</a></li><li><a href="/blog/devops/webpack/hmr.html" class="sidebar-link">HMR 热更新</a></li><li><a href="/blog/devops/webpack/loader.html" class="sidebar-link">Webpack Loader</a></li><li><a href="/blog/devops/webpack/plugin.html" class="sidebar-link">Webpack Plugin</a></li><li><a href="/blog/devops/webpack/module-federation.html" class="sidebar-link">模块联邦</a></li><li><a href="/blog/devops/webpack/cache.html" class="sidebar-link">持久化缓存</a></li><li><a href="/blog/devops/webpack/parallel.html" class="sidebar-link">并行构建</a></li><li><a href="/blog/devops/webpack/split-chunks.html" class="sidebar-link">分包策略</a></li><li><a href="/blog/devops/webpack/compress.html" class="sidebar-link">代码压缩</a></li><li><a href="/blog/devops/webpack/tree-shaking.html" class="sidebar-link">Tree Shaking</a></li><li><a href="/blog/devops/webpack/others.html" class="sidebar-link">Webpack 相关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops/vite/esm.html" class="sidebar-link">模块化规范</a></li><li><a href="/blog/devops/vite/css.html" class="sidebar-link">CSS 工程化</a></li><li><a href="/blog/devops/vite/prebuild.html" class="sidebar-link">依赖预构建</a></li><li><a href="/blog/devops/vite/engines.html" class="sidebar-link">双引擎架构</a></li><li><a href="/blog/devops/vite/rollup.html" class="sidebar-link">Rollup 打包</a></li><li><a href="/blog/devops/vite/building.html" class="sidebar-link">Vite 构建原理</a></li><li><a href="/blog/devops/vite/plugin.html" class="sidebar-link">Vite Plugin</a></li><li><a href="/blog/devops/vite/hmr.html" class="sidebar-link">Vite HMR 热更新</a></li><li><a href="/blog/devops/vite/ssr.html" class="sidebar-link">SSR 工程化</a></li><li><a href="/blog/devops/vite/legacy.html" class="sidebar-link">兼容性问题</a></li><li><a href="/blog/devops/vite/split-code.html" class="sidebar-link">代码分割</a></li><li><a href="/blog/devops/vite/mini.html" class="sidebar-link">Vite Mini 实现</a></li><li><a href="/blog/devops/vite/vite-news.html" class="sidebar-link">Vite 新特性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops/performance/indicator.html" aria-current="page" class="active sidebar-link">性能指标与采集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/devops/performance/indicator.html#性能指标" class="sidebar-link">性能指标</a></li><li class="sidebar-sub-header"><a href="/blog/devops/performance/indicator.html#指标采集" class="sidebar-link">指标采集</a></li><li class="sidebar-sub-header"><a href="/blog/devops/performance/indicator.html#性能评估" class="sidebar-link">性能评估</a></li></ul></li><li><a href="/blog/devops/performance/webpack.html" class="sidebar-link">打包方面优化</a></li><li><a href="/blog/devops/performance/network.html" class="sidebar-link">网络方面优化</a></li><li><a href="/blog/devops/performance/render.html" class="sidebar-link">渲染方面优化</a></li><li><a href="/blog/devops/performance/code.html" class="sidebar-link">代码方面优化</a></li><li><a href="/blog/devops/performance/analysis.html" class="sidebar-link">打包性能分析工具</a></li><li><a href="/blog/devops/performance/optimization.html" class="sidebar-link">指标性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码与包管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops/git/git.html" class="sidebar-link">Git</a></li><li><a href="/blog/devops/git/package.html" class="sidebar-link">认识 package.json</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="性能指标与采集"><a href="#性能指标与采集" class="header-anchor">#</a> 性能指标与采集</h1> <h2 id="性能指标"><a href="#性能指标" class="header-anchor">#</a> 性能指标</h2> <h3 id="传统性能指标"><a href="#传统性能指标" class="header-anchor">#</a> 传统性能指标</h3> <p>传统性能指标，通过记录一个文档从发起请求到加载完毕的各阶段的性能耗时，以加载速度来衡量性能。</p> <p><img src="/blog/images/devops/indicator3.png" alt="indicator3"></p> <h4 id="初始化阶段"><a href="#初始化阶段" class="header-anchor">#</a> 初始化阶段</h4> <ul><li><p>navigationStart: 用户完成卸载前一个文档的时间点。</p></li> <li><p>redirectStart：页面重定向时的开始时间，或者是 0。</p></li> <li><p>redirectEnd：页面重定向的结束时间，或者是 0。</p></li></ul> <h4 id="请求阶段"><a href="#请求阶段" class="header-anchor">#</a> 请求阶段</h4> <ul><li><p>fetchStart：浏览器发起资源请求时，有缓存时，则返回读取缓存的开始时间。</p></li> <li><p>domainLookupStart：查询 DNS 的开始时间。</p></li> <li><p>domainLookupEnd：查询 DNS 的结束时间。</p></li> <li><p>connectStart：浏览器开始与服务器连接时的时间。</p></li> <li><p>secureConnectionStart：如果页面使用 HTTPS，它的值是安全连接握手之前的时刻。</p></li> <li><p>connectEnd：当浏览器端完成与服务器端建立连接的时刻。</p></li> <li><p>responseStart：指客户端收到从服务器端（或缓存、本地资源）响应回的第一个字节的数据的时刻。</p></li> <li><p>responseEnd：指客户端收到从服务器端（或缓存、本地资源）响应回的最后一个字节的数据的时刻。</p></li></ul> <h4 id="解析渲染阶段"><a href="#解析渲染阶段" class="header-anchor">#</a> 解析渲染阶段</h4> <ul><li><p>domLoading： 浏览器即将开始解析第一批收到的 HTML 文档字节，<code>Document.readyState</code> 变为 <code>loading</code>。</p></li> <li><p>domInteractive: 当前网页 DOM结构结束解析、开始加载内嵌资源的时间点。<code>Document.readyState</code> 变为 <code>interactive</code>。</p></li> <li><p>domContentLoadedEventStart: 当解析器发送 <code>DomContentLoaded</code> 事件，所有需要被执行的脚本已经被解析。</p></li> <li><p>domContentLoadedEventEnd: 所有需要立即执行的脚本已经被执行。</p></li> <li><p>domComplete: 当前文档解析完成， <code>Document.readyState</code> 变为 <code>complete</code>。</p></li> <li><p>loadEventStart: 作为每个网页加载的最后一步，浏览器会触发 <code>load</code> 事件，以便触发额外的应用逻辑。如果这个事件还未被发送，它的值将会是 0。</p></li> <li><p>loadEventEnd:<code>load</code> 事件执行完成。如果这个事件还未被发送，或者尚未完成，它的值将会是 0。</p></li></ul> <p><img src="/blog/images/devops/indicator4.png" alt="indicator4"></p> <h4 id="各阶段耗时"><a href="#各阶段耗时" class="header-anchor">#</a> 各阶段耗时</h4> <ul><li><p>重定向 Redirect:  <code>redirectEnd - redirectStart</code></p></li> <li><p>缓存 App cache:  <code>domainLookupStart - fetchStart</code></p></li> <li><p>DNS 解析 DNS: <code>domainLookupEnd - domainLookupStart</code></p></li> <li><p>TCP建连 TCP:  <code>connectEnd - connectStart</code></p></li> <li><p>SSL 握手 SSL:  <code>connectEnd - secureConnectionStart</code></p></li> <li><p>请求耗时 Request: <code>responseStart - requestStart</code></p></li> <li><p>响应耗时 Response: <code>responseEnd - responseStart</code></p></li> <li><p>Processing:  <code>domComplete - domLoading</code></p></li></ul> <h4 id="实际运用中的常见指标"><a href="#实际运用中的常见指标" class="header-anchor">#</a> 实际运用中的常见指标</h4> <ul><li><p>页面完全加载耗时 Load:  <code>loadEventEnd - navigationStart</code></p></li> <li><p>DOMReady: <code>domContentLoaded - fetchStart</code></p></li> <li><p>dom 解析耗时 DOMParse: <code>domInteractive - responseEnd</code></p></li> <li><p>页面请求到收到应答 TTFB: <code>responseStart - navigationStart</code></p></li></ul> <p>TTFB（Time To First Byte） 是发出页面请求到接收到应答数据第一 个字节的时间总和，它包含了DNS解析时间、 TCP连接时间、发送HTTP请求时间和获得响应消息第一个字节的时间</p> <ul><li>剩余资源加载耗时 ResourceLoad: domComplete - domContentLoaded</li></ul> <p>传统的性能指标专注于容易衡量的技术细节，但是它们很难反应出用户所真正关心的是什么。如果你仅仅是把加载速度优化的更快，你很快就会发现网站的用户体验依然很差。</p> <p>以用户为中心的性能指标衡量页面显示有用内容的速度，用户是否可以与之交互，以及这些交互是否流畅且无延迟。</p> <p>下面是常用的以用户为中心的性能指标，也是我们比较关注的指标。</p> <h3 id="何时开始渲染-fp-fcp"><a href="#何时开始渲染-fp-fcp" class="header-anchor">#</a> 何时开始渲染  - FP &amp; FCP</h3> <h4 id="fp"><a href="#fp" class="header-anchor">#</a> FP</h4> <p>FP（First Paint）: <strong>首次渲染</strong>的时间点。用于记录页面第一次绘制像素的时间。 FP 时间点之前，用户看到的都是<strong>没有任何内容的白色屏幕</strong>，可以视为<strong>白屏时间</strong>。</p> <h4 id="fcp"><a href="#fcp" class="header-anchor">#</a> FCP</h4> <p>FCP（First Contentful Paint）: <strong>首次有内容渲染</strong>的时间点。用于记录页面首次绘制文本、图片、非空白 Canvas 或 SVG 的时间。在用户访问 Web 网页的过程中，FCP 时间点之前，用户看到的都是<strong>没有任何实际内容的屏幕</strong>。FCP 反映当前 Web 页面的网络加载性能情况、页面 DOM 结构复杂度情况、<code>inline script</code> 的执行效率的情况。当所有的阶段性能做的非常好的情况下，首次出现内容的时间就会越短，用户等待的时间就会越短，流失的概率就会降低，可以作为<strong>首屏时间</strong>。</p> <p>通过这两个指标，就可以衡量页面<strong>何时开始渲染内容</strong>。官方推荐，FP 及 FCP 两指标在 2 秒内完成的话我们的页面就算体验优秀。</p> <div class="custom-block tip"><p class="custom-block-title">FP vs FCP</p> <ul><li><p>FP：从开始加载到第一次渲染</p></li> <li><p>FCP：从开始加载到第一次内容渲染。</p></li> <li><p>FCP 是 FP 的增强版，对用户来说更关键。因为 FCP 带着图像和文字这些内容信息，是用户更关心的。</p></li> <li><p>FP 和 FCP 可能是重合的。</p></li></ul></div> <h3 id="何时渲染出主要内容-fmp-lcp-si"><a href="#何时渲染出主要内容-fmp-lcp-si" class="header-anchor">#</a> 何时渲染出主要内容 - FMP &amp; LCP &amp; SI</h3> <h4 id="fmp"><a href="#fmp" class="header-anchor">#</a> FMP</h4> <p>FMP（First Meaningful Paint）: <strong>首次绘制有意义内容</strong>的时间点。当整体页面的布局和文字内容全部渲染完成后，可认为是完成了首次有意义内容的绘制。业界比较认可的方式是在加载和渲染过程中最大布局变动之后的那个绘制时间即为当前页面的 FMP。FMP 通常被认为是用户获取到了页面主要信息的时刻，也就是说此时<strong>用户的需求是得到了满足的</strong>，所以产品通常也会关注 FMP 指标。只不过它计算相对复杂，且存在准确性等问题，Lighthouse 6.0 中<strong>已被废弃</strong>。</p> <p>FMP 代码实现原理：</p> <p>认为<code>DOM 结构变化的时间点</code>与之对应<code>渲染的时间点</code>近似相同。所以 FMP 的时间点为 <code>DOM 结构变化最剧烈的时间点</code>。</p> <p>DOM 结构变化的时间点」可以利用 <a href="https://dom.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">MutationObserver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://dom.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来获得。</p> <ol><li>通过 <code>MutationObserver</code> 监听每一次页面整体的 DOM 变化，触发 <code>MutationObserver</code> 的回调。</li> <li>在回调计算出当前 DOM 树的分数，分数变化最剧烈的时刻，即为 FMP 的时间点。</li></ol> <h4 id="lcp"><a href="#lcp" class="header-anchor">#</a> LCP</h4> <p>LCP（Largest Contentful Paint）:  <strong>最大的内容在可视区域内变得可见</strong>的时间点。用于记录视窗内最大的元素绘制的时间，该时间会随着页面渲染变化而变化，因为页面中的最大元素在渲染过程中可能会发生改变，另外该指标会在用户第一次交互后停止记录。页面的最大内容（通常是比较核心的内容）加载完成的时间，这个最大内容可以是图片/文本块。它是一个 <strong>SEO 相关的指标</strong>。</p> <p>LCP 其实能比前两个指标更能体现一个页面的性能好坏程度，因为这个指标会持续更新。举个例子：当页面出现骨架屏或者 Loading 动画时 FCP 其实已经被记录下来了，但是此时用户希望看到的内容其实并未呈现，我们更想知道的是页面主要的内容是何时呈现出来的。此时 LCP 指标是能够帮助我们实现想要的需求的。官方推荐，在 2.5 秒内表示体验优秀。</p> <div class="custom-block tip"><p class="custom-block-title">FMP vs LCP</p> <ul><li><p>FMP: 早期比较推荐的性能指标，但是计算更复杂，而且准确性不是很好</p></li> <li><p>LCP: 更新的数据指标，有 API 直接支持，统计简单，且准确，但也存在最大内容是否为最核心内容这样的问题。</p></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">FCP vs LCP</p> <ul><li><p>FCP：页面加载过程中，比较早期的一个指标，如果一个页面有 loading 态，这个指标表现可能很好，但是实际内容什么时候呈现给用户，这个指标没办法衡量。</p></li> <li><p>LCP：关注页面核心内容呈现时间，这个内容是用户更感兴趣的，更加用户相关。</p></li></ul></div> <h4 id="si"><a href="#si" class="header-anchor">#</a> SI</h4> <p>SI（Speed Index）: 衡量<strong>页面可视区域加载速度</strong>，帮助检测页面的加载体验差异。两个页面如果首次内容出现和完全加载时间一样，那么渐进加载的页面体验更好。</p> <div class="custom-block tip"><p class="custom-block-title">何时渲染出主要内容：FMP &amp;&amp; LCP &amp;&amp; SI</p> <ul><li><p>FMP：First Meaningful Paint，完成首次有意义内容绘制的时间点。</p></li> <li><p>LCP：Largest Contentful Paint，最大的内容在可视区域内变得可见的时间点。</p></li> <li><p>SI：Speed Index，衡量页面可视区域的加载速度，反映页面的加载体验差异。</p></li></ul></div> <p>有了这三个指标，就可以衡量页面何时渲染出主要内容了。不过业界有测试得出， LCP  非常近似于 FMP 的时间点，同时 FMP 性能消耗较大，且会因为一些细小的变化导致数值巨大波动，所以<strong>推荐使用 LCP。</strong> 而 SI 因为计算复杂，指标难以解释，所以一般只在实验室环境下使用。</p> <h3 id="何时可以交互-tti-tbt"><a href="#何时可以交互-tti-tbt" class="header-anchor">#</a> 何时可以交互 - TTI &amp; TBT</h3> <h4 id="tti"><a href="#tti" class="header-anchor">#</a> TTI</h4> <p>TTI（Time to Interactive）: 测量页面<strong>从开始加载到主要子资源完成渲染</strong>，并能够快速、可靠地响应用户输入所需的时间。通常是发生在页面依赖的资源已经加载完成，此时浏览器可以快速响应用户交互的时间。TTI 反映页面可用性的重要指标。<strong>TTI 值越小，代表用户可以更早地操作页面</strong>，用户体验就更好。指标的计算过程，需要满足以下几个条件：</p> <ol><li>从 FCP 指标后开始计算；</li> <li>持续 5 秒内无长任务（执行时间超过 50 ms）且无两个以上正在进行中的 GET 请求；</li> <li>往前回溯至 5 秒前的最后一个长任务结束的时间。</li></ol> <div class="custom-block tip"><p class="custom-block-title">Long Task</p> <p>如果浏览器主线程执行的一个 task 耗时大于 50ms，那么这个 task 称为 long task。</p> <p>用户的交互操作也是在主线程执行的，所以当发生 Long Task 时，用户的交互操作很可能无法及时执行，这时用户就会体验到卡顿（当页面响应时间超过 100ms 时，用户可以体验到卡顿），进而影响用户体验。</p></div> <h4 id="tbt"><a href="#tbt" class="header-anchor">#</a> TBT</h4> <p>TBT（Total Blocking Time）: <strong>阻塞总时间</strong>。量化主线程在空闲之前的繁忙程度，有助于理解在加载期间，<strong>页面无法响应用户输入的时间有多久</strong>。一个页面的 TBT，是<strong>从 FCP 到 TTI 之间所有长任务的阻塞时间的总和</strong>。主线程执行的任务分为长任务和短任务。规定持续时间超过 50ms 的任务为长任务，低于 50ms 的任务为短任务。长任务中超过 50ms 的时间被认为是“阻塞”的，因此，TBT 是所有长任务中阻塞时间的总和。</p> <p>这个指标的高低其实也影响了 TTI 的高低，或者说和长任务相关的几个指标都有关联性。TTI 虽然可以衡量页面可以交互的时间点，但是却无法感知这个期间浏览器的繁忙状态。而结合 TBT ，就能帮助理解在加载期间，页面无法响应用户输入的时间有多久。</p> <h3 id="交互时是否有延迟-fid-mpfid"><a href="#交互时是否有延迟-fid-mpfid" class="header-anchor">#</a> 交互时是否有延迟 - FID &amp; MPFID</h3> <h4 id="fid"><a href="#fid" class="header-anchor">#</a> FID</h4> <p>FID（First Input Delay）: <strong>首次输入延迟</strong>。测量从用户第一次与页面交互（比如当他们单击链接、点按按钮等等）直到浏览器对交互作出响应，实际能够<strong>开始处理事件处理程序所经过的时间</strong>，即<strong>交互延迟时间</strong>。一般来说，发生输入延迟是因为浏览器的主线程正忙着执行其他工作（比如解析和执行大型 JS 文件），还不能响应用户。</p> <ol><li>FID 反映用户对页面交互性和响应性的第一印象，良好的第一印象有助于用户建立对整个应用的良好印象。</li> <li>页面加载阶段，资源的处理任务最重，也最容易产生输入延迟。因此<strong>关注 FID 指标对于提升页面的可交互性有很大收益</strong>。</li> <li>FID 和页面加载完成后的 Input Delay 具有不同的解决方案。针对 FID，我们一般建议通过 <code>Code Splitting</code> 等方式减少页面加载阶段 JS 的加载、解析和执行时间。而页面加载完成后的 <code>Input Delay</code>，通常是由于开发人员代码编写不当、引起 JS 执行时间过长而产生的。</li></ol> <h4 id="mpfid"><a href="#mpfid" class="header-anchor">#</a> MPFID</h4> <p>MPFID（Max Potential First Input Delay）：记录在页面加载过程中用户和页面进行首次交互操作可能花费的最长时间。</p> <p>MPFID 是一个虚拟的可能的延迟时间，而FID是用户真实的首次交互的延迟时间。所以一般推荐使用FID，它是用户对页面交互性和响应性的第一印象。良好的第一印象有助于用户建立对整个应用的良好印象。同时在页面加载阶段，资源的处理任务最重，最容易产生输入延迟。</p> <h3 id="页面是否稳定-cls"><a href="#页面是否稳定-cls" class="header-anchor">#</a> 页面是否稳定 - CLS</h3> <h4 id="cls"><a href="#cls" class="header-anchor">#</a> CLS</h4> <p>CLS（Cumulative Layout Shift）: <strong>累积布局偏移</strong>。量化了<strong>在页面加载期间，视口中元素的移动程度</strong>。在一个页面的生命周期中，会不断的发生布局变化（layout shift），对每一次布局变化做一个累积的记分，其中得分最大布局变化即为 CLS，是<strong>衡量页面稳定性</strong>的重要指标。</p> <p>CLS 推荐值为低于 0.1，越低说明页面跳来跳去的情况就越少，用户体验越好。毕竟很少有人喜欢阅读或者交互过程中网页突然动态插入 DOM 的情况，比如说插入广告~</p> <div class="custom-block tip"><p class="custom-block-title">Core Web Vitals 三核心指标</p> <p>2020 年 5 月，Google 提出的衡量网站用户体验的核心数据指标，涵盖了页面的加载速度、可交互性和稳定性，会影响 SEO 的重要指标，包含一下三项：</p> <ul><li>LCP：衡量加载速度。代表了页面的速度指标。LCP 能体现的东西更多一些。一是指标实时更新，数据更精确，二是代表着页面最大元素的渲染时间，通常来说页面中最大元素的快速载入能让用户感觉性能还挺好。</li> <li>FID：衡量交互性。代表了页面的交互体验指标。没有一个用户希望触发交互以后页面的反馈很迟缓，交互响应的快会让用户觉得网页挺流畅。</li> <li>CLS：衡量稳定性。代表了页面的稳定指标。CLS 值一大的话会让用户觉得页面体验做的很差。</li></ul></div> <h2 id="指标采集"><a href="#指标采集" class="header-anchor">#</a> 指标采集</h2> <h3 id="传统指标采集"><a href="#传统指标采集" class="header-anchor">#</a> 传统指标采集</h3> <p>采集页面加载过程的各阶段耗时</p> <p>页面加载过程中的时间点主要依赖 Navigation Timing 标准，这个标准后来升级到了 2.0 版本， 对应 Navigation Timing 2 标准，两者虽然不尽相同，但是可计算出的指标基本一致。获取各个阶段的响应时间，我们所要用到的接口是<code>PerformanceNavigationTiming</code> 接口。<code>PerformanceNavigationTiming</code> 提供了用于存储和检索有关浏览器文档事件的指标的方法和属性。在浏览器中可以通过下面的方式获取：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// navigation timing</span>
<span class="token keyword">const</span> timing <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>timing

<span class="token comment">// navigation timing 2</span>
performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/blog/images/devops/indicator1.png" alt="indicator1"></p> <p>基于这些数据，不仅可以计算出 DNS / TCP / Request 等耗时，还可以计算出 DOMReady / DOMParse / Load 等耗时。</p> <p><img src="/blog/images/devops/indicator2.png" alt="indicator2"></p> <h4 id="domcontentloaded-dcl"><a href="#domcontentloaded-dcl" class="header-anchor">#</a> DOMContentLoaded(DCL)</h4> <p>DOM 加载完成即触发，不用等页面资源加载。</p> <h4 id="load-l"><a href="#load-l" class="header-anchor">#</a> Load(L)</h4> <p>页面及其依赖的资源全部加载完成的时间，包括所有的资源文件，如样式表和图片等。</p> <h4 id="采集-domcontentloaded-load"><a href="#采集-domcontentloaded-load" class="header-anchor">#</a> 采集 DOMContentLoaded &amp; Load</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Load <span class="token operator">=</span> entry<span class="token punctuation">.</span>loadEventStart <span class="token operator">-</span> entry<span class="token punctuation">.</span>fetchStart<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Load:'</span><span class="token punctuation">,</span> Load<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'navigation'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> DOMContentLoaded <span class="token operator">=</span> entry<span class="token punctuation">.</span>domContentLoadedEventStart <span class="token operator">-</span> entry<span class="token punctuation">.</span>fetchStart<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded:'</span><span class="token punctuation">,</span> DOMContentLoaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'navigation'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="采集-fp-fcp"><a href="#采集-fp-fcp" class="header-anchor">#</a> 采集 FP &amp; FCP</h3> <ul><li><p>FP：衡量白屏时间</p></li> <li><p>FCP：衡量首屏时间</p></li></ul> <p>通过这两个指标，就可以衡量页面<strong>何时开始渲染内容</strong>。官方推荐，FP 及 FCP 两指标在 2 秒内完成的话我们的页面就算体验优秀。</p> <p>FP 和 FCP 可以通过浏览器提供的 API 直接获取，所以采集原理并不复杂。如果页面已经完成了首次绘制和首次内容绘制，可以使用下面的方式直接获取。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">)</span>
<span class="token comment">// or</span>
window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">'first-paint'</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">'first-contentful-paint'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>但是如果页面还没有开始首次绘制，就需要通过监听获取。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> perfEntries <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">const</span> perfEntry <span class="token keyword">of</span> perfEntries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Process entries</span>
      <span class="token comment">// report back for analytics and monitoring</span>
      <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// register observer for paint timing notifications</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;paint&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="采集-fmp-lcp"><a href="#采集-fmp-lcp" class="header-anchor">#</a> 采集 FMP &amp; LCP</h3> <ul><li><p>FMP：首次绘制有意义内容的时间点。早期比较推荐的性能指标，但是计算更复杂，实际内容什么时候呈现给用户，这个指标没办法衡量，而且准确性不是很好</p></li> <li><p>LCP：最大的内容在可视区域内变得可见的时间点。一个 SEO 相关的指标，关注页面核心内容呈现时间。官方推荐，在 2.5 秒内表示体验优秀。</p></li></ul> <p>通过这两个指标，就可以衡量页面<strong>何时渲染出主要内容</strong>。官方推荐，使用 LCP 指标，在 2.5  秒内完成的话我们的页面就算体验优秀。</p> <h4 id="采集-fmp"><a href="#采集-fmp" class="header-anchor">#</a> 采集 FMP</h4> <p>与 <code>FP / FCP / LCP</code> 相比， FMP 的采集相对比较复杂，它需要通过算法计算得出，而业界并没有统一的算法。不过比较认可的一个计算 FMP 的方式是「认定页面在加载和渲染过程中最大布局变动之后的那个绘制时间即为当前页面的 FMP 」。由于在页面渲染过程中，「 DOM 结构变化的时间点」和与之对应的「渲染的时间点」近似相同，所以一般计算 FMP 的方式是：计算出 DOM 结构变化最剧烈的时间点，即为 FMP。具体步骤为：</p> <ol><li>通过 MutationObserver 监听每一次页面整体的 DOM 变化，触发 MutationObserver 的回调</li> <li>在回调计算出当前 DOM 树的分数</li> <li>在结算时，通过对比得出分数变化最剧烈的时刻，即为 FMP</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里是剧烈程度分的计算</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过 MutationObserver 对 DOM 变化进行监听，每次回调根据新旧 DOM 数量、种类、深度等，计算出当前 DOM 树的分数，分数变化最剧烈的时刻视为 FMP ，<code>Load</code> 事件触发后 200ms 停止监听，取最大变动的记录做上报。</p> <p>FMP 计算相对复杂，且存在准确性等问题，Lighthouse 6.0 中<strong>已被废弃</strong></p> <h4 id="采集-lcp"><a href="#采集-lcp" class="header-anchor">#</a> 采集 LCP</h4> <p>LCP 主要依赖 PerformanceObserver，具体监听方式如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LCP candidate:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'largest-contentful-paint'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>largest-contentful-paint</code> 事件会在页面加载过程中根据此时已渲染最大元素的变化，不断的被触发，实际上报中会一直监听这些变化，直到用户与页面发生交互行为（比如 click、keydown）或者页面被隐藏或者页面被 <code>unload</code> 等，取监听到的最后值做上报。</p> <p>浏览器会多次报告 LCP ，而一般真正的 LCP 是用户交互前最近一次报告的 LCP ，因为交互往往会改变用户可见的内容，所以用户交互后新报告的 LCP 不再符合 LCP 的指标定义。</p> <h3 id="采集-tti-tbt"><a href="#采集-tti-tbt" class="header-anchor">#</a> 采集 TTI &amp; TBT</h3> <ul><li>TTI：衡量页面页面可用性。测量页面从开始加载到主要子资源完成渲染。TTI 值越小，代表用户可以更早地操作页面，用户体验就更好。TTI 虽然可以衡量页面可以交互的时间点，但是却无法感知这个期间浏览器的繁忙状态。</li> <li>TBT: 衡量主线程长任务（&gt; 50ms）阻塞时间，繁忙程度。测量从 FCP 到 TTI 之间所有长任务的阻塞时间的总和。</li></ul> <p>通过这两个指标，就可以衡量页面<strong>何时可以交互</strong>。</p> <p>与 FMP 相似，浏览器也没有提供直接获取 TTI 的 API ，不过针对如何计算 TTI 有详细的描述，实现对应描述就可以得出 TTI 的时间点。</p> <p>TTI 的采集依赖 <code>Long Tasks API</code> 和 <code>Resource Timing API</code> 这两个 API，计算过程：</p> <ol><li>先采集 FCP，作为起点</li> <li>沿时间轴正向搜索时长至少为 5 秒的安静窗口。安静窗口需要满足三个条件：
<ul><li>没有 Long Task</li> <li>窗口中正在处理的 GET 请求不超过两个</li> <li>窗口时间窗读应该至少 5s</li></ul></li> <li>沿时间轴反向搜索安静窗口之前的最后一个长任务，如果没有找到长任务，则在 FCP 步骤停止执行</li> <li>TTI 是安静窗口之前最后一个长任务的结束时间，如果没有找到长任务，则与 FCP 值相同</li></ol> <p>窗口前的最后一个长任务的结束时间就是 TTI 。</p> <p>而通过计算 FCP 和 TTI 之间的长任务的阻塞时间的总和，就能得出 TBT 。</p> <h3 id="采集-fid-mpfid"><a href="#采集-fid-mpfid" class="header-anchor">#</a> 采集 FID &amp; MPFID</h3> <ul><li>FID：测量实际能够开始处理事件处理程序所经过的时间，即交互延迟时间。FID 反映用户对页面交互性和响应性的第一印象。一般建议通过 <code>Code Splitting</code> 等方式减少页面加载阶段 JS 的加载、解析和执行时间。</li> <li>MPFID：记录在页面加载过程中用户和页面进行首次交互操作可能花费的最长时间</li></ul> <p>通过这两个指标，就可以衡量页面<strong>交互时是否有延迟、反应页面可交互性</strong>。</p> <p>FID 同样依赖 PerformanceObserver，FID 监听用户的第一次输入（first-input）事件，<code>FID = 开始处理 input 的时间 - input 操作的起始时间</code>, 具体监听方式如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> obs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> firstInput <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Measure the delay to begin processing the first input event.</span>
  <span class="token comment">// FID = 开始处理 input 的时间 - input 操作的起始时间</span>
  <span class="token keyword">const</span> firstInputDelay <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>processingStart <span class="token operator">-</span> firstInput<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
  <span class="token comment">// Measure the duration of processing the first input event.</span>
  <span class="token comment">// Only use when the important event handling work is done synchronously in the handlers.</span>
  <span class="token keyword">const</span> firstInputDuration <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
  <span class="token comment">// Obtain some information about the target of this event, such as the id.</span>
  <span class="token keyword">const</span> targetId <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>target <span class="token operator">?</span> firstInput<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token string">'unknown-target'</span><span class="token punctuation">;</span>
  <span class="token comment">// Process the first input delay and perhaps its duration...</span>

  <span class="token comment">// Disconnect this observer since callback is only triggered once.</span>
  obs<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'first-input'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>MPFID 是 FCP 之后最长的长任务耗时，可以通过<strong>监听 FCP 之后的 Long tasks</strong>，对比拿到<strong>最长的长任务就是 MPFID</strong>。</p> <p>虽然浏览器提供了足够的 API 来帮助采集各个性能指标，但是在 JS 中计算具体指标要更为复杂。原因有两点：</p> <ul><li>API 报告的内容和指标本身的定义有部分差异，所以计算时要处理这些差异；</li> <li>部分场景下浏览器不会报告对应内容，这些场景下需要模拟测量。</li></ul> <h3 id="采集-cls"><a href="#采集-cls" class="header-anchor">#</a> 采集 CLS</h3> <ul><li>CLS：量页面稳定性。累积布局偏移。量化了在页面加载期间，视口中元素的移动程度。CLS 推荐值为低于 0.1，越低说明页面跳来跳去的情况就越少，用户体验越好。</li></ul> <p>收集 CLS，将加载过程分块（session），监听 <code>layout-shift</code> 变化获得每次布局变动的 <code>value</code> 值，统计每个 <code>session</code> 的布局变动分数，<strong>最大的布局变动分数时段，即为 CLS</strong>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> sessionEntries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sessionValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> metric <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">entryList</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span>hadRecentInput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> firstSessionEntry <span class="token operator">=</span> sessionEntries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> lastSessionEntry <span class="token operator">=</span> sessionEntries<span class="token punctuation">[</span>sessionEntries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionValue <span class="token operator">&amp;&amp;</span> entry<span class="token punctuation">.</span>startTime <span class="token operator">-</span> lastSessionEntry<span class="token punctuation">.</span>startTime <span class="token operator">&lt;</span> <span class="token number">1000</span> <span class="token operator">&amp;&amp;</span> entry<span class="token punctuation">.</span>startTime <span class="token operator">-</span> firstSessionEntry<span class="token punctuation">.</span>startTime <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果时间靠近上一个 session, 将本轮 layout-shift 累加进上一个 session  </span>
        sessionValue <span class="token operator">+=</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        sessionEntries<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 新起一个 session</span>
        sessionValue <span class="token operator">=</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        sessionEntries <span class="token operator">=</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 如果当前 session 的 value 大于之前的最大值，替换为现在这个大的</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionValue <span class="token operator">&gt;</span> metric<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        metric<span class="token punctuation">.</span>value <span class="token operator">=</span> sessionValue<span class="token punctuation">;</span>
        metric<span class="token punctuation">.</span>entries <span class="token operator">=</span> sessionEntries<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CLS: '</span><span class="token punctuation">,</span> metric<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'layout-shift'</span><span class="token punctuation">,</span><span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="性能评估"><a href="#性能评估" class="header-anchor">#</a> 性能评估</h2> <h3 id="性能指标基准线"><a href="#性能指标基准线" class="header-anchor">#</a> 性能指标基准线</h3> <p>Google 提供了各个性能指标的基准线，有一定的参考意义。为什么只说是有一定参考意义？首先基准线本身是在变化的，随着指标计算的逐渐更新以及软件硬件的更新，基准线也会有一定的调整。其次用户的使用场景对性能指标也会有很大的影响，比如 iOS 用户上报的性能指标一般都优于 Android 用户上报的性能指标。</p> <p><img src="/blog/images/devops/indicator5.png" alt="indicator5"></p> <p>经过测试，LCP 非常近似于FMP的时间点，FMP 渐渐可以通过 LCP 代替。SI 的计算逻辑比较复杂，更常用在 lighthouse 中，而非线上监控。虽然 TBT 可以在线上进行测量，但不建议这样做，因为用户交互会影响网页的 TBT，从而导致报告中出现大量差异，线上监控推荐使用 FID。</p> <h3 id="衡量站点满意度"><a href="#衡量站点满意度" class="header-anchor">#</a> 衡量站点满意度</h3> <p>站点满意度的衡量除了要考虑常规的性能指标外，还要考虑体验类的指标，比如专门衡量视觉稳定性的指标 CLS。</p> <p>线上的站点满意度衡量，一般会在参考lighthouse的满意度计算规则的基础上，去除一些推荐在实验室环境测量的指标的权重。</p> <p><img src="/blog/images/devops/indicator6.png" alt="indicator6"></p> <p><a href="https://juejin.cn/post/7130830761137012766#heading-1" target="_blank" rel="noopener noreferrer">如何衡量一个站点的性能好坏<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s/SlS0J9eSb20PCLW062sQVg" target="_blank" rel="noopener noreferrer">做性能优化时，我们关注哪些指标？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/devops/vite/vite-news.html" class="prev">
        Vite 新特性
      </a></span> <span class="next"><a href="/blog/devops/performance/webpack.html">
        打包方面优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.e9b7ea63.js" defer></script><script src="/blog/assets/js/2.dec2e75d.js" defer></script><script src="/blog/assets/js/1.5b9e135c.js" defer></script><script src="/blog/assets/js/93.4e138a06.js" defer></script><script src="/blog/assets/js/20.badbb211.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块 | 花帽子的博客</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8f6a9f80.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f75abbb.js" as="script"><link rel="preload" href="/blog/assets/js/2.55125c9d.js" as="script"><link rel="preload" href="/blog/assets/js/43.ea7d7535.js" as="script"><link rel="preload" href="/blog/assets/js/3.6b7316b6.js" as="script"><link rel="preload" href="/blog/assets/js/4.f8e09ced.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d7104175.js"><link rel="prefetch" href="/blog/assets/js/11.1d27af04.js"><link rel="prefetch" href="/blog/assets/js/12.983bc0ee.js"><link rel="prefetch" href="/blog/assets/js/13.5d1a37d5.js"><link rel="prefetch" href="/blog/assets/js/14.89bbdd3d.js"><link rel="prefetch" href="/blog/assets/js/15.c1610342.js"><link rel="prefetch" href="/blog/assets/js/16.b38ae9ca.js"><link rel="prefetch" href="/blog/assets/js/17.1bbf4ac6.js"><link rel="prefetch" href="/blog/assets/js/18.c2803f67.js"><link rel="prefetch" href="/blog/assets/js/19.6a4af028.js"><link rel="prefetch" href="/blog/assets/js/20.9f2062cb.js"><link rel="prefetch" href="/blog/assets/js/21.f6842552.js"><link rel="prefetch" href="/blog/assets/js/22.3ee146d2.js"><link rel="prefetch" href="/blog/assets/js/23.a1d395de.js"><link rel="prefetch" href="/blog/assets/js/24.7e6b7124.js"><link rel="prefetch" href="/blog/assets/js/25.64f8b6c2.js"><link rel="prefetch" href="/blog/assets/js/26.71ed6b6f.js"><link rel="prefetch" href="/blog/assets/js/27.dfec2eef.js"><link rel="prefetch" href="/blog/assets/js/28.e3c7e25c.js"><link rel="prefetch" href="/blog/assets/js/29.8b6896a4.js"><link rel="prefetch" href="/blog/assets/js/30.8eb23ffc.js"><link rel="prefetch" href="/blog/assets/js/31.630c43f9.js"><link rel="prefetch" href="/blog/assets/js/32.31bbb248.js"><link rel="prefetch" href="/blog/assets/js/33.6ef45acf.js"><link rel="prefetch" href="/blog/assets/js/34.3c379f18.js"><link rel="prefetch" href="/blog/assets/js/35.81451f70.js"><link rel="prefetch" href="/blog/assets/js/36.a16ea5ef.js"><link rel="prefetch" href="/blog/assets/js/37.5c816d30.js"><link rel="prefetch" href="/blog/assets/js/38.6766c224.js"><link rel="prefetch" href="/blog/assets/js/39.4ab6af0d.js"><link rel="prefetch" href="/blog/assets/js/40.77a4ac8a.js"><link rel="prefetch" href="/blog/assets/js/41.8a1af23d.js"><link rel="prefetch" href="/blog/assets/js/42.4d2b2c2a.js"><link rel="prefetch" href="/blog/assets/js/44.379ac47a.js"><link rel="prefetch" href="/blog/assets/js/45.d585fbbc.js"><link rel="prefetch" href="/blog/assets/js/46.dbaf11a2.js"><link rel="prefetch" href="/blog/assets/js/47.72eb1c4e.js"><link rel="prefetch" href="/blog/assets/js/48.c45ebcff.js"><link rel="prefetch" href="/blog/assets/js/49.0829f2e1.js"><link rel="prefetch" href="/blog/assets/js/5.7f6c9bad.js"><link rel="prefetch" href="/blog/assets/js/50.ff76685a.js"><link rel="prefetch" href="/blog/assets/js/51.64089db8.js"><link rel="prefetch" href="/blog/assets/js/52.95314aa8.js"><link rel="prefetch" href="/blog/assets/js/53.8e2c93cc.js"><link rel="prefetch" href="/blog/assets/js/54.c273158a.js"><link rel="prefetch" href="/blog/assets/js/55.a2bd0a93.js"><link rel="prefetch" href="/blog/assets/js/56.77c86eb1.js"><link rel="prefetch" href="/blog/assets/js/57.3e9eb8ea.js"><link rel="prefetch" href="/blog/assets/js/58.a9d3dee2.js"><link rel="prefetch" href="/blog/assets/js/59.b1f48522.js"><link rel="prefetch" href="/blog/assets/js/6.6628c9dd.js"><link rel="prefetch" href="/blog/assets/js/60.a6ae3f19.js"><link rel="prefetch" href="/blog/assets/js/61.b748fb64.js"><link rel="prefetch" href="/blog/assets/js/62.bbe9162a.js"><link rel="prefetch" href="/blog/assets/js/63.74a2f55f.js"><link rel="prefetch" href="/blog/assets/js/64.5d5760f7.js"><link rel="prefetch" href="/blog/assets/js/65.e8931b55.js"><link rel="prefetch" href="/blog/assets/js/66.98aa7998.js"><link rel="prefetch" href="/blog/assets/js/67.463a4597.js"><link rel="prefetch" href="/blog/assets/js/68.22204e6f.js"><link rel="prefetch" href="/blog/assets/js/69.2c813310.js"><link rel="prefetch" href="/blog/assets/js/7.82cfa7a9.js"><link rel="prefetch" href="/blog/assets/js/70.caf97cf7.js"><link rel="prefetch" href="/blog/assets/js/71.cf642671.js"><link rel="prefetch" href="/blog/assets/js/72.53223443.js"><link rel="prefetch" href="/blog/assets/js/73.7ab5dd3b.js"><link rel="prefetch" href="/blog/assets/js/74.847e91fb.js"><link rel="prefetch" href="/blog/assets/js/75.20a55124.js"><link rel="prefetch" href="/blog/assets/js/76.953d2d0a.js"><link rel="prefetch" href="/blog/assets/js/77.72f80716.js"><link rel="prefetch" href="/blog/assets/js/78.7b308ae4.js"><link rel="prefetch" href="/blog/assets/js/79.e9d288de.js"><link rel="prefetch" href="/blog/assets/js/8.441834aa.js"><link rel="prefetch" href="/blog/assets/js/80.53ed07bc.js"><link rel="prefetch" href="/blog/assets/js/81.472573ec.js"><link rel="prefetch" href="/blog/assets/js/82.fba89376.js"><link rel="prefetch" href="/blog/assets/js/83.51f9fa68.js"><link rel="prefetch" href="/blog/assets/js/84.35ca39e3.js"><link rel="prefetch" href="/blog/assets/js/85.529a7964.js"><link rel="prefetch" href="/blog/assets/js/86.b02cd1fb.js"><link rel="prefetch" href="/blog/assets/js/87.6f7ca8eb.js"><link rel="prefetch" href="/blog/assets/js/88.be2971f2.js"><link rel="prefetch" href="/blog/assets/js/89.0d3d8b88.js"><link rel="prefetch" href="/blog/assets/js/9.a921bf18.js"><link rel="prefetch" href="/blog/assets/js/90.5591e0f6.js"><link rel="prefetch" href="/blog/assets/js/91.16ba3def.js"><link rel="prefetch" href="/blog/assets/js/92.5805b39a.js"><link rel="prefetch" href="/blog/assets/js/93.34ab82c0.js"><link rel="prefetch" href="/blog/assets/js/94.71d2638c.js"><link rel="prefetch" href="/blog/assets/js/95.5107c91a.js"><link rel="prefetch" href="/blog/assets/js/96.136137f7.js"><link rel="prefetch" href="/blog/assets/js/97.2468ccd8.js"><link rel="prefetch" href="/blog/assets/js/98.ee4deba0.js"><link rel="prefetch" href="/blog/assets/js/99.e5755c02.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8f6a9f80.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="花帽子的博客" class="logo"> <span class="site-name can-hide">花帽子的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/blog/javascript/" class="nav-link router-link-active">
  JS
</a></div><div class="nav-item"><a href="/blog/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/blog/optimization/" class="nav-link">
  优化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/blog/talk/" class="nav-link">
  项目
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/blog/javascript/" class="nav-link router-link-active">
  JS
</a></div><div class="nav-item"><a href="/blog/typescript/" class="nav-link">
  TS
</a></div><div class="nav-item"><a href="/blog/optimization/" class="nav-link">
  优化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/blog/talk/" class="nav-link">
  项目
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript高级</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/" aria-current="page" class="sidebar-link">寿司 JavaScript 🍣</a></li><li><a href="/blog/javascript/depth/prototype.html" class="sidebar-link">原型与原型链</a></li><li><a href="/blog/javascript/depth/scope.html" class="sidebar-link">词法作用域和动态作用域</a></li><li><a href="/blog/javascript/depth/ECS.html" class="sidebar-link">执行上下文栈</a></li><li><a href="/blog/javascript/depth/VO.html" class="sidebar-link">变量对象</a></li><li><a href="/blog/javascript/depth/scope-chain.html" class="sidebar-link">作用域链</a></li><li><a href="/blog/javascript/depth/this.html" class="sidebar-link">This</a></li><li><a href="/blog/javascript/depth/closure.html" class="sidebar-link">闭包</a></li><li><a href="/blog/javascript/depth/arguments.html" class="sidebar-link">参数传递与 Arguments</a></li><li><a href="/blog/javascript/depth/var.html" class="sidebar-link">var let const</a></li><li><a href="/blog/javascript/depth/arrow-function.html" class="sidebar-link">箭头函数</a></li><li><a href="/blog/javascript/depth/async-plan.html" class="sidebar-link">异步方案</a></li><li><a href="/blog/javascript/depth/async-achieve.html" class="sidebar-link">异步实现</a></li><li><a href="/blog/javascript/depth/event-loop.html" class="sidebar-link">事件循环</a></li><li><a href="/blog/javascript/depth/set-map.html" class="sidebar-link">Set 和 Map</a></li><li><a href="/blog/javascript/depth/proxy-reflect.html" class="sidebar-link">Proxy 和 Reflect</a></li><li><a href="/blog/javascript/depth/module.html" aria-current="page" class="active sidebar-link">模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/javascript/depth/module.html#模块风格" class="sidebar-link">模块风格</a></li></ul></li><li><a href="/blog/javascript/depth/decorator.html" class="sidebar-link">装饰器</a></li><li><a href="/blog/javascript/depth/reference.html" class="sidebar-link">参考文献</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器与网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/browser/browser-start.html" class="sidebar-link">发生了什么</a></li><li><a href="/blog/javascript/browser/http-history.html" class="sidebar-link">HTTP 前世今生</a></li><li><a href="/blog/javascript/browser/network-OSI.html" class="sidebar-link">网络通信模型</a></li><li><a href="/blog/javascript/browser/network-tcp.html" class="sidebar-link">传输层 TCP 协议</a></li><li><a href="/blog/javascript/browser/network-websocket.html" class="sidebar-link">WebSocket 协议</a></li><li><a href="/blog/javascript/browser/http-message.html" class="sidebar-link">HTTP 报文</a></li><li><a href="/blog/javascript/browser/http-status.html" class="sidebar-link">HTTP 状态码</a></li><li><a href="/blog/javascript/browser/http-methods.html" class="sidebar-link">HTTP 请求</a></li><li><a href="/blog/javascript/browser/web-storage.html" class="sidebar-link">浏览器存储</a></li><li><a href="/blog/javascript/browser/DNS.html" class="sidebar-link">DNS 域名系统</a></li><li><a href="/blog/javascript/browser/browser-cache.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/blog/javascript/browser/browser-render.html" class="sidebar-link">浏览器渲染</a></li><li><a href="/blog/javascript/browser/cross-domain.html" class="sidebar-link">跨域</a></li><li><a href="/blog/javascript/browser/web-security.html" class="sidebar-link">浏览器安全机制</a></li><li><a href="/blog/javascript/browser/web-attack.html" class="sidebar-link">浏览器攻击</a></li><li><a href="/blog/javascript/browser/js-gc.html" class="sidebar-link">垃圾回收机制</a></li><li><a href="/blog/javascript/browser/reference.html" class="sidebar-link">参考文献</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>DOM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/dom/dom-event.html" class="sidebar-link">DOM 事件模型(事件流)</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h1> <h2 id="模块风格"><a href="#模块风格" class="header-anchor">#</a> 模块风格</h2> <p>一些广为使用的模块格式有：</p> <ul><li>CommonJS</li> <li>Asynchronous Module Definition（AMD）- RequireJS</li> <li>Common Module Definition（CMD）- SeaJS</li> <li>Universal Module Definition（UMD）</li> <li>ES6 Module</li></ul> <h3 id="commonjs"><a href="#commonjs" class="header-anchor">#</a> CommonJS</h3> <p>2009 年 Nodejs 发布，其中 Commonjs 是作为 Node 中模块化规范以及原生模块面世的。基本上 Commonjs 发布之后，就成了 Node 里面标准的模块化管理工具。同时 Node 还推出了 npm 包管理工具，npm 平台上的包均满足 Commonjs 规范。</p> <h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <ul><li>module.exports</li> <li>require</li></ul> <p>CommonJS 还可以细分为 CommonJSl 和 CommonJS2，区别在于 CommonJSl 只能通过 <code>exports.XX = XX</code> 的方式导出，而 CommonJS2 在 CommonJSl 的基础上加入了 <code>module.exports = XX</code> 的导出方式。 CommonJS 通常指 CommonJS2。</p> <p>module.exports 属性表示当前模块对外输出的接口，其他文件加载该模块，实际上就是读取 module.exports 变量。node 为每一个模块提供了一个 exports 变量(可以说是一个对象)，指向 module.exports。这相当于每个模块中都有一句这样的命令 <code>var exports = module.exports</code>。既然两个不好区分，那就放弃 exports, 只用 module.exports 就好。</p> <div class="custom-block tip"><p class="custom-block-title">Module 对象</p> <ul><li>module.id 模块的识别符，通常是带有绝对路径的模块文件名。</li> <li>module.filename 模块的文件名，带有绝对路径。</li> <li>module.loaded 返回一个布尔值，表示模块是否已经完成加载。</li> <li>module.parent 返回一个对象，表示调用该模块的模块。</li> <li>module.children 返回一个数组，表示该模块要用到的其他模块。</li> <li>module.exports 表示模块对外输出的值。</li></ul></div> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h4> <ul><li>原生 Module 对象，每个文件都是一个 Module 实例</li> <li>文件内通过 require 对象引入指定模块</li> <li>所有文件加载均是同步完成</li> <li>通过 module 关键字暴露内容</li> <li>每个模块加载一次之后就会被缓存</li> <li>模块编译本质上是沙箱编译</li> <li>由于使用了 Node 的 api，只能在服务端环境上运行</li> <li>所有代码都运行带模块作用域、不会污染全局作用域</li> <li>模块加载的顺序是按照其在代码中出现的顺序</li></ul> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <ul><li>强大的查找模块功能，开发十分方便</li> <li>标准化的输入输出，非常统一</li> <li>每个文件引入自己的依赖，最终形成文件依赖树</li> <li>模块缓存机制，提高编译效率</li> <li>利用 node 实现文件同步读取</li> <li>依靠注入变量的沙箱编译实现模块化</li></ul> <div class="custom-block tip"><p class="custom-block-title">沙箱编译</p> <p>require 进来的 js 模块会被 Module 模块注入一些变量，使用立即执行函数编译，看起来就好像：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//原始文件内容</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Node 内部提供一个 Module 构建函数。所有模块都是 Module 的实例。</p></div> <p>CommonJS 的缺点在于: 这样的代码无法直接运行在浏览器环境下，必须通过工具转换 成标准的 ES5。</p> <h3 id="amd"><a href="#amd" class="header-anchor">#</a> AMD</h3> <p>Commonjs 的诞生给 js 模块化发展有了重要的启发，Commonjs 非常受欢迎，但是局限性很明显：</p> <p>Commonjs 基于 Node 原生 api 在服务端可以实现模块同步加载，但是仅仅局限于服务端，客户端如果同步加载依赖的话时间消耗非常大，所以需要一个在客户端上基于 Commonjs但 是对于加载模块做改进的方案，于是 AMD 规范诞生了。</p> <p>AMD(Asynchronous Module Definition) 异步模块定义。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到所有依赖加载完成之后（前置依赖），这个回调函数才会运行。它大大的利用了浏览器的并发请求能力，让模块的依赖过程的阻塞变得更少了。requireJs 就是 AMD 模块化规范的实现。</p> <p>CommonJS 规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。AMD 规范则是非同步加载模块，允许指定回调函数。由于 Node.js 主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快，不用考虑非同步加载的方式，所以 CommonJS 规范比较适用。但是，如果是浏览器环境，要从服务器端加载模块，这时就必须采用非同步模式，因此浏览器端一般采用 AMD 规范。</p> <h4 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> 使用</h4> <p>模块功能主要的几个命令：define、require、return 和 define.amd。</p> <p>使用 define 来定义模块，return 来输出接口， require 来加载模块，这是 AMD 官方推荐用法。</p> <ul><li><code>define(id?, dependencies?, factory);</code></li> <li><code>require([module], callback);</code></li></ul> <p>AMD 模块运行在浏览器环境下，它使用 define 函数来定义模块。不同于CommonJS，它要求两个参数：</p> <p><code>require([module], callback);</code></p> <p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不同于 Commonjs，在定义模块的时候需要使用 define 函数定义：</p> <p><code>define(id?, dependencies?, factory);</code></p> <p>define方法与require类似，id是定义模块的名字，仍然会在所有依赖加载完毕之后执行factory。</p> <h4 id="requirejs"><a href="#requirejs" class="header-anchor">#</a> RequireJs</h4> <p>RequireJs 是 js 模块化的工具框架，是 AMD 规范的具体实现。RequireJs 有两个最鲜明的特点：</p> <ul><li>依赖前置：动态创建 <code>&lt;script&gt;</code> 引入依赖，在 <code>&lt;script&gt;</code> 标签的 onload 事件监听文件加载完毕；一个模块的回调函数必须得等到所有依赖都加载完毕之后，才可执行，类似 <code>Promise.all</code>。</li> <li>配置文件：有一个 main 文件，配置不同模块的路径，以及 shim 不满足 AMD 规范的 js 文件。</li></ul> <h4 id="优点-2"><a href="#优点-2" class="header-anchor">#</a> 优点</h4> <ul><li>动态并行加载 js，依赖前置，无需再考虑 js 加载顺序问题。</li> <li>核心还是注入变量的沙箱编译，解决模块化问题。</li> <li>规范化输入输出，使用起来方便。</li> <li>对于不满足 AMD 规范的文件可以很好地兼容。</li></ul> <h3 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h3> <p>同样是受到 Commonjs 的启发，国内（阿里）诞生了一个 CMD（Common Module Definition）规范。该规范借鉴了 Commonjs 的规范与 AMD 规范，在两者基础上做了改进。一个文件就是一个模块，可以像 Node.js 一般书写模块代码。主要在浏览器中运行，当然也可以在 Node.js 中运行。现在 CMD 已经凉了。</p> <h4 id="特点-2"><a href="#特点-2" class="header-anchor">#</a> 特点</h4> <p>与 AMD 相比非常类似，CMD 规范（2011）具有以下特点：</p> <ul><li>define 定义模块，require 加载模块，exports 暴露变量。</li> <li>不同于 AMD 的依赖前置，CMD 推崇依赖就近（需要的时候再加载）</li> <li>推崇 api 功能单一，一个模块干一件事。</li></ul> <h4 id="seajs"><a href="#seajs" class="header-anchor">#</a> SeaJS</h4> <p>SeaJs 是 CMD 规范的实现，跟 RequireJs 类似，CMD 也是 SeaJs 推广过程中诞生的规范。CMD 借鉴了很多 AMD 和 Commonjs 优点，同样 SeaJs 也对 AMD 和 Commonjs
做出了很多兼容。</p> <ul><li>需要配置模块对应的url。</li> <li>入口文件执行之后，根据文件内的依赖关系整理出依赖树，然后通过插入 <code>&lt;script&gt;</code> 标签加载依赖。</li> <li>依赖加载完毕之后，执行根factory。</li> <li>在 factory 中遇到 require，则去执行对应模块的 factory，实现就近依赖。</li> <li>类似 Commonjs，对所有模块进行缓存（模块的 url 就是 id）。</li> <li>类似 Commonjs，可以使用相对路径加载模块。</li> <li>可以向 RequireJs 一样前置依赖，但是推崇就近依赖。</li> <li>exports 和 return 都可以暴露变量。</li></ul> <div class="custom-block tip"><p class="custom-block-title">ADM vs CMD</p> <ul><li>AMD 是提前执行， CMD 是延迟执行</li> <li>CMD 推崇依赖就近，AMD 推崇依赖前置</li> <li>AMD 的 API 默认是一个当多个用，CMD 的 API 严格区分，推崇职责单一</li></ul></div> <h3 id="umd"><a href="#umd" class="header-anchor">#</a> UMD</h3> <p>UMD(Universal Module Definition)通用模块定义模式，该模式主要用来解决 CommonJS 模式和 AMD 模式代码不能通用的问题，并同时还支持老式的全局变量规范。它可以通过运行时或者编译时让同一个代码模块在使用 CommonJs、CMD 甚至是 AMD 的项目中运行。未来同一个 JavaScript 包运行在浏览器端、服务区端甚至是 APP 端都只需要遵守同一个写法就行了。它没有自己专有的规范，是集结了 CommonJs、CMD、AMD 的规范于一身。它或许不是未来最好的模块化方式，未来在 ES6+、TypeScript、Dart 这些拥有高级语法的语言回代替这些方案。</p> <h3 id="es-modules"><a href="#es-modules" class="header-anchor">#</a> ES Modules</h3> <p>ES modules（ESM）是 JavaScript 官方的标准化模块系统。</p> <ul><li>它因为是标准，所以未来很多浏览器会支持，可以很方便的在浏览器中使用。(浏览器默认加载不能省略.js)</li> <li>它同时兼容在 node 环境下运行。</li> <li>模块的导入导出，通过 import 和 export 来确定。</li> <li>可以和 Commonjs 模块混合使用。</li> <li><span class="highlighter">ES modules 输出的是值的引用，输出接口动态绑定，而 CommonJS 输出的是值的拷贝</span></li> <li><span class="highlighter">ES modules 模块编译时执行，而 CommonJS 模块总是在运行时加载</span></li> <li>无论是 ES6 模块还是 CommonJS 模块，当你重复引入某个相同的模块时，模块只会执行一次。</li> <li>ES modules 静态编译，CommonJS 运行时加载</li> <li>import 命令会被 JavaScript 引擎静态分析，优先于模块内的其他内容执行，即 import 优先执行。</li> <li>export 命令会有变量声明提前的效果，即 export 变量声明提升。</li></ul> <p><strong>require.ensure 的出现是 webpack 的产物</strong>：</p> <p>它是因为浏览器需要一种异步的机制可以用来异步加载模块，从而减少初始的加载文件的体积，所以如果在服务端的话 <code>require.ensure</code> 就无用武之地了，因为服务端不存在异步加载模块的情况，模块同步进行加载就可以满足使用场景了。 CommonJS 模块可以在运行时确认模块加载。</p> <p><strong>Tree shaking 就是得益 ES modules 的发展的产物</strong>：</p> <p>ES Modules 之所以能 Tree-shaking 主要为以下四个原因（摘自尤雨溪在知乎的回答）:</p> <ul><li>import 只能作为模块顶层的语句出现，不能出现在 function 里面或是 if 里面。</li> <li>import 的模块名只能是字符串常量。</li> <li>不管 import 的语句出现的位置在哪里，在模块初始化的时候所有的 import 都必须已经导入完成。</li> <li>import binding 是 immutable 的，类似 const。比如说你不能 import { a } from ‘./a’ 然后给 a 赋值个其他什么东西。</li></ul> <div class="custom-block warning"><p class="custom-block-title">参考文献</p> <p><a href="https://juejin.cn/post/6844904066233925639#heading-6" target="_blank" rel="noopener noreferrer">彻底理清 AMD,CommonJS,CMD,UMD,ES6<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6917810024253227021#heading-0" target="_blank" rel="noopener noreferrer">一文搞懂JS模块、模块格式、模块加载器和模块打包器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6907529287880933384#heading-23" target="_blank" rel="noopener noreferrer">前端模块化发展历史<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6844903565236895758" target="_blank" rel="noopener noreferrer">深入理解 ES6 模块机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/javascript/depth/proxy-reflect.html" class="prev">
        Proxy 和 Reflect
      </a></span> <span class="next"><a href="/blog/javascript/depth/decorator.html">
        装饰器
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.9f75abbb.js" defer></script><script src="/blog/assets/js/2.55125c9d.js" defer></script><script src="/blog/assets/js/43.ea7d7535.js" defer></script><script src="/blog/assets/js/3.6b7316b6.js" defer></script><script src="/blog/assets/js/4.f8e09ced.js" defer></script>
  </body>
</html>

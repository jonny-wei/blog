<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SDK 设计 | 前端那些事儿</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f0017422.css" as="style"><link rel="preload" href="/blog/assets/js/app.e167c4d9.js" as="script"><link rel="preload" href="/blog/assets/js/2.dec2e75d.js" as="script"><link rel="preload" href="/blog/assets/js/1.5b9e135c.js" as="script"><link rel="preload" href="/blog/assets/js/44.9cbfb2c5.js" as="script"><link rel="preload" href="/blog/assets/js/20.badbb211.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc7e09f3.js"><link rel="prefetch" href="/blog/assets/js/100.c9eb98b2.js"><link rel="prefetch" href="/blog/assets/js/101.18ea58c9.js"><link rel="prefetch" href="/blog/assets/js/102.50d95968.js"><link rel="prefetch" href="/blog/assets/js/103.4cfa5054.js"><link rel="prefetch" href="/blog/assets/js/104.47c724ef.js"><link rel="prefetch" href="/blog/assets/js/105.ea080f51.js"><link rel="prefetch" href="/blog/assets/js/106.e242c957.js"><link rel="prefetch" href="/blog/assets/js/107.9f6cb36f.js"><link rel="prefetch" href="/blog/assets/js/108.c78f12f4.js"><link rel="prefetch" href="/blog/assets/js/109.912a4854.js"><link rel="prefetch" href="/blog/assets/js/11.b60c9933.js"><link rel="prefetch" href="/blog/assets/js/110.ba7dd32b.js"><link rel="prefetch" href="/blog/assets/js/111.280463a4.js"><link rel="prefetch" href="/blog/assets/js/112.c368d781.js"><link rel="prefetch" href="/blog/assets/js/113.11a11646.js"><link rel="prefetch" href="/blog/assets/js/114.0132f7b3.js"><link rel="prefetch" href="/blog/assets/js/115.c32f6423.js"><link rel="prefetch" href="/blog/assets/js/116.02860d44.js"><link rel="prefetch" href="/blog/assets/js/117.d5223f7d.js"><link rel="prefetch" href="/blog/assets/js/118.44e5a2bb.js"><link rel="prefetch" href="/blog/assets/js/119.71ea1c3f.js"><link rel="prefetch" href="/blog/assets/js/12.c53283e7.js"><link rel="prefetch" href="/blog/assets/js/120.f884a2a5.js"><link rel="prefetch" href="/blog/assets/js/121.12fbb0dc.js"><link rel="prefetch" href="/blog/assets/js/122.f94a3684.js"><link rel="prefetch" href="/blog/assets/js/123.bf3bb00a.js"><link rel="prefetch" href="/blog/assets/js/124.6e8b1dba.js"><link rel="prefetch" href="/blog/assets/js/125.b2a6953a.js"><link rel="prefetch" href="/blog/assets/js/126.e4e1f652.js"><link rel="prefetch" href="/blog/assets/js/127.b942a4b3.js"><link rel="prefetch" href="/blog/assets/js/128.c4cd2392.js"><link rel="prefetch" href="/blog/assets/js/129.d7743ad2.js"><link rel="prefetch" href="/blog/assets/js/13.6bdc6b5d.js"><link rel="prefetch" href="/blog/assets/js/130.89fe7501.js"><link rel="prefetch" href="/blog/assets/js/131.cb0ea907.js"><link rel="prefetch" href="/blog/assets/js/132.ae454055.js"><link rel="prefetch" href="/blog/assets/js/133.1fb65c29.js"><link rel="prefetch" href="/blog/assets/js/134.b7e49e42.js"><link rel="prefetch" href="/blog/assets/js/135.cd331791.js"><link rel="prefetch" href="/blog/assets/js/136.99022c5f.js"><link rel="prefetch" href="/blog/assets/js/137.c204c801.js"><link rel="prefetch" href="/blog/assets/js/138.11072dc9.js"><link rel="prefetch" href="/blog/assets/js/139.a7b9ee5f.js"><link rel="prefetch" href="/blog/assets/js/14.c3201a23.js"><link rel="prefetch" href="/blog/assets/js/140.42dbe4f0.js"><link rel="prefetch" href="/blog/assets/js/141.94fa9b5f.js"><link rel="prefetch" href="/blog/assets/js/142.10038048.js"><link rel="prefetch" href="/blog/assets/js/143.ae2794ca.js"><link rel="prefetch" href="/blog/assets/js/144.bfc24aa4.js"><link rel="prefetch" href="/blog/assets/js/145.3329d695.js"><link rel="prefetch" href="/blog/assets/js/146.80d1f7a4.js"><link rel="prefetch" href="/blog/assets/js/147.6bc76b56.js"><link rel="prefetch" href="/blog/assets/js/148.f1775c4b.js"><link rel="prefetch" href="/blog/assets/js/149.41d55e48.js"><link rel="prefetch" href="/blog/assets/js/15.a0b9e44e.js"><link rel="prefetch" href="/blog/assets/js/150.c5affd73.js"><link rel="prefetch" href="/blog/assets/js/151.731c2390.js"><link rel="prefetch" href="/blog/assets/js/152.fb05e213.js"><link rel="prefetch" href="/blog/assets/js/153.aaf891fc.js"><link rel="prefetch" href="/blog/assets/js/154.28ed43f9.js"><link rel="prefetch" href="/blog/assets/js/155.c7bd2f0a.js"><link rel="prefetch" href="/blog/assets/js/156.28bf984c.js"><link rel="prefetch" href="/blog/assets/js/157.9195b8a7.js"><link rel="prefetch" href="/blog/assets/js/158.7292d515.js"><link rel="prefetch" href="/blog/assets/js/159.bfac6e97.js"><link rel="prefetch" href="/blog/assets/js/16.491191e4.js"><link rel="prefetch" href="/blog/assets/js/160.68f60393.js"><link rel="prefetch" href="/blog/assets/js/161.4387caa5.js"><link rel="prefetch" href="/blog/assets/js/162.51c89735.js"><link rel="prefetch" href="/blog/assets/js/163.ec3b78ac.js"><link rel="prefetch" href="/blog/assets/js/164.b1f592cf.js"><link rel="prefetch" href="/blog/assets/js/165.349529bc.js"><link rel="prefetch" href="/blog/assets/js/166.e508130a.js"><link rel="prefetch" href="/blog/assets/js/167.bf7a46c5.js"><link rel="prefetch" href="/blog/assets/js/168.53dfe261.js"><link rel="prefetch" href="/blog/assets/js/169.e68d8cc7.js"><link rel="prefetch" href="/blog/assets/js/17.89ec8c57.js"><link rel="prefetch" href="/blog/assets/js/170.4b889667.js"><link rel="prefetch" href="/blog/assets/js/171.e37cef45.js"><link rel="prefetch" href="/blog/assets/js/172.c15140f1.js"><link rel="prefetch" href="/blog/assets/js/173.f5983df6.js"><link rel="prefetch" href="/blog/assets/js/174.56d53660.js"><link rel="prefetch" href="/blog/assets/js/175.63cc189a.js"><link rel="prefetch" href="/blog/assets/js/176.7f94419f.js"><link rel="prefetch" href="/blog/assets/js/177.2e778f00.js"><link rel="prefetch" href="/blog/assets/js/178.4b3c78c6.js"><link rel="prefetch" href="/blog/assets/js/179.0b106c7e.js"><link rel="prefetch" href="/blog/assets/js/18.b91f1411.js"><link rel="prefetch" href="/blog/assets/js/180.9a9db9c1.js"><link rel="prefetch" href="/blog/assets/js/181.d2a8c606.js"><link rel="prefetch" href="/blog/assets/js/182.ac73cf8f.js"><link rel="prefetch" href="/blog/assets/js/183.bbaeab4f.js"><link rel="prefetch" href="/blog/assets/js/184.0c197702.js"><link rel="prefetch" href="/blog/assets/js/185.a08d3259.js"><link rel="prefetch" href="/blog/assets/js/186.b1fa10b8.js"><link rel="prefetch" href="/blog/assets/js/187.75ee6b77.js"><link rel="prefetch" href="/blog/assets/js/188.03d3e3c4.js"><link rel="prefetch" href="/blog/assets/js/189.45be268f.js"><link rel="prefetch" href="/blog/assets/js/19.cb1f17c8.js"><link rel="prefetch" href="/blog/assets/js/190.4c70b520.js"><link rel="prefetch" href="/blog/assets/js/191.79056e6b.js"><link rel="prefetch" href="/blog/assets/js/192.935b3c6a.js"><link rel="prefetch" href="/blog/assets/js/193.afe5f5e6.js"><link rel="prefetch" href="/blog/assets/js/194.d17a7216.js"><link rel="prefetch" href="/blog/assets/js/195.a6a53082.js"><link rel="prefetch" href="/blog/assets/js/196.a655cba5.js"><link rel="prefetch" href="/blog/assets/js/197.77bb24de.js"><link rel="prefetch" href="/blog/assets/js/198.3ad3a1c9.js"><link rel="prefetch" href="/blog/assets/js/199.3f782727.js"><link rel="prefetch" href="/blog/assets/js/200.a8995c8e.js"><link rel="prefetch" href="/blog/assets/js/201.6c1d8f8c.js"><link rel="prefetch" href="/blog/assets/js/202.9443f613.js"><link rel="prefetch" href="/blog/assets/js/203.ea95b9b0.js"><link rel="prefetch" href="/blog/assets/js/204.613d1840.js"><link rel="prefetch" href="/blog/assets/js/205.dc3e11a2.js"><link rel="prefetch" href="/blog/assets/js/206.7cc9735f.js"><link rel="prefetch" href="/blog/assets/js/207.410386ae.js"><link rel="prefetch" href="/blog/assets/js/208.e744d24a.js"><link rel="prefetch" href="/blog/assets/js/209.099f2e3e.js"><link rel="prefetch" href="/blog/assets/js/21.bf0041b7.js"><link rel="prefetch" href="/blog/assets/js/210.167eebc6.js"><link rel="prefetch" href="/blog/assets/js/211.36d5a497.js"><link rel="prefetch" href="/blog/assets/js/212.617970bc.js"><link rel="prefetch" href="/blog/assets/js/213.a296a4b4.js"><link rel="prefetch" href="/blog/assets/js/214.ad499e16.js"><link rel="prefetch" href="/blog/assets/js/215.cf9f860a.js"><link rel="prefetch" href="/blog/assets/js/216.4ce6df55.js"><link rel="prefetch" href="/blog/assets/js/217.55493374.js"><link rel="prefetch" href="/blog/assets/js/218.65ca376c.js"><link rel="prefetch" href="/blog/assets/js/219.30c2da81.js"><link rel="prefetch" href="/blog/assets/js/22.48390d4f.js"><link rel="prefetch" href="/blog/assets/js/220.1d5709e0.js"><link rel="prefetch" href="/blog/assets/js/221.6a2478b4.js"><link rel="prefetch" href="/blog/assets/js/222.a7c9dce8.js"><link rel="prefetch" href="/blog/assets/js/223.5afa3b79.js"><link rel="prefetch" href="/blog/assets/js/224.51e80330.js"><link rel="prefetch" href="/blog/assets/js/225.09d0c412.js"><link rel="prefetch" href="/blog/assets/js/226.f71c0ce0.js"><link rel="prefetch" href="/blog/assets/js/227.4e115357.js"><link rel="prefetch" href="/blog/assets/js/23.35c4ba93.js"><link rel="prefetch" href="/blog/assets/js/24.cc3b12df.js"><link rel="prefetch" href="/blog/assets/js/25.632a83cc.js"><link rel="prefetch" href="/blog/assets/js/26.dc0735bf.js"><link rel="prefetch" href="/blog/assets/js/27.01692d0f.js"><link rel="prefetch" href="/blog/assets/js/28.3cdce864.js"><link rel="prefetch" href="/blog/assets/js/29.6c1aebe8.js"><link rel="prefetch" href="/blog/assets/js/3.cb0627fa.js"><link rel="prefetch" href="/blog/assets/js/30.b0873f63.js"><link rel="prefetch" href="/blog/assets/js/31.6ae5d6bc.js"><link rel="prefetch" href="/blog/assets/js/32.ac6cb854.js"><link rel="prefetch" href="/blog/assets/js/33.0a98d657.js"><link rel="prefetch" href="/blog/assets/js/34.40c5ff1d.js"><link rel="prefetch" href="/blog/assets/js/35.efc8ebcf.js"><link rel="prefetch" href="/blog/assets/js/36.20b76716.js"><link rel="prefetch" href="/blog/assets/js/37.f189ff30.js"><link rel="prefetch" href="/blog/assets/js/38.4892f77f.js"><link rel="prefetch" href="/blog/assets/js/39.47282d18.js"><link rel="prefetch" href="/blog/assets/js/4.cbb57fa7.js"><link rel="prefetch" href="/blog/assets/js/40.05545ac8.js"><link rel="prefetch" href="/blog/assets/js/41.7437f6d7.js"><link rel="prefetch" href="/blog/assets/js/42.714adee0.js"><link rel="prefetch" href="/blog/assets/js/43.c75777f5.js"><link rel="prefetch" href="/blog/assets/js/45.833d201a.js"><link rel="prefetch" href="/blog/assets/js/46.8191686d.js"><link rel="prefetch" href="/blog/assets/js/47.010cbb50.js"><link rel="prefetch" href="/blog/assets/js/48.5c4055e8.js"><link rel="prefetch" href="/blog/assets/js/49.8b1f8a28.js"><link rel="prefetch" href="/blog/assets/js/5.fe065607.js"><link rel="prefetch" href="/blog/assets/js/50.d987119c.js"><link rel="prefetch" href="/blog/assets/js/51.a17bc372.js"><link rel="prefetch" href="/blog/assets/js/52.bf4dfd27.js"><link rel="prefetch" href="/blog/assets/js/53.ed4350d1.js"><link rel="prefetch" href="/blog/assets/js/54.f066d9b0.js"><link rel="prefetch" href="/blog/assets/js/55.24fd50e0.js"><link rel="prefetch" href="/blog/assets/js/56.98c941b0.js"><link rel="prefetch" href="/blog/assets/js/57.b9773f20.js"><link rel="prefetch" href="/blog/assets/js/58.ee58e68a.js"><link rel="prefetch" href="/blog/assets/js/59.78411e0c.js"><link rel="prefetch" href="/blog/assets/js/6.68cda050.js"><link rel="prefetch" href="/blog/assets/js/60.0d75dd19.js"><link rel="prefetch" href="/blog/assets/js/61.cedaac73.js"><link rel="prefetch" href="/blog/assets/js/62.21462869.js"><link rel="prefetch" href="/blog/assets/js/63.9c8cbf57.js"><link rel="prefetch" href="/blog/assets/js/64.cdfa1458.js"><link rel="prefetch" href="/blog/assets/js/65.a85f73c0.js"><link rel="prefetch" href="/blog/assets/js/66.45510560.js"><link rel="prefetch" href="/blog/assets/js/67.64c61bf6.js"><link rel="prefetch" href="/blog/assets/js/68.30aef03e.js"><link rel="prefetch" href="/blog/assets/js/69.0c4a34cb.js"><link rel="prefetch" href="/blog/assets/js/7.3b8d63a0.js"><link rel="prefetch" href="/blog/assets/js/70.06a1bc4e.js"><link rel="prefetch" href="/blog/assets/js/71.8d806629.js"><link rel="prefetch" href="/blog/assets/js/72.ce2004b4.js"><link rel="prefetch" href="/blog/assets/js/73.e21f9c47.js"><link rel="prefetch" href="/blog/assets/js/74.bf6edcd7.js"><link rel="prefetch" href="/blog/assets/js/75.106e497f.js"><link rel="prefetch" href="/blog/assets/js/76.58cd0968.js"><link rel="prefetch" href="/blog/assets/js/77.8c04b31c.js"><link rel="prefetch" href="/blog/assets/js/78.ff200e44.js"><link rel="prefetch" href="/blog/assets/js/79.375a9aff.js"><link rel="prefetch" href="/blog/assets/js/80.7d56e86a.js"><link rel="prefetch" href="/blog/assets/js/81.f52b1074.js"><link rel="prefetch" href="/blog/assets/js/82.a69af57e.js"><link rel="prefetch" href="/blog/assets/js/83.990e39c8.js"><link rel="prefetch" href="/blog/assets/js/84.ccbf9553.js"><link rel="prefetch" href="/blog/assets/js/85.bdba086c.js"><link rel="prefetch" href="/blog/assets/js/86.4a301d2e.js"><link rel="prefetch" href="/blog/assets/js/87.f0d23d4b.js"><link rel="prefetch" href="/blog/assets/js/88.46df456a.js"><link rel="prefetch" href="/blog/assets/js/89.c56c8284.js"><link rel="prefetch" href="/blog/assets/js/90.35400392.js"><link rel="prefetch" href="/blog/assets/js/91.7ae8f9a1.js"><link rel="prefetch" href="/blog/assets/js/92.0eeaad4f.js"><link rel="prefetch" href="/blog/assets/js/93.d3afbce3.js"><link rel="prefetch" href="/blog/assets/js/94.d46f3ea7.js"><link rel="prefetch" href="/blog/assets/js/95.8258a561.js"><link rel="prefetch" href="/blog/assets/js/96.b9df442b.js"><link rel="prefetch" href="/blog/assets/js/97.34b79282.js"><link rel="prefetch" href="/blog/assets/js/98.fd1effee.js"><link rel="prefetch" href="/blog/assets/js/99.09292853.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.bd3cdb54.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f0017422.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="前端那些事儿" class="logo"> <span class="site-name can-hide">前端那些事儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/" aria-current="page" class="sidebar-link">渲染模式通识</a></li><li><a href="/blog/architecture/framework/Islands.html" class="sidebar-link">了解 Islands 架构</a></li><li><a href="/blog/architecture/framework/micro-frontend.html" class="sidebar-link">微前端架构</a></li><li><a href="/blog/architecture/framework/shadowbox.html" class="sidebar-link">微前端的沙箱设计</a></li><li><a href="/blog/architecture/framework/icestark.html" class="sidebar-link">iceStack 架构设计</a></li><li><a href="/blog/architecture/framework/wujie.html" class="sidebar-link">iframe 微前端方案</a></li><li><a href="/blog/architecture/framework/lowcode-components.html" class="sidebar-link">低代码组件设计与实现</a></li><li><a href="/blog/architecture/framework/lowcode-engine.html" class="sidebar-link">低代码引擎设计与实现</a></li><li><a href="/blog/architecture/framework/ali-lowcode-engine.html" class="sidebar-link">Ali-lowcode-engine</a></li><li><a href="/blog/architecture/framework/materialin-engine.html" class="sidebar-link">入料引擎</a></li><li><a href="/blog/architecture/framework/choreography-engine.html" class="sidebar-link">编排引擎</a></li><li><a href="/blog/architecture/framework/lowcode-extend.html" class="sidebar-link">低代码扩展点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/plan/color-thief.html" class="sidebar-link">图片分类与主题色提取</a></li><li><a href="/blog/architecture/plan/i18n.html" class="sidebar-link">国际化探索实践</a></li><li><a href="/blog/architecture/plan/sdk.html" aria-current="page" class="active sidebar-link">SDK 设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/plan/sdk.html#设计原则" class="sidebar-link">设计原则</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/sdk.html#设计模式" class="sidebar-link">设计模式</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/sdk.html#支付-sdk" class="sidebar-link">支付 SDK</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/sdk.html#caniuse-兼容性设计" class="sidebar-link">canIUse 兼容性设计</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/sdk.html#typedoc-文档生成" class="sidebar-link">TypeDoc 文档生成</a></li></ul></li><li><a href="/blog/architecture/plan/pay.html" class="sidebar-link">三方支付与收银台</a></li><li><a href="/blog/architecture/plan/tracker.html" class="sidebar-link">积分任务与埋点</a></li><li><a href="/blog/architecture/plan/virtual-list.html" class="sidebar-link">虚拟滚动与懒加载</a></li><li><a href="/blog/architecture/plan/masonry.html" class="sidebar-link">瀑布流虚拟列表实践</a></li><li><a href="/blog/architecture/plan/file-transfer.html" class="sidebar-link">大文件上传</a></li><li><a href="/blog/architecture/plan/auth.html" class="sidebar-link">登录鉴权</a></li><li><a href="/blog/architecture/plan/webTransport.html" class="sidebar-link">WebTransport</a></li><li><a href="/blog/architecture/plan/webCodecs.html" class="sidebar-link">WebCodecs</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sdk-设计"><a href="#sdk-设计" class="header-anchor">#</a> SDK 设计</h1> <p>本文探讨了SDK的设计原则和设计模式的应用。介绍了如何通过模块化、策略模式、工厂模式、适配器模式和模板方法模式等来构建一个可扩展、解耦和易于维护的SDK。展示了SDK的模块化分层设计，包括核心功能模块、平台相关实现、API模块等，并提供了一个示例项目结构。讨论了如何通过静态代码分析工具（如ts-morph）来实现一个canIUse功能，以判断SDK中的API、回调、参数、组件等在当前版本中的可用性。介绍了如何使用TypeDoc工具从JSDoc注释中生成API文档，并提供了tsconfig.json的配置示例和如何在代码中使用JSDoc注释的示例。</p> <h2 id="设计原则"><a href="#设计原则" class="header-anchor">#</a> 设计原则</h2> <p>以下是设计原则的汇总表格，涵盖了常见的设计原则、目的、应用场景和示例：</p> <table><thead><tr><th><strong>设计原则</strong></th> <th><strong>定义</strong></th> <th><strong>目的</strong></th> <th><strong>应用场景</strong></th> <th><strong>示例</strong></th></tr></thead> <tbody><tr><td><strong>单一职责原则 (SRP)</strong></td> <td>一个类应该只有一个职责，且每个类应该仅有一个引起它变化的原因。</td> <td>提高类的可维护性，减少类的复杂性。</td> <td>类有多个职责时，修改一个功能可能会影响其他功能。</td> <td>将报告生成和打印分离到不同的类：<br> <code>class Report { generateReport() {} }</code> <br> <code>class ReportPrinter { printReport(report) {} }</code></td></tr> <tr><td><strong>开放封闭原则 (OCP)</strong></td> <td>软件实体（类、模块、函数等）应该对扩展开放，对修改封闭。</td> <td>提高系统的灵活性和可扩展性。</td> <td>需要在不修改原有代码的情况下，增加新功能时。</td> <td>使用继承和多态来扩展功能，而不是修改原有类的代码：<br> <code>class Shape { area() {} }</code> <br> <code>class Circle extends Shape { area() {} }</code></td></tr> <tr><td><strong>里氏替换原则 (LSP)</strong></td> <td>子类对象应该可以替换父类对象出现在任何地方，并且不影响程序的正确性。</td> <td>确保继承关系合理，避免修改父类行为破坏子类行为。</td> <td>子类和父类之间存在继承关系，确保子类可以正确替换父类使用。</td> <td>子类 <code>Penguin</code> 不应覆盖父类 <code>Bird</code> 的行为，导致异常：<br> <code>class Penguin extends Bird { fly() { throw &quot;Cannot fly!&quot; } }</code></td></tr> <tr><td><strong>接口隔离原则 (ISP)</strong></td> <td>不应强迫一个类依赖它不需要的接口。</td> <td>使接口保持简洁，避免不必要的依赖。</td> <td>类依赖过大的接口，导致不需要的功能被实现或依赖时。</td> <td>将接口拆分成小接口：<br> <code>class Workable { work() {} }</code> <br> <code>class Eatable { eat() {} }</code></td></tr> <tr><td><strong>依赖倒转原则 (DIP)</strong></td> <td>高层模块不应依赖低层模块，二者应依赖抽象；抽象不应依赖细节，细节应依赖抽象。</td> <td>提高系统灵活性和可维护性。</td> <td>高层模块和低层模块紧耦合时，难以扩展和维护。</td> <td>使用接口或抽象类来替代具体实现类：<br> <code>class Switch { constructor(device) { this.device = device; } operate() { this.device.turnOn(); } }</code></td></tr> <tr><td><strong>合成复用原则 (CRP)</strong></td> <td>尽量使用对象组合，而不是继承来复用代码。</td> <td>提高代码的灵活性，避免继承关系的复杂性。</td> <td>当对象之间是“拥有关系”而不是“是一个关系”时。</td> <td>使用组合而非继承来复用代码：<br> <code>class Engine { start() {} }</code> <br> <code>class Car { constructor() { this.engine = new Engine(); } start() { this.engine.start(); } }</code></td></tr> <tr><td><strong>最小知识原则 (LoD)</strong></td> <td>一个对象应该对其他对象有尽可能少的了解。</td> <td>减少系统间的耦合，增加模块独立性。</td> <td>当类之间有过多依赖关系时，避免暴露内部细节。</td> <td>避免多次调用 <code>getB().getC().doSomething()</code>，而是通过间接方法调用：<br> <code>class A { getB() { return new B(); } }</code> <br> <code>class B { doSomething() {} }</code></td></tr> <tr><td><strong>避免重复代码原则 (DRY)</strong></td> <td>同一功能的代码不应在系统中重复出现。</td> <td>提高代码的可维护性和可复用性。</td> <td>当相同的代码在多个地方出现时，避免冗余代码。</td> <td>将公共方法提取到一个函数中来减少代码重复：<br> <code>function calculateArea(radius) { return Math.PI * radius * radius; }</code> <br> <code>function calculateVolume(radius, height) { return calculateArea(radius) * height; }</code></td></tr></tbody></table> <h2 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h2> <p>下面是一个设计模式汇总表格，包括每种设计模式的<strong>目的</strong>、<strong>应用场景</strong>、<strong>示例代码</strong>等关键信息，帮助更清晰地理解和应用这些模式。</p> <table><thead><tr><th><strong>设计模式</strong></th> <th><strong>目的</strong></th> <th><strong>应用场景</strong></th> <th><strong>示例代码简要</strong></th></tr></thead> <tbody><tr><td><strong>单例模式</strong></td> <td>确保一个类只有一个实例，并提供一个全局访问点。</td> <td>配置管理、日志管理、数据库连接池等。</td> <td>通过静态变量确保类的唯一实例，且构造函数私有化，防止外部创建多个实例。</td></tr> <tr><td><strong>工厂方法模式</strong></td> <td>定义一个创建对象的接口，由子类决定实例化哪个类。</td> <td>系统中有多个相似的对象，并希望将对象的创建与使用解耦。</td> <td>定义一个抽象工厂类，通过子类重写工厂方法来创建具体的产品。</td></tr> <tr><td><strong>抽象工厂模式</strong></td> <td>提供一个接口，用于创建相关或依赖对象的家族，而无需明确指定具体类。</td> <td>当系统需要独立于其产品的创建、组合和表示时。</td> <td>提供多个工厂方法创建不同类型的产品系列，避免直接实例化具体类。</td></tr> <tr><td><strong>适配器模式</strong></td> <td>将一个类的接口转换成客户端希望的另一个接口，使得不兼容的接口可以一起工作。</td> <td>当你希望将一个已有的类与一个不兼容的接口进行适配时。</td> <td>通过一个适配器类将现有类的接口转换为目标接口，解耦原始类和使用类。</td></tr> <tr><td><strong>装饰器模式</strong></td> <td>动态地给一个对象添加一些额外的职责。</td> <td>需要扩展对象功能，但又不想影响原始类的代码或多个类的功能。</td> <td>通过装饰器类扩展原有对象的行为，可以动态添加新的功能。</td></tr> <tr><td><strong>观察者模式</strong></td> <td>定义对象间的一对多依赖关系，当一个对象改变状态时，所有依赖它的对象都会自动得到通知并更新。</td> <td>事件系统、数据绑定、UI更新等。</td> <td>定义一个主题类，当状态变化时，通知所有观察者对象执行更新操作。</td></tr> <tr><td><strong>策略模式</strong></td> <td>定义一系列算法，将每一个算法封装起来，并让它们可以互换。</td> <td>当多个算法之间需要互换，且希望避免大量条件判断时。</td> <td>定义一个策略接口，不同算法实现该接口，客户端根据需要选择策略执行。</td></tr> <tr><td><strong>状态模式</strong></td> <td>允许对象在内部状态改变时改变其行为，仿佛改变了其类。</td> <td>当对象的行为依赖于其状态，并且必须在运行时根据状态变化时。</td> <td>将不同状态封装为状态类，状态变化时通过上下文切换不同状态的行为。</td></tr> <tr><td><strong>代理模式</strong></td> <td>为其他对象提供一种代理以控制对这个对象的访问。</td> <td>当需要控制对某个对象的访问，或需要在访问前后做一些处理时（如懒加载、缓存、权限检查等）。</td> <td>创建一个代理类，委托实际的业务处理给真实对象，代理类可在实际处理之前或之后插入额外的逻辑。</td></tr> <tr><td><strong>命令模式</strong></td> <td>将请求封装为一个对象，从而使你可以用不同的请求对客户进行参数化。</td> <td>解耦请求发送者和接收者，尤其是在涉及多个请求的情境中。</td> <td>将请求封装为命令对象，命令对象可以被请求发送者调用，支持撤销等功能。</td></tr> <tr><td><strong>中介者模式</strong></td> <td>通过一个中介对象来封装一系列对象之间的交互，避免对象间的直接依赖。</td> <td>复杂的对象交互，尤其是当多个对象之间有很多相互依赖时。</td> <td>创建一个中介者类，通过它管理多个对象之间的通信，避免对象间的紧耦合。</td></tr> <tr><td><strong>责任链模式</strong></td> <td>允许多个处理者处理同一个请求，每个处理者决定是否将请求转发给下一个处理者。</td> <td>当有多个对象可以处理一个请求时，需要动态选择一个合适的处理者。</td> <td>创建一个处理者链，每个处理者处理自己关心的部分，然后将请求传递给下一个处理者。</td></tr> <tr><td><strong>桥接模式</strong></td> <td>将抽象与实现分离，使得它们可以独立变化。</td> <td>需要在多个维度上扩展系统时，比如将不同的实现与抽象组合成不同的变体。</td> <td>抽象类和实现类分开，并通过桥接类将它们连接，支持多维度扩展。</td></tr> <tr><td><strong>组合模式</strong></td> <td>使客户端可以统一处理单个对象和对象集合。</td> <td>需要处理树形结构的对象，例如文件系统、UI组件树等。</td> <td>将对象组织成树形结构，客户端可以以统一的方式处理单个对象和对象集合。</td></tr> <tr><td><strong>迭代器模式</strong></td> <td>提供一种方法顺序访问集合对象，而不暴露该对象的内部表示。</td> <td>需要遍历集合对象，并且集合内部结构可能发生变化时。</td> <td>创建一个迭代器类，实现对集合的遍历，客户端通过迭代器类访问集合中的元素。</td></tr> <tr><td><strong>模板方法模式</strong></td> <td>在一个方法中定义算法的骨架，将具体步骤的实现延迟到子类。</td> <td>当算法的结构不变，而某些步骤的实现可能变化时。</td> <td>创建一个模板方法，在父类中定义算法的步骤，子类实现具体的步骤。</td></tr> <tr><td><strong>访问者模式</strong></td> <td>允许在不修改元素类的前提下，定义作用于这些元素的新操作。</td> <td>系统有很多不同的元素类，并且需要对这些元素做各种不同操作。</td> <td>定义一个访问者类，提供不同的操作，而每个元素类只需要接受一个访问者并调用相应的方法。</td></tr> <tr><td><strong>享元模式</strong></td> <td>通过共享技术有效地支持大量细粒度对象的复用。</td> <td>当需要创建大量相似对象，且这些对象可以共享时（例如图形、文本字符等）。</td> <td>将共享部分提取出来，集中管理，避免为每个对象创建新实例，而是复用已有的实例。</td></tr> <tr><td><strong>外观模式</strong></td> <td>为复杂子系统提供一个简单接口，使得客户端可以方便地访问复杂的系统。</td> <td>系统复杂且有多个子模块，需要提供一个统一的访问入口。</td> <td>创建一个外观类，封装系统中多个模块的调用，使得客户端通过外观类与系统交互。</td></tr> <tr><td><strong>备忘录模式</strong></td> <td>在不暴露对象实现细节的情况下，保存对象的状态，以便以后恢复。</td> <td>需要保存对象的状态并支持回滚或恢复操作。</td> <td>通过备忘录对象保存状态，发起者可以请求保存状态，或恢复为某个历史状态。</td></tr></tbody></table> <h3 id="单例模式-singleton"><a href="#单例模式-singleton" class="header-anchor">#</a> 单例模式（Singleton）</h3> <p><strong>目的</strong>：确保一个类只有一个实例，并提供一个全局访问点。</p> <p><strong>应用场景</strong>：例如配置管理类、日志管理类、数据库连接池等。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单例类</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 静态属性来保存唯一的实例</span>
  <span class="token keyword">static</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 构造函数私有化，防止外部通过 new 创建实例</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>  <span class="token comment">// 如果实例已存在，则直接返回该实例</span>
    <span class="token punctuation">}</span>
    Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// 否则保存当前实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 初始化数据</span>
  <span class="token punctuation">}</span>

  <span class="token function">addData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试单例模式</span>
<span class="token keyword">const</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
instance1<span class="token punctuation">.</span><span class="token function">addData</span><span class="token punctuation">(</span><span class="token string">&quot;Item 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
instance2<span class="token punctuation">.</span><span class="token function">addData</span><span class="token punctuation">(</span><span class="token string">&quot;Item 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [&quot;Item 1&quot;, &quot;Item 2&quot;]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1 <span class="token operator">===</span> instance2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，验证两个实例是相同的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="工厂方法模式-factory-method"><a href="#工厂方法模式-factory-method" class="header-anchor">#</a> 工厂方法模式（Factory Method）</h3> <p><strong>目的</strong>：定义一个创建对象的接口，由子类决定实例化哪个类。</p> <p><strong>应用场景</strong>：当系统中有多个相似的对象，并且希望将对象的创建与使用解耦时。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 抽象产品类</span>
<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;This method must be overridden.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体产品 A</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteProductA</span> <span class="token keyword">extends</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Product A operation&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体产品 B</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteProductB</span> <span class="token keyword">extends</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
  <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Product B operation&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 抽象工厂类</span>
<span class="token keyword">class</span> <span class="token class-name">Creator</span> <span class="token punctuation">{</span>
  <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 工厂方法</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体工厂 A</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteCreatorA</span> <span class="token keyword">extends</span> <span class="token class-name">Creator</span> <span class="token punctuation">{</span>
  <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体工厂 B</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteCreatorB</span> <span class="token keyword">extends</span> <span class="token class-name">Creator</span> <span class="token punctuation">{</span>
  <span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteProductB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试工厂方法模式</span>
<span class="token keyword">const</span> creatorA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteCreatorA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>creatorA<span class="token punctuation">.</span><span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Product A operation&quot;</span>

<span class="token keyword">const</span> creatorB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteCreatorB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>creatorB<span class="token punctuation">.</span><span class="token function">createProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Product B operation&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="适配器模式-adapter"><a href="#适配器模式-adapter" class="header-anchor">#</a> 适配器模式（Adapter）</h3> <p><strong>目的</strong>：将一个类的接口转换成客户端希望的另一个接口，使得不兼容的接口可以一起工作。</p> <p><strong>应用场景</strong>：当你希望将一个已有的类与一个不兼容的接口进行适配时。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 目标接口</span>
<span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>
  <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;This method must be overridden.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 现有类，接口不兼容</span>
<span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">{</span>
  <span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Special request from Adaptee&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 适配器类</span>
<span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">adaptee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee <span class="token operator">=</span> adaptee<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee<span class="token punctuation">.</span><span class="token function">specificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将特定请求适配成通用请求</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试适配器模式</span>
<span class="token keyword">const</span> adaptee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span>adaptee<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;Special request from Adaptee&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="装饰器模式-decorator"><a href="#装饰器模式-decorator" class="header-anchor">#</a> 装饰器模式（Decorator）</h3> <p><strong>目的</strong>：动态地给一个对象添加一些额外的职责。</p> <p><strong>应用场景</strong>：当你需要扩展对象的功能时，可以使用装饰器模式，而无需修改原有类。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 基本组件类</span>
<span class="token keyword">class</span> <span class="token class-name">Coffee</span> <span class="token punctuation">{</span>
  <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// 基础咖啡价格</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 装饰器基类</span>
<span class="token keyword">class</span> <span class="token class-name">CoffeeDecorator</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">coffee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>coffee <span class="token operator">=</span> coffee<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体装饰器类</span>
<span class="token keyword">class</span> <span class="token class-name">MilkDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">CoffeeDecorator</span> <span class="token punctuation">{</span>
  <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 加奶装饰，价格增加</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SugarDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">CoffeeDecorator</span> <span class="token punctuation">{</span>
  <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 加糖装饰，价格增加</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试装饰器模式</span>
<span class="token keyword">let</span> coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 5</span>

coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MilkDecorator</span><span class="token punctuation">(</span>coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加奶</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 7</span>

coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SugarDecorator</span><span class="token punctuation">(</span>coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 再加糖</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="观察者模式-observer"><a href="#观察者模式-observer" class="header-anchor">#</a> 观察者模式（Observer）</h3> <p><strong>目的</strong>：定义对象间的一对多依赖关系，当一个对象改变状态时，所有依赖它的对象都会自动得到通知并更新。</p> <p><strong>应用场景</strong>：例如事件系统、数据绑定等。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 主题类，管理所有观察者</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 观察者类</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> received an update!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试观察者模式</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> observer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">&quot;Observer 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> observer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">&quot;Observer 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer1<span class="token punctuation">)</span><span class="token punctuation">;</span>
subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer2<span class="token punctuation">)</span><span class="token punctuation">;</span>

subject<span class="token punctuation">.</span><span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// Observer 1 received an update!</span>
<span class="token comment">// Observer 2 received an update!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="策略模式-strategy"><a href="#策略模式-strategy" class="header-anchor">#</a> 策略模式（Strategy）</h3> <p><strong>目的</strong>：定义一系列算法，将每一个算法封装起来，并让它们可以互换。</p> <p><strong>应用场景</strong>：当你需要在不同算法之间进行选择时，使用策略模式可以避免使用大量的条件判断。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 策略接口</span>
<span class="token keyword">class</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;This method must be overridden.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体策略：支付宝支付</span>
<span class="token keyword">class</span> <span class="token class-name">AlipayStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Paid </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> using Alipay</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体策略：微信支付</span>
<span class="token keyword">class</span> <span class="token class-name">WeChatStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Paid </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> using WeChat</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 上下文类，持有策略并委托处理支付</span>
<span class="token keyword">class</span> <span class="token class-name">PaymentContext</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">strategy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">executePayment</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 委托给具体策略</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试策略模式</span>
<span class="token keyword">const</span> alipay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> weChat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeChatStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentContext</span><span class="token punctuation">(</span>alipay<span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">executePayment</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;Paid 100 using Alipay&quot;</span>

context<span class="token punctuation">.</span>strategy <span class="token operator">=</span> weChat<span class="token punctuation">;</span>  <span class="token comment">// 切换策略</span>
context<span class="token punctuation">.</span><span class="token function">executePayment</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;Paid 200 using WeChat&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="状态模式-state"><a href="#状态模式-state" class="header-anchor">#</a> 状态模式（State）</h3> <p><strong>目的</strong>：允许对象在内部状态改变时改变其行为，仿佛改变了其类。</p> <p><strong>应用场景</strong>：当对象的行为依赖于其状态，并且必须在运行时根据状态变化时。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 状态接口</span>
<span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;This method must be overridden.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体状态 A</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteStateA</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Handling in State A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体状态 B</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteStateB</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Handling in State B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 上下文类，保存当前状态并根据状态切换行为</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>  <span class="token comment">// 切换状态</span>
  <span class="token punctuation">}</span>

  <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 根据当前状态执行行为</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试状态模式</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;Handling in State A&quot;</span>

context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;Handling in State B&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><a href="https://refactoringguru.cn/design-patterns/catalog" target="_blank" rel="noopener noreferrer">设计模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="支付-sdk"><a href="#支付-sdk" class="header-anchor">#</a> 支付 SDK</h2> <p>这里以封装一个支付 SDK，支持多端，多渠道支付为例，理解开发一个 SDK 设计原则和思想：</p> <h3 id="架构设计原则"><a href="#架构设计原则" class="header-anchor">#</a> 架构设计原则</h3> <ul><li><strong>模块化</strong>：将 SDK 分为多个模块（支付策略、平台适配、支付上下文、API 交互等），每个模块职责单一，遵循单一职责原则（SRP）。</li> <li><strong>可扩展性</strong>：通过策略模式、工厂模式和适配器模式实现了高度的灵活性和可扩展性。可以方便地扩展新的支付渠道（如微信支付、支付宝、苹果支付等）和支持新的平台（H5、React Native、PC 等）。</li> <li><strong>解耦性</strong>：支付渠道、平台适配和支付逻辑都被解耦成不同的模块，避免了对 SDK 核心功能的影响，增加了 SDK 的灵活性和可维护性。</li> <li><strong>统一接口</strong>：通过统一的支付上下文（<code>PaymentContext</code>），不同的支付方式和平台都遵循同样的接口规范，保证 SDK 在调用过程中的一致性。</li></ul> <h3 id="设计模式的应用"><a href="#设计模式的应用" class="header-anchor">#</a> 设计模式的应用</h3> <ul><li><p><strong>策略模式（Strategy Pattern）</strong>：支付渠道（微信支付、支付宝等）通过策略模式实现不同支付方式的封装。每个支付方式都是独立的策略，遵循同一接口，便于后续的扩展和替换。</p> <ul><li><code>PaymentStrategy</code> 接口定义了支付的基本操作（如生成订单、发起支付、查询支付状态、退款等）。</li> <li>每个支付渠道实现对应的支付策略类，如 <code>WeChatPayStrategy</code>、<code>AlipayStrategy</code> 等。</li></ul></li> <li><p><strong>工厂模式（Factory Pattern）</strong>：<code>PaymentFactory</code> 用于创建具体的支付策略对象。根据支付类型，选择相应的支付渠道策略。</p> <ul><li>通过工厂方法来动态选择支付渠道，避免了大量条件判断，使得扩展支付渠道时只需要添加相应的策略类和工厂方法。</li></ul></li> <li><p><strong>适配器模式（Adapter Pattern）</strong>：通过适配器模式实现对不同平台（H5、React Native、PC 等）的适配。每个平台有对应的适配器类，将支付流程与平台的具体实现分离。</p> <ul><li>适配器模式帮助统一了各个平台的调用接口，开发者无需关心不同平台的差异。</li></ul></li> <li><p><strong>模板方法模式（Template Method Pattern）</strong>：通过支付上下文（<code>PaymentContext</code>）封装了支付流程的模板，支付流程中涉及的步骤由具体的支付策略类来实现。<code>PaymentContext</code> 作为模板类，定义了支付流程的基本步骤，具体的支付渠道通过策略模式来实现每个步骤的细节。</p></li></ul> <h3 id="模块化分层设计"><a href="#模块化分层设计" class="header-anchor">#</a> 模块化分层设计</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>/payment-sdk
├── /src
│   ├── /core               <span class="token comment"># 核心功能模块，如支付上下文、支付策略、工厂等</span>
│   │   ├── /strategies      <span class="token comment"># 支付策略（微信支付、支付宝支付、苹果支付等）</span>
│   │   ├── /factories      <span class="token comment"># 支付工厂（生成支付策略）</span>
│   │   ├── /adapters       <span class="token comment"># 支付适配器（处理平台适配，如H5、React Native等）</span>
│   │   ├── /context        <span class="token comment"># 支付上下文（执行支付流程）</span>
│   │   ├── /models         <span class="token comment"># 数据模型（订单、支付状态等）</span>
│   │   └── /utils          <span class="token comment"># 工具类（签名、加密、时间等工具函数）</span>
│   ├── /platforms          <span class="token comment"># 针对不同平台的实现（H5、React Native、PC等）</span>
│   │   ├── /h5             <span class="token comment"># H5平台实现</span>
│   │   ├── /react-native   <span class="token comment"># React Native平台实现</span>
│   │   └── /pc             <span class="token comment"># PC平台实现</span>
│   ├── /api                <span class="token comment"># 与支付服务端交互的 API 模块</span>
│   │   ├── /wechat         <span class="token comment"># 微信支付相关 API</span>
│   │   ├── /alipay         <span class="token comment"># 支付宝支付相关 API</span>
│   │   └── /apple          <span class="token comment"># 苹果支付相关 API</span>
│   ├── /config             <span class="token comment"># 配置文件（支付方式、平台信息等）</span>
│   └── /index.ts           <span class="token comment"># SDK 入口文件</span>
├── /test                   <span class="token comment"># 单元测试文件夹</span>
│   ├── /core               <span class="token comment"># 核心功能测试</span>
│   ├── /platforms          <span class="token comment"># 平台相关测试</span>
│   ├── /api                <span class="token comment"># API 测试</span>
│   └── /utils              <span class="token comment"># 工具类测试</span>
├── /docs                   <span class="token comment"># SDK 文档</span>
│   └── /usage.md           <span class="token comment"># SDK 使用文档</span>
├── /examples               <span class="token comment"># SDK 示例项目</span>
├── /build                  <span class="token comment"># 构建输出文件夹</span>
├── /package.json           <span class="token comment"># npm 配置文件</span>
└── /tsconfig.json          <span class="token comment"># TypeScript 配置文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="核心模块-core"><a href="#核心模块-core" class="header-anchor">#</a> 核心模块（/core）</h3> <p>核心模块包含了 SDK 的主要逻辑，包括支付策略、支付上下文、支付工厂和适配器等内容</p> <ul><li>支付策略（/strategies）：根据不同的支付渠道（如微信支付、支付宝支付、苹果支付等）实现各自的支付流程。每种支付方式都有一个策略类，负责支付过程的具体实现。支付策略类需要实现统一的接口，如 generateOrder、initiatePayment、checkPaymentStatus、refund 等</li> <li>支付工厂（/factories）：支付工厂负责根据支付方式（如微信支付、支付宝支付等）来创建不同的支付策略对象。</li> <li>支付上下文（/context）：支付上下文类协调支付策略的调用，负责顺序执行支付流程中的各个步骤。</li> <li>支付适配器（/adapters）: 适配器模式用于处理不同平台（如 H5、React Native、PC）之间的差异性。每个平台的实现都可以调用相应的支付策略，并封装平台特定的调用逻辑。</li></ul> <h4 id="支付策略-strategies"><a href="#支付策略-strategies" class="header-anchor">#</a> 支付策略（/strategies）</h4> <p>根据不同的支付渠道（如微信支付、支付宝支付、苹果支付等）实现各自的支付流程。每种支付方式都有一个策略类，负责支付过程的具体实现。支付策略类需要实现统一的接口，如 generateOrder、initiatePayment、checkPaymentStatus、refund 等</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/strategies/WeChatPayStrategy.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WeChatPayStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 微信支付订单生成逻辑</span>
    <span class="token keyword">return</span> <span class="token string">'wechat_order_str_with_signature'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 微信支付发起预下单</span>
    <span class="token keyword">return</span> <span class="token string">'wechat_perpay_id'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>PaymentStatus<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询微信支付状态</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token literal-property property">transactionId</span><span class="token operator">:</span> <span class="token string">'wechat_txn_12345'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">refund</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 微信支付退款</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="支付工厂-factories"><a href="#支付工厂-factories" class="header-anchor">#</a> 支付工厂（/factories）</h4> <p>支付工厂负责根据支付方式（如微信支付、支付宝支付等）来创建不同的支付策略对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/factories/PaymentFactory.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFactory</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">getStrategy</span><span class="token punctuation">(</span>paymentType<span class="token operator">:</span> <span class="token string">'wechat'</span> <span class="token operator">|</span> <span class="token string">'alipay'</span> <span class="token operator">|</span> <span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token operator">:</span> PaymentStrategy <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>paymentType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'wechat'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WeChatPayStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'alipay'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AlipayStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'apple'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApplePayStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unsupported payment type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="支付上下文-context"><a href="#支付上下文-context" class="header-anchor">#</a> 支付上下文（/context）</h4> <p>支付上下文类协调支付策略的调用，负责顺序执行支付流程中的各个步骤。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/context/PaymentContext.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentStrategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../strategies/PaymentStrategy'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models/PaymentStatus'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PaymentContext</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> PaymentStrategy<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">strategy</span><span class="token operator">:</span> PaymentStrategy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">strategy</span><span class="token operator">:</span> PaymentStrategy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 生成订单</span>
  <span class="token keyword">async</span> <span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderStr <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> orderStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'订单生成失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 发起支付</span>
  <span class="token keyword">async</span> <span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> perpayId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> perpayId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'支付发起失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 查询支付状态</span>
  <span class="token keyword">async</span> <span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>PaymentStatus<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'支付状态查询失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 发起退款</span>
  <span class="token keyword">async</span> <span class="token function">refundPayment</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> isRefundSuccessful <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">refund</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> isRefundSuccessful<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'退款失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 一站式支付流程：生成订单 -&gt; 发起支付 -&gt; 查询状态</span>
  <span class="token keyword">async</span> <span class="token function">startPayment</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>PaymentStatus<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderStr <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> perpayId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> paymentStatus <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> paymentStatus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'支付流程发生错误：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h4 id="支付适配器-adapters"><a href="#支付适配器-adapters" class="header-anchor">#</a> 支付适配器（/adapters）</h4> <p>适配器模式用于处理不同平台（如 H5、React Native、PC）之间的差异性。每个平台的实现都可以调用相应的支付策略，并封装平台特定的调用逻辑。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/adapters/H5PaymentAdapter.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">H5PaymentAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentAdapter</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// H5 支付特定实现</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">H5支付: ￥</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="模型-models"><a href="#模型-models" class="header-anchor">#</a> 模型（/models）</h4> <p>数据模型类，用于表示订单信息、支付状态等。通过这些模型类，SDK 可以与支付服务端进行交互。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/models/PaymentStatus.ts</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentStatus</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'failed'</span> <span class="token operator">|</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
  <span class="token literal-property property">transactionId</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="工具类-utils"><a href="#工具类-utils" class="header-anchor">#</a> 工具类（/utils）</h4> <p>工具类包含一些常用的功能，如签名生成、加密、解密等。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/core/utils/Signature.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Signature</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">generateSignature</span><span class="token punctuation">(</span>data<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">secretKey</span><span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token comment">// 签名生成逻辑</span>
    <span class="token keyword">return</span> <span class="token string">'generated_signature'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="平台相关实现-platforms"><a href="#平台相关实现-platforms" class="header-anchor">#</a> 平台相关实现（/platforms）</h3> <p>包含了平台特定的代码，处理不同平台的支付交互方式</p> <h4 id="h5-支付实现-h5"><a href="#h5-支付实现-h5" class="header-anchor">#</a> H5 支付实现（/h5）</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/platforms/h5/PaymentService.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> H5PaymentAdapter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../core/adapters/H5PaymentAdapter'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">H5PaymentService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token literal-property property">adapter</span><span class="token operator">:</span> H5PaymentAdapter<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">H5PaymentAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adapter<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="react-native-支付实现-react-native"><a href="#react-native-支付实现-react-native" class="header-anchor">#</a> React Native 支付实现（/react-native）</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/platforms/react-native/PaymentService.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RNPamentAdapter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../core/adapters/RNPamentAdapter'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RNPaymentService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token literal-property property">adapter</span><span class="token operator">:</span> RNPamentAdapter<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RNPamentAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adapter<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="api-模块-api"><a href="#api-模块-api" class="header-anchor">#</a> API 模块（/api）</h3> <p>封装了与支付服务端的交互，调用不同支付平台的支付接口（如微信、支付宝、苹果支付等）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/api/wechat/WechatAPI.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WechatAPI</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用微信支付 API 生成订单</span>
    <span class="token keyword">return</span> <span class="token string">'wechat_order_str_with_signature'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用微信支付 API 发起预下单</span>
    <span class="token keyword">return</span> <span class="token string">'wechat_perpay_id'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>PaymentStatus<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查询微信支付状态</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token literal-property property">transactionId</span><span class="token operator">:</span> <span class="token string">'wechat_txn_12345'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">refund</span><span class="token punctuation">(</span>orderDetails<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用微信支付 API 发起退款</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="sdk-入口文件-index-ts"><a href="#sdk-入口文件-index-ts" class="header-anchor">#</a> SDK 入口文件（index.ts）</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/index.ts</span>
<span class="token comment">// SDK 入口文件，提供支付接口</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./core/factories/PaymentFactory'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./core/context/PaymentContext'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentStrategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./core/strategies/PaymentStrategy'</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化支付工厂和支付上下文</span>
<span class="token keyword">const</span> paymentType <span class="token operator">=</span> <span class="token string">'wechat'</span><span class="token punctuation">;</span> <span class="token comment">// 假设选择了微信支付</span>
<span class="token keyword">const</span> <span class="token literal-property property">strategy</span><span class="token operator">:</span> PaymentStrategy <span class="token operator">=</span> PaymentFactory<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span>paymentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> paymentContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentContext</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 SDK 调用支付</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startPayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> orderDetails <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 订单信息</span>
  <span class="token keyword">const</span> orderStr <span class="token operator">=</span> <span class="token keyword">await</span> paymentContext<span class="token punctuation">.</span><span class="token function">generateOrder</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'订单字符串：'</span><span class="token punctuation">,</span> orderStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> perpayId <span class="token operator">=</span> <span class="token keyword">await</span> paymentContext<span class="token punctuation">.</span><span class="token function">initiatePayment</span><span class="token punctuation">(</span>orderStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'预支付 ID：'</span><span class="token punctuation">,</span> perpayId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 查询支付状态</span>
  <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> paymentContext<span class="token punctuation">.</span><span class="token function">checkPaymentStatus</span><span class="token punctuation">(</span>perpayId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支付状态：'</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发起支付</span>
<span class="token function">startPayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="rollup-打包"><a href="#rollup-打包" class="header-anchor">#</a> Rollup 打包</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'rollup-plugin-typescript2'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/index.ts'</span><span class="token punctuation">,</span> <span class="token comment">// SDK 入口文件</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/your-payment-sdk.esm.js'</span><span class="token punctuation">,</span> <span class="token comment">// ESM 格式，适用于现代前端框架</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'esm'</span><span class="token punctuation">,</span> <span class="token comment">// ES Module 格式</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用源映射，便于调试</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/your-payment-sdk.cjs.js'</span><span class="token punctuation">,</span> <span class="token comment">// CommonJS 格式，适用于 Node.js 环境</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/your-payment-sdk.umd.js'</span><span class="token punctuation">,</span> <span class="token comment">// UMD 格式，兼容浏览器和 Node.js</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'PaymentSDK'</span><span class="token punctuation">,</span> <span class="token comment">// UMD 格式的全局变量名称</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/your-payment-sdk.min.js'</span><span class="token punctuation">,</span> <span class="token comment">// 压缩后的文件</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'PaymentSDK'</span><span class="token punctuation">,</span> <span class="token comment">// UMD 格式的全局变量名称</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 压缩代码</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'axios'</span><span class="token punctuation">,</span> <span class="token string">'dayjs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 外部依赖，防止将其打包进 SDK，减少体积</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 解析 Node.js 模块</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 支持 CommonJS 模块</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">tsconfig</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'tsconfig.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 使用 TypeScript 配置文件</span>
      <span class="token literal-property property">useTsconfigDeclarationDir</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 指定声明文件输出目录</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">treeshake</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">moduleSideEffects</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁用模块副作用，启用 tree-shaking</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">preserveModules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 保留模块结构，便于按需加载</span>
  <span class="token comment">// 如果你的 SDK 依赖了动态导入，可以设置输出目录</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'esm'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'chunks/[name]-[hash].js'</span><span class="token punctuation">,</span> <span class="token comment">// 按需加载的文件命名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'your-payment-sdk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PaymentContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'your-payment-sdk'</span><span class="token punctuation">;</span>

<span class="token comment">// 配置支付类型，假设是微信支付</span>
<span class="token keyword">const</span> paymentType <span class="token operator">=</span> <span class="token string">'wechat'</span><span class="token punctuation">;</span> <span class="token comment">// 或 'alipay'</span>
<span class="token keyword">const</span> strategy <span class="token operator">=</span> PaymentFactory<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span>paymentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> paymentContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentContext</span><span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用支付流程</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">makePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> orderDetails <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">orderId</span><span class="token operator">:</span> <span class="token string">'123456789'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> paymentStatus <span class="token operator">=</span> <span class="token keyword">await</span> paymentContext<span class="token punctuation">.</span><span class="token function">startPayment</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentStatus<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支付成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支付失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'支付失败，错误信息：'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发起支付</span>
<span class="token function">makePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="caniuse-兼容性设计"><a href="#caniuse-兼容性设计" class="header-anchor">#</a> canIUse 兼容性设计</h2> <p>可利用 <code>ts-morph</code> 来实现支付 SDK 的 <code>caniuse</code> 功能，主要的目标是基于 TypeScript 代码的分析，判断 SDK 中的 <strong>API、回调、参数、组件</strong> 等是否在当前版本中可用。我们可以通过 <code>ts-morph</code> 对 SDK 的 TypeScript 代码进行静态分析，识别出不同功能的支持情况，并根据版本信息来判断该功能是否可用。</p> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <ol><li><strong>API</strong>：支付 SDK 中的接口方法（如：<code>createOrder</code>, <code>processPayment</code>）。</li> <li><strong>回调</strong>：SDK 中的回调函数或事件（如：<code>onSuccess</code>, <code>onError</code>）。</li> <li><strong>参数</strong>：SDK 方法或回调中使用的参数（如：<code>amount</code>, <code>currency</code>）。</li> <li><strong>组件</strong>：SDK 中的组件（如：支付按钮、订单面板等）。</li></ol> <h3 id="基本设计思路"><a href="#基本设计思路" class="header-anchor">#</a> 基本设计思路</h3> <p>我们需要实现以下几个步骤：</p> <ol><li><strong>定义支持版本的注释</strong>：通过在 SDK 中的 API、回调、参数、组件等上添加版本注释，指明该功能从哪个版本开始支持。</li> <li><strong>静态分析 SDK 代码</strong>：使用 <code>ts-morph</code> 来解析 TypeScript 代码，分析 SDK 中的类、方法、参数、回调等。</li> <li><strong>提取支持版本信息</strong>：从代码中的注释中提取版本信息，并生成 <code>canIUseFeatures</code> 数据结构。</li> <li><strong>判断功能是否可用</strong>：通过动态检测当前平台的 SDK 版本，并根据 <code>canIUseFeatures</code> 来判断功能是否可用。</li></ol> <h3 id="实现示例"><a href="#实现示例" class="header-anchor">#</a> 实现示例</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Project <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ts-morph'</span><span class="token punctuation">;</span>

<span class="token comment">// 假设这是 SDK 类型定义文件路径</span>
<span class="token keyword">const</span> sdkFilePath <span class="token operator">=</span> <span class="token string">'path/to/PaymentAPI.d.ts'</span><span class="token punctuation">;</span>

<span class="token comment">// 支持的版本范围，这里你可以设定具体的版本范围（如 3.0 到 5.0）</span>
<span class="token keyword">const</span> <span class="token constant">SUPPORTED_VERSIONS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'3.0'</span><span class="token punctuation">,</span> <span class="token string">'3.1'</span><span class="token punctuation">,</span> <span class="token string">'4.0'</span><span class="token punctuation">,</span> <span class="token string">'5.0'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description 用于表示每个功能的支持信息，包括版本、废弃状态等。
 */</span>
<span class="token keyword">interface</span> <span class="token class-name">FeatureSupportInfo</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 版本号</span>
  <span class="token literal-property property">deprecated</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span> <span class="token comment">// 是否废弃</span>
  replacement<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">// 如果废弃，推荐的替代方法或参数</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @description 构建 SDK 支持信息，获取每个函数、接口、属性的版本信息和废弃状态。
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">buildSupportInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sourceFile</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">apiSupportInfo</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> FeatureSupportInfo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取所有函数信息，包括注释和版本</span>
  sourceFile<span class="token punctuation">.</span><span class="token function">getFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> functionName <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> docComment <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">getJsDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">getComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> versionMatch <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@version (\d+\.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> version <span class="token operator">=</span> versionMatch <span class="token operator">?</span> versionMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> deprecated <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'@deprecated'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> replacement <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@deprecated (.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      apiSupportInfo<span class="token punctuation">[</span>functionName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        version<span class="token punctuation">,</span>
        deprecated<span class="token punctuation">,</span>
        replacement
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取所有类中的方法，并构建相应的信息</span>
  sourceFile<span class="token punctuation">.</span><span class="token function">getClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cls</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> cls<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cls<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> docComment <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getJsDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">getComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> versionMatch <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@version (\d+\.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> version <span class="token operator">=</span> versionMatch <span class="token operator">?</span> versionMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> deprecated <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'@deprecated'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> replacement <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@deprecated (.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        apiSupportInfo<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>methodName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          version<span class="token punctuation">,</span>
          deprecated<span class="token punctuation">,</span>
          replacement
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取接口中的属性信息</span>
  sourceFile<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">intf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> interfaceName <span class="token operator">=</span> intf<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    intf<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">prop</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> propertyName <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> docComment <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getJsDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">getComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> versionMatch <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@version (\d+\.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> version <span class="token operator">=</span> versionMatch <span class="token operator">?</span> versionMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> deprecated <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'@deprecated'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> replacement <span class="token operator">=</span> docComment<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@deprecated (.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        apiSupportInfo<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>interfaceName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>propertyName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          version<span class="token punctuation">,</span>
          deprecated<span class="token punctuation">,</span>
          replacement
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> apiSupportInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description canIUse 函数，用于判断特定路径的功能是否可用。
 * @param {string} path - 用户传入的功能路径，例如 'PaymentAPI.processPayment.amount.currency'
 * @param {string} currentVersion - 当前目标版本，通常是应用的版本。
 * @returns {string} - 返回功能是否支持，以及是否废弃。
 */</span>
<span class="token keyword">const</span> canIUse <span class="token operator">=</span> <span class="token punctuation">(</span>path<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">currentVersion</span><span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> parts <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将路径拆分成各个层级</span>
  <span class="token keyword">let</span> currentPath <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> supportStatus <span class="token operator">=</span> <span class="token string">'not found'</span><span class="token punctuation">;</span> <span class="token comment">// 默认返回功能未找到</span>

  <span class="token comment">// 遍历路径的每个部分，逐层检查支持情况</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentPath <span class="token operator">+=</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'.'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>apiSupportInfo<span class="token punctuation">[</span>currentPath<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> apiSupportInfo<span class="token punctuation">[</span>currentPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 检查版本是否支持，并处理废弃的情况</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SUPPORTED_VERSIONS</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>info<span class="token punctuation">.</span>deprecated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        supportStatus <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">supported in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>deprecated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        supportStatus <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">deprecated in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>replacement <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">. Please use </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>replacement<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        supportStatus <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">not supported</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>supportStatus<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 ts-morph 项目并加载 SDK 文件</span>
<span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Project</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sourceFile <span class="token operator">=</span> project<span class="token punctuation">.</span><span class="token function">addSourceFileAtPath</span><span class="token punctuation">(</span>sdkFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取 SDK 支持信息</span>
<span class="token keyword">const</span> apiSupportInfo <span class="token operator">=</span> <span class="token function">buildSupportInfo</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试用例</span>
<span class="token keyword">const</span> testPaths <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'processPayment'</span><span class="token punctuation">,</span>
  <span class="token string">'PaymentAPI.processPayment.methods'</span><span class="token punctuation">,</span>
  <span class="token string">'PaymentAPI.processPayment.amount.currency'</span><span class="token punctuation">,</span>
  <span class="token string">'PaymentAPI.processPayment.method'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

testPaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">path</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">canIUse</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'3.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设我们在 3.1 版本中进行检查</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br></div></div><h3 id="jsdoc-注释"><a href="#jsdoc-注释" class="header-anchor">#</a> JSDOC 注释</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// PaymentAPI.d.ts</span>

<span class="token comment">/**
 * @version 3.0
 * 处理支付请求的 API，使用 `method` 参数指定支付方式（如信用卡、PayPal）。
 * @param {number} amount - 支付金额
 * @param {string} currency - 支付货币（支持 USD、EUR 等）
 * @param {string} method - 支付方式（如信用卡、PayPal）
 * @returns {void} - 无返回值
 * @deprecated 从版本 3.1 开始，`method` 参数已被废弃，使用 `methods` 替代。
 * 
 * 示例：
 * ```ts
 * PaymentAPI.processPayment(100, 'USD', 'credit_card');
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">processPayment</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">amount</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">method</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @version 3.1
 * 处理支付请求的 API，使用 `methods` 参数指定支付方式。
 * 支持多个支付方式的并行选择，改为接受一个数组。
 * @param {number} amount - 支付金额
 * @param {string} currency - 支付货币（支持 USD、EUR 等）
 * @param {string[]} methods - 支付方式数组（如 `['credit_card', 'paypal']`）
 * @returns {void} - 无返回值
 * 
 * 示例：
 * ```ts
 * PaymentAPI.processPayment(100, 'USD', ['credit_card', 'paypal']);
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">processPayment</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">amount</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">methods</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="typedoc-文档生成"><a href="#typedoc-文档生成" class="header-anchor">#</a> TypeDoc 文档生成</h2> <h3 id="tsconfig-json-配置"><a href="#tsconfig-json-配置" class="header-anchor">#</a> tsconfig.json 配置</h3> <p>在 tsconfig.json 文件中配置 TypeDoc 相关的设置。这是推荐的方式，便于管理项目的编译和文档生成设置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;out&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./docs&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">// 输出文档的目录</span>
  <span class="token string-property property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token string">&quot;**/test/**&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// 排除测试目录</span>
  <span class="token string-property property">&quot;excludePrivate&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">// 排除私有成员</span>
  <span class="token string-property property">&quot;excludeProtected&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token comment">// 排除受保护成员</span>
  <span class="token string-property property">&quot;includeDeclarations&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token comment">// 是否包括声明文件</span>
  <span class="token string-property property">&quot;theme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>                <span class="token comment">// 使用默认主题</span>
  <span class="token string-property property">&quot;readme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">// 不包括 README 文件</span>
  <span class="token string-property property">&quot;hideGenerator&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// 隐藏生成器信息</span>
  <span class="token string-property property">&quot;ignoreCompilerErrors&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token comment">// 忽略 TypeScript 编译错误</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Payment SDK API&quot;</span>          <span class="token comment">// 文档标题</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="在代码中使用-jsdoc-注释"><a href="#在代码中使用-jsdoc-注释" class="header-anchor">#</a> 在代码中使用 JSDoc 注释</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 处理支付的 API。
 * @version 3.0
 * @example
 * ```ts
 * PaymentAPI.processPayment(100, 'USD', 'credit_card');
 * ```
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PaymentAPI</span> <span class="token punctuation">{</span>
  
  <span class="token comment">/**
   * 处理支付请求。
   * @param amount 支付金额
   * @param currency 支付货币（如 USD、EUR）
   * @param method 支付方式（如信用卡、PayPal）
   * @returns 无返回值
   * @throws {Error} 如果支付失败则抛出错误
   * @version 3.0
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">processPayment</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">method</span><span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>amount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid amount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 处理支付逻辑</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="通过命令行生成文档"><a href="#通过命令行生成文档" class="header-anchor">#</a> 通过命令行生成文档</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx typedoc <span class="token operator">--</span>out docs <span class="token operator">--</span>exclude <span class="token operator">**</span><span class="token operator">/</span>test<span class="token comment">/** --excludePrivate --excludeProtected --name &quot;Payment SDK API&quot; src

</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/architecture/plan/i18n.html" class="prev">
        国际化探索实践
      </a></span> <span class="next"><a href="/blog/architecture/plan/pay.html">
        三方支付与收银台
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.e167c4d9.js" defer></script><script src="/blog/assets/js/2.dec2e75d.js" defer></script><script src="/blog/assets/js/1.5b9e135c.js" defer></script><script src="/blog/assets/js/44.9cbfb2c5.js" defer></script><script src="/blog/assets/js/20.badbb211.js" defer></script>
  </body>
</html>

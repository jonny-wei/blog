<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>国际化探索实践 | 前端那些事儿</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f0017422.css" as="style"><link rel="preload" href="/blog/assets/js/app.1648de87.js" as="script"><link rel="preload" href="/blog/assets/js/2.dec2e75d.js" as="script"><link rel="preload" href="/blog/assets/js/1.5b9e135c.js" as="script"><link rel="preload" href="/blog/assets/js/41.1ee9b580.js" as="script"><link rel="preload" href="/blog/assets/js/20.badbb211.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc7e09f3.js"><link rel="prefetch" href="/blog/assets/js/100.1e50224f.js"><link rel="prefetch" href="/blog/assets/js/101.53ad35f3.js"><link rel="prefetch" href="/blog/assets/js/102.de955288.js"><link rel="prefetch" href="/blog/assets/js/103.1943223d.js"><link rel="prefetch" href="/blog/assets/js/104.42cad168.js"><link rel="prefetch" href="/blog/assets/js/105.ee7b701a.js"><link rel="prefetch" href="/blog/assets/js/106.06a442d5.js"><link rel="prefetch" href="/blog/assets/js/107.e7a194ae.js"><link rel="prefetch" href="/blog/assets/js/108.6de74b47.js"><link rel="prefetch" href="/blog/assets/js/109.a4f05837.js"><link rel="prefetch" href="/blog/assets/js/11.b60c9933.js"><link rel="prefetch" href="/blog/assets/js/110.fbd81312.js"><link rel="prefetch" href="/blog/assets/js/111.99da82db.js"><link rel="prefetch" href="/blog/assets/js/112.ae79fa11.js"><link rel="prefetch" href="/blog/assets/js/113.7ca1562e.js"><link rel="prefetch" href="/blog/assets/js/114.0132f7b3.js"><link rel="prefetch" href="/blog/assets/js/115.b23d6104.js"><link rel="prefetch" href="/blog/assets/js/116.9f0e022b.js"><link rel="prefetch" href="/blog/assets/js/117.1927f38b.js"><link rel="prefetch" href="/blog/assets/js/118.0e0f10e2.js"><link rel="prefetch" href="/blog/assets/js/119.71ea1c3f.js"><link rel="prefetch" href="/blog/assets/js/12.c53283e7.js"><link rel="prefetch" href="/blog/assets/js/120.892e1639.js"><link rel="prefetch" href="/blog/assets/js/121.4df1f366.js"><link rel="prefetch" href="/blog/assets/js/122.c4979da8.js"><link rel="prefetch" href="/blog/assets/js/123.771cd31c.js"><link rel="prefetch" href="/blog/assets/js/124.a1db8094.js"><link rel="prefetch" href="/blog/assets/js/125.b388b768.js"><link rel="prefetch" href="/blog/assets/js/126.6ad88a3d.js"><link rel="prefetch" href="/blog/assets/js/127.b942a4b3.js"><link rel="prefetch" href="/blog/assets/js/128.5c69f3d3.js"><link rel="prefetch" href="/blog/assets/js/129.02a8dd87.js"><link rel="prefetch" href="/blog/assets/js/13.6bdc6b5d.js"><link rel="prefetch" href="/blog/assets/js/130.5871f52a.js"><link rel="prefetch" href="/blog/assets/js/131.5207eb9d.js"><link rel="prefetch" href="/blog/assets/js/132.99ca1a2f.js"><link rel="prefetch" href="/blog/assets/js/133.1fb65c29.js"><link rel="prefetch" href="/blog/assets/js/134.b7e49e42.js"><link rel="prefetch" href="/blog/assets/js/135.cd331791.js"><link rel="prefetch" href="/blog/assets/js/136.12a2d4d9.js"><link rel="prefetch" href="/blog/assets/js/137.6a28d008.js"><link rel="prefetch" href="/blog/assets/js/138.302b9909.js"><link rel="prefetch" href="/blog/assets/js/139.a7b9ee5f.js"><link rel="prefetch" href="/blog/assets/js/14.c3201a23.js"><link rel="prefetch" href="/blog/assets/js/140.3ddf9488.js"><link rel="prefetch" href="/blog/assets/js/141.5f125059.js"><link rel="prefetch" href="/blog/assets/js/142.10038048.js"><link rel="prefetch" href="/blog/assets/js/143.5f47c7da.js"><link rel="prefetch" href="/blog/assets/js/144.d9c6cb8c.js"><link rel="prefetch" href="/blog/assets/js/145.f5a49ad0.js"><link rel="prefetch" href="/blog/assets/js/146.e4dc25f4.js"><link rel="prefetch" href="/blog/assets/js/147.3f966ea8.js"><link rel="prefetch" href="/blog/assets/js/148.cf9dfab4.js"><link rel="prefetch" href="/blog/assets/js/149.1789da0b.js"><link rel="prefetch" href="/blog/assets/js/15.a0b9e44e.js"><link rel="prefetch" href="/blog/assets/js/150.d2e0de1e.js"><link rel="prefetch" href="/blog/assets/js/151.83b1f68b.js"><link rel="prefetch" href="/blog/assets/js/152.5920dc0b.js"><link rel="prefetch" href="/blog/assets/js/153.70a6fd63.js"><link rel="prefetch" href="/blog/assets/js/154.a52e09d1.js"><link rel="prefetch" href="/blog/assets/js/155.5dedd8ea.js"><link rel="prefetch" href="/blog/assets/js/156.c2ef82d2.js"><link rel="prefetch" href="/blog/assets/js/157.a7463f47.js"><link rel="prefetch" href="/blog/assets/js/158.cb2b45d5.js"><link rel="prefetch" href="/blog/assets/js/159.bfac6e97.js"><link rel="prefetch" href="/blog/assets/js/16.491191e4.js"><link rel="prefetch" href="/blog/assets/js/160.1c265a50.js"><link rel="prefetch" href="/blog/assets/js/161.aba9bce8.js"><link rel="prefetch" href="/blog/assets/js/162.51c89735.js"><link rel="prefetch" href="/blog/assets/js/163.1688d674.js"><link rel="prefetch" href="/blog/assets/js/164.dc9436f9.js"><link rel="prefetch" href="/blog/assets/js/165.8947de57.js"><link rel="prefetch" href="/blog/assets/js/166.b2be7191.js"><link rel="prefetch" href="/blog/assets/js/167.f7100292.js"><link rel="prefetch" href="/blog/assets/js/168.8966a2fc.js"><link rel="prefetch" href="/blog/assets/js/169.402c91ea.js"><link rel="prefetch" href="/blog/assets/js/17.89ec8c57.js"><link rel="prefetch" href="/blog/assets/js/170.8825cf2f.js"><link rel="prefetch" href="/blog/assets/js/171.128e5dc3.js"><link rel="prefetch" href="/blog/assets/js/172.50acc4ad.js"><link rel="prefetch" href="/blog/assets/js/173.52f54b75.js"><link rel="prefetch" href="/blog/assets/js/174.980dfb14.js"><link rel="prefetch" href="/blog/assets/js/175.0fe18dea.js"><link rel="prefetch" href="/blog/assets/js/176.9479743d.js"><link rel="prefetch" href="/blog/assets/js/177.d84d06e6.js"><link rel="prefetch" href="/blog/assets/js/178.4b3c78c6.js"><link rel="prefetch" href="/blog/assets/js/179.0e617fe3.js"><link rel="prefetch" href="/blog/assets/js/18.b91f1411.js"><link rel="prefetch" href="/blog/assets/js/180.ed5533bf.js"><link rel="prefetch" href="/blog/assets/js/181.f6a32104.js"><link rel="prefetch" href="/blog/assets/js/182.ac73cf8f.js"><link rel="prefetch" href="/blog/assets/js/183.f0b65ca1.js"><link rel="prefetch" href="/blog/assets/js/184.2cb2b3fc.js"><link rel="prefetch" href="/blog/assets/js/185.83b5dc8f.js"><link rel="prefetch" href="/blog/assets/js/186.9256478c.js"><link rel="prefetch" href="/blog/assets/js/187.eb2f933e.js"><link rel="prefetch" href="/blog/assets/js/188.accdba8b.js"><link rel="prefetch" href="/blog/assets/js/189.7758678c.js"><link rel="prefetch" href="/blog/assets/js/19.cb1f17c8.js"><link rel="prefetch" href="/blog/assets/js/190.0515855c.js"><link rel="prefetch" href="/blog/assets/js/191.5a45d0dd.js"><link rel="prefetch" href="/blog/assets/js/192.4eaa50d9.js"><link rel="prefetch" href="/blog/assets/js/193.4b131a85.js"><link rel="prefetch" href="/blog/assets/js/194.1dfe0923.js"><link rel="prefetch" href="/blog/assets/js/195.e187ae31.js"><link rel="prefetch" href="/blog/assets/js/196.d02c94c7.js"><link rel="prefetch" href="/blog/assets/js/197.3a2f4aea.js"><link rel="prefetch" href="/blog/assets/js/198.3834a4af.js"><link rel="prefetch" href="/blog/assets/js/199.90be20aa.js"><link rel="prefetch" href="/blog/assets/js/200.78743df9.js"><link rel="prefetch" href="/blog/assets/js/201.6c1d8f8c.js"><link rel="prefetch" href="/blog/assets/js/202.12273605.js"><link rel="prefetch" href="/blog/assets/js/203.712e9964.js"><link rel="prefetch" href="/blog/assets/js/204.8d2381f4.js"><link rel="prefetch" href="/blog/assets/js/205.6afd0009.js"><link rel="prefetch" href="/blog/assets/js/206.7cc9735f.js"><link rel="prefetch" href="/blog/assets/js/207.bb04666d.js"><link rel="prefetch" href="/blog/assets/js/208.4152b0b4.js"><link rel="prefetch" href="/blog/assets/js/209.e2e1511c.js"><link rel="prefetch" href="/blog/assets/js/21.bf0041b7.js"><link rel="prefetch" href="/blog/assets/js/210.2514251c.js"><link rel="prefetch" href="/blog/assets/js/211.1e817604.js"><link rel="prefetch" href="/blog/assets/js/212.f5d2350e.js"><link rel="prefetch" href="/blog/assets/js/213.1749f0ee.js"><link rel="prefetch" href="/blog/assets/js/214.ad499e16.js"><link rel="prefetch" href="/blog/assets/js/215.2d17a758.js"><link rel="prefetch" href="/blog/assets/js/216.883ab12e.js"><link rel="prefetch" href="/blog/assets/js/217.55493374.js"><link rel="prefetch" href="/blog/assets/js/218.635334cf.js"><link rel="prefetch" href="/blog/assets/js/219.5babbfbe.js"><link rel="prefetch" href="/blog/assets/js/22.48390d4f.js"><link rel="prefetch" href="/blog/assets/js/220.ebc569c6.js"><link rel="prefetch" href="/blog/assets/js/221.5aef31f2.js"><link rel="prefetch" href="/blog/assets/js/222.3e97e09b.js"><link rel="prefetch" href="/blog/assets/js/223.f7a9cfe4.js"><link rel="prefetch" href="/blog/assets/js/224.1323cb6b.js"><link rel="prefetch" href="/blog/assets/js/225.09d0c412.js"><link rel="prefetch" href="/blog/assets/js/226.62713f2d.js"><link rel="prefetch" href="/blog/assets/js/227.4e115357.js"><link rel="prefetch" href="/blog/assets/js/23.35c4ba93.js"><link rel="prefetch" href="/blog/assets/js/24.cc3b12df.js"><link rel="prefetch" href="/blog/assets/js/25.632a83cc.js"><link rel="prefetch" href="/blog/assets/js/26.dc0735bf.js"><link rel="prefetch" href="/blog/assets/js/27.cc85ad1c.js"><link rel="prefetch" href="/blog/assets/js/28.16ae2ba9.js"><link rel="prefetch" href="/blog/assets/js/29.6ed063e8.js"><link rel="prefetch" href="/blog/assets/js/3.cb0627fa.js"><link rel="prefetch" href="/blog/assets/js/30.5c1f61b2.js"><link rel="prefetch" href="/blog/assets/js/31.6958a252.js"><link rel="prefetch" href="/blog/assets/js/32.1ab00675.js"><link rel="prefetch" href="/blog/assets/js/33.0a98d657.js"><link rel="prefetch" href="/blog/assets/js/34.a4d45409.js"><link rel="prefetch" href="/blog/assets/js/35.9be0a651.js"><link rel="prefetch" href="/blog/assets/js/36.20b76716.js"><link rel="prefetch" href="/blog/assets/js/37.4512a11d.js"><link rel="prefetch" href="/blog/assets/js/38.4892f77f.js"><link rel="prefetch" href="/blog/assets/js/39.35b3dcda.js"><link rel="prefetch" href="/blog/assets/js/4.cbb57fa7.js"><link rel="prefetch" href="/blog/assets/js/40.d5f1d015.js"><link rel="prefetch" href="/blog/assets/js/42.e7bf99c8.js"><link rel="prefetch" href="/blog/assets/js/43.12a53484.js"><link rel="prefetch" href="/blog/assets/js/44.7f77450c.js"><link rel="prefetch" href="/blog/assets/js/45.36ceab63.js"><link rel="prefetch" href="/blog/assets/js/46.b4efc80b.js"><link rel="prefetch" href="/blog/assets/js/47.efb54243.js"><link rel="prefetch" href="/blog/assets/js/48.5c4055e8.js"><link rel="prefetch" href="/blog/assets/js/49.caccd6a9.js"><link rel="prefetch" href="/blog/assets/js/5.fe065607.js"><link rel="prefetch" href="/blog/assets/js/50.3273b4c5.js"><link rel="prefetch" href="/blog/assets/js/51.a17bc372.js"><link rel="prefetch" href="/blog/assets/js/52.b0e04a5e.js"><link rel="prefetch" href="/blog/assets/js/53.01ff3cf3.js"><link rel="prefetch" href="/blog/assets/js/54.a417a7e4.js"><link rel="prefetch" href="/blog/assets/js/55.5e6bbd98.js"><link rel="prefetch" href="/blog/assets/js/56.ff03c411.js"><link rel="prefetch" href="/blog/assets/js/57.79506dea.js"><link rel="prefetch" href="/blog/assets/js/58.089a15e0.js"><link rel="prefetch" href="/blog/assets/js/59.bc51862c.js"><link rel="prefetch" href="/blog/assets/js/6.68cda050.js"><link rel="prefetch" href="/blog/assets/js/60.a6145f7e.js"><link rel="prefetch" href="/blog/assets/js/61.ff8e024c.js"><link rel="prefetch" href="/blog/assets/js/62.85b4767f.js"><link rel="prefetch" href="/blog/assets/js/63.720473f9.js"><link rel="prefetch" href="/blog/assets/js/64.cdfa1458.js"><link rel="prefetch" href="/blog/assets/js/65.eca7585e.js"><link rel="prefetch" href="/blog/assets/js/66.45510560.js"><link rel="prefetch" href="/blog/assets/js/67.9d5c2e0c.js"><link rel="prefetch" href="/blog/assets/js/68.7232bc05.js"><link rel="prefetch" href="/blog/assets/js/69.4cdab4a6.js"><link rel="prefetch" href="/blog/assets/js/7.3b8d63a0.js"><link rel="prefetch" href="/blog/assets/js/70.34cb0c60.js"><link rel="prefetch" href="/blog/assets/js/71.c9a2e075.js"><link rel="prefetch" href="/blog/assets/js/72.ce2004b4.js"><link rel="prefetch" href="/blog/assets/js/73.f9ae3ebb.js"><link rel="prefetch" href="/blog/assets/js/74.0b5c3637.js"><link rel="prefetch" href="/blog/assets/js/75.e56c6fd6.js"><link rel="prefetch" href="/blog/assets/js/76.761db19a.js"><link rel="prefetch" href="/blog/assets/js/77.8c04b31c.js"><link rel="prefetch" href="/blog/assets/js/78.c9c291c4.js"><link rel="prefetch" href="/blog/assets/js/79.347fc56a.js"><link rel="prefetch" href="/blog/assets/js/80.7d56e86a.js"><link rel="prefetch" href="/blog/assets/js/81.06d55d16.js"><link rel="prefetch" href="/blog/assets/js/82.9ec03de3.js"><link rel="prefetch" href="/blog/assets/js/83.68baea62.js"><link rel="prefetch" href="/blog/assets/js/84.518a4d47.js"><link rel="prefetch" href="/blog/assets/js/85.8ce7c9a2.js"><link rel="prefetch" href="/blog/assets/js/86.4a301d2e.js"><link rel="prefetch" href="/blog/assets/js/87.0a5ed4ed.js"><link rel="prefetch" href="/blog/assets/js/88.8ee94ec9.js"><link rel="prefetch" href="/blog/assets/js/89.c56c8284.js"><link rel="prefetch" href="/blog/assets/js/90.ba0c7ddd.js"><link rel="prefetch" href="/blog/assets/js/91.a127b13f.js"><link rel="prefetch" href="/blog/assets/js/92.044fe942.js"><link rel="prefetch" href="/blog/assets/js/93.d3cf284c.js"><link rel="prefetch" href="/blog/assets/js/94.2df002a0.js"><link rel="prefetch" href="/blog/assets/js/95.e4cc1bc9.js"><link rel="prefetch" href="/blog/assets/js/96.df84d36f.js"><link rel="prefetch" href="/blog/assets/js/97.7246d352.js"><link rel="prefetch" href="/blog/assets/js/98.7f13b3e4.js"><link rel="prefetch" href="/blog/assets/js/99.0ad43009.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.bd3cdb54.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f0017422.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="前端那些事儿" class="logo"> <span class="site-name can-hide">前端那些事儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/" aria-current="page" class="sidebar-link">渲染模式通识</a></li><li><a href="/blog/architecture/framework/Islands.html" class="sidebar-link">了解 Islands 架构</a></li><li><a href="/blog/architecture/framework/micro-frontend.html" class="sidebar-link">微前端架构</a></li><li><a href="/blog/architecture/framework/shadowbox.html" class="sidebar-link">微前端的沙箱设计</a></li><li><a href="/blog/architecture/framework/icestark.html" class="sidebar-link">iceStack 架构设计</a></li><li><a href="/blog/architecture/framework/wujie.html" class="sidebar-link">iframe 微前端方案</a></li><li><a href="/blog/architecture/framework/lowcode-components.html" class="sidebar-link">低代码组件设计与实现</a></li><li><a href="/blog/architecture/framework/lowcode-engine.html" class="sidebar-link">低代码引擎设计与实现</a></li><li><a href="/blog/architecture/framework/ali-lowcode-engine.html" class="sidebar-link">Ali-lowcode-engine</a></li><li><a href="/blog/architecture/framework/materialin-engine.html" class="sidebar-link">入料引擎</a></li><li><a href="/blog/architecture/framework/choreography-engine.html" class="sidebar-link">编排引擎</a></li><li><a href="/blog/architecture/framework/lowcode-extend.html" class="sidebar-link">低代码扩展点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/plan/color-thief.html" class="sidebar-link">图片分类与主题色提取</a></li><li><a href="/blog/architecture/plan/i18n.html" aria-current="page" class="active sidebar-link">国际化探索实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/plan/i18n.html#手动维护" class="sidebar-link">手动维护</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/i18n.html#多语言管理系统" class="sidebar-link">多语言管理系统</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/i18n.html#核心实现" class="sidebar-link">核心实现</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/i18n.html#优化" class="sidebar-link">优化</a></li></ul></li><li><a href="/blog/architecture/plan/sdk.html" class="sidebar-link">SDK 设计</a></li><li><a href="/blog/architecture/plan/pay.html" class="sidebar-link">三方支付与收银台</a></li><li><a href="/blog/architecture/plan/tracker.html" class="sidebar-link">积分任务与埋点</a></li><li><a href="/blog/architecture/plan/virtual-list.html" class="sidebar-link">虚拟滚动与懒加载</a></li><li><a href="/blog/architecture/plan/masonry.html" class="sidebar-link">瀑布流虚拟列表实践</a></li><li><a href="/blog/architecture/plan/file-transfer.html" class="sidebar-link">大文件上传</a></li><li><a href="/blog/architecture/plan/auth.html" class="sidebar-link">登录鉴权</a></li><li><a href="/blog/architecture/plan/webTransport.html" class="sidebar-link">WebTransport</a></li><li><a href="/blog/architecture/plan/webCodecs.html" class="sidebar-link">WebCodecs</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="国际化探索实践"><a href="#国际化探索实践" class="header-anchor">#</a> 国际化探索实践</h1> <p>随着项目的不断迭代，国际化多语言的维护变得越来越困难。手动维护多语言文案在初期可能可行，但随着项目规模的扩大，手动维护的方式会变得越来越繁琐和容易出错，严重影响开发效率。从手动文案管理到发展出一套全自动化的多语言管理系统非常有必要。全自动化的多语言管理系统，可以有效提升多语言项目的开发效率，解决多语言应用开发中遇到的常见问题，包括但不限于代码中的语义清晰性、文案维护的高效率，以及性能优化等挑战。通过这一系列的改进，能够为全球用户提供更加流畅和响应迅速的使用体验，同时也为多语言应用开发提供了宝贵的实践经验和启示。</p> <ul><li><p><code>i18next</code> 是一个用于前端国际化的 JavaScript 库。它提供了一个简单易用的 API，可以帮助开发人员将应用程序本地化到多种语言。它提供了一种简洁的方式来加载翻译资源，并且支持多种资源格式（如 JSON、PO 等）。同时，也支持按需动态加载和缓存翻译资源，以提高性能和用户体验。</p></li> <li><p><a href="https://react.i18next.com/" target="_blank" rel="noopener noreferrer">react-i18next<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是基于 <code>i18next</code> 的国际化框架，支持 React、React Native、SSR，提供了一套用于在 React 应用程序中实现国际化的组件和高阶组件（<code>Trans</code>、<code>withTranslation</code>）。提供 <code>useTranslation</code>，方便在函数组件中使用国际化。</p></li> <li><p><a href="https://vue-i18n.intlify.dev/" target="_blank" rel="noopener noreferrer">vue-i18n<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 Vue.js 的国际化插件。还支持复数、数字、日期时间等本地化。支持多种语言切换策略，包括 URL 参数、浏览器语言设置和自定义逻辑。同时也支持动态按需加载和异步加载翻译资源，以提高性能和用户体验。</p></li></ul> <p>这些国际化库的用法实际上有比较多的相似点，大体上都是在代码中内置多语种文案，在业务代码中通过调用 i18n 方法，并传入对应文案的 <code>key</code>。编译的时候，会根据当前语种，读取 <code>key</code> 对应的文案并渲染。</p> <h2 id="手动维护"><a href="#手动维护" class="header-anchor">#</a> 手动维护</h2> <p>手动维护多语言存在以下困难：</p> <ul><li><strong>写法复杂，效率低</strong>：<code>t('key')</code> 的写法需要开发者时刻记住每个键对应的翻译内容，增加了心智负担。手动维护多个语言文件，容易出错，特别是当项目规模变大时。</li> <li><strong>不符合语意化</strong>：代码中充斥着大量的 key，缺乏语意化，影响代码的可读性和可维护性。产生较强的割裂感，代码的连贯性被破坏。</li> <li><strong>回溯困难</strong>：定位问题文案需要先找到 key，再通过映射关系找到内容，增加了调试难度。文案的修改和更新需要多次查找和替换，容易遗漏，<strong>这一点在实际开发中尤其影响开发者</strong>。</li> <li><strong>维护困难</strong>：内置的文案如果需要修改，必须改动代码，增加了开发人员的心智负担。多语言文件的同步和更新需要手动操作，容易出错。</li> <li><strong>代码冗余、影响性能</strong>：一个模块内的内容被重复引用，引入了不必要的文案，增加了代码体积。多语言文件的加载和解析会影响应用的启动时间和性能。</li> <li><strong>无法有效支持所有端</strong>：Web、Android、IOS、服务端等都需要自己维护一套多语言，维护困难、代码冗余、没有标准和统一。</li> <li><strong>项目迁移难度大</strong>：一个原先国内的项目要接入多语言需要做大量的文本兼容和调整。项目迁移过程中容易引入新的问题，增加开发和测试的工作量。</li></ul> <p>一般的 i18n 插件已经提高了一部分效率，但还是存在 key 的问题，比如<strong>代码入侵必须写 key、不符合语义可读性差、文案定位繁琐和遗漏、代码冗余、多端无法复用文案</strong>等问题。中央化、自动化的国际化多语言文案管理系统（例如使用在线平台 Crowdin、Locize 来管理多语言文案）可以有效解决上述问题。</p> <h2 id="多语言管理系统"><a href="#多语言管理系统" class="header-anchor">#</a> 多语言管理系统</h2> <ol><li>建立国际化管理平台。用于存储、更新和检索所有语言的文本，为不同项目、不同平台（Web、Android、IOS、服务端等）提供中央化的维护和统一的文案资源。</li> <li>多语种文案长度对比及约束。支持实时预览同一文案在不同语言下的文案长度，以便翻译人员调整文案，确保各语种版本在长度上尽可能一致，避免不同语种下产生的样式表现问题。</li> <li>多语言文案翻译上下文和场景表达。支持开发在备注说明当前文案所处的使用场景以便于翻译表达准确。</li> <li>Excel 批量导出导出文案。通过自动化插件脚本从项目代码中导出所有或指定路径的中文文案到 Excel 表格，批量上传到管理平台。也支持从平台批量导出翻译后再上传从而批量更新。</li> <li>支持机器翻译。管理平台支持 Google、百度或者 LLM 等进行自动化翻译及翻译优化。</li> <li>集成飞书机器人。开发者上传完待翻译文案后，通过飞书机器人推送消息给翻译及 Review 人员。</li> <li>版本控制及上传 CDN。使用版本控制来管理国际化文本，确保更改的可追溯性，完成后发版并上传 CDN。</li></ol> <p>有了多语言管理平台，开发流程则如下：</p> <ol><li>在多语言管理平台录入文案，或者通过自动化插件批量导出文案并上传到平台，批量录入（重复的会被过滤）。</li> <li>机器人 bot 通知翻译人员翻译。支持机器翻译，翻译人员 Review 即可。</li> <li>确认后上传到 CDN。</li> <li>前端代码中直接写 <code>$i18n('中文')</code>，而不是 Key，编译阶段通过 <code>babel-plugin-i18n</code> 插件自动替换对应的 key。</li></ol> <p><img src="/blog/images/architecture/i18n1.png" alt="i18n1"></p> <p>通过 Babel 插件分析抽象语法树（AST），识别出代码中的 <code>$i18n('中文')</code> 表达式，并将其替换成 <code>t('module:key')</code> 格式。这里的 key 其实不需要语义化的 key，只需要平台在该项目空间下生成唯一的且较短的标识，也不需要关注不同版本的 key 是否被修改或者不同，比如使用 <code>nanoid</code> 类似的短 ID 生成器，甚至数字索引。同时将嵌套的键结构扁平化，减少解析层数。</p> <p>在代码提交前，通过 <code>commit</code> 钩子扫描修改过的代码，确定新的或修改过的文案，并将其自动上传到多语言管理平台。文案上传后，自动触发平台的发布流程，更新文案版本号。</p> <p>实际在使用中，避免不了一些动态文案场景的出现(如评论区)，可以把这些文案节点打上一个动态标识，在运行时调用机器翻译。在可枚举的动态文案也可以由前端和后端约定翻译平台开放接口的使用，达到可枚举文案能够走精确翻译的模式(比方说跨境电商商品名场景)。</p> <h2 id="核心实现"><a href="#核心实现" class="header-anchor">#</a> 核心实现</h2> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span>

<span class="token comment">// 纯文本写法</span>
<span class="token keyword">const</span> text1 <span class="token operator">=</span> <span class="token function">$i18n</span><span class="token punctuation">(</span><span class="token string">'纯中文'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: &quot;纯中文&quot; 或者其他语言的翻译</span>

<span class="token comment">// 带变量的文本写法</span>
<span class="token keyword">const</span> text2 <span class="token operator">=</span> <span class="token function">$i18n</span><span class="token punctuation">(</span><span class="token string">'你好！%1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: &quot;你好！张三&quot;</span>

<span class="token comment">// 模块键值对写法</span>
<span class="token keyword">const</span> text3 <span class="token operator">=</span> <span class="token function">$i18n</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'shop'</span><span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'dress'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: &quot;连衣裙&quot; 或者其他语言的翻译</span>

<span class="token comment">// 多语言组件写法</span>
<span class="token keyword">const</span> text4 <span class="token operator">=</span> <span class="token function">$i18n</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'你好！&lt;1&gt;%1&lt;/1&gt;'</span><span class="token punctuation">,</span> <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'span'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">values</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: &quot;你好！&lt;span&gt;张三&lt;/span&gt;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="babel-plugin-i18n"><a href="#babel-plugin-i18n" class="header-anchor">#</a> babel-plugin-i18n</h3> <p>通过 Babel 插件分析抽象语法树（AST），识别出代码中的 <code>$i18n('中文')</code> 表达式，并将其替换成 <code>t('key')</code> 格式。也可以使用 jscodeshift 这种库。</p> <p>多语言资源文件 <code>i18nResources</code>，通过 i18nPlugin 加载 CDN 资源获取，见下一节。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">types</span><span class="token operator">:</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取缓存文件</span>
<span class="token keyword">function</span> <span class="token function">readCacheFile</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果文件不存在或解析失败，创建一个新的空缓存文件</span>
    <span class="token function">writeCacheFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 写入缓存文件</span>
<span class="token keyword">function</span> <span class="token function">writeCacheFile</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 辅助函数：查找对象属性</span>
<span class="token keyword">function</span> <span class="token function">findProperty</span><span class="token punctuation">(</span><span class="token parameter">properties<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">prop</span> <span class="token operator">=&gt;</span> prop<span class="token punctuation">.</span>key<span class="token punctuation">.</span>name <span class="token operator">===</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Babel 插件定义</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">types</span><span class="token operator">:</span> t<span class="token punctuation">,</span> opts <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">i18nFunctionName</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>i18nFunctionName <span class="token operator">||</span> <span class="token string">'$i18n'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">translationFunctionName</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>translationFunctionName <span class="token operator">||</span> <span class="token string">'t'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> opts<span class="token punctuation">.</span>cacheFilePath <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> i18nResources <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'i18n-transformer'</span><span class="token punctuation">,</span>
    <span class="token function">pre</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 插件在 pre 钩子中加载缓存文件，以提高效率并避免每次编译时都读取语言资源</span>
      <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token function">readCacheFile</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cacheFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      i18nResources <span class="token operator">=</span> cache<span class="token punctuation">.</span>resources <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 检查是否是 $i18n 调用</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'Identifier'</span> <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> options<span class="token punctuation">.</span>i18nFunctionName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">[</span>arg<span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isStringLiteral</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 纯文本写法</span>
            <span class="token keyword">const</span> text <span class="token operator">=</span> arg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">const</span> key <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>i18nResources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> i18nResources<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>
                t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>
                  t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>translationFunctionName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isObjectExpression</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> properties <span class="token operator">=</span> arg<span class="token punctuation">.</span>properties<span class="token punctuation">;</span>
            <span class="token keyword">const</span> hasComponentAttr <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> keyFind <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> moduleFind <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> textFind <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> valuesFind <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'values'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>moduleFind <span class="token operator">&amp;&amp;</span> keyFind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 模块键值对写法</span>
              <span class="token keyword">const</span> module <span class="token operator">=</span> moduleFind<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token keyword">const</span> key <span class="token operator">=</span> keyFind<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token keyword">const</span> languageText <span class="token operator">=</span> i18nResources<span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>languageText<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>
                  t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>
                    t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>translationFunctionName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>languageText<span class="token punctuation">)</span><span class="token punctuation">]</span>
                  <span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>textFind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 带变量的文本写法</span>
              <span class="token keyword">const</span> text <span class="token operator">=</span> textFind<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token keyword">const</span> values <span class="token operator">=</span> valuesFind <span class="token operator">?</span> valuesFind<span class="token punctuation">.</span>value <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> values <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> formattedText <span class="token operator">=</span> text<span class="token punctuation">;</span>
                Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  formattedText <span class="token operator">=</span> formattedText<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> values<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>
                  t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>formattedText<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hasComponentAttr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 多语言组件写法</span>
              <span class="token keyword">const</span> text <span class="token operator">=</span> textFind<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token function">findProperty</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token keyword">const</span> values <span class="token operator">=</span> valuesFind <span class="token operator">?</span> valuesFind<span class="token punctuation">.</span>value <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

              <span class="token keyword">const</span> reactComponents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

              text<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(&lt;\d+&gt;)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">part<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>part<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">const</span> componentKey <span class="token operator">=</span> part<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">const</span> componentName <span class="token operator">=</span> components<span class="token punctuation">[</span>componentKey<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
                  <span class="token keyword">const</span> componentValue <span class="token operator">=</span> values<span class="token punctuation">[</span>componentKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
                  reactComponents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
                    t<span class="token punctuation">.</span><span class="token function">jsxElement</span><span class="token punctuation">(</span>
                      t<span class="token punctuation">.</span><span class="token function">jsxOpeningElement</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">jsxIdentifier</span><span class="token punctuation">(</span>componentName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      t<span class="token punctuation">.</span><span class="token function">jsxClosingElement</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">jsxIdentifier</span><span class="token punctuation">(</span>componentName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">jsxText</span><span class="token punctuation">(</span>componentValue<span class="token punctuation">)</span><span class="token punctuation">]</span>
                    <span class="token punctuation">)</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  reactComponents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">jsxText</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>
                t<span class="token punctuation">.</span><span class="token function">jsxFragment</span><span class="token punctuation">(</span>
                  t<span class="token punctuation">.</span><span class="token function">jsxOpeningFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  t<span class="token punctuation">.</span><span class="token function">JSXClosingFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  reactComponents
                <span class="token punctuation">)</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br></div></div><h3 id="i18nplugin"><a href="#i18nplugin" class="header-anchor">#</a> i18nPlugin</h3> <p>以 Webpack Plugin 为例子，在 <code>compiler.hooks.watchRun.tapAsync('I18nPlugin', (compilation, callback) =&gt; {}</code> 中拉取和更新本地多语言资源并缓存文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取缓存文件</span>
<span class="token keyword">function</span> <span class="token function">readCacheFile</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果文件不存在或解析失败，创建一个新的空缓存文件</span>
    <span class="token function">writeCacheFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 写入缓存文件</span>
<span class="token keyword">function</span> <span class="token function">writeCacheFile</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取最新版本号</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchLatestVersion</span><span class="token punctuation">(</span><span class="token parameter">versionUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>versionUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to fetch version: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> version<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取多语言资源</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchI18nResources</span><span class="token punctuation">(</span><span class="token parameter">resourcesUrl<span class="token punctuation">,</span> version</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>resourcesUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to fetch i18n resources: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">I18nPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> options<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token literal-property property">versionUrl</span><span class="token operator">:</span> options<span class="token punctuation">.</span>versionUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">resourcesUrl</span><span class="token operator">:</span> options<span class="token punctuation">.</span>resourcesUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> options<span class="token punctuation">.</span>cacheFilePath <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>watchRun<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'I18nPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWorkflow</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">handleWorkflow</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 读取缓存文件</span>
      <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token function">readCacheFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>cacheFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> cachedVersion <span class="token operator">=</span> cache<span class="token punctuation">.</span>version<span class="token punctuation">;</span>

      <span class="token comment">// 获取最新版本号</span>
      <span class="token keyword">const</span> latestVersion <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchLatestVersion</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedVersion <span class="token operator">!==</span> latestVersion<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Updating i18n resources...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取最新多语言资源</span>
        <span class="token keyword">const</span> resources <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchI18nResources</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resourcesUrl<span class="token punctuation">,</span> latestVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 更新缓存文件</span>
        <span class="token function">writeCacheFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>cacheFilePath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">version</span><span class="token operator">:</span> latestVersion<span class="token punctuation">,</span> resources <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i18n resources updated.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i18n resources are up to date.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error handling workflow:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> I18nPlugin <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> I18nPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'i18n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span><span class="token string">'babel-plugin-i18n'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">i18nFunctionName</span><span class="token operator">:</span> <span class="token string">'$i18n'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">translationFunctionName</span><span class="token operator">:</span> <span class="token string">'t'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">I18nPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token comment">// 项目空间 id</span>
      <span class="token literal-property property">versionUrl</span><span class="token operator">:</span> <span class="token string">'https://your-custom-cdn-url.com/i18n/190/version.json'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">resourcesUrl</span><span class="token operator">:</span> <span class="token string">'https://your-custom-cdn-url.com/i18n/190'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 其他配置项</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> I18nPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'I18nPlugin'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-babel'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">I18nPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">190</span><span class="token punctuation">,</span>
      <span class="token literal-property property">versionUrl</span><span class="token operator">:</span> <span class="token string">'https://your-custom-cdn-url.com/i18n/190/version.json'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">resourcesUrl</span><span class="token operator">:</span> <span class="token string">'https://your-custom-cdn-url.com/i18n/190'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">babelHelpers</span><span class="token operator">:</span> <span class="token string">'bundled'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">'babel-plugin-i18n'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">i18nFunctionName</span><span class="token operator">:</span> <span class="token string">'$i18n'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">translationFunctionName</span><span class="token operator">:</span> <span class="token string">'t'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cacheFilePath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'i18n-cache.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h2 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h2> <p>一般的 i18n 插件已经提高了一部分效率，但还是存在 key 的问题，比如<strong>代码入侵必须写 key、不符合语义可读性差、文案定位繁琐和遗漏、代码冗余、多端无法复用文案、多个地方公用的 key 文案如果修改后影响范围广</strong>等问题。中央化、自动化的国际化多语言文案管理系统（例如使用在线平台 Crowdin、Locize 来管理多语言文案）可以有效解决上述问题。但多语言文案管理系统也会引入一些新的问题：</p> <ul><li>随着项目的迭代，如何解决本地文案新增、修改或删除后，如何解决未翻译，漏翻译问题？如何解决多语言平台资源同步和翻译更新的问题？</li> <li>本地文案新增、修改或删除后，开发人员需要手动维护文案，效率低，如何优化？</li> <li>本地文案新增、修改或删除后，如何同步资源后，进行调试？</li> <li>国际化多语言如何更新版本？如何使得多语言切换及时生效？</li> <li>多端复用的多语言资源，如何区分，若某一端文案新增、修改或删除后，如何不影响其他端？</li> <li>加载多语言资源是否影响性能，如何优化？</li> <li>将所有语种文案打包进项目中，这增加了首屏加载时间，如何优化？</li> <li>引入 react-i18next 类似这样的库，导致项目体积增加，如何优化？</li> <li>必须等待多语言库初始化完成后，才能进行最终渲染，影响用户体验，如何优化？</li></ul> <h3 id="自动化文案管理"><a href="#自动化文案管理" class="header-anchor">#</a> 自动化文案管理</h3> <p>随着项目的迭代，本地文案新增、修改后，由于使用的是<code>$i18n('你好')</code>这种方案，无法借助类似 vue-i18n 的 vscode 插件识别文案是否已翻译，如何解决未翻译文案识别的问题？如何未翻译，漏翻译问题？如何解决多语言平台资源同步和翻译更新的问题？</p> <p>通过自动化工具提取代码中<code>$i18n('你好')</code>的表达式，收集起一份本地文案的中文文案资源，然后与本地缓存的多语言文件（其实就是多语言平台中已翻译的文件）全量对比，生成未翻译文件并上传到平台，翻译后发布，生成最新的多语言资源文件。</p> <p>那删除的文案怎么办呢？多端复用的多语言资源，如何区分，若某一端文案新增、修改或删除后，如何不影响其他端？再多语言平台上除了key、中文、英文、项目空间、可以加一个平台字段，表示该文案在哪些平台中有用到，例如，['H5','RN']，表示在 H5、RN 中有用到，若数组为空，表示该字段可以删除了，并且多语言资源上传 CDN 时不会上传。</p> <ul><li><strong>自动提取</strong>：可以通过执行 npm 命令触发对应的脚本，例如：<code>npm run i18n</code>; 也可以在代码提交时通过 <code>git commit</code> 钩子扫描修改过的代码。通过这两种方式，与缓存文件进行对比，以确定新的或修改过的文案。然后，将这些文案自动上传到多语言管理平台。</li> <li><strong>发布更新</strong>：文案上传后，翻译并 review 后，触发平台的发布流程，主要<strong>更新文案版本号</strong>，确保在代码的<strong>热更新</strong>过程中，如果文案发生变化，文案自动替换阶段能够<strong>识别并拉取最新的文案资源</strong>。</li></ul> <h3 id="文案中嵌入变量如何生效"><a href="#文案中嵌入变量如何生效" class="header-anchor">#</a> 文案中嵌入变量如何生效</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> callee <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">;</span>
<span class="token keyword">const</span> argument <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 纯文本 将 $t('登录') 替换为 $t('user.login.btn')</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> argument<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>i18nResources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> i18nResources<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>
  t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'$t'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 动态  $t(你好！{name}, {name:'张三' }）替换 为 $t(user.info.name, {name:'张三' })</span>
<span class="token keyword">function</span> <span class="token function">getTranslationKeyByText</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> nestedKey <span class="token operator">=</span> <span class="token function">getTranslationKeyByText</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nestedKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nestedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="多语言资源加载如何优化"><a href="#多语言资源加载如何优化" class="header-anchor">#</a> 多语言资源加载如何优化</h3> <ul><li>为每个语种创建独立的静态资源构建包，通过这种多构建产物方案，我们旨在显著提高项目的加载速度和运行效率，同时维持开发过程的自动化和高效性，为用户提供更加流畅和响应快速的体验。</li> <li>懒加载多语言资源，在用户需要某个特定语言时，才动态加载对应的语言包。这种方法可以有效地减小初始加载的体积，并且可以在不影响首屏渲染的情况下，延迟加载多语言资源。使用 <code>import()</code> 动态加载语言包，并在语言初始化完成后进行渲染</li> <li>延迟语言初始化（优先渲染默认语言），尽量延迟初始化多语言功能，或者先渲染一个简化版本的页面（比如使用默认语言）。在后台异步加载多语言包时，可以并行渲染页面内容，等语言加载完成后再进行更新。</li></ul> <h3 id="一词多译如何解决"><a href="#一词多译如何解决" class="header-anchor">#</a> 一词多译如何解决</h3> <p>一词多译指的是一个词在不同的地方要翻译显示为不同的内容。 比如 <code>$i18n('确定')</code>，可能在不同的场合下，会分别需要被翻译成 OK、Confirm、Yes、Sure 等，但是提取内容时则提取的都是同一个词<code>确定</code>，这就导致无法做到一词多译，有两种解决办法：</p> <ul><li>还是要用 key：相同的文案，不同的语意，不同的 key，即还是需要唯一的 key，来解决一词多译问题，不能直接以中文作为 key。</li> <li>采用插值变量注释：在提取和编译时就会被识别为确定的一词多译，而插值变量 OK、Confirm、Yes、Sure 如果没有为之提供对应的变量会被忽略，仅起占位注释的作用。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">&quot;确定{ok}&quot;</span><span class="token punctuation">)</span>
<span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">&quot;确定{confirm}&quot;</span><span class="token punctuation">)</span>
<span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">&quot;确定{yes}&quot;</span><span class="token punctuation">)</span>
<span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">&quot;确定{sure}&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="为什么不直接用中文作-key"><a href="#为什么不直接用中文作-key" class="header-anchor">#</a> 为什么不直接用中文作 key</h3> <p>有人疑惑为什么不直接用中文作 key，类似下面的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// en.js</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;中华人民共和国&quot;</span><span class="token operator">:</span><span class="token string">&quot;the people's Republic of China&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// jp.js</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;中华人民共和国&quot;</span><span class="token operator">:</span><span class="token string">&quot;中華人民共和国&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>直接使用文本内容作为 key，虽然符合直觉，但是会造成大量的冗余信息；对于同一个文本，在不同的语言文件中都需要重复存储，导致存储空间的浪费。</li> <li>由于 key 过长且可能包含特殊字符，索引效率会受到影响，导致查询速度变慢。</li> <li>文本内容作为 key，不太好解决一词多译问题。</li></ul> <p>通过 <code>babel-plugin</code> 将 <code>$t(&quot;中文&quot;)</code> 自动更改为 <code>$t(key)</code> , 消除了重复冗余信息。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//idMap.js</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;中华人民共和国万岁&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// en.js</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Long live the people's Republic of China&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// jp.js</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;中華人民共和国&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/architecture/plan/color-thief.html" class="prev">
        图片分类与主题色提取
      </a></span> <span class="next"><a href="/blog/architecture/plan/sdk.html">
        SDK 设计
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.1648de87.js" defer></script><script src="/blog/assets/js/2.dec2e75d.js" defer></script><script src="/blog/assets/js/1.5b9e135c.js" defer></script><script src="/blog/assets/js/41.1ee9b580.js" defer></script><script src="/blog/assets/js/20.badbb211.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图片主题色智能提取 | 前端那些事儿</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f0017422.css" as="style"><link rel="preload" href="/blog/assets/js/app.9837e659.js" as="script"><link rel="preload" href="/blog/assets/js/2.dec2e75d.js" as="script"><link rel="preload" href="/blog/assets/js/1.5b9e135c.js" as="script"><link rel="preload" href="/blog/assets/js/38.3bd3223e.js" as="script"><link rel="preload" href="/blog/assets/js/20.badbb211.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc7e09f3.js"><link rel="prefetch" href="/blog/assets/js/100.f407730f.js"><link rel="prefetch" href="/blog/assets/js/101.e710c448.js"><link rel="prefetch" href="/blog/assets/js/102.92ae6c17.js"><link rel="prefetch" href="/blog/assets/js/103.007f3b3b.js"><link rel="prefetch" href="/blog/assets/js/104.3ac72f8c.js"><link rel="prefetch" href="/blog/assets/js/105.51d5c599.js"><link rel="prefetch" href="/blog/assets/js/106.ec3a526e.js"><link rel="prefetch" href="/blog/assets/js/107.65ac35b9.js"><link rel="prefetch" href="/blog/assets/js/108.d54d25b8.js"><link rel="prefetch" href="/blog/assets/js/109.9ce45aeb.js"><link rel="prefetch" href="/blog/assets/js/11.b60c9933.js"><link rel="prefetch" href="/blog/assets/js/110.c94559a0.js"><link rel="prefetch" href="/blog/assets/js/111.8cc6ddf5.js"><link rel="prefetch" href="/blog/assets/js/112.c5825e87.js"><link rel="prefetch" href="/blog/assets/js/113.d8439f83.js"><link rel="prefetch" href="/blog/assets/js/114.ab5f5072.js"><link rel="prefetch" href="/blog/assets/js/115.d3485e67.js"><link rel="prefetch" href="/blog/assets/js/116.f8ba423b.js"><link rel="prefetch" href="/blog/assets/js/117.180e779f.js"><link rel="prefetch" href="/blog/assets/js/118.750bc66b.js"><link rel="prefetch" href="/blog/assets/js/119.d19dce29.js"><link rel="prefetch" href="/blog/assets/js/12.c53283e7.js"><link rel="prefetch" href="/blog/assets/js/120.22ba4b52.js"><link rel="prefetch" href="/blog/assets/js/121.87173c2d.js"><link rel="prefetch" href="/blog/assets/js/122.b1f1b9fb.js"><link rel="prefetch" href="/blog/assets/js/123.e9084f07.js"><link rel="prefetch" href="/blog/assets/js/124.8c82e91e.js"><link rel="prefetch" href="/blog/assets/js/125.ca6489cb.js"><link rel="prefetch" href="/blog/assets/js/126.378839fe.js"><link rel="prefetch" href="/blog/assets/js/127.b600c029.js"><link rel="prefetch" href="/blog/assets/js/128.9963fdfe.js"><link rel="prefetch" href="/blog/assets/js/129.1ca648c8.js"><link rel="prefetch" href="/blog/assets/js/13.6bdc6b5d.js"><link rel="prefetch" href="/blog/assets/js/130.c5db444e.js"><link rel="prefetch" href="/blog/assets/js/131.02af2a08.js"><link rel="prefetch" href="/blog/assets/js/132.ebb38ddb.js"><link rel="prefetch" href="/blog/assets/js/133.251e8237.js"><link rel="prefetch" href="/blog/assets/js/134.b3a2005a.js"><link rel="prefetch" href="/blog/assets/js/135.ceaea81f.js"><link rel="prefetch" href="/blog/assets/js/136.708d09cd.js"><link rel="prefetch" href="/blog/assets/js/137.769f82b6.js"><link rel="prefetch" href="/blog/assets/js/138.ed5273c1.js"><link rel="prefetch" href="/blog/assets/js/139.0ec298d0.js"><link rel="prefetch" href="/blog/assets/js/14.c3201a23.js"><link rel="prefetch" href="/blog/assets/js/140.ef7d45db.js"><link rel="prefetch" href="/blog/assets/js/141.b31aecb7.js"><link rel="prefetch" href="/blog/assets/js/142.e2f2edf6.js"><link rel="prefetch" href="/blog/assets/js/143.a79a1b8f.js"><link rel="prefetch" href="/blog/assets/js/144.c1bb7148.js"><link rel="prefetch" href="/blog/assets/js/145.1cb14eaf.js"><link rel="prefetch" href="/blog/assets/js/146.8d9dde4e.js"><link rel="prefetch" href="/blog/assets/js/147.78b2f8de.js"><link rel="prefetch" href="/blog/assets/js/148.84ee2591.js"><link rel="prefetch" href="/blog/assets/js/149.a8fcad8c.js"><link rel="prefetch" href="/blog/assets/js/15.a0b9e44e.js"><link rel="prefetch" href="/blog/assets/js/150.853d6fec.js"><link rel="prefetch" href="/blog/assets/js/151.8fa74781.js"><link rel="prefetch" href="/blog/assets/js/152.e12ddf86.js"><link rel="prefetch" href="/blog/assets/js/153.bad961d8.js"><link rel="prefetch" href="/blog/assets/js/154.0c39368e.js"><link rel="prefetch" href="/blog/assets/js/155.e93c114d.js"><link rel="prefetch" href="/blog/assets/js/156.8ce4347d.js"><link rel="prefetch" href="/blog/assets/js/157.48b977cc.js"><link rel="prefetch" href="/blog/assets/js/158.39b54506.js"><link rel="prefetch" href="/blog/assets/js/159.d49ec073.js"><link rel="prefetch" href="/blog/assets/js/16.491191e4.js"><link rel="prefetch" href="/blog/assets/js/160.d7012a28.js"><link rel="prefetch" href="/blog/assets/js/161.494c9bc2.js"><link rel="prefetch" href="/blog/assets/js/162.0abd7a20.js"><link rel="prefetch" href="/blog/assets/js/163.111ecfe7.js"><link rel="prefetch" href="/blog/assets/js/164.85270af9.js"><link rel="prefetch" href="/blog/assets/js/165.c3f31a14.js"><link rel="prefetch" href="/blog/assets/js/166.e9700b8e.js"><link rel="prefetch" href="/blog/assets/js/167.e0bd86d4.js"><link rel="prefetch" href="/blog/assets/js/168.4222e8a4.js"><link rel="prefetch" href="/blog/assets/js/169.6dc77fa7.js"><link rel="prefetch" href="/blog/assets/js/17.89ec8c57.js"><link rel="prefetch" href="/blog/assets/js/170.aea06188.js"><link rel="prefetch" href="/blog/assets/js/171.a1ff9eb5.js"><link rel="prefetch" href="/blog/assets/js/172.491152b1.js"><link rel="prefetch" href="/blog/assets/js/173.f1255242.js"><link rel="prefetch" href="/blog/assets/js/174.c07f4625.js"><link rel="prefetch" href="/blog/assets/js/175.52685a26.js"><link rel="prefetch" href="/blog/assets/js/176.d2b201cc.js"><link rel="prefetch" href="/blog/assets/js/177.5f804b7b.js"><link rel="prefetch" href="/blog/assets/js/178.66c68565.js"><link rel="prefetch" href="/blog/assets/js/179.88fafeef.js"><link rel="prefetch" href="/blog/assets/js/18.b91f1411.js"><link rel="prefetch" href="/blog/assets/js/180.2ce35692.js"><link rel="prefetch" href="/blog/assets/js/181.1a5bf5bc.js"><link rel="prefetch" href="/blog/assets/js/182.7ca07676.js"><link rel="prefetch" href="/blog/assets/js/183.75aa3a08.js"><link rel="prefetch" href="/blog/assets/js/184.7ff9cca9.js"><link rel="prefetch" href="/blog/assets/js/185.e8f9ce10.js"><link rel="prefetch" href="/blog/assets/js/186.0f193ac2.js"><link rel="prefetch" href="/blog/assets/js/187.cf13dc5f.js"><link rel="prefetch" href="/blog/assets/js/188.8d3d4137.js"><link rel="prefetch" href="/blog/assets/js/189.3b5645ab.js"><link rel="prefetch" href="/blog/assets/js/19.cb1f17c8.js"><link rel="prefetch" href="/blog/assets/js/190.abc7168c.js"><link rel="prefetch" href="/blog/assets/js/191.8f3ab0bf.js"><link rel="prefetch" href="/blog/assets/js/192.469ea5f2.js"><link rel="prefetch" href="/blog/assets/js/193.ee6cd77f.js"><link rel="prefetch" href="/blog/assets/js/194.daa9a187.js"><link rel="prefetch" href="/blog/assets/js/195.75c93135.js"><link rel="prefetch" href="/blog/assets/js/196.dbd8a40b.js"><link rel="prefetch" href="/blog/assets/js/197.a94f776a.js"><link rel="prefetch" href="/blog/assets/js/198.2cacb2de.js"><link rel="prefetch" href="/blog/assets/js/199.e9dd4d47.js"><link rel="prefetch" href="/blog/assets/js/200.eaee179b.js"><link rel="prefetch" href="/blog/assets/js/201.b3551172.js"><link rel="prefetch" href="/blog/assets/js/202.ec987871.js"><link rel="prefetch" href="/blog/assets/js/203.a72779ab.js"><link rel="prefetch" href="/blog/assets/js/204.568bb2e0.js"><link rel="prefetch" href="/blog/assets/js/205.0e2bf8f2.js"><link rel="prefetch" href="/blog/assets/js/206.be633b8e.js"><link rel="prefetch" href="/blog/assets/js/207.d08f28d3.js"><link rel="prefetch" href="/blog/assets/js/208.fa9b3b68.js"><link rel="prefetch" href="/blog/assets/js/209.67f84e35.js"><link rel="prefetch" href="/blog/assets/js/21.bf0041b7.js"><link rel="prefetch" href="/blog/assets/js/210.a922706f.js"><link rel="prefetch" href="/blog/assets/js/211.570b852b.js"><link rel="prefetch" href="/blog/assets/js/212.58f36cb1.js"><link rel="prefetch" href="/blog/assets/js/213.b1deb858.js"><link rel="prefetch" href="/blog/assets/js/214.608a4396.js"><link rel="prefetch" href="/blog/assets/js/215.065c0928.js"><link rel="prefetch" href="/blog/assets/js/216.5bc75d74.js"><link rel="prefetch" href="/blog/assets/js/217.f4aac988.js"><link rel="prefetch" href="/blog/assets/js/218.5be98fcb.js"><link rel="prefetch" href="/blog/assets/js/219.1caa396f.js"><link rel="prefetch" href="/blog/assets/js/22.48390d4f.js"><link rel="prefetch" href="/blog/assets/js/220.a3f723c8.js"><link rel="prefetch" href="/blog/assets/js/221.037c4806.js"><link rel="prefetch" href="/blog/assets/js/222.21e215d8.js"><link rel="prefetch" href="/blog/assets/js/23.35c4ba93.js"><link rel="prefetch" href="/blog/assets/js/24.cc3b12df.js"><link rel="prefetch" href="/blog/assets/js/25.632a83cc.js"><link rel="prefetch" href="/blog/assets/js/26.574f1fc1.js"><link rel="prefetch" href="/blog/assets/js/27.cc85ad1c.js"><link rel="prefetch" href="/blog/assets/js/28.3cdce864.js"><link rel="prefetch" href="/blog/assets/js/29.30b592e7.js"><link rel="prefetch" href="/blog/assets/js/3.cb0627fa.js"><link rel="prefetch" href="/blog/assets/js/30.ac572eff.js"><link rel="prefetch" href="/blog/assets/js/31.6958a252.js"><link rel="prefetch" href="/blog/assets/js/32.1ab00675.js"><link rel="prefetch" href="/blog/assets/js/33.bb4f6f93.js"><link rel="prefetch" href="/blog/assets/js/34.2eae6294.js"><link rel="prefetch" href="/blog/assets/js/35.f31ea17d.js"><link rel="prefetch" href="/blog/assets/js/36.7787a61a.js"><link rel="prefetch" href="/blog/assets/js/37.6ecbc381.js"><link rel="prefetch" href="/blog/assets/js/39.51208fdd.js"><link rel="prefetch" href="/blog/assets/js/4.cbb57fa7.js"><link rel="prefetch" href="/blog/assets/js/40.5d83aef7.js"><link rel="prefetch" href="/blog/assets/js/41.70c71269.js"><link rel="prefetch" href="/blog/assets/js/42.94c5bac3.js"><link rel="prefetch" href="/blog/assets/js/43.26e97bca.js"><link rel="prefetch" href="/blog/assets/js/44.5ea4ef3f.js"><link rel="prefetch" href="/blog/assets/js/45.df6bb47c.js"><link rel="prefetch" href="/blog/assets/js/46.a2bf386e.js"><link rel="prefetch" href="/blog/assets/js/47.d179f5ad.js"><link rel="prefetch" href="/blog/assets/js/48.15365f7f.js"><link rel="prefetch" href="/blog/assets/js/49.9650e5b0.js"><link rel="prefetch" href="/blog/assets/js/5.fe065607.js"><link rel="prefetch" href="/blog/assets/js/50.d0df511a.js"><link rel="prefetch" href="/blog/assets/js/51.f98265a0.js"><link rel="prefetch" href="/blog/assets/js/52.cb5e6632.js"><link rel="prefetch" href="/blog/assets/js/53.bea77bac.js"><link rel="prefetch" href="/blog/assets/js/54.1e1ac697.js"><link rel="prefetch" href="/blog/assets/js/55.06335ff1.js"><link rel="prefetch" href="/blog/assets/js/56.a0ae32a3.js"><link rel="prefetch" href="/blog/assets/js/57.409df2b0.js"><link rel="prefetch" href="/blog/assets/js/58.a0879de6.js"><link rel="prefetch" href="/blog/assets/js/59.81f74678.js"><link rel="prefetch" href="/blog/assets/js/6.68cda050.js"><link rel="prefetch" href="/blog/assets/js/60.fd3d88ca.js"><link rel="prefetch" href="/blog/assets/js/61.ea01bbda.js"><link rel="prefetch" href="/blog/assets/js/62.fa5f76a2.js"><link rel="prefetch" href="/blog/assets/js/63.e8d268a6.js"><link rel="prefetch" href="/blog/assets/js/64.10f55bc1.js"><link rel="prefetch" href="/blog/assets/js/65.748a4832.js"><link rel="prefetch" href="/blog/assets/js/66.f95f198d.js"><link rel="prefetch" href="/blog/assets/js/67.f0353093.js"><link rel="prefetch" href="/blog/assets/js/68.306f460b.js"><link rel="prefetch" href="/blog/assets/js/69.392e6d71.js"><link rel="prefetch" href="/blog/assets/js/7.3b8d63a0.js"><link rel="prefetch" href="/blog/assets/js/70.26512a69.js"><link rel="prefetch" href="/blog/assets/js/71.239a5a8f.js"><link rel="prefetch" href="/blog/assets/js/72.d0ea4edf.js"><link rel="prefetch" href="/blog/assets/js/73.856657a3.js"><link rel="prefetch" href="/blog/assets/js/74.ba38dc63.js"><link rel="prefetch" href="/blog/assets/js/75.90e06085.js"><link rel="prefetch" href="/blog/assets/js/76.6bcf1a10.js"><link rel="prefetch" href="/blog/assets/js/77.093602d7.js"><link rel="prefetch" href="/blog/assets/js/78.ac7dbe12.js"><link rel="prefetch" href="/blog/assets/js/79.cbbe5904.js"><link rel="prefetch" href="/blog/assets/js/80.f495d4e1.js"><link rel="prefetch" href="/blog/assets/js/81.edd69d51.js"><link rel="prefetch" href="/blog/assets/js/82.2c9d8453.js"><link rel="prefetch" href="/blog/assets/js/83.03e9ee6b.js"><link rel="prefetch" href="/blog/assets/js/84.6bb0ac83.js"><link rel="prefetch" href="/blog/assets/js/85.7f5e8913.js"><link rel="prefetch" href="/blog/assets/js/86.f6653aaa.js"><link rel="prefetch" href="/blog/assets/js/87.df8a6c8e.js"><link rel="prefetch" href="/blog/assets/js/88.d51df031.js"><link rel="prefetch" href="/blog/assets/js/89.4b9169f0.js"><link rel="prefetch" href="/blog/assets/js/90.a2086ea4.js"><link rel="prefetch" href="/blog/assets/js/91.3ef43b1d.js"><link rel="prefetch" href="/blog/assets/js/92.3e888f94.js"><link rel="prefetch" href="/blog/assets/js/93.7250eb45.js"><link rel="prefetch" href="/blog/assets/js/94.5f5b58fd.js"><link rel="prefetch" href="/blog/assets/js/95.f5f2c0d1.js"><link rel="prefetch" href="/blog/assets/js/96.8e694323.js"><link rel="prefetch" href="/blog/assets/js/97.170796d2.js"><link rel="prefetch" href="/blog/assets/js/98.c63ad3c6.js"><link rel="prefetch" href="/blog/assets/js/99.f0de0b40.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.bd3cdb54.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f0017422.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="前端那些事儿" class="logo"> <span class="site-name can-hide">前端那些事儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link router-link-active">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/" aria-current="page" class="sidebar-link">渲染模式通识</a></li><li><a href="/blog/architecture/framework/Islands.html" class="sidebar-link">了解 Islands 架构</a></li><li><a href="/blog/architecture/framework/micro-frontend.html" class="sidebar-link">微前端架构</a></li><li><a href="/blog/architecture/framework/shadowbox.html" class="sidebar-link">微前端的沙箱设计</a></li><li><a href="/blog/architecture/framework/icestark.html" class="sidebar-link">iceStack 架构设计</a></li><li><a href="/blog/architecture/framework/wujie.html" class="sidebar-link">iframe 微前端方案</a></li><li><a href="/blog/architecture/framework/lowcode-components.html" class="sidebar-link">低代码组件设计与实现</a></li><li><a href="/blog/architecture/framework/lowcode-engine.html" class="sidebar-link">低代码引擎设计与实现</a></li><li><a href="/blog/architecture/framework/ali-lowcode-engine.html" class="sidebar-link">Ali-lowcode-engine</a></li><li><a href="/blog/architecture/framework/materialin-engine.html" class="sidebar-link">入料引擎</a></li><li><a href="/blog/architecture/framework/choreography-engine.html" class="sidebar-link">编排引擎</a></li><li><a href="/blog/architecture/framework/lowcode-extend.html" class="sidebar-link">低代码扩展点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/architecture/plan/i18n.html" class="sidebar-link">国际化探索实践</a></li><li><a href="/blog/architecture/plan/color-thief.html" aria-current="page" class="active sidebar-link">图片主题色智能提取</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/plan/color-thief.html#实现方案" class="sidebar-link">实现方案</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/plan/color-thief.html#提取算法" class="sidebar-link">提取算法</a></li></ul></li><li><a href="/blog/architecture/plan/pay.html" class="sidebar-link">三方支付与收银台</a></li><li><a href="/blog/architecture/plan/tracker.html" class="sidebar-link">积分任务与埋点</a></li><li><a href="/blog/architecture/plan/virtual-list.html" class="sidebar-link">无限滚动虚拟列表</a></li><li><a href="/blog/architecture/plan/masonry.html" class="sidebar-link">瀑布流虚拟列表实践</a></li><li><a href="/blog/architecture/plan/file-transfer.html" class="sidebar-link">大文件上传</a></li><li><a href="/blog/architecture/plan/webTransport.html" class="sidebar-link">WebTransport</a></li><li><a href="/blog/architecture/plan/webCodecs.html" class="sidebar-link">WebCodecs</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="图片主题色智能提取"><a href="#图片主题色智能提取" class="header-anchor">#</a> 图片主题色智能提取</h1> <p>图片主题色的提取是图像处理中的一个常见需求，例如音频播放器根据封面图动态显示背景色，配合封面图起到很好视觉效果，沉浸式的用户体验。图片主题色提取也在图像分类，搜索识别等方面有利用。</p> <p>下面以音频播放器场景为例，提取封面图主题色，动态显示播放器的背景色。</p> <h2 id="实现方案"><a href="#实现方案" class="header-anchor">#</a> 实现方案</h2> <p>在实际应用中可直接使用类似 <code>ColorThief</code> 这样的库。这里主要介绍图片主题色提取的实现方案和原理。</p> <p>一般的技术方案主要为以下几个步骤：</p> <ul><li><p><strong>获取图片数据</strong>：使用 canvas 元素来获取图片的像素数据。首先，需要通过 <code>drawImage()</code> 方法将图片绘制到 canvas 上，然后通过 <code>getImageData()</code> 方法获取图片的像素数据。这个过程需要确保图片已经加载完成，否则可能会获取到错误的数据。如果图片较多，为了不影响主线程性能，可以使用 OffscreenCanvas 在 Web Worker 中进行 Canvas 离屏渲染，这样可以避免主线程被密集的计算任务阻塞。</p></li> <li><p><strong>空间转换与预处理</strong>：将图片从 RGB 颜色空间转换到更适合处理的颜色空间，如 HSV 或 LAB。为了减少计算量并提高提取算法的准确性，可通过降噪、缩放、去皮等对数据进行预处理。例如，通过高斯滤波、均值滤波、中值滤波等方式对图像降噪处理去除图像中的干扰。</p></li> <li><p><strong>提取主题色</strong>：采用颜色量化算法进行颜色提取。常用的颜色量化算法有最小差值法、中位切分法、八叉树算法、聚类、色彩建模法等。其中聚类和色彩建模法需要对提取函数和样本、特征变量等进行调参和回归计算不太适用于 JS 实践。</p></li> <li><p><strong>设置背景色主题色</strong>：将提取出的主题色设置到对应元素上。</p></li> <li><p><strong>优化调整</strong>：可根据实际效果进行调整，比如通过间隔采样、优化切割点查找等方式来优化性能和准确性。</p></li></ul> <h2 id="提取算法"><a href="#提取算法" class="header-anchor">#</a> 提取算法</h2> <p>颜色量化（Color Quantization）是一种减少图像中颜色数量的技术，它将图像从高颜色深度转换为低颜色深度，同时尽量保持图像的视觉质量。颜色量化通常用于：图像压缩与传输、索引颜色图像的创建（调色板）等。常见的颜色量化算法有：</p> <ol><li><strong>中位切分法（Median Cut）</strong>：中位切分法是一种颜色量化算法，它将颜色空间划分为多个区域，并计算每个区域的中位色作为该区域的主题色。算法从整个图像作为一个长方体开始，选择 RGB 中最长的一边从颜色统计的中位数一切为二，使得到的两个长方体所包含的像素数量相同，重复上述步骤，直到最终切分得到长方体的数量等于主题颜色数量为止。</li></ol> <ul><li>优点：可以很好地保持图像中颜色的分布，适用于快速获取主题色，并且对图像细节不太关心的场景。</li> <li>缺点：在某些条件下，可能会存在体积大但只包含少量像素的长方体，导致颜色表示不准确。此外，算法的运行时间可能会较长。</li></ul> <ol start="2"><li><strong>八叉树算法（Octree）</strong>：八叉树算法将颜色空间划分为一个八叉树结构，每个节点代表一个颜色区域。通过递归地将颜色空间划分为更小的区域来提取主题色。颜色成分转换成二进制后，较低位的数值被压缩进较高位，从而实现颜色的量化。</li></ol> <ul><li>优点：可以保留更多的细节信息，适用于需要精细颜色量化的场景。</li> <li>缺点：计算量较大，对于大规模图像数据，可能会有性能瓶颈。</li></ul> <ol start="3"><li><strong>K-Means聚类算法</strong>：一种无监督学习算法，用于将数据点分成 K 个簇。在图像主题色提取中，每个像素点被视为一个数据点，通过迭代计算，将像素点分配到最近的簇中心，从而形成主题色。算法开始时随机选择 K 个像素作为初始簇中心，然后通过迭代过程，不断更新簇中心，直到满足停止条件（如达到最大迭代次数或簇中心变化小于某个阈值）。</li></ol> <ul><li>优点：简单易懂，实现容易，对于大规模数据集相对高效。</li> <li>缺点：对初始簇中心的选择敏感，可能导致不同的结果。对于颜色空间的分布不均匀的问题，可能无法得到最佳的聚类效果。此外，K 值的选择也对结果有较大影响，但并没有一个统一的标准来确定最优的 K 值。</li></ul> <ol start="4"><li><strong>最小差值法</strong>：最小差值法是在给定调色板的情况下，找到与色差最小的颜色。对于每个像素，算法会计算它与调色板中每种颜色的差距，选择差距最小的颜色作为代表色。</li></ol> <ul><li>优点：实现简单，对于有固定调色板的应用场景非常适用。</li> <li>缺点：对于没有固定调色板的场景，需要预先定义调色板，这可能限制了算法的适用性。此外，对于色彩分布不均匀的图像，可能无法得到最佳的颜色表示。</li></ul> <ol start="5"><li><strong>流行色算法</strong>：流行色算法选择图像中出现频率最高的 K 个颜色作为图像的颜色映射表，然后计算选择映射表中距离图像各像素颜色值最近的颜色作为该像素的映射颜色。</li></ol> <ul><li>优点：能够保留图像中的主要颜色，对于颜色分布集中的图像效果较好。</li> <li>缺点：在计算过程中寻找最高频 K 颜色时将十分消耗内存，同时，做颜色映射的距离度量方式虽然可以有多种选择，但是最终得到的效果也相对较差。</li></ul> <h3 id="中位切分法"><a href="#中位切分法" class="header-anchor">#</a> 中位切分法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 对给定的颜色数组执行中位数切割算法。
 * @param {Array} colors - 颜色数组，每个元素是一个包含r, g, b属性的对象。
 * @param {number} maxColors - 最终想要得到的颜色数量。
 * @returns {Array} - 返回一个包含最终颜色的数组。
 */</span>
<span class="token keyword">function</span> <span class="token function">medianCut</span><span class="token punctuation">(</span><span class="token parameter">colors<span class="token punctuation">,</span> maxColors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>colors<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> maxColors<span class="token punctuation">)</span> <span class="token keyword">return</span> colors<span class="token punctuation">;</span>

    <span class="token keyword">let</span> boxes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Box</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>boxes<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> maxColors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> boxToSplit <span class="token operator">=</span> boxes<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">maxBox<span class="token punctuation">,</span> box</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> box<span class="token punctuation">.</span>range <span class="token operator">&gt;</span> maxBox<span class="token punctuation">.</span>range <span class="token operator">?</span> box <span class="token operator">:</span> maxBox<span class="token punctuation">,</span> boxes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> newBoxes <span class="token operator">=</span> boxToSplit<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boxes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>boxes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>boxToSplit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>newBoxes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> boxes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">box</span> <span class="token operator">=&gt;</span> box<span class="token punctuation">.</span><span class="token function">getAverageColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">colors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> colors<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">calculateRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> minR <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">,</span> maxR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            minG <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">,</span> maxG <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            minB <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">,</span> maxB <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> minR<span class="token punctuation">)</span> minR <span class="token operator">=</span> color<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>r <span class="token operator">&gt;</span> maxR<span class="token punctuation">)</span> maxR <span class="token operator">=</span> color<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>g <span class="token operator">&lt;</span> minG<span class="token punctuation">)</span> minG <span class="token operator">=</span> color<span class="token punctuation">.</span>g<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>g <span class="token operator">&gt;</span> maxG<span class="token punctuation">)</span> maxG <span class="token operator">=</span> color<span class="token punctuation">.</span>g<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>b <span class="token operator">&lt;</span> minB<span class="token punctuation">)</span> minB <span class="token operator">=</span> color<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">.</span>b <span class="token operator">&gt;</span> maxB<span class="token punctuation">)</span> maxB <span class="token operator">=</span> color<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>range <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxR <span class="token operator">-</span> minR<span class="token punctuation">,</span> maxG <span class="token operator">-</span> minG<span class="token punctuation">,</span> maxB <span class="token operator">-</span> minB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> channel <span class="token operator">=</span> <span class="token string">'r'</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> maxRange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>range<span class="token punctuation">;</span>

        <span class="token comment">// 确定哪个通道的范围最大</span>
        <span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> range <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=&gt;</span> color<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=&gt;</span> color<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>range <span class="token operator">&gt;</span> maxRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                maxRange <span class="token operator">=</span> range<span class="token punctuation">;</span>
                channel <span class="token operator">=</span> c<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 根据最大范围的通道排序并切割</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> midIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Box</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> midIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Box</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>midIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getAverageColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> totalR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> totalG <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> totalB <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            totalR <span class="token operator">+=</span> color<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            totalG <span class="token operator">+=</span> color<span class="token punctuation">.</span>g<span class="token punctuation">;</span>
            totalB <span class="token operator">+=</span> color<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">r</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>totalR <span class="token operator">/</span> count<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">g</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>totalG <span class="token operator">/</span> count<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">b</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>totalB <span class="token operator">/</span> count<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试用例：</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 假设这里已经有一张图片绘制在canvas上</span>
    <span class="token comment">// 例如：ctx.drawImage(image, 0, 0);</span>

    <span class="token comment">// 获取图像数据</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

    <span class="token comment">// 提取颜色数据</span>
    <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> r <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> g <span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> b <span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以选择忽略透明度为0的像素</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 应用中位数切割算法</span>
    <span class="token keyword">const</span> resultColors <span class="token operator">=</span> <span class="token function">medianCut</span><span class="token punctuation">(</span>colors<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设我们希望得到5种主要颜色</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resultColors<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><h3 id="八叉树算法"><a href="#八叉树算法" class="header-anchor">#</a> 八叉树算法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>

<span class="token comment">/**
 * 八叉树类
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Octree</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxDepth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 八叉树的最大深度</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>colorMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 存储最终的颜色映射</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加颜色到八叉树
     * @param {Object} color - 包含r, g, b属性的颜色对象
     */</span>
    <span class="token function">addColor</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OctreeNode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 减少颜色数量
     * @param {number} maxColors - 最终想要得到的颜色数量
     * @returns {Array} - 返回一个包含最终颜色的数组
     */</span>
    <span class="token function">reduceColors</span><span class="token punctuation">(</span><span class="token parameter">maxColors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLeafNodes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodes<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>volume <span class="token operator">-</span> a<span class="token punctuation">.</span>volume<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> maxColors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> node <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            node<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateParentVolumes</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildColorMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>colorMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取所有叶子节点
     * @param {OctreeNode} node - 当前节点
     * @returns {Array} - 返回所有叶子节点的数组
     */</span>
    <span class="token function">getLeafNodes</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> leafNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            leafNodes <span class="token operator">=</span> leafNodes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLeafNodes</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> leafNodes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 更新父节点的体积
     * @param {OctreeNode} node - 当前节点
     */</span>
    <span class="token function">updateParentVolumes</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span><span class="token function">calculateVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateParentVolumes</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 构建颜色映射
     * @param {OctreeNode} node - 当前节点
     */</span>
    <span class="token function">buildColorMap</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>colorMap<span class="token punctuation">[</span>node<span class="token punctuation">.</span>averageColor<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">.</span>averageColor<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildColorMap</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 八叉树节点类
 */</span>
<span class="token keyword">class</span> <span class="token class-name">OctreeNode</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">depth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>depth <span class="token operator">=</span> depth<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>volume <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalG <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalB <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 插入颜色到节点
     * @param {Object} color - 包含r, g, b属性的颜色对象
     * @param {number} level - 当前深度
     */</span>
    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> level</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depth <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalR <span class="token operator">+=</span> color<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalG <span class="token operator">+=</span> color<span class="token punctuation">.</span>g<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalB <span class="token operator">+=</span> color<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OctreeNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 计算节点的体积
     */</span>
    <span class="token function">calculateVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>volume <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取颜色在当前深度的索引
     * @param {Object} color - 包含r, g, b属性的颜色对象
     * @param {number} level - 当前深度
     * @returns {number} - 返回索引
     */</span>
    <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> level</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token number">0x80</span> <span class="token operator">&gt;&gt;</span> level<span class="token punctuation">;</span>
        <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>r <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>g <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>b <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>g <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 减少节点
     */</span>
    <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取节点的平均颜色
     * @returns {Object} - 包含r, g, b属性的颜色对象
     */</span>
    <span class="token keyword">get</span> <span class="token function">averageColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">r</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalR <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">g</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalG <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">b</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalB <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixelCount<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 假设这里已经有一张图片绘制在canvas上</span>
    <span class="token comment">// 例如：ctx.drawImage(image, 0, 0);</span>

    <span class="token comment">// 获取图像数据</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

    <span class="token comment">// 提取颜色数据</span>
    <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> r <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> g <span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> b <span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以选择忽略透明度为0的像素</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> octree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Octree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=&gt;</span> octree<span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> resultColors <span class="token operator">=</span> octree<span class="token punctuation">.</span><span class="token function">reduceColors</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设我们希望得到5种主要颜色</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resultColors<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br></div></div><p>中位切分法适用于资源有限且需要快速提取图像主题色的场景，尤其适合实时或大规模处理需求。它的简单性和计算效率使其在这些场景下成为很好的选择，尤其是当主要目标是从图像中快速捕捉主题颜色而不需要过多考虑细节和渐变色时。而八叉树在动态适应性和处理颜色渐变方面具有优势，适用于需要保持细节不和平滑度的图像颜色提取任务，但其算法复杂度较高，内存消耗较大。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/architecture/plan/i18n.html" class="prev">
        国际化探索实践
      </a></span> <span class="next"><a href="/blog/architecture/plan/pay.html">
        三方支付与收银台
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.9837e659.js" defer></script><script src="/blog/assets/js/2.dec2e75d.js" defer></script><script src="/blog/assets/js/1.5b9e135c.js" defer></script><script src="/blog/assets/js/38.3bd3223e.js" defer></script><script src="/blog/assets/js/20.badbb211.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 组件及通信 | 前端那些事儿</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/logo.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/images/icons/apple-icon-152x152.png">
    <meta name="description" content="我命由我不由天，学习吧少年">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f0017422.css" as="style"><link rel="preload" href="/blog/assets/js/app.d7ed97c7.js" as="script"><link rel="preload" href="/blog/assets/js/2.dec2e75d.js" as="script"><link rel="preload" href="/blog/assets/js/1.5b9e135c.js" as="script"><link rel="preload" href="/blog/assets/js/162.c0650f65.js" as="script"><link rel="preload" href="/blog/assets/js/20.badbb211.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cc7e09f3.js"><link rel="prefetch" href="/blog/assets/js/100.9b336fb7.js"><link rel="prefetch" href="/blog/assets/js/101.b3f26860.js"><link rel="prefetch" href="/blog/assets/js/102.eeb09b48.js"><link rel="prefetch" href="/blog/assets/js/103.295a03f7.js"><link rel="prefetch" href="/blog/assets/js/104.717a1120.js"><link rel="prefetch" href="/blog/assets/js/105.07d4a177.js"><link rel="prefetch" href="/blog/assets/js/106.b867c336.js"><link rel="prefetch" href="/blog/assets/js/107.30bc7c42.js"><link rel="prefetch" href="/blog/assets/js/108.483bd993.js"><link rel="prefetch" href="/blog/assets/js/109.76770490.js"><link rel="prefetch" href="/blog/assets/js/11.b60c9933.js"><link rel="prefetch" href="/blog/assets/js/110.c9a362b9.js"><link rel="prefetch" href="/blog/assets/js/111.437e19f6.js"><link rel="prefetch" href="/blog/assets/js/112.a97b06a0.js"><link rel="prefetch" href="/blog/assets/js/113.ad01063e.js"><link rel="prefetch" href="/blog/assets/js/114.a8f8f633.js"><link rel="prefetch" href="/blog/assets/js/115.028538b8.js"><link rel="prefetch" href="/blog/assets/js/116.9887f4cf.js"><link rel="prefetch" href="/blog/assets/js/117.cbe35c59.js"><link rel="prefetch" href="/blog/assets/js/118.09ac2f52.js"><link rel="prefetch" href="/blog/assets/js/119.e8238a8b.js"><link rel="prefetch" href="/blog/assets/js/12.c53283e7.js"><link rel="prefetch" href="/blog/assets/js/120.7f3948b9.js"><link rel="prefetch" href="/blog/assets/js/121.d562c136.js"><link rel="prefetch" href="/blog/assets/js/122.813f1055.js"><link rel="prefetch" href="/blog/assets/js/123.ed542f34.js"><link rel="prefetch" href="/blog/assets/js/124.ad28403f.js"><link rel="prefetch" href="/blog/assets/js/125.82ca87f4.js"><link rel="prefetch" href="/blog/assets/js/126.e4c25686.js"><link rel="prefetch" href="/blog/assets/js/127.cc3b25e8.js"><link rel="prefetch" href="/blog/assets/js/128.ded58ef7.js"><link rel="prefetch" href="/blog/assets/js/129.966c655a.js"><link rel="prefetch" href="/blog/assets/js/13.6bdc6b5d.js"><link rel="prefetch" href="/blog/assets/js/130.84505c68.js"><link rel="prefetch" href="/blog/assets/js/131.cec1f85b.js"><link rel="prefetch" href="/blog/assets/js/132.40001954.js"><link rel="prefetch" href="/blog/assets/js/133.2ebebd9b.js"><link rel="prefetch" href="/blog/assets/js/134.36c81557.js"><link rel="prefetch" href="/blog/assets/js/135.f1ec454a.js"><link rel="prefetch" href="/blog/assets/js/136.66c83721.js"><link rel="prefetch" href="/blog/assets/js/137.9f8b8dad.js"><link rel="prefetch" href="/blog/assets/js/138.988cd2bb.js"><link rel="prefetch" href="/blog/assets/js/139.2cf615e5.js"><link rel="prefetch" href="/blog/assets/js/14.c3201a23.js"><link rel="prefetch" href="/blog/assets/js/140.5c5eb828.js"><link rel="prefetch" href="/blog/assets/js/141.b51af892.js"><link rel="prefetch" href="/blog/assets/js/142.bfa62f8b.js"><link rel="prefetch" href="/blog/assets/js/143.3f55661b.js"><link rel="prefetch" href="/blog/assets/js/144.f9f516ff.js"><link rel="prefetch" href="/blog/assets/js/145.6f138c1a.js"><link rel="prefetch" href="/blog/assets/js/146.0535f35d.js"><link rel="prefetch" href="/blog/assets/js/147.aa51a883.js"><link rel="prefetch" href="/blog/assets/js/148.a4d9d839.js"><link rel="prefetch" href="/blog/assets/js/149.20920577.js"><link rel="prefetch" href="/blog/assets/js/15.a0b9e44e.js"><link rel="prefetch" href="/blog/assets/js/150.20d31db8.js"><link rel="prefetch" href="/blog/assets/js/151.8c8797d3.js"><link rel="prefetch" href="/blog/assets/js/152.d7f2d776.js"><link rel="prefetch" href="/blog/assets/js/153.e2cc8151.js"><link rel="prefetch" href="/blog/assets/js/154.f1652a62.js"><link rel="prefetch" href="/blog/assets/js/155.b19acae0.js"><link rel="prefetch" href="/blog/assets/js/156.e9c9ed76.js"><link rel="prefetch" href="/blog/assets/js/157.3253a5d0.js"><link rel="prefetch" href="/blog/assets/js/158.3f2ba030.js"><link rel="prefetch" href="/blog/assets/js/159.bd59b2f5.js"><link rel="prefetch" href="/blog/assets/js/16.491191e4.js"><link rel="prefetch" href="/blog/assets/js/160.1a686de4.js"><link rel="prefetch" href="/blog/assets/js/161.4e0b6f98.js"><link rel="prefetch" href="/blog/assets/js/163.ec3b78ac.js"><link rel="prefetch" href="/blog/assets/js/164.d21dfff7.js"><link rel="prefetch" href="/blog/assets/js/165.f930cb5f.js"><link rel="prefetch" href="/blog/assets/js/166.1144a3b5.js"><link rel="prefetch" href="/blog/assets/js/167.d9f85a7a.js"><link rel="prefetch" href="/blog/assets/js/168.196a44b6.js"><link rel="prefetch" href="/blog/assets/js/169.bf573f56.js"><link rel="prefetch" href="/blog/assets/js/17.89ec8c57.js"><link rel="prefetch" href="/blog/assets/js/170.9971d5ae.js"><link rel="prefetch" href="/blog/assets/js/171.35d1ba8d.js"><link rel="prefetch" href="/blog/assets/js/172.9bd9c064.js"><link rel="prefetch" href="/blog/assets/js/173.de70e5d2.js"><link rel="prefetch" href="/blog/assets/js/174.8888c1f8.js"><link rel="prefetch" href="/blog/assets/js/175.e6465260.js"><link rel="prefetch" href="/blog/assets/js/176.027707dc.js"><link rel="prefetch" href="/blog/assets/js/177.e066f5f3.js"><link rel="prefetch" href="/blog/assets/js/178.850415f0.js"><link rel="prefetch" href="/blog/assets/js/179.c11070c0.js"><link rel="prefetch" href="/blog/assets/js/18.b91f1411.js"><link rel="prefetch" href="/blog/assets/js/180.f67ffd4c.js"><link rel="prefetch" href="/blog/assets/js/181.8528bfeb.js"><link rel="prefetch" href="/blog/assets/js/182.54743558.js"><link rel="prefetch" href="/blog/assets/js/183.f7a6ea25.js"><link rel="prefetch" href="/blog/assets/js/184.1f5959df.js"><link rel="prefetch" href="/blog/assets/js/185.1d105f97.js"><link rel="prefetch" href="/blog/assets/js/186.77a337c1.js"><link rel="prefetch" href="/blog/assets/js/187.3bbd3ebb.js"><link rel="prefetch" href="/blog/assets/js/188.20d5d95a.js"><link rel="prefetch" href="/blog/assets/js/189.243f4482.js"><link rel="prefetch" href="/blog/assets/js/19.cb1f17c8.js"><link rel="prefetch" href="/blog/assets/js/190.2a570e90.js"><link rel="prefetch" href="/blog/assets/js/191.ebc7021d.js"><link rel="prefetch" href="/blog/assets/js/192.d64c7526.js"><link rel="prefetch" href="/blog/assets/js/193.afe5f5e6.js"><link rel="prefetch" href="/blog/assets/js/194.b39b2183.js"><link rel="prefetch" href="/blog/assets/js/195.7abe4d78.js"><link rel="prefetch" href="/blog/assets/js/196.fada8913.js"><link rel="prefetch" href="/blog/assets/js/197.6fbcf396.js"><link rel="prefetch" href="/blog/assets/js/198.4ff82464.js"><link rel="prefetch" href="/blog/assets/js/199.c1deed3a.js"><link rel="prefetch" href="/blog/assets/js/200.1748ffa7.js"><link rel="prefetch" href="/blog/assets/js/201.b1e95257.js"><link rel="prefetch" href="/blog/assets/js/202.7a52de85.js"><link rel="prefetch" href="/blog/assets/js/203.88138866.js"><link rel="prefetch" href="/blog/assets/js/204.e6d2f17b.js"><link rel="prefetch" href="/blog/assets/js/205.650b8efa.js"><link rel="prefetch" href="/blog/assets/js/206.11376430.js"><link rel="prefetch" href="/blog/assets/js/207.500b316a.js"><link rel="prefetch" href="/blog/assets/js/208.bddce877.js"><link rel="prefetch" href="/blog/assets/js/209.57413f4b.js"><link rel="prefetch" href="/blog/assets/js/21.bf0041b7.js"><link rel="prefetch" href="/blog/assets/js/210.a0a44e1e.js"><link rel="prefetch" href="/blog/assets/js/211.8e9ab64a.js"><link rel="prefetch" href="/blog/assets/js/212.17214657.js"><link rel="prefetch" href="/blog/assets/js/213.e33a2abb.js"><link rel="prefetch" href="/blog/assets/js/214.d53d39fa.js"><link rel="prefetch" href="/blog/assets/js/215.7d8e6a0e.js"><link rel="prefetch" href="/blog/assets/js/216.3407e98e.js"><link rel="prefetch" href="/blog/assets/js/217.55493374.js"><link rel="prefetch" href="/blog/assets/js/218.635334cf.js"><link rel="prefetch" href="/blog/assets/js/219.1c46332e.js"><link rel="prefetch" href="/blog/assets/js/22.48390d4f.js"><link rel="prefetch" href="/blog/assets/js/220.ebc569c6.js"><link rel="prefetch" href="/blog/assets/js/221.a859e2c2.js"><link rel="prefetch" href="/blog/assets/js/222.0c7fe13e.js"><link rel="prefetch" href="/blog/assets/js/223.7df0d70a.js"><link rel="prefetch" href="/blog/assets/js/224.5c5fb749.js"><link rel="prefetch" href="/blog/assets/js/225.e09e4d9d.js"><link rel="prefetch" href="/blog/assets/js/226.3043cac7.js"><link rel="prefetch" href="/blog/assets/js/227.4e115357.js"><link rel="prefetch" href="/blog/assets/js/23.35c4ba93.js"><link rel="prefetch" href="/blog/assets/js/24.cc3b12df.js"><link rel="prefetch" href="/blog/assets/js/25.632a83cc.js"><link rel="prefetch" href="/blog/assets/js/26.574f1fc1.js"><link rel="prefetch" href="/blog/assets/js/27.ee3c36ec.js"><link rel="prefetch" href="/blog/assets/js/28.2598e102.js"><link rel="prefetch" href="/blog/assets/js/29.6ed063e8.js"><link rel="prefetch" href="/blog/assets/js/3.cb0627fa.js"><link rel="prefetch" href="/blog/assets/js/30.c5bb1b3d.js"><link rel="prefetch" href="/blog/assets/js/31.6ae5d6bc.js"><link rel="prefetch" href="/blog/assets/js/32.63714a18.js"><link rel="prefetch" href="/blog/assets/js/33.0a98d657.js"><link rel="prefetch" href="/blog/assets/js/34.66a4b69e.js"><link rel="prefetch" href="/blog/assets/js/35.efc8ebcf.js"><link rel="prefetch" href="/blog/assets/js/36.28b482d2.js"><link rel="prefetch" href="/blog/assets/js/37.0c70a804.js"><link rel="prefetch" href="/blog/assets/js/38.7b2228d8.js"><link rel="prefetch" href="/blog/assets/js/39.2bc990cf.js"><link rel="prefetch" href="/blog/assets/js/4.cbb57fa7.js"><link rel="prefetch" href="/blog/assets/js/40.5be60d0e.js"><link rel="prefetch" href="/blog/assets/js/41.7524bbf0.js"><link rel="prefetch" href="/blog/assets/js/42.714adee0.js"><link rel="prefetch" href="/blog/assets/js/43.718a9ac3.js"><link rel="prefetch" href="/blog/assets/js/44.cdf11766.js"><link rel="prefetch" href="/blog/assets/js/45.b9f73462.js"><link rel="prefetch" href="/blog/assets/js/46.070617b5.js"><link rel="prefetch" href="/blog/assets/js/47.45dbd8ee.js"><link rel="prefetch" href="/blog/assets/js/48.a5d36e11.js"><link rel="prefetch" href="/blog/assets/js/49.03e700f2.js"><link rel="prefetch" href="/blog/assets/js/5.fe065607.js"><link rel="prefetch" href="/blog/assets/js/50.edafa678.js"><link rel="prefetch" href="/blog/assets/js/51.6e2290a8.js"><link rel="prefetch" href="/blog/assets/js/52.c109d7d5.js"><link rel="prefetch" href="/blog/assets/js/53.50675a1d.js"><link rel="prefetch" href="/blog/assets/js/54.0afdb68d.js"><link rel="prefetch" href="/blog/assets/js/55.f9013f21.js"><link rel="prefetch" href="/blog/assets/js/56.e7ca6c14.js"><link rel="prefetch" href="/blog/assets/js/57.8b42df8f.js"><link rel="prefetch" href="/blog/assets/js/58.7b68fa2c.js"><link rel="prefetch" href="/blog/assets/js/59.e276f401.js"><link rel="prefetch" href="/blog/assets/js/6.68cda050.js"><link rel="prefetch" href="/blog/assets/js/60.4add09d0.js"><link rel="prefetch" href="/blog/assets/js/61.0fe45890.js"><link rel="prefetch" href="/blog/assets/js/62.66b58176.js"><link rel="prefetch" href="/blog/assets/js/63.adc3ee7b.js"><link rel="prefetch" href="/blog/assets/js/64.590e5a37.js"><link rel="prefetch" href="/blog/assets/js/65.bfebad49.js"><link rel="prefetch" href="/blog/assets/js/66.281a5ac4.js"><link rel="prefetch" href="/blog/assets/js/67.3b13d2f2.js"><link rel="prefetch" href="/blog/assets/js/68.e53606db.js"><link rel="prefetch" href="/blog/assets/js/69.2059be22.js"><link rel="prefetch" href="/blog/assets/js/7.3b8d63a0.js"><link rel="prefetch" href="/blog/assets/js/70.c7774f34.js"><link rel="prefetch" href="/blog/assets/js/71.559dfdd3.js"><link rel="prefetch" href="/blog/assets/js/72.cbac4235.js"><link rel="prefetch" href="/blog/assets/js/73.aa1efffb.js"><link rel="prefetch" href="/blog/assets/js/74.de2cf5f9.js"><link rel="prefetch" href="/blog/assets/js/75.d9244242.js"><link rel="prefetch" href="/blog/assets/js/76.93d6b837.js"><link rel="prefetch" href="/blog/assets/js/77.c82da724.js"><link rel="prefetch" href="/blog/assets/js/78.4e6d4811.js"><link rel="prefetch" href="/blog/assets/js/79.0f4aac22.js"><link rel="prefetch" href="/blog/assets/js/80.6a6b99e8.js"><link rel="prefetch" href="/blog/assets/js/81.712bd61b.js"><link rel="prefetch" href="/blog/assets/js/82.181cda89.js"><link rel="prefetch" href="/blog/assets/js/83.7ab5ac5b.js"><link rel="prefetch" href="/blog/assets/js/84.6bbbb8d2.js"><link rel="prefetch" href="/blog/assets/js/85.4adfb728.js"><link rel="prefetch" href="/blog/assets/js/86.2121d070.js"><link rel="prefetch" href="/blog/assets/js/87.e8c62457.js"><link rel="prefetch" href="/blog/assets/js/88.93dd4fca.js"><link rel="prefetch" href="/blog/assets/js/89.a93de9cf.js"><link rel="prefetch" href="/blog/assets/js/90.d4170ea4.js"><link rel="prefetch" href="/blog/assets/js/91.9bc2590d.js"><link rel="prefetch" href="/blog/assets/js/92.e94d0ec0.js"><link rel="prefetch" href="/blog/assets/js/93.3f378b31.js"><link rel="prefetch" href="/blog/assets/js/94.b567445f.js"><link rel="prefetch" href="/blog/assets/js/95.708acdfa.js"><link rel="prefetch" href="/blog/assets/js/96.fe23b2db.js"><link rel="prefetch" href="/blog/assets/js/97.2301b9cf.js"><link rel="prefetch" href="/blog/assets/js/98.6c7c4ab4.js"><link rel="prefetch" href="/blog/assets/js/99.974edfb7.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.bd3cdb54.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f0017422.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="前端那些事儿" class="logo"> <span class="site-name can-hide">前端那些事儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/base/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/blog/devops/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/mobile/" class="nav-link">
  泛客户端
</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">
  架构与方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/jonny-wei/sushi-js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 寿司
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react/" aria-current="page" class="sidebar-link">React JSX</a></li><li><a href="/blog/react/warmup/react-component.html" aria-current="page" class="active sidebar-link">React 组件及通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/react/warmup/react-component.html#react-组件" class="sidebar-link">React 组件</a></li><li class="sidebar-sub-header"><a href="/blog/react/warmup/react-component.html#组件的强化方式" class="sidebar-link">组件的强化方式</a></li><li class="sidebar-sub-header"><a href="/blog/react/warmup/react-component.html#组件自定义内容处理" class="sidebar-link">组件自定义内容处理</a></li><li class="sidebar-sub-header"><a href="/blog/react/warmup/react-component.html#组件通信" class="sidebar-link">组件通信</a></li><li class="sidebar-sub-header"><a href="/blog/react/warmup/react-component.html#问题" class="sidebar-link">问题</a></li></ul></li><li><a href="/blog/react/warmup/react-state.html" class="sidebar-link">React State</a></li><li><a href="/blog/react/warmup/react-props.html" class="sidebar-link">React Props</a></li><li><a href="/blog/react/warmup/react-lifecycle.html" class="sidebar-link">React 生命周期</a></li><li><a href="/blog/react/warmup/react-ref.html" class="sidebar-link">React Ref</a></li><li><a href="/blog/react/warmup/react-context.html" class="sidebar-link">React Context</a></li><li><a href="/blog/react/warmup/react-css.html" class="sidebar-link">React 中 CSS 的模块化</a></li><li><a href="/blog/react/warmup/react-hoc.html" class="sidebar-link">React HOC</a></li><li><a href="/blog/react/warmup/react-render.html" class="sidebar-link">React 渲染优化</a></li><li><a href="/blog/react/warmup/react-router.html" class="sidebar-link">React Router</a></li><li><a href="/blog/react/warmup/react-redux.html" class="sidebar-link">React Rudex</a></li><li><a href="/blog/react/warmup/react-mobx.html" class="sidebar-link">React Mobx</a></li><li><a href="/blog/react/warmup/react-keepalive.html" class="sidebar-link">实现 KeepAlive</a></li><li><a href="/blog/react/warmup/react-state-v18.html" class="sidebar-link">V18 - Automatic Batching</a></li><li><a href="/blog/react/warmup/react-transition.html" class="sidebar-link">V18 - Transition</a></li><li><a href="/blog/react/warmup/react-suspense.html" class="sidebar-link">V18 - Suspense</a></li><li><a href="/blog/react/warmup/react-useSyncExternalStore.html" class="sidebar-link">V18 - useSyncExternalStore</a></li><li><a href="/blog/react/warmup/react-ssr.html" class="sidebar-link">V18 - Streaming SSR</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React源码解析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react/react/react-reconciler.html" class="sidebar-link">Reconciler 调和器</a></li><li><a href="/blog/react/react/react-priority.html" class="sidebar-link">React 优先级管理</a></li><li><a href="/blog/react/react/react-scheduler.html" class="sidebar-link">Scheduler 调度器</a></li><li><a href="/blog/react/react/react-render.html" class="sidebar-link">Render 阶段</a></li><li><a href="/blog/react/react/react-commit.html" class="sidebar-link">Commit 阶段</a></li><li><a href="/blog/react/react/react-diff.html" class="sidebar-link">React Diff 算法</a></li><li><a href="/blog/react/react/react-hooks.html" class="sidebar-link">React Hooks 理解</a></li><li><a href="/blog/react/react/react-context.html" class="sidebar-link">React Context 原理</a></li><li><a href="/blog/react/react/react-event.html" class="sidebar-link">React 事件系统</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-组件及通信"><a href="#react-组件及通信" class="header-anchor">#</a> React 组件及通信</h1> <p><strong>React 组件本质</strong>：UI + update + 常规的类和函数 = React 组件。组件承载了渲染视图的 UI 和更新视图的 setState 、 useState 等方法。React 在底层逻辑上会像正常实例化类和正常执行函数那样处理的组件。Component 加入 updater, 通过 updater 控制 state 和更新视图。组件的数据结构本质是一个函数或者类，当你使用元素标签的方式进行调用时，函数或者类会被执行，最终返回一个 React 元素。</p> <h2 id="react-组件"><a href="#react-组件" class="header-anchor">#</a> React 组件</h2> <ul><li>类（ Class ）组件</li> <li>函数（ Function ）组件</li></ul> <p>组件本质上就是类和函数，但是与常规的类和函数不同的是，组件承载了渲染视图的 UI 和更新视图的 setState 、 useState 等方法。React 在底层逻辑上会像正常实例化类和正常执行函数那样处理的组件。因此，函数与类上的特性在 React 组件上同样具有，比如原型链，继承，静态属性等，所以不要把 React 组件和类与函数独立开来。</p> <h3 id="react-对组件的处理流程"><a href="#react-对组件的处理流程" class="header-anchor">#</a> React 对组件的处理流程</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 类组件的执行</span>
<span class="token keyword">function</span> <span class="token function">constructClassInstance</span><span class="token punctuation">(</span>
    workInProgress<span class="token punctuation">,</span> <span class="token comment">// 当前正在工作的 fiber 对象</span>
    ctor<span class="token punctuation">,</span>           <span class="token comment">// 我们的类组件</span>
    props           <span class="token comment">// props </span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">/* 实例化组件，得到组件实例 instance */</span>
     <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//函数组件的执行</span>
<span class="token keyword">function</span> <span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
  current<span class="token punctuation">,</span>          <span class="token comment">// 当前函数组件对应的 `fiber`， 初始化</span>
  workInProgress<span class="token punctuation">,</span>   <span class="token comment">// 当前正在工作的 fiber 对象</span>
  Component<span class="token punctuation">,</span>        <span class="token comment">// 我们函数组件</span>
  props<span class="token punctuation">,</span>            <span class="token comment">// 函数组件第一个参数 props</span>
  secondArg<span class="token punctuation">,</span>        <span class="token comment">// 函数组件其他参数</span>
  nextRenderExpirationTime<span class="token punctuation">,</span> <span class="token comment">//下次渲染过期时间</span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">/* 执行我们的函数组件，得到 return 返回的 React.element 对象 */</span>
     <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">Component</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> secondArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="类组件"><a href="#类组件" class="header-anchor">#</a> 类组件</h3> <p>在 class 组件中，除了继承 React.Component ，底层还加入了 updater 对象，组件中调用的 setState 和 forceUpdate 本质上是调用了 updater 对象上的 enqueueSetState 和 enqueueForceUpdate 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * Base class helpers for the updating state of a component.
 */</span>
<span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context<span class="token punctuation">,</span> updater</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>      <span class="token comment">//绑定props</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>  <span class="token comment">//绑定context</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>refs <span class="token operator">=</span> emptyObject<span class="token punctuation">;</span> <span class="token comment">//绑定ref</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater <span class="token operator">=</span> updater <span class="token operator">||</span> ReactNoopUpdateQueue<span class="token punctuation">;</span> <span class="token comment">//上面所属的 updater 对象</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 绑定 setState 方法 */</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">partialState<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partialState<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'setState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 绑定 forceUpdate 方法 */</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueForceUpdate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'forceUpdate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Component 底层 React 的处理逻辑是，类组件执行构造函数过程中会在实例上绑定 props 和 context ，初始化置空 refs 属性，原型链上绑定 setState、forceUpdate 方法。对于 updater，React 在实例化类组件之后会单独绑定 update 对象。</p> <p>如果没有在 constructor 的 super 函数中传递 props，那么接下来 constructor 执行上下文中就获取不到 props ，这是为什么呢？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 假设我们在 constructor 中这么写 */</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token comment">// 打印 undefined 为什么?</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 解决问题 */</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>刚才的 Component 源码已经说得明明白白了，绑定 props 是在父类 Component 构造函数中，执行 super 等于执行 Component 函数，此时 props 没有作为第一个参数传给 super() ，在 Component 中就会找不到 props 参数，从而变成 undefined ，在接下来 constructor 代码中打印 props 为 undefined</p> <p>为了更好地使用 React 类组件，我们首先看一下类组件各个部分的功能:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token punctuation">)</span>                        <span class="token comment">/* 执行 react 底层 Component 函数 */</span>
    <span class="token punctuation">}</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                              <span class="token comment">/* state */</span>
    <span class="token keyword">static</span> number <span class="token operator">=</span> <span class="token number">1</span>                       <span class="token comment">/* 内置静态属性 */</span>
    <span class="token function-variable function">handleClick</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>     <span class="token comment">/* 方法： 箭头函数方法直接绑定在this实例上 */</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token comment">/* 生命周期 */</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Index<span class="token punctuation">.</span>number<span class="token punctuation">,</span>Index<span class="token punctuation">.</span>number1<span class="token punctuation">)</span> <span class="token comment">// 打印 1 , 2 </span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                               <span class="token comment">/* 渲染函数 */</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'50px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handerClick <span class="token punctuation">}</span>  <span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>React<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Index<span class="token punctuation">.</span>number1 <span class="token operator">=</span> <span class="token number">2</span>                           <span class="token comment">/* 外置静态属性 */</span>
<span class="token class-name">Index</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span> <span class="token comment">/* 方法: 绑定在 Index 原型链的 方法*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上述绑定了两个 handleClick ，那么点击 div 之后会打印什么呢？结果是 111 。因为在 class 类内部，箭头函数是直接绑定在实例对象上的，而第二个 handleClick 是绑定在 prototype 原型链上的，它们的优先级是：实例对象上方法属性 &gt; 原型链对象上方法属性。</p> <p>对于 pureComponent 会在 <a href="/blog/react/warmup/react-render.html#react-渲染控制">React 渲染优化</a>，详细探讨。</p> <h3 id="函数组件"><a href="#函数组件" class="header-anchor">#</a> 函数组件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Index<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token comment">// 打印 1 </span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> message <span class="token punctuation">,</span> setMessage  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'hello,world'</span><span class="token punctuation">)</span> <span class="token comment">/* hooks  */</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">'let us learn React!'</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span> <span class="token operator">&gt;</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token comment">/* 返回值 作为 ui*/</span>
 <span class="token punctuation">}</span>
 Index<span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">/* 绑定静态属性 */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>不要尝试给函数组件 prototype 绑定属性或方法，即使绑定了也没有任何作用，因为通过上面源码中 React 对函数组件的调用，是采用直接执行函数的方式，而不是通过 new 的方式。</p> <p>那么，<strong>函数组件和类组件本质的区别</strong>是什么呢？</p> <p>对于类组件来说，底层只需要实例化一次，实例中保存了组件的 state 等状态。对于每一次更新只需要调用 render 方法以及对应的生命周期就可以了。但是在函数组件中，每一次更新都是一次新的函数执行，一次函数组件的更新，里面的变量会重新声明。为了能让函数组件可以保存一些状态，执行一些副作用钩子，React Hooks 应运而生，它可以帮助记录 React 中组件的状态，处理一些额外的副作用。</p> <h2 id="组件的强化方式"><a href="#组件的强化方式" class="header-anchor">#</a> 组件的强化方式</h2> <h3 id="类组件继承"><a href="#类组件继承" class="header-anchor">#</a> 类组件继承</h3> <p>对于类组件的强化，首先想到的是继承方式，开源项目 react-keepalive-router 就是通过继承 React-Router 中的 Switch 和 Router ，来达到缓存页面的功能的。因为 React 中类组件，有良好的继承属性，所以可以针对一些基础组件，首先实现一部分基础功能，再针对项目要求进行有方向的改造、强化、添加额外功能。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 人类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello , i am person'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/* 吃饭 */</span> <span class="token punctuation">}</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">/* 睡觉 */</span>  <span class="token punctuation">}</span>
    <span class="token function">ddd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打豆豆'</span><span class="token punctuation">)</span>  <span class="token comment">/* 打豆豆 */</span> <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            大家好，我是一个person
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 程序员 */</span>
<span class="token keyword">class</span> <span class="token class-name">Programmer</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello , i am Programmer too'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>
    <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* 敲代码 */</span> <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'50px'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>
            <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token comment">/* 让 Person 中的 render 执行 */</span> <span class="token punctuation">}</span>
            我还是一个程序员！    <span class="token punctuation">{</span> <span class="token comment">/* 添加自己的内容 */</span> <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Programmer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>类继承优势如下：</p> <ul><li>可以控制父类 render，还可以添加一些其他的渲染内容；</li> <li>可以共享父类方法，还可以添加额外的方法和属性。</li></ul> <p>但是也有值得注意的地方，就是 state 和生命周期会被继承后的组件修改。像上述 demo 中，Person 组件中的 componentDidMount 生命周期将不会被执行。</p> <h3 id="函数组件自定义-hooks"><a href="#函数组件自定义-hooks" class="header-anchor">#</a> 函数组件自定义 Hooks</h3> <p>在 React hooks 章节，会详细介绍自定义 hooks 的原理。<a href="/blog/react/react/react-hooks.html">React Hooks 理解</a></p> <h3 id="hoc高阶组件"><a href="#hoc高阶组件" class="header-anchor">#</a> HOC高阶组件</h3> <p>在 HOC 章节，会详细介绍高阶组件 HOC 。<a href="/blog/react/warmup/react-hoc.html">React HOC</a></p> <h2 id="组件自定义内容处理"><a href="#组件自定义内容处理" class="header-anchor">#</a> 组件自定义内容处理</h2> <p>举个例子，我们实现了一个 Modal 组件，有确定按钮，有取消按钮，但 Modal 展示的内容为了更加灵活，我们提供了一个 props 属性，用户可以自定义一个组件传入其中，用户提供什么，Modal 就展示什么，Modal 相当于一个容器，那么，我们该怎么实现这个功能呢？</p> <h3 id="props-方式"><a href="#props-方式" class="header-anchor">#</a> props 方式</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Modal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>content<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">确定</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">取消</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">CustomContent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">content</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CustomContent</span></span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>根据前面的知识，我们可以知道，<code>content</code> 属性这里传入的其实是一个 React 元素，所以 Modal 组件的内部是用 <code>{}</code> 进行渲染。</p> <h3 id="function-方式"><a href="#function-方式" class="header-anchor">#</a> function 方式</h3> <p>但第一种方式，并不总能解决需求。有的时候，我们可能会用到组件内部的值。就比如一个倒计时组件 <code>Timer</code>，依然提供了一个属性 <code>content</code>，用于自定义时间的展示样式，时间由 <code>Timer</code> 组件内部处理，展示样式则完全由用户自定义，在这种时候，我们就可以选择传入一个组件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">content</span><span class="token operator">:</span> Content<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> changeTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">changeTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>time<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Content time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">CustomContent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>time<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>


<span class="token operator">&lt;</span>Timer content<span class="token operator">=</span><span class="token punctuation">{</span>CustomContent<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在这个示例中，我们可以看到 <code>content</code> 属性传入的是一个 React 组件 CustomContent，而 CustomContent 组件会被传入 time 属性，我们正是基于这个约定进行的 CustomContent 组件的开发。而 Timer 组件内部，因为传入的是组件，所以使用的是 <code>&lt;Content time={time}/&gt;</code>进行的渲染。</p> <h3 id="render-props-方式"><a href="#render-props-方式" class="header-anchor">#</a> render props 方式</h3> <p>在面对第二种实现方式的需求时，除了上面这种实现方式，还有一种称为 <code>render props</code> 的技巧，比第二种方式更常见一些，我们依然以 Timer 组件为例：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>renderContent<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> changeTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">changeTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>time<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 这里直接调用传入的 renderContent 函数</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token function">renderContent</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">CustomContent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>time<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px solid #ccc'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Timer renderContent<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>CustomContent time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>鉴于我们传入的是一个函数，我们把 <code>content</code> 属性名改为了 <code>renderContent</code>，其实叫什么都可以。<code>renderContent</code> 传入了一个函数，该函数接收 <code>time</code> 作为参数，返回一个 React 元素，而在 <code>Timer</code> 内部，我们直接执行了 renderContent 函数，并传入内部处理好的 time 参数，由此实现了用户使用组件内部值自定义渲染内容。</p> <p>多说一句，除了放到属性里，我们也可以放到 children 里，是一样的：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token function">children</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token operator">&lt;</span>Timer<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>CustomContent time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Timer<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="组件通信"><a href="#组件通信" class="header-anchor">#</a> 组件通信</h2> <p>React 一共有 5 种主流的通信方式：</p> <ul><li>props 和 callback 方式</li> <li>event bus 事件总线</li> <li>ref 方式</li> <li>React-redux 或 React-mobx 等状态管理方式</li> <li>context 上下文方式</li></ul> <h3 id="props-和-callback-方式"><a href="#props-和-callback-方式" class="header-anchor">#</a> props 和 callback 方式</h3> <p>props 和 callback 可以作为 React 组件最基本的通信方式，父组件可以通过 props 将信息传递给子组件，子组件可以通过执行 props 中的回调函数 callback 来触发父组件的方法，实现父与子的消息通讯。</p> <ul><li>父组件 -&gt; 通过自身 state 改变，重新渲染，传递 props -&gt; 通知子组件</li> <li>子组件 -&gt; 通过调用父组件 props 方法 -&gt; 通知父组件。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 子组件 */</span>
<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>  fatherSay <span class="token punctuation">,</span> sayFather  <span class="token punctuation">}</span> <span class="token operator">=</span> props
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'son'</span> <span class="token operator">&gt;</span>
         我是子组件
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 父组件对我说：<span class="token punctuation">{</span> fatherSay <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;我对父组件说&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">sayFather</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 父组件 */</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> childSay <span class="token punctuation">,</span> setChildSay <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> fatherSay <span class="token punctuation">,</span> setFatherSay <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box father&quot;</span> <span class="token operator">&gt;</span>
        我是父组件
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 子组件对我说：<span class="token punctuation">{</span> childSay <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;我对子组件说&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">setFatherSay</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>Son fatherSay<span class="token operator">=</span><span class="token punctuation">{</span>fatherSay<span class="token punctuation">}</span>  sayFather<span class="token operator">=</span><span class="token punctuation">{</span> setChildSay <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="event-bus-事件总线"><a href="#event-bus-事件总线" class="header-anchor">#</a> event bus 事件总线</h3> <p>当然利用 eventBus 也可以实现组件通信，但是在 React 中并不提倡用这种方式，我还是更提倡用 props 方式通信。如果说非要用 eventBus，我觉得它更适合用 React 做基础构建的小程序，比如 Taro。接下来将上述 demo 通过 eventBus 方式进行改造。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BusService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./eventBus'</span>
<span class="token comment">/* event Bus  */</span>
<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> fatherSay <span class="token punctuation">,</span> setFatherSay <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
        BusService<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'fatherSay'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token comment">/* 事件绑定 , 给父组件绑定事件 */</span>
            <span class="token function">setFatherSay</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  BusService<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'fatherSay'</span><span class="token punctuation">)</span> <span class="token comment">/* 解绑事件 */</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'son'</span> <span class="token operator">&gt;</span>
         我是子组件
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 父组件对我说：<span class="token punctuation">{</span> fatherSay <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;我对父组件说&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> BusService<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'childSay'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 父组件 */</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> childSay <span class="token punctuation">,</span> setChildSay <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    <span class="token comment">/* 事件绑定 , 给子组件绑定事件 */</span>
        BusService<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'childSay'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
             <span class="token function">setChildSay</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  BusService<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'childSay'</span><span class="token punctuation">)</span> <span class="token comment">/* 解绑事件 */</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box father&quot;</span> <span class="token operator">&gt;</span>
        我是父组件
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 子组件对我说：<span class="token punctuation">{</span> childSay <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;我对子组件说&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> BusService<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'fatherSay'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>Son  <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>这样做不仅达到了和使用 props 同样的效果，还能跨层级，不会受到 React 父子组件层级的影响。但是为什么很多人都不推荐这种方式呢？因为它有一些致命缺点。</p> <ul><li>需要手动绑定和解绑。</li> <li>对于小型项目还好，但是对于中大型项目，这种方式的组件通信，会造成牵一发动全身的影响，而且后期难以维护，组件之间的状态也是未知的。</li> <li>一定程度上违背了 React 数据流向原则。</li></ul> <h3 id="ref-实现组件通信"><a href="#ref-实现组件通信" class="header-anchor">#</a> ref 实现组件通信</h3> <p>如果有种场景不想通过父组件 render 改变 props 的方式，来触发子组件的更新，也就是子组件通过 state 单独管理数据层，针对这种情况父组件可以通过 ref 模式标记子组件实例，从而操纵子组件方法，这种情况通常发生在一些数据层托管的组件上，比如 <code>&lt;Form/&gt;</code> 表单，经典案例可以参考 antd 里面的 form 表单，暴露出对外的 resetFields ， setFieldsValue 等接口，可以通过表单实例调用这些 API 。</p> <ol><li>类组件 ref</li> <li>函数组件 forwardRef + useImperativeHandle</li></ol> <h4 id="_1-类组件-ref"><a href="#_1-类组件-ref" class="header-anchor">#</a> 1. 类组件 ref</h4> <p>对于类组件可以通过 ref 直接获取组件实例，实现组件通信。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 子组件 */</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span><span class="token punctuation">{</span>
    state<span class="token operator">=</span><span class="token punctuation">{</span>
       <span class="token literal-property property">fatherMes</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
       <span class="token literal-property property">sonMes</span><span class="token operator">:</span><span class="token string">''</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">fatherSay</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">fatherMes</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fatherMes  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">/* 提供给父组件的API */</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> fatherMes<span class="token punctuation">,</span> sonMes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;sonbox&quot;</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span> <span class="token operator">&gt;</span>子组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>父组件对我说：<span class="token punctuation">{</span> fatherMes <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;label&quot;</span> <span class="token operator">&gt;</span>对父组件说<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>input  onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">sonMes</span><span class="token operator">:</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>   className<span class="token operator">=</span><span class="token string">&quot;input&quot;</span>  <span class="token operator">/</span><span class="token operator">&gt;</span> 
            <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">&quot;searchbtn&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">toFather</span><span class="token punctuation">(</span>sonMes<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token operator">&gt;</span>to father<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 父组件 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> sonMes <span class="token punctuation">,</span> setSonMes <span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> 
    <span class="token keyword">const</span> sonInstance <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">/* 用来获取子组件实例 */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> fatherMes <span class="token punctuation">,</span> setFatherMes <span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">toSon</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> sonInstance<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">fatherSay</span><span class="token punctuation">(</span>fatherMes<span class="token punctuation">)</span> <span class="token comment">/* 调用子组件实例方法，改变子组件state */</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span> <span class="token operator">&gt;</span>父组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>子组件对我说：<span class="token punctuation">{</span> sonMes <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;label&quot;</span> <span class="token operator">&gt;</span>对子组件说<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setFatherMes</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>  className<span class="token operator">=</span><span class="token string">&quot;input&quot;</span>  <span class="token operator">/</span><span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">&quot;searchbtn&quot;</span>  onClick<span class="token operator">=</span><span class="token punctuation">{</span>toSon<span class="token punctuation">}</span>  <span class="token operator">&gt;</span>to son<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Son ref<span class="token operator">=</span><span class="token punctuation">{</span>sonInstance<span class="token punctuation">}</span> toFather<span class="token operator">=</span><span class="token punctuation">{</span>setSonMes<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ol><li>子组件暴露方法 fatherSay 供父组件使用，父组件通过调用方法可以设置子组件展示内容。</li> <li>父组件提供给子组件 toFather，子组件调用，改变父组件展示内容，实现父 &lt;-&gt; 子 双向通信。</li></ol> <h4 id="_2-函数组件-forwardref-useimperativehandle"><a href="#_2-函数组件-forwardref-useimperativehandle" class="header-anchor">#</a> 2. 函数组件 forwardRef + useImperativeHandle</h4> <p>对于函数组件，本身是没有实例的，但是 React Hooks 提供了 useImperativeHandle 其第一个参数接受父组件传递的 ref 对象，第二个参数是一个函数，函数返回值，作为 ref 对象获取的内容。</p> <p>useImperativeHandle 则是用来自定义暴露给父组件的 ref 对象。它通常与 forwardRef 一起使用，让你可以控制子组件暴露给父组件的哪些方法和值。通过 useImperativeHandle，你可以返回一个对象，该对象包含子组件想要暴露给父组件的方法和属性。useImperativeHandle 接受三个参数：</p> <ul><li>第一个参数 ref：接受 forwardRef 传递过来的 ref 。</li> <li>第二个参数 createHandle：处理函数，返回值作为暴露给父组件的 ref 对象。</li> <li>第三个参数 deps：依赖项 deps，依赖项更改形成新的 ref 对象。</li></ul> <p>forwardRef 是一个高阶函数，它接受一个函数组件或类组件，并返回一个新的组件。这个新的组件在渲染时会接收一个额外的 ref 参数，并将其传递给子组件 <code>fatherRef.current = sonRef.current</code>，组件通过 ref 就可以直接访问这些节点或组件。如果需要自定义 ref 的行为，可以使用 useImperativeHandle。forwardRef + useImperativeHandle 可以完全让函数组件也能流畅的使用 Ref 通信。其原理图如下所示：</p> <p><img src="/blog/images/react/ref4.png" alt="ref4"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子组件</span>
<span class="token keyword">function</span> <span class="token function">Son</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> inputValue <span class="token punctuation">,</span> setInputValue <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token keyword">const</span> handleRefs <span class="token operator">=</span> <span class="token punctuation">{</span>
           <span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token comment">/* 声明方法用于聚焦input框 */</span>
              inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token function">onChangeValue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">/* 声明方法用于改变input的值 */</span>
               <span class="token function">setInputValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> handleRefs
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;请输入内容&quot;</span>  ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span>  value<span class="token operator">=</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ForwardSon <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>Son<span class="token punctuation">)</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    sonInstance <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function">handlerClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">const</span> <span class="token punctuation">{</span> onFocus <span class="token punctuation">,</span> onChangeValue <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sonInstance
       <span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 让子组件的输入框获取焦点</span>
       <span class="token function">onChangeValue</span><span class="token punctuation">(</span><span class="token string">'let us learn React!'</span><span class="token punctuation">)</span> <span class="token comment">// 让子组件input  </span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'50px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ForwardSon ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">cur</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sonInstance <span class="token operator">=</span> cur<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handlerClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>操控子组件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ul><li>父组件用 ref 标记子组件，由于子组件 Son 是函数组件没有实例，所以用 forwardRef 转发 ref。</li> <li>子组件 Son 用 useImperativeHandle 接收父组件 ref，将让 input 聚焦的方法 onFocus 和 改变 input 输入框的值的方法 onChangeValue 传递给 ref 。</li> <li>父组件可以通过调用 ref 下的 onFocus 和 onChangeValue 控制子组件中 input 赋值和聚焦。</li></ul> <p>关于 React Ref 的其他用法和原理详见 <a href="/blog/react/warmup/react-ref.html">React Ref 章节</a></p> <h3 id="状态管理库通信"><a href="#状态管理库通信" class="header-anchor">#</a> 状态管理库通信</h3> <p>关于状态管理库的组件通信方式及其原理详见以下章节：</p> <ul><li><a href="/blog/react/warmup/react-redux.html">React Rudex</a></li> <li><a href="/blog/react/warmup/react-mobx.html">React Mobx</a></li></ul> <h3 id="context-通信"><a href="#context-通信" class="header-anchor">#</a> Context 通信</h3> <p>关于 context 的组件通信方式及其原理详见以下章节：</p> <ul><li><a href="/blog/react/warmup/react-context.html">React Context</a></li> <li><a href="/blog/react/react/react-context.html">React Context 原理</a></li></ul> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <h3 id="q1-无状态组件和有状态组件"><a href="#q1-无状态组件和有状态组件" class="header-anchor">#</a> Q1. 无状态组件和有状态组件</h3> <h4 id="无状态组件"><a href="#无状态组件" class="header-anchor">#</a> 无状态组件</h4> <p>无状态组件（Stateless Component）是最基础的组件形式，由于没有状态的影响所以就是纯静态展示的作用。一般来说，各种 UI 库里也是最开始会开发的组件类别。如按钮、标签、输入框等。它的基本组成结构就是属性（props）加上一个渲染函数（render）。由于不涉及到状态的更新，所以这种组件的复用性也最强。</p> <p><strong>特点：</strong></p> <ul><li>只负责接收 <code>props</code>，渲染 DOM，可以是类组件或者函数组件。组件内部不维护 state ，只根据外部组件传入的 props 进行渲染的组件，当 props 改变时，组件重新渲染。</li> <li>没有 <code>state</code>，不依赖自身的状态 state。</li> <li>不能访问生命周期方法</li> <li>不需要声明类：可以避免 <code>extends</code> 或 <code>constructor</code> 之类的代码，语法上更加简洁。</li> <li>不会被实例化：因此不能直接传 <code>ref</code>（可以使用 <code>React.forwardRef</code> 包装后再传 <code>ref</code>）。</li> <li>不需要显示声明 <code>this</code> 关键字：在 ES6 的类声明中往往需要将函数的 <code>this</code> 关键字绑定到当前作用域，而因为函数式声明的特性，我们不需要再强制绑定。可以完全避免使用 this 关键字。（由于使用的是箭头函数事件无需绑定）。</li> <li>更好的性能表现：因为函数式组件中并不需要进行生命周期的管理与状态管理，因此React并不需要进行某些特定的检查或者内存分配，从而保证了更好地性能表现。当不需要使用生命周期钩子时，应该首先使用无状态函数组件。</li></ul> <p><strong>使用场景：</strong></p> <ul><li>组件不需要管理 state，纯展示</li></ul> <p><strong>优点：</strong></p> <ul><li>简化代码、专注于 render</li> <li>组件不需要被实例化，无生命周期，提升性能。 输出（渲染）只取决于输入（属性），无副作用</li> <li>视图和数据的解耦分离</li></ul> <p><strong>缺点：</strong></p> <ul><li>无法使用 ref</li> <li>无生命周期方法</li> <li>无法控制组件的重渲染，因为无法使用 <code>shouldComponentUpdate</code> 方法，当组件接受到新的属性时则会重渲染</li></ul> <p><strong>总结：</strong> 对于像 <code>&lt;Button /&gt;</code>、<code>&lt;Input /&gt;</code>这样的组件，如果它们只是基于 props 渲染 UI，而不包含自己的状态逻辑，应该优先设计为函数组件。使用函数组件可以减少代码量，提高性能，因为它们更轻量级。对于无状态组件，可以使用 React.memo 进行包装，以避免不必要的渲染。</p> <h4 id="有状态组件"><a href="#有状态组件" class="header-anchor">#</a> 有状态组件</h4> <p>在无状态组件的基础上，如果组件内部包含状态且状态随着事件或者外部的消息而发生改变的时候，这就构成了有状态组件（Stateful Component）。有状态组件通常会带有生命周期（Lifecycle），用以在不同的时刻触发状态的更新。这种组件也是通常在写业务逻辑中最经常使用到的，根据不同的业务场景组件的状态数量以及生命周期机制也不尽相同。</p> <p><strong>特点：</strong></p> <ul><li>是类组件或带有 hooks 的函数组件</li> <li>有继承</li> <li>可以使用 this</li> <li>可以使用 react 的生命周期</li> <li>使用较多，容易频繁触发生命周期钩子函数，影响性能</li> <li>内部使用 state，维护自身状态的变化，有状态组件根据外部组件传入的 props 和自身的 state 进行渲染。</li></ul> <p><strong>使用场景：</strong></p> <ul><li>需要使用到状态的。</li> <li>需要使用状态操作组件的（无状态组件的也可以实现新版本 react hooks 也可实现）</li></ul> <p><strong>总结：</strong> 类组件可以维护自身的状态变量，即组件的 state ，类组件还有不同的生命周期方法，可以让开发者能够在组件的不同阶段（挂载、更新、卸载），对组件做更多的控制。类组件则既可以充当无状态组件，也可以充当有状态组件。当一个类组件不需要管理自身状态时，也可称为无状态组件。</p> <h3 id="q2-受控组件和非控组件"><a href="#q2-受控组件和非控组件" class="header-anchor">#</a> Q2. 受控组件和非控组件</h3> <h4 id="受控组件"><a href="#受控组件" class="header-anchor">#</a> 受控组件</h4> <p>在使用表单来收集用户输入时，例如<code>&lt;input&gt;&lt;select&gt;&lt;textearea&gt;</code>等元素都要绑定一个 <code>change</code> 事件，当表单的状态发生变化，就会触发 <code>onChange</code> 事件，更新组件的 <code>state</code>。这种组件在 React 中被称为<strong>受控组件</strong>。在受控组件中，组件渲染出的状态与它的<code>value</code>或 <code>checked</code> 等属性相对应，react 通过这种方式消除了组件的局部状态，使整个状态可控。react 官方推荐使用受控表单组件。</p> <p>受控组件更新 <code>state</code> 的流程：</p> <ul><li>可以通过初始 <code>state</code> 中设置表单的默认值</li> <li>每当表单的值发生变化时，调用 <code>onChange</code> 事件处理器</li> <li>事件处理器通过事件对象<code>e</code> 拿到改变后的状态，并更新组件的 <code>state</code></li> <li>一旦通过 <code>setState</code> 方法更新 <code>state</code>，就会触发视图的重新渲染，完成表单组件的更新</li></ul> <p>受控组件<strong>缺陷</strong>：表单元素的值都是由 React 组件进行管理，当有多个输入框，或者多个这种组件时，如果想同时获取到全部的值就必须每个都要编写事件处理函数，这会让代码看着很臃肿，所以为了解决这种情况，出现了非受控组件。</p> <h4 id="非受控组件"><a href="#非受控组件" class="header-anchor">#</a> 非受控组件</h4> <p>如果一个表单组件没有 <code>value props</code>（单选和复选按钮对应的是<code>checked props</code>）时，就可以称为<strong>非受控组件</strong>。在非受控组件中，可以使用一个 <code>ref</code>来从 <code>DOM</code> 获得表单值。而不是为每个状态更新编写一个事件处理程序。</p> <p>React官方的解释：</p> <blockquote><p>要编写一个非受控组件，而不是为每个状态更新都编写数据处理函数，你可以使用 ref 来从 DOM 节点中获取表单数据。 因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p></blockquote> <p>例如，下面的代码在非受控组件中接收单个属性：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">NameForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSubmit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'A name was submitted: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span>
          <span class="token literal-property property">Name</span><span class="token operator">:</span>
          <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> input<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Submit&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>总结：</strong> 页面中所有输入类的 DOM 如果是现用现取的称为<strong>非受控组件</strong>，而通过 <code>setState</code> 将输入的值维护到了 <code>state</code> 中，需要时再从<code>state</code> 中取出，这里的数据就受到了 <code>state</code> 的控制，称为<strong>受控组件</strong>。</p> <h3 id="q3-react-组件的通信方式有哪些"><a href="#q3-react-组件的通信方式有哪些" class="header-anchor">#</a> Q3. React 组件的通信方式有哪些？</h3> <ul><li>父子通信：<code>props/props callback</code>，<code>context</code>，<code>ref</code>，<code>event bus</code>，<code>状态管理库</code>。</li> <li>兄弟通信：<code>event bus</code>，<code>公共父组件 context</code>，<code>状态管理库</code></li> <li>隔代（跨级）通信：<code>event bus</code>，<code>context</code>,<code>状态管理库</code></li></ul> <h3 id="q4-函数组件和类组件本质的区别是什么"><a href="#q4-函数组件和类组件本质的区别是什么" class="header-anchor">#</a> Q4. 函数组件和类组件本质的区别是什么？</h3> <p>对于类组件来说，底层只需要实例化一次，实例中保存了组件的 state 等状态。对于每一次更新只需要调用 render 方法以及对应的生命周期就可以了。但是在函数组件中，每一次更新都是一次新的函数执行，一次函数组件的更新，里面的变量会重新声明。为了能让函数组件可以保存一些状态，执行一些副作用钩子，React Hooks 应运而生，它可以帮助记录 React 中组件的状态，处理一些额外的副作用。</p> <p><a href="https://juejin.cn/post/6914464070506643470#heading-14" target="_blank" rel="noopener noreferrer">React 组件通信<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/react/" class="prev router-link-active">
        React JSX
      </a></span> <span class="next"><a href="/blog/react/warmup/react-state.html">
        React State
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----><!----></div></div>
    <script src="/blog/assets/js/app.d7ed97c7.js" defer></script><script src="/blog/assets/js/2.dec2e75d.js" defer></script><script src="/blog/assets/js/1.5b9e135c.js" defer></script><script src="/blog/assets/js/162.c0650f65.js" defer></script><script src="/blog/assets/js/20.badbb211.js" defer></script>
  </body>
</html>
